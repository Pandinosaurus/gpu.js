{"version":3,"file":"gpu-browser-core.min.js","sources":["../node_modules/gpu-mock.js/index.js","../src/common.js","../src/input.js","../src/texture.js","../src/utils.js","../src/backend/kernel.js","../src/backend/function-builder.js","../src/backend/function-tracer.js","../src/backend/function-node.js","../src/backend/cpu/function-node.js","../src/backend/cpu/kernel.js","../src/backend/cpu/kernel-string.js","../src/backend/gl/texture/float.js","../src/backend/gl/texture/array-2-float.js","../src/backend/gl/texture/array-2-float-2d.js","../src/backend/gl/texture/array-2-float-3d.js","../src/backend/gl/texture/array-3-float.js","../src/backend/gl/texture/array-3-float-2d.js","../src/backend/gl/texture/array-3-float-3d.js","../src/backend/gl/texture/array-4-float.js","../src/backend/gl/texture/array-4-float-2d.js","../src/backend/gl/texture/array-4-float-3d.js","../src/backend/gl/texture/float-2d.js","../src/backend/gl/texture/float-3d.js","../src/backend/gl/texture/memory-optimized.js","../src/backend/gl/texture/memory-optimized-2d.js","../src/backend/gl/texture/memory-optimized-3d.js","../src/backend/gl/texture/unsigned.js","../src/backend/gl/texture/unsigned-2d.js","../src/backend/gl/texture/unsigned-3d.js","../src/backend/gl/texture/graphical.js","../src/backend/gl/kernel.js","../src/backend/web-gl/function-node.js","../src/plugins/triangle-noise.js","../src/backend/web-gl/fragment-shader.js","../src/backend/web-gl/vertex-shader.js","../node_modules/gl-wiretap/index.js","../src/backend/gl/kernel-string.js","../src/backend/kernel-value.js","../src/backend/web-gl/kernel-value/index.js","../src/backend/web-gl/kernel-value/boolean.js","../src/backend/web-gl/kernel-value/float.js","../src/backend/web-gl/kernel-value/integer.js","../src/backend/web-gl/kernel-value/html-image.js","../src/backend/web-gl/kernel-value/dynamic-html-image.js","../src/backend/web-gl/kernel-value/html-video.js","../src/backend/web-gl/kernel-value/dynamic-html-video.js","../src/backend/web-gl/kernel-value/single-input.js","../src/backend/web-gl/kernel-value/unsigned-input.js","../src/backend/web-gl/kernel-value/dynamic-unsigned-input.js","../src/backend/web-gl/kernel-value/memory-optimized-number-texture.js","../src/backend/web-gl/kernel-value/dynamic-memory-optimized-number-texture.js","../src/backend/web-gl/kernel-value/number-texture.js","../src/backend/web-gl/kernel-value/dynamic-number-texture.js","../src/backend/web-gl/kernel-value/single-array.js","../src/backend/web-gl/kernel-value/dynamic-single-array.js","../src/backend/web-gl/kernel-value/single-array1d-i.js","../src/backend/web-gl/kernel-value/dynamic-single-array1d-i.js","../src/backend/web-gl/kernel-value/single-array2d-i.js","../src/backend/web-gl/kernel-value/dynamic-single-array2d-i.js","../src/backend/web-gl/kernel-value/single-array3d-i.js","../src/backend/web-gl/kernel-value/dynamic-single-array3d-i.js","../src/backend/web-gl/kernel-value/single-array2.js","../src/backend/web-gl/kernel-value/single-array3.js","../src/backend/web-gl/kernel-value/single-array4.js","../src/backend/web-gl/kernel-value/unsigned-array.js","../src/backend/web-gl/kernel-value/dynamic-unsigned-array.js","../src/backend/web-gl/kernel-value-maps.js","../src/backend/web-gl/kernel-value/dynamic-single-input.js","../src/backend/web-gl/kernel.js","../src/backend/web-gl2/function-node.js","../src/backend/web-gl2/fragment-shader.js","../src/backend/web-gl2/vertex-shader.js","../src/backend/web-gl2/kernel-value/boolean.js","../src/backend/web-gl2/kernel-value/float.js","../src/backend/web-gl2/kernel-value/integer.js","../src/backend/web-gl2/kernel-value/html-image.js","../src/backend/web-gl2/kernel-value/dynamic-html-image.js","../src/backend/web-gl2/kernel-value/html-image-array.js","../src/backend/web-gl2/kernel-value/dynamic-html-image-array.js","../src/backend/web-gl2/kernel-value/html-video.js","../src/backend/web-gl2/kernel-value/dynamic-html-video.js","../src/backend/web-gl2/kernel-value/single-input.js","../src/backend/web-gl2/kernel-value/dynamic-memory-optimized-number-texture.js","../src/backend/web-gl2/kernel-value/number-texture.js","../src/backend/web-gl2/kernel-value/dynamic-number-texture.js","../src/backend/web-gl2/kernel-value/single-array.js","../src/backend/web-gl2/kernel-value/single-array1d-i.js","../src/backend/web-gl2/kernel-value/dynamic-single-array1d-i.js","../src/backend/web-gl2/kernel-value/single-array2d-i.js","../src/backend/web-gl2/kernel-value/dynamic-single-array2d-i.js","../src/backend/web-gl2/kernel-value/single-array3d-i.js","../src/backend/web-gl2/kernel-value/dynamic-single-array3d-i.js","../src/backend/web-gl2/kernel-value/single-array2.js","../src/backend/web-gl2/kernel-value/single-array3.js","../src/backend/web-gl2/kernel-value/single-array4.js","../src/backend/web-gl2/kernel-value-maps.js","../src/backend/web-gl2/kernel-value/dynamic-unsigned-array.js","../src/backend/web-gl2/kernel-value/dynamic-unsigned-input.js","../src/backend/web-gl2/kernel-value/unsigned-array.js","../src/backend/web-gl2/kernel-value/unsigned-input.js","../src/backend/web-gl2/kernel-value/dynamic-single-array.js","../src/backend/web-gl2/kernel-value/dynamic-single-input.js","../src/backend/web-gl2/kernel-value/memory-optimized-number-texture.js","../src/backend/web-gl2/kernel.js","../src/kernel-run-shortcut.js","../src/base-gpu.js","../src/browser.js","../src/alias.js"],"sourcesContent":["function setupArguments(args) {\n  const newArguments = new Array(args.length);\n  for (let i = 0; i < args.length; i++) {\n    const arg = args[i];\n    if (arg.toArray) {\n      newArguments[i] = arg.toArray();\n    } else {\n      newArguments[i] = arg;\n    }\n  }\n  return newArguments;\n}\n\nfunction mock1D() {\n  const args = setupArguments(arguments);\n  const row = new Float32Array(this.output.x);\n  for (let x = 0; x < this.output.x; x++) {\n    this.thread.x = x;\n    this.thread.y = 0;\n    this.thread.z = 0;\n    row[x] = this._fn.apply(this, args);\n  }\n  return row;\n}\n\nfunction mock2D() {\n  const args = setupArguments(arguments);\n  const matrix = new Array(this.output.y);\n  for (let y = 0; y < this.output.y; y++) {\n    const row = new Float32Array(this.output.x);\n    for (let x = 0; x < this.output.x; x++) {\n      this.thread.x = x;\n      this.thread.y = y;\n      this.thread.z = 0;\n      row[x] = this._fn.apply(this, args);\n    }\n    matrix[y] = row;\n  }\n  return matrix;\n}\n\nfunction mock2DGraphical() {\n  const args = setupArguments(arguments);\n  for (let y = 0; y < this.output.y; y++) {\n    for (let x = 0; x < this.output.x; x++) {\n      this.thread.x = x;\n      this.thread.y = y;\n      this.thread.z = 0;\n      this._fn.apply(this, args);\n    }\n  }\n}\n\nfunction mock3D() {\n  const args = setupArguments(arguments);\n  const cube = new Array(this.output.z);\n  for (let z = 0; z < this.output.z; z++) {\n    const matrix = new Array(this.output.y);\n    for (let y = 0; y < this.output.y; y++) {\n      const row = new Float32Array(this.output.x);\n      for (let x = 0; x < this.output.x; x++) {\n        this.thread.x = x;\n        this.thread.y = y;\n        this.thread.z = z;\n        row[x] = this._fn.apply(this, args);\n      }\n      matrix[y] = row;\n    }\n    cube[z] = matrix;\n  }\n  return cube;\n}\n\nfunction apiDecorate(kernel) {\n  kernel.setOutput = (output) => {\n    kernel.output = setupOutput(output);\n    if (kernel.graphical) {\n      setupGraphical(kernel);\n    }\n  };\n  kernel.toJSON = () => {\n    throw new Error('Not usable with gpuMock');\n  };\n  kernel.setConstants = (flag) => {\n    kernel.constants = flag;\n    return kernel;\n  };\n  kernel.setGraphical = (flag) => {\n    kernel.graphical = flag;\n    return kernel;\n  };\n  kernel.setCanvas = (flag) => {\n    kernel.canvas = flag;\n    return kernel;\n  };\n  kernel.setContext = (flag) => {\n    kernel.context = flag;\n    return kernel;\n  };\n  kernel.exec = function() {\n    return new Promise((resolve, reject) => {\n      try {\n        resolve(kernel.apply(kernel, arguments));\n      } catch(e) {\n        reject(e);\n      }\n    });\n  };\n  kernel.getPixels = (flip) => {\n    const {x, y} = kernel.output;\n    // cpu is not flipped by default\n    return flip ? flipPixels(kernel._imageData.data, x, y) : kernel._imageData.data.slice(0);\n  };\n  kernel.color = function(r, g, b, a) {\n    if (typeof a === 'undefined') {\n      a = 1;\n    }\n\n    r = Math.floor(r * 255);\n    g = Math.floor(g * 255);\n    b = Math.floor(b * 255);\n    a = Math.floor(a * 255);\n\n    const width = kernel.output.x;\n    const height = kernel.output.y;\n\n    const x = kernel.thread.x;\n    const y = height - kernel.thread.y - 1;\n\n    const index = x + y * width;\n\n    kernel._colorData[index * 4 + 0] = r;\n    kernel._colorData[index * 4 + 1] = g;\n    kernel._colorData[index * 4 + 2] = b;\n    kernel._colorData[index * 4 + 3] = a;\n  };\n\n  // these are added for api compatibility, but have no affect\n  kernel.setWarnVarUsage = () => {\n    return kernel;\n  };\n  kernel.setOptimizeFloatMemory = () => {\n    return kernel;\n  };\n  kernel.setArgumentTypes = () => {\n    return kernel;\n  };\n  kernel.setDebug = () => {\n    return kernel;\n  };\n  kernel.setLoopMaxIterations = () => {\n    return kernel;\n  };\n  kernel.setPipeline = () => {\n    return kernel;\n  };\n  kernel.setPrecision = () => {\n    return kernel;\n  };\n  kernel.setImmutable = () => {\n    return kernel;\n  };\n  kernel.setFunctions = () => {\n    return kernel;\n  };\n  kernel.addSubKernel = () => {\n    return kernel;\n  };\n  kernel.destroy = () => {};\n  kernel.validateSettings = () => {};\n  if (kernel.graphical && kernel.output) {\n    setupGraphical(kernel);\n  }\n  return kernel;\n}\n\nfunction setupGraphical(kernel) {\n  const {x, y} = kernel.output;\n  if (kernel.context && kernel.context.createImageData) {\n    const data = new Uint8ClampedArray(x * y * 4);\n    kernel._imageData = kernel.context.createImageData(x, y);\n    kernel._colorData = data;\n  } else {\n    const data = new Uint8ClampedArray(x * y * 4);\n    kernel._imageData = { data };\n    kernel._colorData = data;\n  }\n}\n\nfunction setupOutput(output) {\n  let result = null;\n  if (output.length) {\n    if (output.length === 3) {\n      const [x,y,z] = output;\n      result = { x, y, z };\n    } else if (output.length === 2) {\n      const [x,y] = output;\n      result = { x, y };\n    } else {\n      const [x] = output;\n      result = { x };\n    }\n  } else {\n    result = output;\n  }\n  return result;\n}\n\nfunction gpuMock(fn, settings = {}) {\n  const output = settings.output ? setupOutput(settings.output) : null;\n  function kernel() {\n    if (kernel.output.z) {\n      return mock3D.apply(kernel, arguments);\n    } else if (kernel.output.y) {\n      if (kernel.graphical) {\n        return mock2DGraphical.apply(kernel, arguments);\n      }\n      return mock2D.apply(kernel, arguments);\n    } else {\n      return mock1D.apply(kernel, arguments);\n    }\n  }\n  kernel._fn = fn;\n  kernel.constants = settings.constants || null;\n  kernel.context = settings.context || null;\n  kernel.canvas = settings.canvas || null;\n  kernel.graphical = settings.graphical || false;\n  kernel._imageData = null;\n  kernel._colorData = null;\n  kernel.output = output;\n  kernel.thread = {\n    x: 0,\n    y: 0,\n    z: 0\n  };\n  return apiDecorate(kernel);\n}\n\nfunction flipPixels(pixels, width, height) {\n  // https://stackoverflow.com/a/41973289/1324039\n  const halfHeight = height / 2 | 0; // the | 0 keeps the result an int\n  const bytesPerRow = width * 4;\n  // make a temp buffer to hold one row\n  const temp = new Uint8ClampedArray(width * 4);\n  const result = pixels.slice(0);\n  for (let y = 0; y < halfHeight; ++y) {\n    const topOffset = y * bytesPerRow;\n    const bottomOffset = (height - y - 1) * bytesPerRow;\n\n    // make copy of a row on the top half\n    temp.set(result.subarray(topOffset, topOffset + bytesPerRow));\n\n    // copy a row from the bottom half to the top\n    result.copyWithin(topOffset, bottomOffset, bottomOffset + bytesPerRow);\n\n    // copy the copy of the top half row to the bottom half\n    result.set(temp, bottomOffset);\n  }\n  return result;\n}\n\nmodule.exports = {\n  gpuMock\n};\n","/**\r\n * @fileoverview Branch of utils to prevent circular dependencies.\r\n */\r\n\r\nconst ARGUMENT_NAMES = /([^\\s,]+)/g;\r\nconst FUNCTION_NAME = /function ([^(]*)/;\r\nconst STRIP_COMMENTS = /((\\/\\/.*$)|(\\/\\*[\\s\\S]*?\\*\\/))/mg;\r\n\r\n/**\r\n * @descReturn TRUE, on a JS function\r\n * @param {Function} funcObj - Object to validate if its a function\r\n * @returns  {Boolean} TRUE if the object is a JS function\r\n */\r\nexport function isFunction(funcObj) {\r\n  return typeof(funcObj) === 'function';\r\n};\r\n\r\n/**\r\n * @desc Return the function name from a JS function string\r\n * @param {String} funcStr - String of JS function to validate\r\n * @returns {String} Function name string (if found)\r\n */\r\nexport function getFunctionNameFromString(funcStr) {\r\n  return FUNCTION_NAME.exec(funcStr)[1].trim();\r\n};\r\n\r\n/**\r\n *\r\n * @param {String|Function} source\r\n * @param {IFunctionSettings} [settings]\r\n * @returns {IFunction}\r\n */\r\nexport function functionToIFunction(source, settings) {\r\n  settings = settings || {};\r\n  if (typeof source !== 'string' && typeof source !== 'function') throw new Error('source not a string or function');\r\n  const sourceString = typeof source === 'string' ? source : source.toString();\r\n\r\n  let argumentTypes = [];\r\n\r\n  if (Array.isArray(settings.argumentTypes)) {\r\n    argumentTypes = settings.argumentTypes;\r\n  } else if (typeof settings.argumentTypes === 'object') {\r\n    argumentTypes = getArgumentNamesFromString(sourceString)\r\n      .map(name => settings.argumentTypes[name]) || [];\r\n  } else {\r\n    argumentTypes = settings.argumentTypes || [];\r\n  }\r\n\r\n  return {\r\n    source: sourceString,\r\n    argumentTypes,\r\n    returnType: settings.returnType || null,\r\n  };\r\n};\r\n\r\nexport function warnDeprecated(type, oldName, newName) {\r\n  const msg = newName\r\n    ? `It has been replaced with \"${ newName }\"`\r\n    : 'It has been removed';\r\n  console.warn(`You are using a deprecated ${ type } \"${ oldName }\". ${msg}. Fixing, but please upgrade as it will soon be removed.`)\r\n};\r\n\r\n/**\r\n * @desc Return TRUE, on a valid JS function string\r\n * Note: This does just a VERY simply sanity check. And may give false positives.\r\n *\r\n * @param {String} fn - String of JS function to validate\r\n * @returns {Boolean} TRUE if the string passes basic validation\r\n */\r\nexport function isFunctionString(fn) {\r\n  if (typeof fn === 'string') {\r\n    return (fn\r\n      .slice(0, 'function'.length)\r\n      .toLowerCase() === 'function');\r\n  }\r\n  return false;\r\n};\r\n\r\n/**\r\n * @desc Return list of argument names extracted from a javascript function\r\n * @param {String} fn - String of JS function to validate\r\n * @returns {String[]}  Array representing all the parameter names\r\n */\r\nexport function getArgumentNamesFromString(fn) {\r\n  const fnStr = fn.replace(STRIP_COMMENTS, '');\r\n  let result = fnStr.slice(fnStr.indexOf('(') + 1, fnStr.indexOf(')')).match(ARGUMENT_NAMES);\r\n  if (result === null) {\r\n    result = [];\r\n  }\r\n  return result;\r\n};\r\n\r\n/**\r\n * @desc Checks if is an array or Array-like object\r\n * @param {Object} array - The argument object to check if is array\r\n * @returns {Boolean}  true if is array or Array-like object\r\n */\r\nexport function isArray(array) {\r\n  return !isNaN(array.length);\r\n};\r\n\r\nexport function erectMemoryOptimized2DFloat(array, width, height) {\r\n  const yResults = new Array(height);\r\n  for (let y = 0; y < height; y++) {\r\n    const offset = y * width;\r\n    yResults[y] = array.subarray(offset, offset + width);\r\n  }\r\n  return yResults;\r\n};\r\n\r\nexport function erectMemoryOptimized3DFloat(array, width, height, depth) {\r\n  const zResults = new Array(depth);\r\n  for (let z = 0; z < depth; z++) {\r\n    const yResults = new Array(height);\r\n    for (let y = 0; y < height; y++) {\r\n      const offset = (z * height * width) + (y * width);\r\n      yResults[y] = array.subarray(offset, offset + width);\r\n    }\r\n    zResults[z] = yResults;\r\n  }\r\n  return zResults;\r\n};\r\n\r\nexport function getAstString(source, ast) {\r\n  const lines = Array.isArray(source) ? source : source.split(/\\r?\\n/g);\r\n  const start = ast.loc.start;\r\n  const end = ast.loc.end;\r\n  const result = [];\r\n  if (start.line === end.line) {\r\n    result.push(lines[start.line - 1].substring(start.column, end.column));\r\n  } else {\r\n    result.push(lines[start.line - 1].slice(start.column));\r\n    for (let i = start.line; i < end.line; i++) {\r\n      result.push(lines[i]);\r\n    }\r\n    result.push(lines[end.line - 1].slice(0, end.column));\r\n  }\r\n  return result.join('\\n');\r\n};\r\n","import { erectMemoryOptimized2DFloat, erectMemoryOptimized3DFloat } from './common';\r\n\r\nexport class Input {\r\n  constructor(value, size) {\r\n    this.value = value;\r\n    if (Array.isArray(size)) {\r\n      this.size = size;\r\n    } else {\r\n      this.size = new Int32Array(3);\r\n      if (size.z) {\r\n        this.size = new Int32Array([size.x, size.y, size.z]);\r\n      } else if (size.y) {\r\n        this.size = new Int32Array([size.x, size.y]);\r\n      } else {\r\n        this.size = new Int32Array([size.x]);\r\n      }\r\n    }\r\n\r\n    const [w, h, d] = this.size;\r\n    if (d) {\r\n      if (this.value.length !== (w * h * d)) {\r\n        throw new Error(`Input size ${this.value.length} does not match ${w} * ${h} * ${d} = ${(h * w * d)}`);\r\n      }\r\n    } else if (h) {\r\n      if (this.value.length !== (w * h)) {\r\n        throw new Error(`Input size ${this.value.length} does not match ${w} * ${h} = ${(h * w)}`);\r\n      }\r\n    } else {\r\n      if (this.value.length !== w) {\r\n        throw new Error(`Input size ${this.value.length} does not match ${w}`);\r\n      }\r\n    }\r\n\r\n  }\r\n\r\n  toArray() {\r\n    const [ w, h, d ] = this.size;\r\n    if (d) {\r\n      return erectMemoryOptimized3DFloat(this.value.subarray ? this.value : new Float32Array(this.value), w, h, d);\r\n    } else if (h) {\r\n      return erectMemoryOptimized2DFloat(this.value.subarray ? this.value : new Float32Array(this.value), w, h);\r\n    } else {\r\n      return this.value;\r\n    }\r\n  }\r\n};\r\n\r\nexport function input(value, size) {\r\n  return new Input(value, size);\r\n};\r\n","/**\r\n * @desc WebGl Texture implementation in JS\r\n * @param {ITextureSettings} settings\r\n */\r\nexport class Texture {\r\n  constructor(settings) {\r\n    const {\r\n      texture,\r\n      size,\r\n      dimensions,\r\n      output,\r\n      context,\r\n      type = 'NumberTexture',\r\n    } = settings;\r\n    if (!output) throw new Error('settings property \"output\" required.');\r\n    if (!context) throw new Error('settings property \"context\" required.');\r\n    this.texture = texture;\r\n    this.size = size;\r\n    this.dimensions = dimensions;\r\n    this.output = output;\r\n    this.context = context;\r\n    this.kernel = null;\r\n    this.type = type;\r\n  }\r\n\r\n  /**\r\n   * @desc Converts the Texture into a JavaScript Array\r\n   * @returns {Number[]|Number[][]|Number[][][]}\r\n   */\r\n  toArray() {\r\n    throw new Error(`Not implemented on ${this.constructor.name}`);\r\n  }\r\n\r\n  /**\r\n   * @desc Deletes the Texture\r\n   */\r\n  delete() {\r\n    return this.context.deleteTexture(this.texture);\r\n  }\r\n};\r\n","import { parse } from 'acorn';\r\nimport { Texture } from './texture';\r\nimport { Input } from './input';\r\nimport {\r\n  getAstString,\r\n  erectMemoryOptimized2DFloat,\r\n  erectMemoryOptimized3DFloat,\r\n  functionToIFunction,\r\n  getArgumentNamesFromString,\r\n  getFunctionNameFromString,\r\n  isArray,\r\n  isFunction,\r\n  isFunctionString,\r\n  warnDeprecated\r\n} from './common';\r\n\r\nexport function getSystemEndianness() {\r\n  const b = new ArrayBuffer(4);\r\n  const a = new Uint32Array(b);\r\n  const c = new Uint8Array(b);\r\n  a[0] = 0xdeadbeef;\r\n  if (c[0] === 0xef) return 'LE';\r\n  if (c[0] === 0xde) return 'BE';\r\n  throw new Error('unknown endianness');\r\n};\r\n\r\nconst _systemEndianness = getSystemEndianness();\r\n\r\n/**\r\n *\r\n * @desc Gets the system endianness, and cache it\r\n * @returns {String} 'LE' or 'BE' depending on system architecture\r\n * Credit: https://gist.github.com/TooTallNate/4750953\r\n */\r\nexport function systemEndianness() {\r\n  return _systemEndianness;\r\n};\r\n\r\n/**\r\n * @desc Evaluate the argument type, to apply respective logic for it\r\n * @param {Object} value - The argument object to evaluate type\r\n * @returns {String}  Argument type Array/Number/Float/Texture/Unknown\r\n */\r\nexport function getVariableType(value, strictIntegers) {\r\n  if (isArray(value)) {\r\n    if (value[0].nodeName === 'IMG') {\r\n      return 'HTMLImageArray';\r\n    }\r\n    return 'Array';\r\n  }\r\n\r\n  switch (value.constructor) {\r\n    case Boolean:\r\n      return 'Boolean';\r\n    case Number:\r\n      return strictIntegers && Number.isInteger(value) ? 'Integer' : 'Float';\r\n    case Texture:\r\n      return value.type;\r\n    case Input:\r\n      return 'Input';\r\n  }\r\n\r\n  switch (value.nodeName) {\r\n    case 'IMG':\r\n      return 'HTMLImage';\r\n    case 'VIDEO':\r\n      return 'HTMLVideo';\r\n  }\r\n\r\n  return value.hasOwnProperty('type') ? value.type : 'Unknown';\r\n};\r\n\r\n/**\r\n * @desc Various utility functions / snippets of code that GPU.JS uses internally.\r\n * This covers various snippets of code that is not entirely gpu.js specific (ie. may find uses elsewhere)\r\n */\r\nconst utils = {\r\n  systemEndianness,\r\n  getSystemEndianness,\r\n  isFunction,\r\n  isFunctionString,\r\n  getFunctionNameFromString,\r\n\r\n  getFunctionBodyFromString(funcStr) {\r\n    return funcStr.substring(funcStr.indexOf('{') + 1, funcStr.lastIndexOf('}'));\r\n  },\r\n\r\n  getArgumentNamesFromString,\r\n\r\n  /**\r\n   * @desc Returns a clone\r\n   * @param {Object} obj - Object to clone\r\n   * @returns {Object|Array} Cloned object\r\n   */\r\n  clone(obj) {\r\n    if (obj === null || typeof obj !== 'object' || obj.hasOwnProperty('isActiveClone')) return obj;\r\n\r\n    const temp = obj.constructor(); // changed\r\n\r\n    for (let key in obj) {\r\n      if (Object.prototype.hasOwnProperty.call(obj, key)) {\r\n        obj.isActiveClone = null;\r\n        temp[key] = utils.clone(obj[key]);\r\n        delete obj.isActiveClone;\r\n      }\r\n    }\r\n\r\n    return temp;\r\n  },\r\n\r\n  isArray,\r\n  getVariableType,\r\n\r\n  getKernelTextureSize(settings, dimensions) {\r\n    let [w, h, d] = dimensions;\r\n    let texelCount = (w || 1) * (h || 1) * (d || 1);\r\n\r\n    if (settings.optimizeFloatMemory && settings.precision === 'single') {\r\n      w = texelCount = Math.ceil(texelCount / 4);\r\n    }\r\n    // if given dimensions == a 2d image\r\n    if (h > 1 && w * h === texelCount) {\r\n      return new Int32Array([w, h]);\r\n    }\r\n    return utils.closestSquareDimensions(texelCount);\r\n  },\r\n\r\n  /**\r\n   *\r\n   * @param {Number} length\r\n   * @returns {TextureDimensions}\r\n   */\r\n  closestSquareDimensions(length) {\r\n    const sqrt = Math.sqrt(length);\r\n    let high = Math.ceil(sqrt);\r\n    let low = Math.floor(sqrt);\r\n    while (high * low < length) {\r\n      high--;\r\n      low = Math.ceil(length / high);\r\n    }\r\n    return new Int32Array([low, Math.ceil(length / low)]);\r\n  },\r\n\r\n  /**\r\n   * A texture takes up four\r\n   * @param {OutputDimensions} dimensions\r\n   * @param {Number} bitRatio\r\n   * @returns {TextureDimensions}\r\n   */\r\n  getMemoryOptimizedFloatTextureSize(dimensions, bitRatio) {\r\n    const totalArea = utils.roundTo((dimensions[0] || 1) * (dimensions[1] || 1) * (dimensions[2] || 1) * (dimensions[3] || 1), 4);\r\n    const texelCount = totalArea / bitRatio;\r\n    return utils.closestSquareDimensions(texelCount);\r\n  },\r\n\r\n  /**\r\n   *\r\n   * @param dimensions\r\n   * @param bitRatio\r\n   * @returns {*|TextureDimensions}\r\n   */\r\n  getMemoryOptimizedPackedTextureSize(dimensions, bitRatio) {\r\n    const [w, h, d] = dimensions;\r\n    const totalArea = utils.roundTo((w || 1) * (h || 1) * (d || 1), 4);\r\n    const texelCount = totalArea / (4 / bitRatio);\r\n    return utils.closestSquareDimensions(texelCount);\r\n  },\r\n\r\n  roundTo(n, d) {\r\n    return Math.floor((n + d - 1) / d) * d;\r\n  },\r\n  /**\r\n   * @desc Return the dimension of an array.\r\n   * @param {Array|String|Texture|Input} x - The array\r\n   * @param {Boolean} [pad] - To include padding in the dimension calculation\r\n   * @returns {OutputDimensions}\r\n   */\r\n  getDimensions(x, pad) {\r\n    let ret;\r\n    if (isArray(x)) {\r\n      const dim = [];\r\n      let temp = x;\r\n      while (isArray(temp)) {\r\n        dim.push(temp.length);\r\n        temp = temp[0];\r\n      }\r\n      ret = dim.reverse();\r\n    } else if (x instanceof Texture) {\r\n      ret = x.output;\r\n    } else if (x instanceof Input) {\r\n      ret = x.size;\r\n    } else {\r\n      throw new Error(`Unknown dimensions of ${x}`);\r\n    }\r\n\r\n    if (pad) {\r\n      ret = Array.from(ret);\r\n      while (ret.length < 3) {\r\n        ret.push(1);\r\n      }\r\n    }\r\n\r\n    return new Int32Array(ret);\r\n  },\r\n\r\n  /**\r\n   * Puts a nested 2d array into a one-dimensional target array\r\n   * @param {Array|*} array\r\n   * @param {Float32Array|Float64Array} target\r\n   */\r\n  flatten2dArrayTo(array, target) {\r\n    let offset = 0;\r\n    for (let y = 0; y < array.length; y++) {\r\n      target.set(array[y], offset);\r\n      offset += array[y].length;\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Puts a nested 3d array into a one-dimensional target array\r\n   * @param {Array|*} array\r\n   * @param {Float32Array|Float64Array} target\r\n   */\r\n  flatten3dArrayTo(array, target) {\r\n    let offset = 0;\r\n    for (let z = 0; z < array.length; z++) {\r\n      for (let y = 0; y < array[z].length; y++) {\r\n        target.set(array[z][y], offset);\r\n        offset += array[z][y].length;\r\n      }\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Puts a nested 4d array into a one-dimensional target array\r\n   * @param {Array|*} array\r\n   * @param {Float32Array|Float64Array} target\r\n   */\r\n  flatten4dArrayTo(array, target) {\r\n    let offset = 0;\r\n    for (let l = 0; l < array.length; l++) {\r\n      for (let z = 0; z < array[l].length; z++) {\r\n        for (let y = 0; y < array[l][z].length; y++) {\r\n          target.set(array[l][z][y], offset);\r\n          offset += array[l][z][y].length;\r\n        }\r\n      }\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Puts a nested 1d, 2d, or 3d array into a one-dimensional target array\r\n   * @param {Float32Array|Uint16Array|Uint8Array} array\r\n   * @param {Float32Array} target\r\n   */\r\n  flattenTo(array, target) {\r\n    if (isArray(array[0])) {\r\n      if (isArray(array[0][0])) {\r\n        if (isArray(array[0][0][0])) {\r\n          utils.flatten4dArrayTo(array, target);\r\n        } else {\r\n          utils.flatten3dArrayTo(array, target);\r\n        }\r\n      } else {\r\n        utils.flatten2dArrayTo(array, target);\r\n      }\r\n    } else {\r\n      target.set(array);\r\n    }\r\n  },\r\n\r\n  /**\r\n   *\r\n   * @desc Splits an array into smaller arrays.\r\n   * Number of elements in one small chunk is given by `part`\r\n   *\r\n   * @param {Number[]} array - The array to split into chunks\r\n   * @param {Number} part - elements in one chunk\r\n   *\r\n   * @returns {Number[]} An array of smaller chunks\r\n   */\r\n  splitArray(array, part) {\r\n    const result = [];\r\n    for (let i = 0; i < array.length; i += part) {\r\n      result.push(new array.constructor(array.buffer, i * 4 + array.byteOffset, part));\r\n    }\r\n    return result;\r\n  },\r\n\r\n  getAstString,\r\n\r\n  allPropertiesOf(obj) {\r\n    const props = [];\r\n\r\n    do {\r\n      props.push.apply(props, Object.getOwnPropertyNames(obj));\r\n    } while (obj = Object.getPrototypeOf(obj));\r\n\r\n    return props;\r\n  },\r\n\r\n  /**\r\n   * @param {Array} lines - An Array of strings\r\n   * @returns {String} Single combined String, separated by *\\n*\r\n   */\r\n  linesToString(lines) {\r\n    if (lines.length > 0) {\r\n      return lines.join(';\\n') + ';\\n';\r\n    } else {\r\n      return '\\n';\r\n    }\r\n  },\r\n\r\n  warnDeprecated,\r\n  functionToIFunction,\r\n\r\n  flipPixels(pixels, width, height) {\r\n    // https://stackoverflow.com/a/41973289/1324039\r\n    const halfHeight = height / 2 | 0; // the | 0 keeps the result an int\r\n    const bytesPerRow = width * 4;\r\n    // make a temp buffer to hold one row\r\n    const temp = new Uint8ClampedArray(width * 4);\r\n    const result = pixels.slice(0);\r\n    for (let y = 0; y < halfHeight; ++y) {\r\n      const topOffset = y * bytesPerRow;\r\n      const bottomOffset = (height - y - 1) * bytesPerRow;\r\n\r\n      // make copy of a row on the top half\r\n      temp.set(result.subarray(topOffset, topOffset + bytesPerRow));\r\n\r\n      // copy a row from the bottom half to the top\r\n      result.copyWithin(topOffset, bottomOffset, bottomOffset + bytesPerRow);\r\n\r\n      // copy the copy of the top half row to the bottom half\r\n      result.set(temp, bottomOffset);\r\n    }\r\n    return result;\r\n  },\r\n\r\n  erectPackedFloat: (array, width) => {\r\n    return array.subarray(0, width);\r\n  },\r\n  erect2DPackedFloat: (array, width, height) => {\r\n    const yResults = new Array(height);\r\n    for (let y = 0; y < height; y++) {\r\n      const xStart = y * width;\r\n      const xEnd = xStart + width;\r\n      yResults[y] = array.subarray(xStart, xEnd);\r\n    }\r\n    return yResults;\r\n  },\r\n  erect3DPackedFloat: (array, width, height, depth) => {\r\n    const zResults = new Array(depth);\r\n    for (let z = 0; z < depth; z++) {\r\n      const yResults = new Array(height);\r\n      for (let y = 0; y < height; y++) {\r\n        const xStart = (z * height * width) + y * width;\r\n        const xEnd = xStart + width;\r\n        yResults[y] = array.subarray(xStart, xEnd);\r\n      }\r\n      zResults[z] = yResults;\r\n    }\r\n    return zResults;\r\n  },\r\n  erectMemoryOptimizedFloat: (array, width) => {\r\n    return array.subarray(0, width);\r\n  },\r\n  erectMemoryOptimized2DFloat,\r\n  erectMemoryOptimized3DFloat,\r\n  erectFloat: (array, width) => {\r\n    const xResults = new Float32Array(width);\r\n    let i = 0;\r\n    for (let x = 0; x < width; x++) {\r\n      xResults[x] = array[i];\r\n      i += 4;\r\n    }\r\n    return xResults;\r\n  },\r\n  erect2DFloat: (array, width, height) => {\r\n    const yResults = new Array(height);\r\n    let i = 0;\r\n    for (let y = 0; y < height; y++) {\r\n      const xResults = new Float32Array(width);\r\n      for (let x = 0; x < width; x++) {\r\n        xResults[x] = array[i];\r\n        i += 4;\r\n      }\r\n      yResults[y] = xResults;\r\n    }\r\n    return yResults;\r\n  },\r\n  erect3DFloat: (array, width, height, depth) => {\r\n    const zResults = new Array(depth);\r\n    let i = 0;\r\n    for (let z = 0; z < depth; z++) {\r\n      const yResults = new Array(height);\r\n      for (let y = 0; y < height; y++) {\r\n        const xResults = new Float32Array(width);\r\n        for (let x = 0; x < width; x++) {\r\n          xResults[x] = array[i];\r\n          i += 4;\r\n        }\r\n        yResults[y] = xResults;\r\n      }\r\n      zResults[z] = yResults;\r\n    }\r\n    return zResults;\r\n  },\r\n  erectArray2: (array, width) => {\r\n    const xResults = new Array(width);\r\n    const xResultsMax = width * 4;\r\n    let i = 0;\r\n    for (let x = 0; x < xResultsMax; x += 4) {\r\n      xResults[i++] = array.subarray(x, x + 2);\r\n    }\r\n    return xResults;\r\n  },\r\n  erect2DArray2: (array, width, height) => {\r\n    const yResults = new Array(height);\r\n    const XResultsMax = width * 4;\r\n    for (let y = 0; y < height; y++) {\r\n      const xResults = new Array(width);\r\n      const offset = y * XResultsMax;\r\n      let i = 0;\r\n      for (let x = 0; x < XResultsMax; x += 4) {\r\n        xResults[i++] = array.subarray(x + offset, x + offset + 2);\r\n      }\r\n      yResults[y] = xResults;\r\n    }\r\n    return yResults;\r\n  },\r\n  erect3DArray2: (array, width, height, depth) => {\r\n    const xResultsMax = width * 4;\r\n    const zResults = new Array(depth);\r\n    for (let z = 0; z < depth; z++) {\r\n      const yResults = new Array(height);\r\n      for (let y = 0; y < height; y++) {\r\n        const xResults = new Array(width);\r\n        const offset = (z * xResultsMax * height) + (y * xResultsMax);\r\n        let i = 0;\r\n        for (let x = 0; x < xResultsMax; x += 4) {\r\n          xResults[i++] = array.subarray(x + offset, x + offset + 2);\r\n        }\r\n        yResults[y] = xResults;\r\n      }\r\n      zResults[z] = yResults;\r\n    }\r\n    return zResults;\r\n  },\r\n  erectArray3: (array, width) => {\r\n    const xResults = new Array(width);\r\n    const xResultsMax = width * 4;\r\n    let i = 0;\r\n    for (let x = 0; x < xResultsMax; x += 4) {\r\n      xResults[i++] = array.subarray(x, x + 3);\r\n    }\r\n    return xResults;\r\n  },\r\n  erect2DArray3: (array, width, height) => {\r\n    const xResultsMax = width * 4;\r\n    const yResults = new Array(height);\r\n    for (let y = 0; y < height; y++) {\r\n      const xResults = new Array(width);\r\n      const offset = y * xResultsMax;\r\n      let i = 0;\r\n      for (let x = 0; x < xResultsMax; x += 4) {\r\n        xResults[i++] = array.subarray(x + offset, x + offset + 3);\r\n      }\r\n      yResults[y] = xResults;\r\n    }\r\n    return yResults;\r\n  },\r\n  erect3DArray3: (array, width, height, depth) => {\r\n    const xResultsMax = width * 4;\r\n    const zResults = new Array(depth);\r\n    for (let z = 0; z < depth; z++) {\r\n      const yResults = new Array(height);\r\n      for (let y = 0; y < height; y++) {\r\n        const xResults = new Array(width);\r\n        const offset = (z * xResultsMax * height) + (y * xResultsMax);\r\n        let i = 0;\r\n        for (let x = 0; x < xResultsMax; x += 4) {\r\n          xResults[i++] = array.subarray(x + offset, x + offset + 3);\r\n        }\r\n        yResults[y] = xResults;\r\n      }\r\n      zResults[z] = yResults;\r\n    }\r\n    return zResults;\r\n  },\r\n  erectArray4: (array, width) => {\r\n    const xResults = new Array(array);\r\n    const xResultsMax = width * 4;\r\n    let i = 0;\r\n    for (let x = 0; x < xResultsMax; x += 4) {\r\n      xResults[i++] = array.subarray(x, x + 4);\r\n    }\r\n    return xResults;\r\n  },\r\n  erect2DArray4: (array, width, height) => {\r\n    const xResultsMax = width * 4;\r\n    const yResults = new Array(height);\r\n    for (let y = 0; y < height; y++) {\r\n      const xResults = new Array(width);\r\n      const offset = y * xResultsMax;\r\n      let i = 0;\r\n      for (let x = 0; x < xResultsMax; x += 4) {\r\n        xResults[i++] = array.subarray(x + offset, x + offset + 4);\r\n      }\r\n      yResults[y] = xResults;\r\n    }\r\n    return yResults;\r\n  },\r\n  erect3DArray4: (array, width, height, depth) => {\r\n    const xResultsMax = width * 4;\r\n    const zResults = new Array(depth);\r\n    for (let z = 0; z < depth; z++) {\r\n      const yResults = new Array(height);\r\n      for (let y = 0; y < height; y++) {\r\n        const xResults = new Array(width);\r\n        const offset = (z * xResultsMax * height) + (y * xResultsMax);\r\n        let i = 0;\r\n        for (let x = 0; x < xResultsMax; x += 4) {\r\n          xResults[i++] = array.subarray(x + offset, x + offset + 4);\r\n        }\r\n        yResults[y] = xResults;\r\n      }\r\n      zResults[z] = yResults;\r\n    }\r\n    return zResults;\r\n  },\r\n\r\n  /**\r\n   * @param {String} source\r\n   * @param {Object} settings\r\n   * @return {String}\r\n   */\r\n  flattenFunctionToString: (source, settings) => {\r\n    const { findDependency, thisLookup, doNotDefine } = settings;\r\n    let flattened = settings.flattened;\r\n    if (!flattened) {\r\n      flattened = settings.flattened = {};\r\n    }\r\n\r\n    if (parse === null) {\r\n      throw new Error('Missing JS to AST parser');\r\n    }\r\n\r\n    const ast = parse(source);\r\n    const functionDependencies = [];\r\n\r\n    function flatten(ast) {\r\n      if (Array.isArray(ast)) {\r\n        const results = [];\r\n        for (let i = 0; i < ast.length; i++) {\r\n          results.push(flatten(ast[i]));\r\n        }\r\n        return results.join('');\r\n      }\r\n      switch (ast.type) {\r\n        case 'Program':\r\n          return flatten(ast.body);\r\n        case 'FunctionDeclaration':\r\n          return `function ${ast.id.name}(${ast.params.map(flatten).join(', ')}) ${ flatten(ast.body) }`;\r\n        case 'BlockStatement': {\r\n          const result = [];\r\n          for (let i = 0; i < ast.body.length; i++) {\r\n            result.push(flatten(ast.body[i]), ';\\n');\r\n          }\r\n          return `{\\n${result.join('')}}`;\r\n        }\r\n        case 'VariableDeclaration':\r\n          switch (ast.declarations[0].id.type) {\r\n            case 'ObjectPattern': {\r\n              const source = flatten(ast.declarations[0].init);\r\n              const properties = ast.declarations.map(declaration => declaration.id.properties.map(flatten))[0];\r\n              if (/this/.test(source)) {\r\n                const result = [];\r\n                const lookups = properties.map(thisLookup);\r\n                for (let i = 0; i < lookups.length; i++) {\r\n                  const lookup = lookups[i];\r\n                  if (lookup === null) continue;\r\n                  const property = properties[i];\r\n                  result.push(`${ast.kind} ${ property } = ${ lookup };\\n`);\r\n                }\r\n\r\n                return result.join('');\r\n              }\r\n              return `${ast.kind} { ${properties} } = ${source}`;\r\n            }\r\n            case 'ArrayPattern':\r\n              return `${ast.kind} [ ${ ast.declarations.map(declaration => flatten(declaration.id)).join(', ') } ] = ${flatten(ast.declarations[0].init)}`;\r\n          }\r\n          if (doNotDefine && doNotDefine.indexOf(ast.declarations[0].id.name) !== -1) {\r\n            return '';\r\n          }\r\n          return `${ast.kind} ${ast.declarations[0].id.name} = ${flatten(ast.declarations[0].init)}`;\r\n        case 'CallExpression': {\r\n          if (ast.callee.property.name === 'subarray') {\r\n            return `${flatten(ast.callee.object)}.${flatten(ast.callee.property)}(${ast.arguments.map(value => flatten(value)).join(', ')})`;\r\n          }\r\n          if (ast.callee.object.name === 'gl' || ast.callee.object.name === 'context') {\r\n            return `${flatten(ast.callee.object)}.${flatten(ast.callee.property)}(${ast.arguments.map(value => flatten(value)).join(', ')})`;\r\n          }\r\n          if (ast.callee.object.type === 'ThisExpression') {\r\n            functionDependencies.push(findDependency('this', ast.callee.property.name));\r\n            return `${ast.callee.property.name}(${ast.arguments.map(value => flatten(value)).join(', ')})`;\r\n          } else if (ast.callee.object.name) {\r\n            const foundSource = findDependency(ast.callee.object.name, ast.callee.property.name);\r\n            if (foundSource === null) {\r\n              // we're not flattening it\r\n              return `${ast.callee.object.name}.${ast.callee.property.name}(${ast.arguments.map(value => flatten(value)).join(', ')})`;\r\n            } else {\r\n              functionDependencies.push(foundSource);\r\n              // we're flattening it\r\n              return `${ast.callee.property.name}(${ast.arguments.map(value => flatten(value)).join(', ')})`;\r\n            }\r\n          } else if (ast.callee.object.type === 'MemberExpression') {\r\n            return `${flatten(ast.callee.object)}.${ast.callee.property.name}(${ast.arguments.map(value => flatten(value)).join(', ')})`;\r\n          } else {\r\n            throw new Error('unknown ast.callee');\r\n          }\r\n        }\r\n        case 'ReturnStatement':\r\n          return `return ${flatten(ast.argument)}`;\r\n        case 'BinaryExpression':\r\n          return `(${flatten(ast.left)}${ast.operator}${flatten(ast.right)})`;\r\n        case 'UnaryExpression':\r\n          if (ast.prefix) {\r\n            return `${ast.operator} ${flatten(ast.argument)}`;\r\n          } else {\r\n            return `${flatten(ast.argument)} ${ast.operator}`;\r\n          }\r\n          case 'ExpressionStatement':\r\n            return `(${flatten(ast.expression)})`;\r\n          case 'ArrowFunctionExpression':\r\n            return `(${ast.params.map(flatten).join(', ')}) => ${flatten(ast.body)}`;\r\n          case 'Literal':\r\n            return ast.raw;\r\n          case 'Identifier':\r\n            return ast.name;\r\n          case 'MemberExpression':\r\n            if (ast.object.type === 'ThisExpression') {\r\n              return thisLookup(ast.property.name);\r\n            }\r\n            if (ast.computed) {\r\n              return `${flatten(ast.object)}[${flatten(ast.property)}]`;\r\n            }\r\n            return flatten(ast.object) + '.' + flatten(ast.property);\r\n          case 'ThisExpression':\r\n            return 'this';\r\n          case 'NewExpression':\r\n            return `new ${flatten(ast.callee)}(${ast.arguments.map(value => flatten(value)).join(', ')})`;\r\n          case 'ForStatement':\r\n            return `for (${flatten(ast.init)};${flatten(ast.test)};${flatten(ast.update)}) ${flatten(ast.body)}`;\r\n          case 'AssignmentExpression':\r\n            return `${flatten(ast.left)}${ast.operator}${flatten(ast.right)}`;\r\n          case 'UpdateExpression':\r\n            return `${flatten(ast.argument)}${ast.operator}`;\r\n          case 'IfStatement':\r\n            return `if (${flatten(ast.test)}) ${flatten(ast.consequent)}`;\r\n          case 'ThrowStatement':\r\n            return `throw ${flatten(ast.argument)}`;\r\n          case 'ObjectPattern':\r\n            return ast.properties.map(flatten).join(', ');\r\n          case 'ArrayPattern':\r\n            return ast.elements.map(flatten).join(', ');\r\n          case 'DebuggerStatement':\r\n            return 'debugger;';\r\n          case 'ConditionalExpression':\r\n            return `${flatten(ast.test)}?${flatten(ast.consequent)}:${flatten(ast.alternate)}`;\r\n          case 'Property':\r\n            if (ast.kind === 'init') {\r\n              return flatten(ast.key);\r\n            }\r\n      }\r\n      throw new Error(`unhandled ast.type of ${ ast.type }`);\r\n    }\r\n    const result = flatten(ast);\r\n    if (functionDependencies.length > 0) {\r\n      const flattenedFunctionDependencies = [];\r\n      for (let i = 0; i < functionDependencies.length; i++) {\r\n        const functionDependency = functionDependencies[i];\r\n        if (!flattened[functionDependency]) {\r\n          flattened[functionDependency] = true;\r\n        }\r\n        flattenedFunctionDependencies.push(utils.flattenFunctionToString(functionDependency, settings) + ';\\n');\r\n      }\r\n      return flattenedFunctionDependencies.join('') + result;\r\n    }\r\n    return result;\r\n  },\r\n};\r\n\r\nexport { utils };\r\n","import { Input } from '../input';\r\nimport {\r\n  functionToIFunction,\r\n  getArgumentNamesFromString,\r\n  isArray,\r\n  isFunctionString,\r\n  warnDeprecated\r\n} from '../common';\r\nimport { getVariableType } from '../utils';\r\n\r\nexport class Kernel {\r\n  /**\r\n   * @type {Boolean}\r\n   */\r\n  static get isSupported() {\r\n    throw new Error(`\"isSupported\" not implemented on ${ this.name }`);\r\n  }\r\n\r\n  /**\r\n   * @type {Boolean}\r\n   */\r\n  static isContextMatch(context) {\r\n    throw new Error(`\"isContextMatch\" not implemented on ${ this.name }`);\r\n  }\r\n\r\n  /**\r\n   * @type {IKernelFeatures}\r\n   * Used internally to populate the kernel.feature, which is a getter for the output of this value\r\n   */\r\n  static getFeatures() {\r\n    throw new Error(`\"getFeatures\" not implemented on ${ this.name }`);\r\n  }\r\n\r\n  static destroyContext(context) {\r\n    throw new Error(`\"destroyContext\" called on ${ this.name }`);\r\n  }\r\n\r\n  static nativeFunctionArguments() {\r\n    throw new Error(`\"nativeFunctionArguments\" called on ${ this.name }`);\r\n  }\r\n\r\n  static nativeFunctionReturnType() {\r\n    throw new Error(`\"nativeFunctionReturnType\" called on ${ this.name }`);\r\n  }\r\n\r\n  static combineKernels() {\r\n    throw new Error(`\"combineKernels\" called on ${ this.name }`);\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @param {string|object} source\r\n   * @param [settings]\r\n   */\r\n  constructor(source, settings) {\r\n    if (typeof source !== 'object') {\r\n      if (typeof source !== 'string') {\r\n        throw new Error('source not a string');\r\n      }\r\n      if (!isFunctionString(source)) {\r\n        throw new Error('source not a function string');\r\n      }\r\n    }\r\n    this.useLegacyEncoder = false;\r\n    this.fallbackRequested = false;\r\n    this.onRequestFallback = null;\r\n\r\n    /**\r\n     * Name of the arguments found from parsing source argument\r\n     * @type {String[]}\r\n     */\r\n    this.argumentNames = typeof source === 'string' ? getArgumentNamesFromString(source) : null;\r\n    this.argumentTypes = null;\r\n    this.argumentSizes = null;\r\n    this.argumentBitRatios = null;\r\n    this.kernelArguments = null;\r\n    this.kernelConstants = null;\r\n\r\n\r\n    /**\r\n     * The function source\r\n     * @type {String}\r\n     */\r\n    this.source = source;\r\n\r\n    /**\r\n     * The size of the kernel's output\r\n     * @type {Number[]}\r\n     */\r\n    this.output = null;\r\n\r\n    /**\r\n     * Debug mode\r\n     * @type {Boolean}\r\n     */\r\n    this.debug = false;\r\n\r\n    /**\r\n     * Graphical mode\r\n     * @type {Boolean}\r\n     */\r\n    this.graphical = false;\r\n\r\n    /**\r\n     * Maximum loops when using argument values to prevent infinity\r\n     * @type {Number}\r\n     */\r\n    this.loopMaxIterations = 0;\r\n\r\n    /**\r\n     * Constants used in kernel via `this.constants`\r\n     * @type {Object}\r\n     */\r\n    this.constants = null;\r\n    this.constantTypes = null;\r\n    this.constantBitRatios = null;\r\n    this.dynamicArguments = false;\r\n    this.dynamicOutput = true;\r\n\r\n    /**\r\n     *\r\n     * @type {Object}\r\n     */\r\n    this.canvas = null;\r\n\r\n    /**\r\n     *\r\n     * @type {WebGLRenderingContext}\r\n     */\r\n    this.context = null;\r\n\r\n    /**\r\n     *\r\n     * @type {Boolean}\r\n     */\r\n    this.checkContext = null;\r\n\r\n    /**\r\n     *\r\n     * @type {GPU}\r\n     */\r\n    this.gpu = null;\r\n\r\n    /**\r\n     *\r\n     * @type {IGPUFunction[]}\r\n     */\r\n    this.functions = null;\r\n\r\n    /**\r\n     *\r\n     * @type {IGPUNativeFunction[]}\r\n     */\r\n    this.nativeFunctions = null;\r\n\r\n    /**\r\n     *\r\n     * @type {String}\r\n     */\r\n    this.injectedNative = null;\r\n\r\n    /**\r\n     *\r\n     * @type {ISubKernel[]}\r\n     */\r\n    this.subKernels = null;\r\n\r\n    /**\r\n     *\r\n     * @type {Boolean}\r\n     */\r\n    this.validate = true;\r\n\r\n    /**\r\n     * Enforces kernel to write to a new array or texture on run\r\n     * @type {Boolean}\r\n     */\r\n    this.immutable = false;\r\n\r\n    /**\r\n     * Enforces kernel to write to a texture on run\r\n     * @type {Boolean}\r\n     */\r\n    this.pipeline = false;\r\n\r\n    /**\r\n     * Make GPU use single precison or unsigned.  Acceptable values: 'single' or 'unsigned'\r\n     * @type {String|null}\r\n     * @enum 'single' | 'unsigned'\r\n     */\r\n    this.precision = null;\r\n\r\n    /**\r\n     *\r\n     * @type {String|null}\r\n     * @enum 'speed' | 'balanced' | 'precision'\r\n     */\r\n    this.tactic = 'balanced';\r\n\r\n    this.plugins = null;\r\n\r\n    this.returnType = null;\r\n    this.leadingReturnStatement = null;\r\n    this.followingReturnStatement = null;\r\n    this.optimizeFloatMemory = null;\r\n    this.strictIntegers = false;\r\n    this.fixIntegerDivisionAccuracy = null;\r\n    this.warnVarUsage = true;\r\n  }\r\n\r\n  mergeSettings(settings) {\r\n    for (let p in settings) {\r\n      if (!settings.hasOwnProperty(p) || !this.hasOwnProperty(p)) continue;\r\n      switch (p) {\r\n        case 'output':\r\n          if (!Array.isArray(settings.output)) {\r\n            this.setOutput(settings.output); // Flatten output object\r\n            continue;\r\n          }\r\n          break;\r\n        case 'functions':\r\n          if (typeof settings.functions[0] === 'function') {\r\n            this.functions = settings.functions.map(source => functionToIFunction(source));\r\n            continue;\r\n          }\r\n          break;\r\n        case 'graphical':\r\n          if (settings[p] && !settings.hasOwnProperty('precision')) {\r\n            this.precision = 'unsigned';\r\n          }\r\n          this[p] = settings[p];\r\n          continue;\r\n      }\r\n      this[p] = settings[p];\r\n    }\r\n\r\n    if (!this.canvas) this.canvas = this.initCanvas();\r\n    if (!this.context) this.context = this.initContext();\r\n    if (!this.plugins) this.plugins = this.initPlugins(settings);\r\n  }\r\n  /**\r\n   * @desc Builds the Kernel, by compiling Fragment and Vertical Shaders,\r\n   * and instantiates the program.\r\n   * @abstract\r\n   */\r\n  build() {\r\n    throw new Error(`\"build\" not defined on ${ this.constructor.name }`);\r\n  }\r\n\r\n  /**\r\n   * @desc Run the kernel program, and send the output to renderOutput\r\n   * <p> This method calls a helper method *renderOutput* to return the result. </p>\r\n   * @returns {Float32Array|Float32Array[]|Float32Array[][]|void} Result The final output of the program, as float, and as Textures for reuse.\r\n   * @abstract\r\n   */\r\n  run() {\r\n    throw new Error(`\"run\" not defined on ${ this.constructor.name }`)\r\n  }\r\n\r\n  /**\r\n   * @abstract\r\n   * @return {Object}\r\n   */\r\n  initCanvas() {\r\n    throw new Error(`\"initCanvas\" not defined on ${ this.constructor.name }`);\r\n  }\r\n\r\n  /**\r\n   * @abstract\r\n   * @return {Object}\r\n   */\r\n  initContext() {\r\n    throw new Error(`\"initContext\" not defined on ${ this.constructor.name }`);\r\n  }\r\n\r\n  /**\r\n   * @param {IFunctionSettings} settings\r\n   * @return {Object};\r\n   * @abstract\r\n   */\r\n  initPlugins(settings) {\r\n    throw new Error(`\"initPlugins\" not defined on ${ this.constructor.name }`);\r\n  }\r\n\r\n  /**\r\n   * @desc Setup the parameter types for the parameters\r\n   * supplied to the Kernel function\r\n   *\r\n   * @param {IArguments} args - The actual parameters sent to the Kernel\r\n   */\r\n  setupArguments(args) {\r\n    this.kernelArguments = [];\r\n    if (!this.argumentTypes) {\r\n      if (!this.argumentTypes) {\r\n        this.argumentTypes = [];\r\n        for (let i = 0; i < args.length; i++) {\r\n          const argType = getVariableType(args[i], this.strictIntegers);\r\n          const type = argType === 'Integer' ? 'Number' : argType;\r\n          this.argumentTypes.push(type);\r\n          this.kernelArguments.push({\r\n            type\r\n          });\r\n        }\r\n      }\r\n    } else {\r\n      for (let i = 0; i < this.argumentTypes.length; i++) {\r\n        this.kernelArguments.push({\r\n          type: this.argumentTypes[i]\r\n        });\r\n      }\r\n    }\r\n\r\n    // setup sizes\r\n    this.argumentSizes = new Array(args.length);\r\n    this.argumentBitRatios = new Int32Array(args.length);\r\n\r\n    for (let i = 0; i < args.length; i++) {\r\n      const arg = args[i];\r\n      this.argumentSizes[i] = arg.constructor === Input ? arg.size : null;\r\n      this.argumentBitRatios[i] = this.getBitRatio(arg);\r\n    }\r\n\r\n    if (this.argumentNames.length !== args.length) {\r\n      throw new Error(`arguments are miss-aligned`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Setup constants\r\n   */\r\n  setupConstants() {\r\n    this.kernelConstants = [];\r\n    let needsConstantTypes = this.constantTypes === null;\r\n    if (needsConstantTypes) {\r\n      this.constantTypes = {};\r\n    }\r\n    this.constantBitRatios = {};\r\n    if (this.constants) {\r\n      for (let name in this.constants) {\r\n        if (needsConstantTypes) {\r\n          const type = getVariableType(this.constants[name], this.strictIntegers);\r\n          this.constantTypes[name] = type;\r\n          this.kernelConstants.push({\r\n            name,\r\n            type\r\n          });\r\n        } else {\r\n          this.kernelConstants.push({\r\n            name,\r\n            type: this.constantTypes[name]\r\n          });\r\n        }\r\n        this.constantBitRatios[name] = this.getBitRatio(this.constants[name]);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @param flag\r\n   * @return {Kernel}\r\n   */\r\n  setOptimizeFloatMemory(flag) {\r\n    this.optimizeFloatMemory = flag;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * @desc Set output dimensions of the kernel function\r\n   * @param {Array|Object} output - The output array to set the kernel output size to\r\n   */\r\n  setOutput(output) {\r\n    if (output.hasOwnProperty('x')) {\r\n      if (output.hasOwnProperty('y')) {\r\n        if (output.hasOwnProperty('z')) {\r\n          this.output = [output.x, output.y, output.z];\r\n        } else {\r\n          this.output = [output.x, output.y];\r\n        }\r\n      } else {\r\n        this.output = [output.x];\r\n      }\r\n    } else {\r\n      this.output = output;\r\n    }\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * @desc Toggle debug mode\r\n   * @param {Boolean} flag - true to enable debug\r\n   */\r\n  setDebug(flag) {\r\n    this.debug = flag;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * @desc Toggle graphical output mode\r\n   * @param {Boolean} flag - true to enable graphical output\r\n   */\r\n  setGraphical(flag) {\r\n    this.graphical = flag;\r\n    this.precision = 'unsigned';\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * @desc Set the maximum number of loop iterations\r\n   * @param {number} max - iterations count\r\n   *\r\n   */\r\n  setLoopMaxIterations(max) {\r\n    this.loopMaxIterations = max;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * @desc Set Constants\r\n   */\r\n  setConstants(constants) {\r\n    this.constants = constants;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @param [IKernelValueTypes] constantTypes\r\n   * @return {Kernel}\r\n   */\r\n  setConstantTypes(constantTypes) {\r\n    this.constantTypes = constantTypes;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @param {IFunction[]|KernelFunction[]} functions\r\n   * @return {Kernel}\r\n   */\r\n  setFunctions(functions) {\r\n    if (typeof functions[0] === 'function') {\r\n      this.functions = functions.map(source => functionToIFunction(source));\r\n    } else {\r\n      this.functions = functions;\r\n    }\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @param {IGPUNativeFunction} nativeFunctions\r\n   * @return {Kernel}\r\n   */\r\n  setNativeFunctions(nativeFunctions) {\r\n    this.nativeFunctions = nativeFunctions;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @param {String} injectedNative\r\n   * @return {Kernel}\r\n   */\r\n  setInjectedNative(injectedNative) {\r\n    this.injectedNative = injectedNative;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Set writing to texture on/off\r\n   * @param flag\r\n   * @return {Kernel}\r\n   */\r\n  setPipeline(flag) {\r\n    this.pipeline = flag;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Set precision to 'unsigned' or 'single'\r\n   * @param {String} flag 'unsigned' or 'single'\r\n   * @return {Kernel}\r\n   */\r\n  setPrecision(flag) {\r\n    this.precision = flag;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * @param flag\r\n   * @return {Kernel}\r\n   * @deprecated\r\n   */\r\n  setOutputToTexture(flag) {\r\n    warnDeprecated('method', 'setOutputToTexture', 'setPipeline');\r\n    this.pipeline = flag;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Set to immutable\r\n   * @param flag\r\n   * @return {Kernel}\r\n   */\r\n  setImmutable(flag) {\r\n    this.immutable = flag;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * @desc Bind the canvas to kernel\r\n   * @param {Object} canvas\r\n   */\r\n  setCanvas(canvas) {\r\n    this.canvas = canvas;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * @param {Boolean} flag\r\n   * @return {Kernel}\r\n   */\r\n  setStrictIntegers(flag) {\r\n    this.strictIntegers = flag;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @param flag\r\n   * @return {Kernel}\r\n   */\r\n  setDynamicOutput(flag) {\r\n    this.dynamicOutput = flag;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * @deprecated\r\n   * @param flag\r\n   * @return {Kernel}\r\n   */\r\n  setHardcodeConstants(flag) {\r\n    warnDeprecated('method', 'setHardcodeConstants');\r\n    this.setDynamicOutput(flag);\r\n    this.setDynamicArguments(flag);\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @param flag\r\n   * @return {Kernel}\r\n   */\r\n  setDynamicArguments(flag) {\r\n    this.dynamicArguments = flag;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * @param {Boolean} flag\r\n   * @return {Kernel}\r\n   */\r\n  setUseLegacyEncoder(flag) {\r\n    this.useLegacyEncoder = flag;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @param {Boolean} flag\r\n   * @return {Kernel}\r\n   */\r\n  setWarnVarUsage(flag) {\r\n    this.warnVarUsage = flag;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * @deprecated\r\n   * @returns {Object}\r\n   */\r\n  getCanvas() {\r\n    warnDeprecated('method', 'getCanvas');\r\n    return this.canvas;\r\n  }\r\n\r\n  /**\r\n   * @deprecated\r\n   * @returns {Object}\r\n   */\r\n  getWebGl() {\r\n    warnDeprecated('method', 'getWebGl');\r\n    return this.context;\r\n  }\r\n\r\n  /**\r\n   * @desc Bind the webGL instance to kernel\r\n   * @param {WebGLRenderingContext} context - webGl instance to bind\r\n   */\r\n  setContext(context) {\r\n    this.context = context;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @param [IKernelValueTypes|GPUVariableType[]] argumentTypes\r\n   * @return {Kernel}\r\n   */\r\n  setArgumentTypes(argumentTypes) {\r\n    if (Array.isArray(argumentTypes)) {\r\n      this.argumentTypes = argumentTypes;\r\n    } else {\r\n      this.argumentTypes = [];\r\n      for (const p in argumentTypes) {\r\n        const argumentIndex = this.argumentNames.indexOf(p);\r\n        if (argumentIndex === -1) throw new Error(`unable to find argument ${ p }`);\r\n        this.argumentTypes[argumentIndex] = argumentTypes[p];\r\n      }\r\n    }\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @param [Tactic] tactic\r\n   * @return {Kernel}\r\n   */\r\n  setTactic(tactic) {\r\n    this.tactic = tactic;\r\n    return this;\r\n  }\r\n\r\n  requestFallback(args) {\r\n    if (!this.onRequestFallback) {\r\n      throw new Error(`\"onRequestFallback\" not defined on ${ this.constructor.name }`);\r\n    }\r\n    this.fallbackRequested = true;\r\n    return this.onRequestFallback(args);\r\n  }\r\n\r\n  /**\r\n   * @desc Validate settings\r\n   * @abstract\r\n   */\r\n  validateSettings() {\r\n    throw new Error(`\"validateSettings\" not defined on ${ this.constructor.name }`);\r\n  }\r\n\r\n  /**\r\n   * @desc Add a sub kernel to the root kernel instance.\r\n   * This is what `createKernelMap` uses.\r\n   *\r\n   * @param {ISubKernel} subKernel - function (as a String) of the subKernel to add\r\n   */\r\n  addSubKernel(subKernel) {\r\n    if (this.subKernels === null) {\r\n      this.subKernels = [];\r\n    }\r\n    if (!subKernel.source) throw new Error('subKernel missing \"source\" property');\r\n    if (!subKernel.property && isNaN(subKernel.property)) throw new Error('subKernel missing \"property\" property');\r\n    if (!subKernel.name) throw new Error('subKernel missing \"name\" property');\r\n    this.subKernels.push(subKernel);\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * @desc Destroys all memory associated with this kernel\r\n   * @param {Boolean} [removeCanvasReferences] remove any associated canvas references\r\n   */\r\n  destroy(removeCanvasReferences) {\r\n    throw new Error(`\"destroy\" called on ${ this.constructor.name }`);\r\n  }\r\n\r\n  /**\r\n   * bit storage ratio of source to target 'buffer', i.e. if 8bit array -> 32bit tex = 4\r\n   * @param value\r\n   * @returns {number}\r\n   */\r\n  getBitRatio(value) {\r\n    if (this.precision === 'single') {\r\n      // 8 and 16 are upconverted to float32\r\n      return 4;\r\n    } else if (Array.isArray(value[0])) {\r\n      return this.getBitRatio(value[0]);\r\n    } else if (value.constructor === Input) {\r\n      return this.getBitRatio(value.value);\r\n    }\r\n    switch (value.constructor) {\r\n      case Uint8ClampedArray:\r\n      case Uint8Array:\r\n      case Int8Array:\r\n        return 1;\r\n      case Uint16Array:\r\n      case Int16Array:\r\n        return 2;\r\n      case Float32Array:\r\n      case Int32Array:\r\n      default:\r\n        return 4;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @returns {number[]}\r\n   */\r\n  getPixels() {\r\n    throw new Error(`\"getPixels\" called on ${ this.constructor.name }`);\r\n  }\r\n\r\n  checkOutput() {\r\n    if (!this.output || !isArray(this.output)) throw new Error('kernel.output not an array');\r\n    if (this.output.length < 1) throw new Error('kernel.output is empty, needs at least 1 value');\r\n    for (let i = 0; i < this.output.length; i++) {\r\n      if (isNaN(this.output[i]) || this.output[i] < 1) {\r\n        throw new Error(`${ this.constructor.name }.output[${ i }] incorrectly defined as \\`${ this.output[i] }\\`, needs to be numeric, and greater than 0`);\r\n      }\r\n    }\r\n  }\r\n\r\n  toJSON() {\r\n    const settings = {\r\n      output: this.output,\r\n      threadDim: this.threadDim,\r\n      pipeline: this.pipeline,\r\n      argumentNames: this.argumentNames,\r\n      argumentsTypes: this.argumentTypes,\r\n      constants: this.constants,\r\n      pluginNames: this.plugins ? this.plugins.map(plugin => plugin.name) : null,\r\n      returnType: this.returnType,\r\n    };\r\n    return {\r\n      settings\r\n    };\r\n  }\r\n}\r\n","/**\r\n * @desc This handles all the raw state, converted state, etc. of a single function.\r\n * [INTERNAL] A collection of functionNodes.\r\n * @class\r\n */\r\nexport class FunctionBuilder {\r\n  /**\r\n   *\r\n   * @param {Kernel} kernel\r\n   * @param {FunctionNode} FunctionNode\r\n   * @param {object} [extraNodeOptions]\r\n   * @returns {FunctionBuilder}\r\n   * @static\r\n   */\r\n  static fromKernel(kernel, FunctionNode, extraNodeOptions) {\r\n    const {\r\n      kernelArguments,\r\n      kernelConstants,\r\n      argumentNames,\r\n      argumentSizes,\r\n      argumentBitRatios,\r\n      constants,\r\n      constantBitRatios,\r\n      debug,\r\n      loopMaxIterations,\r\n      nativeFunctions,\r\n      output,\r\n      optimizeFloatMemory,\r\n      precision,\r\n      plugins,\r\n      source,\r\n      subKernels,\r\n      functions,\r\n      leadingReturnStatement,\r\n      followingReturnStatement,\r\n      dynamicArguments,\r\n      dynamicOutput,\r\n      warnVarUsage,\r\n    } = kernel;\r\n\r\n    const argumentTypes = new Array(kernelArguments.length);\r\n    const constantTypes = {};\r\n\r\n    for (let i = 0; i < kernelArguments.length; i++) {\r\n      argumentTypes[i] = kernelArguments[i].type;\r\n    }\r\n\r\n    for (let i = 0; i < kernelConstants.length; i++) {\r\n      const kernelConstant = kernelConstants[i]\r\n      constantTypes[kernelConstant.name] = kernelConstant.type;\r\n    }\r\n\r\n    const needsArgumentType = (functionName, index) => {\r\n      return functionBuilder.needsArgumentType(functionName, index);\r\n    };\r\n\r\n    const assignArgumentType = (functionName, index, type) => {\r\n      functionBuilder.assignArgumentType(functionName, index, type);\r\n    };\r\n\r\n    const lookupReturnType = (functionName, ast, requestingNode) => {\r\n      return functionBuilder.lookupReturnType(functionName, ast, requestingNode);\r\n    };\r\n\r\n    const lookupFunctionArgumentTypes = (functionName) => {\r\n      return functionBuilder.lookupFunctionArgumentTypes(functionName);\r\n    };\r\n\r\n    const lookupFunctionArgumentName = (functionName, argumentIndex) => {\r\n      return functionBuilder.lookupFunctionArgumentName(functionName, argumentIndex);\r\n    };\r\n\r\n    const lookupFunctionArgumentBitRatio = (functionName, argumentName) => {\r\n      return functionBuilder.lookupFunctionArgumentBitRatio(functionName, argumentName);\r\n    };\r\n\r\n    const triggerImplyArgumentType = (functionName, i, argumentType, requestingNode) => {\r\n      functionBuilder.assignArgumentType(functionName, i, argumentType, requestingNode);\r\n    };\r\n\r\n    const triggerTrackArgumentSynonym = (functionName, argumentName, calleeFunctionName, argumentIndex) => {\r\n      functionBuilder.trackArgumentSynonym(functionName, argumentName, calleeFunctionName, argumentIndex);\r\n    };\r\n\r\n    const lookupArgumentSynonym = (originFunctionName, functionName, argumentName) => {\r\n      return functionBuilder.lookupArgumentSynonym(originFunctionName, functionName, argumentName);\r\n    };\r\n\r\n    const onFunctionCall = (functionName, calleeFunctionName, args) => {\r\n      functionBuilder.trackFunctionCall(functionName, calleeFunctionName, args);\r\n    };\r\n\r\n    const onNestedFunction = (ast, returnType) => {\r\n      const argumentNames = [];\r\n      for (let i = 0; i < ast.params.length; i++) {\r\n        argumentNames.push(ast.params[i].name);\r\n      }\r\n      const nestedFunction = new FunctionNode(null, Object.assign({}, nodeOptions, {\r\n        returnType: null,\r\n        ast,\r\n        name: ast.id.name,\r\n        argumentNames,\r\n        lookupReturnType,\r\n        lookupFunctionArgumentTypes,\r\n        lookupFunctionArgumentName,\r\n        lookupFunctionArgumentBitRatio,\r\n        needsArgumentType,\r\n        assignArgumentType,\r\n        triggerImplyArgumentType,\r\n        triggerTrackArgumentSynonym,\r\n        lookupArgumentSynonym,\r\n        onFunctionCall,\r\n        warnVarUsage,\r\n      }));\r\n      nestedFunction.traceFunctionAST(ast);\r\n      functionBuilder.addFunctionNode(nestedFunction);\r\n    };\r\n\r\n    const nodeOptions = Object.assign({\r\n      isRootKernel: false,\r\n      onNestedFunction,\r\n      lookupReturnType,\r\n      lookupFunctionArgumentTypes,\r\n      lookupFunctionArgumentName,\r\n      lookupFunctionArgumentBitRatio,\r\n      needsArgumentType,\r\n      assignArgumentType,\r\n      triggerImplyArgumentType,\r\n      triggerTrackArgumentSynonym,\r\n      lookupArgumentSynonym,\r\n      onFunctionCall,\r\n      optimizeFloatMemory,\r\n      precision,\r\n      constants,\r\n      constantTypes,\r\n      constantBitRatios,\r\n      debug,\r\n      loopMaxIterations,\r\n      output,\r\n      plugins,\r\n      dynamicArguments,\r\n      dynamicOutput,\r\n    }, extraNodeOptions || {});\r\n\r\n    const rootNodeOptions = Object.assign({}, nodeOptions, {\r\n      isRootKernel: true,\r\n      name: 'kernel',\r\n      argumentNames,\r\n      argumentTypes,\r\n      argumentSizes,\r\n      argumentBitRatios,\r\n      leadingReturnStatement,\r\n      followingReturnStatement,\r\n    });\r\n\r\n    if (typeof source === 'object' && source.functionNodes) {\r\n      return new FunctionBuilder().fromJSON(source.functionNodes, FunctionNode);\r\n    }\r\n\r\n    const rootNode = new FunctionNode(source, rootNodeOptions);\r\n\r\n    let functionNodes = null;\r\n    if (functions) {\r\n      functionNodes = functions.map((fn) => new FunctionNode(fn.source, {\r\n        returnType: fn.returnType,\r\n        argumentTypes: fn.argumentTypes,\r\n        output,\r\n        plugins,\r\n        constants,\r\n        constantTypes,\r\n        constantBitRatios,\r\n        optimizeFloatMemory,\r\n        precision,\r\n        lookupReturnType,\r\n        lookupFunctionArgumentTypes,\r\n        lookupFunctionArgumentName,\r\n        lookupFunctionArgumentBitRatio,\r\n        needsArgumentType,\r\n        assignArgumentType,\r\n        triggerImplyArgumentType,\r\n        triggerTrackArgumentSynonym,\r\n        lookupArgumentSynonym,\r\n        onFunctionCall,\r\n      }));\r\n    }\r\n\r\n    let subKernelNodes = null;\r\n    if (subKernels) {\r\n      subKernelNodes = subKernels.map((subKernel) => {\r\n        const { name, source } = subKernel;\r\n        return new FunctionNode(source, Object.assign({}, nodeOptions, {\r\n          name,\r\n          isSubKernel: true,\r\n          isRootKernel: false,\r\n        }));\r\n      });\r\n    }\r\n\r\n    const functionBuilder = new FunctionBuilder({\r\n      kernel,\r\n      rootNode,\r\n      functionNodes,\r\n      nativeFunctions,\r\n      subKernelNodes\r\n    });\r\n\r\n    return functionBuilder;\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @param {IFunctionBuilderSettings} [settings]\r\n   */\r\n  constructor(settings) {\r\n    settings = settings || {};\r\n    this.kernel = settings.kernel;\r\n    this.rootNode = settings.rootNode;\r\n    this.functionNodes = settings.functionNodes || [];\r\n    this.subKernelNodes = settings.subKernelNodes || [];\r\n    this.nativeFunctions = settings.nativeFunctions || [];\r\n    this.functionMap = {};\r\n    this.nativeFunctionNames = [];\r\n    this.lookupChain = [];\r\n    this.argumentChain = [];\r\n    this.functionNodeDependencies = {};\r\n    this.functionCalls = {};\r\n\r\n    if (this.rootNode) {\r\n      this.functionMap['kernel'] = this.rootNode;\r\n    }\r\n\r\n    if (this.functionNodes) {\r\n      for (let i = 0; i < this.functionNodes.length; i++) {\r\n        this.functionMap[this.functionNodes[i].name] = this.functionNodes[i];\r\n      }\r\n    }\r\n\r\n    if (this.subKernelNodes) {\r\n      for (let i = 0; i < this.subKernelNodes.length; i++) {\r\n        this.functionMap[this.subKernelNodes[i].name] = this.subKernelNodes[i];\r\n      }\r\n    }\r\n\r\n    if (this.nativeFunctions) {\r\n      for (let i = 0; i < this.nativeFunctions.length; i++) {\r\n        const nativeFunction = this.nativeFunctions[i];\r\n        this.nativeFunctionNames.push(nativeFunction.name);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @desc Add the function node directly\r\n   *\r\n   * @param {FunctionNode} functionNode - functionNode to add\r\n   *\r\n   */\r\n  addFunctionNode(functionNode) {\r\n    if (!functionNode.name) throw new Error('functionNode.name needs set');\r\n    this.functionMap[functionNode.name] = functionNode;\r\n    if (functionNode.isRootKernel) {\r\n      this.rootNode = functionNode;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @desc Trace all the depending functions being called, from a single function\r\n   *\r\n   * This allow for 'unneeded' functions to be automatically optimized out.\r\n   * Note that the 0-index, is the starting function trace.\r\n   *\r\n   * @param {String} functionName - Function name to trace from, default to 'kernel'\r\n   * @param {String[]} [retList] - Returning list of function names that is traced. Including itself.\r\n   *\r\n   * @returns {String[]}  Returning list of function names that is traced. Including itself.\r\n   */\r\n  traceFunctionCalls(functionName, retList) {\r\n    functionName = functionName || 'kernel';\r\n    retList = retList || [];\r\n\r\n    if (this.nativeFunctionNames.indexOf(functionName) > -1) {\r\n      if (retList.indexOf(functionName) === -1) {\r\n        retList.push(functionName);\r\n      }\r\n      return retList;\r\n    }\r\n\r\n    const functionNode = this.functionMap[functionName];\r\n    if (functionNode) {\r\n      // Check if function already exists\r\n      const functionIndex = retList.indexOf(functionName);\r\n      if (functionIndex === -1) {\r\n        retList.push(functionName);\r\n        functionNode.toString(); //ensure JS trace is done\r\n        for (let i = 0; i < functionNode.calledFunctions.length; ++i) {\r\n          this.traceFunctionCalls(functionNode.calledFunctions[i], retList);\r\n        }\r\n      } else {\r\n        /**\r\n         * https://github.com/gpujs/gpu.js/issues/207\r\n         * if dependent function is already in the list, because a function depends on it, and because it has\r\n         * already been traced, we know that we must move the dependent function to the end of the the retList.\r\n         * */\r\n        const dependantFunctionName = retList.splice(functionIndex, 1)[0];\r\n        retList.push(dependantFunctionName);\r\n      }\r\n    }\r\n\r\n    return retList;\r\n  }\r\n\r\n  /**\r\n   * @desc Return the string for a function\r\n   * @param {String} functionName - Function name to trace from. If null, it returns the WHOLE builder stack\r\n   * @returns {String} The full string, of all the various functions. Trace optimized if functionName given\r\n   */\r\n  getPrototypeString(functionName) {\r\n    return this.getPrototypes(functionName).join('\\n');\r\n  }\r\n\r\n  /**\r\n   * @desc Return the string for a function\r\n   * @param {String} [functionName] - Function name to trace from. If null, it returns the WHOLE builder stack\r\n   * @returns {Array} The full string, of all the various functions. Trace optimized if functionName given\r\n   */\r\n  getPrototypes(functionName) {\r\n    if (this.rootNode) {\r\n      this.rootNode.toString();\r\n    }\r\n    if (functionName) {\r\n      return this.getPrototypesFromFunctionNames(this.traceFunctionCalls(functionName, []).reverse());\r\n    }\r\n    return this.getPrototypesFromFunctionNames(Object.keys(this.functionMap));\r\n  }\r\n\r\n  /**\r\n   * @desc Get string from function names\r\n   * @param {String[]} functionList - List of function to build string\r\n   * @returns {String} The string, of all the various functions. Trace optimized if functionName given\r\n   */\r\n  getStringFromFunctionNames(functionList) {\r\n    const ret = [];\r\n    for (let i = 0; i < functionList.length; ++i) {\r\n      const node = this.functionMap[functionList[i]];\r\n      if (node) {\r\n        ret.push(this.functionMap[functionList[i]].toString());\r\n      }\r\n    }\r\n    return ret.join('\\n');\r\n  }\r\n\r\n  /**\r\n   * @desc Return string of all functions converted\r\n   * @param {String[]} functionList - List of function names to build the string.\r\n   * @returns {Array} Prototypes of all functions converted\r\n   */\r\n  getPrototypesFromFunctionNames(functionList) {\r\n    const ret = [];\r\n    for (let i = 0; i < functionList.length; ++i) {\r\n      const functionName = functionList[i];\r\n      const functionIndex = this.nativeFunctionNames.indexOf(functionName);\r\n      if (functionIndex > -1) {\r\n        ret.push(this.nativeFunctions[functionIndex].source);\r\n        continue;\r\n      }\r\n      const node = this.functionMap[functionName];\r\n      if (node) {\r\n        ret.push(node.toString());\r\n      }\r\n    }\r\n    return ret;\r\n  }\r\n\r\n  toJSON() {\r\n    return this.traceFunctionCalls(this.rootNode.name).reverse().map(name => {\r\n      const nativeIndex = this.nativeFunctions.indexOf(name);\r\n      if (nativeIndex > -1) {\r\n        return {\r\n          name,\r\n          source: this.nativeFunctions[nativeIndex].source\r\n        };\r\n      } else if (this.functionMap[name]) {\r\n        return this.functionMap[name].toJSON();\r\n      } else {\r\n        throw new Error(`function ${ name } not found`);\r\n      }\r\n    });\r\n  }\r\n\r\n  fromJSON(jsonFunctionNodes, FunctionNode) {\r\n    this.functionMap = {};\r\n    for (let i = 0; i < jsonFunctionNodes.length; i++) {\r\n      const jsonFunctionNode = jsonFunctionNodes[i];\r\n      this.functionMap[jsonFunctionNode.settings.name] = new FunctionNode(jsonFunctionNode.ast, jsonFunctionNode.settings);\r\n    }\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * @desc Get string for a particular function name\r\n   * @param {String} functionName - Function name to trace from. If null, it returns the WHOLE builder stack\r\n   * @returns {String} settings - The string, of all the various functions. Trace optimized if functionName given\r\n   */\r\n  getString(functionName) {\r\n    if (functionName) {\r\n      return this.getStringFromFunctionNames(this.traceFunctionCalls(functionName).reverse());\r\n    }\r\n    return this.getStringFromFunctionNames(Object.keys(this.functionMap));\r\n  }\r\n\r\n  lookupReturnType(functionName, ast, requestingNode) {\r\n    if (ast.type !== 'CallExpression') {\r\n      throw new Error(`expected ast type of \"CallExpression\", but is ${ ast.type }`);\r\n    }\r\n    if (this._isNativeFunction(functionName)) {\r\n      return this._lookupNativeFunctionReturnType(functionName);\r\n    } else if (this._isFunction(functionName)) {\r\n      const node = this._getFunction(functionName);\r\n      if (node.returnType) {\r\n        return node.returnType;\r\n      } else {\r\n        for (let i = 0; i < this.lookupChain.length; i++) {\r\n          // detect circlical logic\r\n          if (this.lookupChain[i].ast === ast) {\r\n            // detect if arguments have not resolved, preventing a return type\r\n            // if so, go ahead and resolve them, so we can resolve the return type\r\n            if (node.argumentTypes.length === 0 && ast.arguments.length > 0) {\r\n              const args = ast.arguments;\r\n              for (let j = 0; j < args.length; j++) {\r\n                this.lookupChain.push({\r\n                  name: requestingNode.name,\r\n                  ast: args[i],\r\n                  requestingNode\r\n                });\r\n                node.argumentTypes[j] = requestingNode.getType(args[j]);\r\n                this.lookupChain.pop();\r\n              }\r\n              return node.returnType = node.getType(node.getJsAST());\r\n            }\r\n\r\n            throw new Error('circlical logic detected!');\r\n          }\r\n        }\r\n        // get ready for a ride!\r\n        this.lookupChain.push({\r\n          name: requestingNode.name,\r\n          ast,\r\n          requestingNode\r\n        });\r\n        const type = node.getType(node.getJsAST());\r\n        this.lookupChain.pop();\r\n        return node.returnType = type;\r\n      }\r\n    }\r\n\r\n    // function not found, maybe native?\r\n    return null;\r\n\r\n    /**\r\n     * first iteration\r\n     * kernel.outputs = Array\r\n     * kernel.targets = Array\r\n     * kernel.returns = null\r\n     * kernel.calls.calcErrorOutput = [kernel.output, kernel.targets]\r\n     * kernel.calls.calcDeltas = [calcErrorOutput.returns, kernel.output]\r\n     * calcErrorOutput.output = null\r\n     * calcErrorOutput.targets = null\r\n     * calcErrorOutput.returns = null\r\n     * calcDeltasSigmoid.error = null\r\n     * calcDeltasSigmoid.output = Number\r\n     * calcDeltasSigmoid.returns = null\r\n     *\r\n     * resolvable are:\r\n     * calcErrorOutput.output\r\n     * calcErrorOutput.targets\r\n     * calcErrorOutput.returns\r\n     *\r\n     * second iteration\r\n     * kernel.outputs = Array\r\n     * kernel.targets = Array\r\n     * kernel.returns = null\r\n     * kernel.calls.calcErrorOutput = [kernel.output, kernel.targets]\r\n     * kernel.calls.calcDeltas = [calcErrorOutput.returns, kernel.output]\r\n     * calcErrorOutput.output = Number\r\n     * calcErrorOutput.targets = Array\r\n     * calcErrorOutput.returns = Number\r\n     * calcDeltasSigmoid.error = null\r\n     * calcDeltasSigmoid.output = Number\r\n     * calcDeltasSigmoid.returns = null\r\n     *\r\n     * resolvable are:\r\n     * calcDeltasSigmoid.error\r\n     * calcDeltasSigmoid.returns\r\n     * kernel.returns\r\n     *\r\n     * third iteration\r\n     * kernel.outputs = Array\r\n     * kernel.targets = Array\r\n     * kernel.returns = Number\r\n     * kernel.calls.calcErrorOutput = [kernel.output, kernel.targets]\r\n     * kernel.calls.calcDeltas = [calcErrorOutput.returns, kernel.output]\r\n     * calcErrorOutput.output = Number\r\n     * calcErrorOutput.targets = Array\r\n     * calcErrorOutput.returns = Number\r\n     * calcDeltasSigmoid.error = Number\r\n     * calcDeltasSigmoid.output = Number\r\n     * calcDeltasSigmoid.returns = Number\r\n     *\r\n     *\r\n     */\r\n  }\r\n\r\n  _getFunction(functionName) {\r\n    if (!this._isFunction(functionName)) {\r\n      new Error(`Function ${functionName} not found`);\r\n    }\r\n    return this.functionMap[functionName];\r\n  }\r\n\r\n  _isFunction(functionName) {\r\n    return Boolean(this.functionMap[functionName]);\r\n  }\r\n\r\n  _getNativeFunction(functionName) {\r\n    for (let i = 0; i < this.nativeFunctions.length; i++) {\r\n      if (this.nativeFunctions[i].name === functionName) return this.nativeFunctions[i];\r\n    }\r\n    return null;\r\n  }\r\n\r\n  _isNativeFunction(functionName) {\r\n    return Boolean(this._getNativeFunction(functionName));\r\n  }\r\n\r\n  _lookupNativeFunctionReturnType(functionName) {\r\n    let nativeFunction = this._getNativeFunction(functionName);\r\n    if (nativeFunction) {\r\n      return nativeFunction.returnType;\r\n    }\r\n    throw new Error(`Native function ${ functionName } not found`);\r\n  }\r\n\r\n  lookupFunctionArgumentTypes(functionName) {\r\n    if (this._isNativeFunction(functionName)) {\r\n      return this._getNativeFunction(functionName).argumentTypes;\r\n    } else if (this._isFunction(functionName)) {\r\n      return this._getFunction(functionName).argumentTypes;\r\n    }\r\n    return null;\r\n  }\r\n\r\n  lookupFunctionArgumentName(functionName, argumentIndex) {\r\n    return this._getFunction(functionName).argumentNames[argumentIndex];\r\n  }\r\n\r\n  lookupFunctionArgumentBitRatio(functionName, argumentName) {\r\n    if (!this._isFunction(functionName)) {\r\n      throw new Error('function not found');\r\n    }\r\n    if (this.rootNode.name === functionName) {\r\n      const i = this.rootNode.argumentNames.indexOf(argumentName);\r\n      if (i !== -1) {\r\n        return this.rootNode.argumentBitRatios[i];\r\n      } else {\r\n        throw new Error('argument bit ratio not found');\r\n      }\r\n    } else {\r\n      const node = this._getFunction(functionName);\r\n      const argumentSynonym = node.argumentSynonym[node.synonymIndex];\r\n      if (!argumentSynonym) {\r\n        throw new Error('argument synonym not found');\r\n      }\r\n      return this.lookupFunctionArgumentBitRatio(argumentSynonym.functionName, argumentSynonym.argumentName);\r\n    }\r\n  }\r\n\r\n  needsArgumentType(functionName, i) {\r\n    if (!this._isFunction(functionName)) return false;\r\n    const fnNode = this._getFunction(functionName);\r\n    return !fnNode.argumentTypes[i];\r\n  }\r\n\r\n  assignArgumentType(functionName, i, argumentType, requestingNode) {\r\n    if (!this._isFunction(functionName)) return;\r\n    const fnNode = this._getFunction(functionName);\r\n    if (!fnNode.argumentTypes[i]) {\r\n      fnNode.argumentTypes[i] = argumentType;\r\n    }\r\n  }\r\n\r\n  trackArgumentSynonym(functionName, argumentName, calleeFunctionName, argumentIndex) {\r\n    if (!this._isFunction(calleeFunctionName)) return;\r\n    const node = this._getFunction(calleeFunctionName);\r\n    if (!node.argumentSynonym) {\r\n      node.argumentSynonym = {};\r\n    }\r\n    const calleeArgumentName = node.argumentNames[argumentIndex];\r\n    if (!node.argumentSynonym[calleeArgumentName]) {\r\n      node.argumentSynonym[calleeArgumentName] = {};\r\n    }\r\n    node.synonymIndex++;\r\n    node.argumentSynonym[node.synonymIndex] = {\r\n      functionName,\r\n      argumentName,\r\n      calleeArgumentName,\r\n      calleeFunctionName,\r\n    };\r\n  }\r\n\r\n  lookupArgumentSynonym(originFunctionName, functionName, argumentName) {\r\n    if (originFunctionName === functionName) return argumentName;\r\n    if (!this._isFunction(functionName)) return null;\r\n    const node = this._getFunction(functionName);\r\n    const argumentSynonym = node.argumentSynonym[node.synonymUseIndex];\r\n    if (!argumentSynonym) return null;\r\n    if (argumentSynonym.calleeArgumentName !== argumentName) return null;\r\n    node.synonymUseIndex++;\r\n    if (originFunctionName !== functionName) {\r\n      return this.lookupArgumentSynonym(originFunctionName, argumentSynonym.functionName, argumentSynonym.argumentName);\r\n    }\r\n    return argumentSynonym.argumentName;\r\n  }\r\n\r\n  trackFunctionCall(functionName, calleeFunctionName, args) {\r\n    if (!this.functionNodeDependencies[functionName]) {\r\n      this.functionNodeDependencies[functionName] = new Set();\r\n      this.functionCalls[functionName] = [];\r\n    }\r\n    this.functionNodeDependencies[functionName].add(calleeFunctionName);\r\n    this.functionCalls[functionName].push(args);\r\n  }\r\n\r\n  getKernelResultType() {\r\n    return this.rootNode.returnType || this.rootNode.getType(this.rootNode.ast);\r\n  }\r\n\r\n  getSubKernelResultType(index) {\r\n    const subKernelNode = this.subKernelNodes[index];\r\n    let called = false;\r\n    for (let functionCallIndex = 0; functionCallIndex < this.rootNode.functionCalls.length; functionCallIndex++) {\r\n      const functionCall = this.rootNode.functionCalls[functionCallIndex];\r\n      if (functionCall.ast.callee.name === subKernelNode.name) {\r\n        called = true;\r\n      }\r\n    }\r\n    if (!called) {\r\n      throw new Error(`SubKernel ${ subKernelNode.name } never called by kernel`);\r\n    }\r\n    return subKernelNode.returnType || subKernelNode.getType(subKernelNode.getJsAST());\r\n  }\r\n\r\n  getReturnTypes() {\r\n    const result = {\r\n      [this.rootNode.name]: this.rootNode.getType(this.rootNode.ast),\r\n    };\r\n    const list = this.traceFunctionCalls(this.rootNode.name);\r\n    for (let i = 0; i < list.length; i++) {\r\n      const functionName = list[i];\r\n      const functionNode = this.functionMap[functionName];\r\n      result[functionName] = functionNode.getType(functionNode.ast);\r\n    }\r\n    return result;\r\n  }\r\n}\r\n","export class FunctionTracer {\r\n  constructor(ast) {\r\n    this.runningContexts = [];\r\n    this.contexts = [];\r\n    this.functionCalls = [];\r\n    this.declarations = [];\r\n    this.identifiers = [];\r\n    this.functions = [];\r\n    this.returnStatements = [];\r\n    this.inLoopInit = false;\r\n    this.scan(ast);\r\n  }\r\n\r\n  get currentContext() {\r\n    return this.runningContexts.length > 0 ? this.runningContexts[this.runningContexts.length - 1] : null;\r\n  }\r\n\r\n  newContext(run) {\r\n    const newContext = Object.assign({}, this.currentContext);\r\n    this.contexts.push(newContext);\r\n    this.runningContexts.push(newContext);\r\n    run();\r\n    this.runningContexts.pop();\r\n  }\r\n\r\n  /**\r\n   * Recursively scans AST for declarations and functions, and add them to their respective context\r\n   * @param ast\r\n   */\r\n  scan(ast) {\r\n    if (Array.isArray(ast)) {\r\n      for (let i = 0; i < ast.length; i++) {\r\n        this.scan(ast[i]);\r\n      }\r\n      return;\r\n    }\r\n    switch (ast.type) {\r\n      case 'Program':\r\n        this.scan(ast.body);\r\n        break;\r\n      case 'BlockStatement':\r\n        this.newContext(() => {\r\n          this.scan(ast.body);\r\n        });\r\n        break;\r\n      case 'AssignmentExpression':\r\n        this.scan(ast.left);\r\n        this.scan(ast.right);\r\n        break;\r\n      case 'BinaryExpression':\r\n        this.scan(ast.left);\r\n        if (ast.right) this.scan(ast.right);\r\n        break;\r\n      case 'UpdateExpression':\r\n        this.scan(ast.argument);\r\n        break;\r\n      case 'UnaryExpression':\r\n        this.scan(ast.argument);\r\n        break;\r\n      case 'VariableDeclaration':\r\n        this.scan(ast.declarations);\r\n        break;\r\n      case 'VariableDeclarator':\r\n        const { currentContext } = this;\r\n        const declaration = {\r\n          ast: ast,\r\n          context: currentContext,\r\n          name: ast.id.name,\r\n          origin: 'declaration',\r\n          forceInteger: this.inLoopInit,\r\n          assignable: !this.inLoopInit && !currentContext.hasOwnProperty(ast.id.name),\r\n        };\r\n        currentContext[ast.id.name] = declaration;\r\n        this.declarations.push(declaration);\r\n        this.scan(ast.id);\r\n        this.scan(ast.init);\r\n        break;\r\n      case 'FunctionExpression':\r\n      case 'FunctionDeclaration':\r\n        if (this.runningContexts.length === 0) {\r\n          this.scan(ast.body);\r\n        } else {\r\n          this.functions.push(ast);\r\n        }\r\n        break;\r\n      case 'IfStatement':\r\n        this.scan(ast.test);\r\n        this.scan(ast.consequent);\r\n        if (ast.alternate) this.scan(ast.alternate);\r\n        break;\r\n      case 'ForStatement':\r\n        this.newContext(() => {\r\n          if (ast.init) {\r\n            this.inLoopInit = true;\r\n            this.scan(ast.init);\r\n            this.inLoopInit = false;\r\n          }\r\n          if (ast.test) {\r\n            this.scan(ast.test);\r\n          }\r\n          this.scan(ast.update);\r\n          this.newContext(() => {\r\n            this.scan(ast.body);\r\n          });\r\n        });\r\n        break;\r\n      case 'DoWhileStatement':\r\n      case 'WhileStatement':\r\n        this.newContext(() => {\r\n          this.scan(ast.body);\r\n          this.scan(ast.test);\r\n        });\r\n        break;\r\n      case 'Identifier':\r\n        this.identifiers.push({\r\n          context: this.currentContext,\r\n          ast,\r\n        });\r\n        break;\r\n      case 'ReturnStatement':\r\n        this.returnStatements.push(ast);\r\n        this.scan(ast.argument);\r\n        break;\r\n      case 'MemberExpression':\r\n        this.scan(ast.object);\r\n        this.scan(ast.property);\r\n        break;\r\n      case 'ExpressionStatement':\r\n        this.scan(ast.expression);\r\n        break;\r\n      case 'ThisExpression':\r\n        break;\r\n      case 'CallExpression':\r\n        this.functionCalls.push({\r\n          context: this.currentContext,\r\n          ast,\r\n        });\r\n        this.scan(ast.arguments);\r\n        break;\r\n      case 'ArrayExpression':\r\n        this.scan(ast.elements);\r\n        break;\r\n      case 'ConditionalExpression':\r\n        this.scan(ast.test);\r\n        this.scan(ast.alternate);\r\n        this.scan(ast.consequent);\r\n        break;\r\n      case 'SwitchStatement':\r\n        this.scan(ast.discriminant);\r\n        this.scan(ast.cases);\r\n        break;\r\n      case 'SwitchCase':\r\n        if (ast.test) this.scan(ast.test);\r\n        this.scan(ast.consequent);\r\n        break;\r\n      case 'LogicalExpression':\r\n        this.scan(ast.left);\r\n        this.scan(ast.right);\r\n        break;\r\n      case 'Literal':\r\n        break;\r\n      case 'DebuggerStatement':\r\n        break;\r\n      case 'EmptyStatement':\r\n        break;\r\n      case 'BreakStatement':\r\n        break;\r\n      default:\r\n        throw new Error(`unhandled type \"${ast.type}\"`);\r\n    }\r\n  }\r\n}\r\n","import { parse } from 'acorn';\r\nimport { FunctionTracer } from './function-tracer';\r\nimport {\r\n  getArgumentNamesFromString,\r\n  getAstString,\r\n  getFunctionNameFromString,\r\n  isFunctionString,\r\n} from '../common';\r\n\r\n/**\r\n *\r\n * @desc Represents a single function, inside JS, webGL, or openGL.\r\n * <p>This handles all the raw state, converted state, etc. Of a single function.</p>\r\n */\r\nexport class FunctionNode {\r\n  /**\r\n   *\r\n   * @param {string|object} source\r\n   * @param {IFunctionSettings} [settings]\r\n   */\r\n  constructor(source, settings) {\r\n    if (!source && !settings.ast) {\r\n      throw new Error('source parameter is missing');\r\n    }\r\n    settings = settings || {};\r\n    this.source = source;\r\n    this.ast = null;\r\n    this.name = typeof source === 'string' ? settings.isRootKernel ?\r\n      'kernel' :\r\n      (settings.name || getFunctionNameFromString(source)) : null;\r\n    this.calledFunctions = [];\r\n    this.constants = {};\r\n    this.constantTypes = {};\r\n    this.constantBitRatios = {};\r\n    this.isRootKernel = false;\r\n    this.isSubKernel = false;\r\n    this.debug = null;\r\n    this.declarations = null;\r\n    this.functions = null;\r\n    this.identifiers = null;\r\n    this.contexts = null;\r\n    this.functionCalls = null;\r\n    this.states = [];\r\n    this.needsArgumentType = null;\r\n    this.assignArgumentType = null;\r\n    this.lookupReturnType = null;\r\n    this.lookupFunctionArgumentTypes = null;\r\n    this.lookupFunctionArgumentBitRatio = null;\r\n    this.triggerImplyArgumentType = null;\r\n    this.triggerTrackArgumentSynonym = null;\r\n    this.lookupArgumentSynonym = null;\r\n    this.onNestedFunction = null;\r\n    this.onFunctionCall = null;\r\n    this.optimizeFloatMemory = null;\r\n    this.precision = null;\r\n    this.loopMaxIterations = null;\r\n    this.argumentNames = (typeof this.source === 'string' ? getArgumentNamesFromString(this.source) : null);\r\n    this.argumentTypes = [];\r\n    this.argumentSizes = [];\r\n    this.argumentBitRatios = null;\r\n    this.returnType = null;\r\n    this.output = [];\r\n    this.plugins = null;\r\n    this.leadingReturnStatement = null;\r\n    this.followingReturnStatement = null;\r\n    this.dynamicOutput = null;\r\n    this.dynamicArguments = null;\r\n    this.strictTypingChecking = false;\r\n    this.fixIntegerDivisionAccuracy = null;\r\n    this.warnVarUsage = true;\r\n\r\n    if (settings) {\r\n      for (const p in settings) {\r\n        if (!settings.hasOwnProperty(p)) continue;\r\n        if (!this.hasOwnProperty(p)) continue;\r\n        this[p] = settings[p];\r\n      }\r\n    }\r\n\r\n    this.synonymIndex = -1;\r\n    this.synonymUseIndex = 0;\r\n    this.argumentSynonym = {};\r\n    this.literalTypes = {};\r\n\r\n    this.validate();\r\n    this._string = null;\r\n    this._internalVariableNames = {};\r\n  }\r\n\r\n  validate() {\r\n    if (typeof this.source !== 'string' && !this.ast) {\r\n      throw new Error('this.source not a string');\r\n    }\r\n\r\n    if (!this.ast && !isFunctionString(this.source)) {\r\n      throw new Error('this.source not a function string');\r\n    }\r\n\r\n    if (!this.name) {\r\n      throw new Error('this.name could not be set');\r\n    }\r\n\r\n    if (this.argumentTypes.length > 0 && this.argumentTypes.length !== this.argumentNames.length) {\r\n      throw new Error(`argumentTypes count of ${ this.argumentTypes.length } exceeds ${ this.argumentNames.length }`);\r\n    }\r\n\r\n    if (this.output.length < 1) {\r\n      throw new Error('this.output is not big enough');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @param {String} name\r\n   * @returns {boolean}\r\n   */\r\n  isIdentifierConstant(name) {\r\n    if (!this.constants) return false;\r\n    return this.constants.hasOwnProperty(name);\r\n  }\r\n\r\n  isInput(argumentName) {\r\n    return this.argumentTypes[this.argumentNames.indexOf(argumentName)] === 'Input';\r\n  }\r\n\r\n  pushState(state) {\r\n    this.states.push(state);\r\n  }\r\n\r\n  popState(state) {\r\n    if (this.state !== state) {\r\n      throw new Error(`Cannot popState ${ state } when in ${ this.state }`);\r\n    }\r\n    this.states.pop();\r\n  }\r\n\r\n  isState(state) {\r\n    return this.state === state;\r\n  }\r\n\r\n  get state() {\r\n    return this.states[this.states.length - 1];\r\n  }\r\n\r\n  /**\r\n   * @function\r\n   * @name astMemberExpressionUnroll\r\n   * @desc Parses the abstract syntax tree for binary expression.\r\n   *\r\n   * <p>Utility function for astCallExpression.</p>\r\n   *\r\n   * @param {Object} ast - the AST object to parse\r\n   *\r\n   * @returns {String} the function namespace call, unrolled\r\n   */\r\n  astMemberExpressionUnroll(ast) {\r\n    if (ast.type === 'Identifier') {\r\n      return ast.name;\r\n    } else if (ast.type === 'ThisExpression') {\r\n      return 'this';\r\n    }\r\n\r\n    if (ast.type === 'MemberExpression') {\r\n      if (ast.object && ast.property) {\r\n        //babel sniffing\r\n        if (ast.object.hasOwnProperty('name') && ast.object.name[0] === '_') {\r\n          return this.astMemberExpressionUnroll(ast.property);\r\n        }\r\n\r\n        return (\r\n          this.astMemberExpressionUnroll(ast.object) +\r\n          '.' +\r\n          this.astMemberExpressionUnroll(ast.property)\r\n        );\r\n      }\r\n    }\r\n\r\n    //babel sniffing\r\n    if (ast.hasOwnProperty('expressions')) {\r\n      const firstExpression = ast.expressions[0];\r\n      if (firstExpression.type === 'Literal' && firstExpression.value === 0 && ast.expressions.length === 2) {\r\n        return this.astMemberExpressionUnroll(ast.expressions[1]);\r\n      }\r\n    }\r\n\r\n    // Failure, unknown expression\r\n    throw this.astErrorOutput('Unknown astMemberExpressionUnroll', ast);\r\n  }\r\n\r\n  /**\r\n   * @desc Parses the class function JS, and returns its Abstract Syntax Tree object.\r\n   * This is used internally to convert to shader code\r\n   *\r\n   * @param {Object} [import { $1 } from $2] - Parser to use, assumes in scope 'parser' if null or undefined\r\n   *\r\n   * @returns {Object} The function AST Object, note that result is cached under this.ast;\r\n   */\r\n  getJsAST(inParser) {\r\n    if (this.ast) {\r\n      return this.ast;\r\n    }\r\n    if (typeof this.source === 'object') {\r\n      this.traceFunctionAST(this.source);\r\n      return this.ast = this.source;\r\n    }\r\n\r\n    const parser = inParser && inParser.hasOwnProperty('parse') ? inParser.parse : parse\r\n    if (inParser === null) {\r\n      throw new Error('Missing JS to AST parser');\r\n    }\r\n\r\n    const ast = Object.freeze(parser(`const parser_${ this.name } = ${ this.source };`, {\r\n      locations: true\r\n    }));\r\n    // take out the function object, outside the var declarations\r\n    const functionAST = ast.body[0].declarations[0].init;\r\n    this.traceFunctionAST(functionAST);\r\n\r\n    if (!ast) {\r\n      throw new Error('Failed to parse JS code');\r\n    }\r\n\r\n    return this.ast = functionAST;\r\n  }\r\n\r\n  traceFunctionAST(ast) {\r\n    const { contexts, declarations, functions, identifiers, functionCalls } = new FunctionTracer(ast);\r\n    this.contexts = contexts;\r\n    this.identifiers = identifiers;\r\n    this.functionCalls = functionCalls;\r\n    this.declarations = [];\r\n    this.functions = functions;\r\n    for (let i = 0; i < declarations.length; i++) {\r\n      const declaration = declarations[i];\r\n      const { ast, context, name, origin, forceInteger, assignable } = declaration;\r\n      const { init } = ast;\r\n      const dependencies = this.getDependencies(init);\r\n      let valueType = null;\r\n\r\n      if (forceInteger) {\r\n        valueType = 'Integer';\r\n      } else {\r\n        if (init) {\r\n          const realType = this.getType(init);\r\n          switch (realType) {\r\n            case 'Integer':\r\n            case 'Float':\r\n            case 'Number':\r\n              if (init.type === 'MemberExpression') {\r\n                valueType = realType;\r\n              } else {\r\n                valueType = 'Number';\r\n              }\r\n              break;\r\n            case 'LiteralInteger':\r\n              valueType = 'Number';\r\n              break;\r\n            default:\r\n              valueType = realType;\r\n          }\r\n        }\r\n      }\r\n      this.declarations.push({\r\n        valueType,\r\n        dependencies,\r\n        isSafe: this.isSafeDependencies(dependencies),\r\n        ast,\r\n        name,\r\n        context,\r\n        origin,\r\n        assignable,\r\n      });\r\n    }\r\n\r\n    for (let i = 0; i < functions.length; i++) {\r\n      this.onNestedFunction(functions[i]);\r\n    }\r\n  }\r\n\r\n  getDeclaration(ast) {\r\n    for (let i = 0; i < this.identifiers.length; i++) {\r\n      const identifier = this.identifiers[i];\r\n      if (ast === identifier.ast && identifier.context.hasOwnProperty(ast.name)) {\r\n        for (let j = 0; j < this.declarations.length; j++) {\r\n          const declaration = this.declarations[j];\r\n          if (declaration.name === ast.name && declaration.context[ast.name] === identifier.context[ast.name]) {\r\n            return declaration;\r\n          }\r\n        }\r\n      }\r\n    }\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * @desc Return the type of parameter sent to subKernel/Kernel.\r\n   * @param {Object} ast - Identifier\r\n   * @returns {String} Type of the parameter\r\n   */\r\n  getVariableType(ast) {\r\n    if (ast.type !== 'Identifier') {\r\n      throw new Error(`ast of ${ast.type} not \"Identifier\"`);\r\n    }\r\n    let type = null;\r\n    const argumentIndex = this.argumentNames.indexOf(ast.name);\r\n    if (argumentIndex === -1) {\r\n      const declaration = this.getDeclaration(ast);\r\n      if (declaration) {\r\n        return declaration.valueType;\r\n      }\r\n    } else {\r\n      const argumentType = this.argumentTypes[argumentIndex];\r\n      if (argumentType) {\r\n        type = argumentType;\r\n      }\r\n    }\r\n    if (!type && this.strictTypingChecking) {\r\n      throw new Error(`Declaration of ${name} not found`);\r\n    }\r\n    return type;\r\n  }\r\n\r\n  /**\r\n   * Generally used to lookup the value type returned from a member expressions\r\n   * @param {String} type\r\n   * @return {String}\r\n   */\r\n  getLookupType(type) {\r\n    if (!typeLookupMap.hasOwnProperty(type)) {\r\n      throw new Error(`unknown typeLookupMap ${ type }`);\r\n    }\r\n    return typeLookupMap[type];\r\n  }\r\n\r\n  getConstantType(constantName) {\r\n    if (this.constantTypes[constantName]) {\r\n      const type = this.constantTypes[constantName];\r\n      if (type === 'Float') {\r\n        return 'Number';\r\n      } else {\r\n        return type;\r\n      }\r\n    }\r\n    throw new Error(`Type for constant \"${ constantName }\" not declared`);\r\n  }\r\n\r\n  /**\r\n   * @desc Return the name of the *user argument*(subKernel argument) corresponding\r\n   * to the argument supplied to the kernel\r\n   *\r\n   * @param {String} name - Name of the argument\r\n   * @returns {String} Name of the parameter\r\n   */\r\n  getKernelArgumentName(name) {\r\n    if (!this.lookupArgumentSynonym) return null;\r\n    const argumentIndex = this.argumentNames.indexOf(name);\r\n    if (argumentIndex === -1) return null;\r\n    return this.lookupArgumentSynonym('kernel', this.name, name);\r\n  }\r\n\r\n  toString() {\r\n    if (this._string) return this._string;\r\n    return this._string = this.astGeneric(this.getJsAST(), []).join('').trim();\r\n  }\r\n\r\n  toJSON() {\r\n    const settings = {\r\n      source: this.source,\r\n      name: this.name,\r\n      constants: this.constants,\r\n      constantTypes: this.constantTypes,\r\n      isRootKernel: this.isRootKernel,\r\n      isSubKernel: this.isSubKernel,\r\n      debug: this.debug,\r\n      output: this.output,\r\n      loopMaxIterations: this.loopMaxIterations,\r\n      argumentNames: this.argumentNames,\r\n      argumentTypes: this.argumentTypes,\r\n      argumentSizes: this.argumentSizes,\r\n      returnType: this.returnType,\r\n      leadingReturnStatement: this.leadingReturnStatement,\r\n      followingReturnStatement: this.followingReturnStatement,\r\n    };\r\n\r\n    return {\r\n      ast: this.ast,\r\n      settings\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Recursively looks up type for ast expression until it's found\r\n   * @param ast\r\n   * @returns {String|null}\r\n   */\r\n  getType(ast) {\r\n    if (Array.isArray(ast)) {\r\n      return this.getType(ast[ast.length - 1]);\r\n    }\r\n    switch (ast.type) {\r\n      case 'BlockStatement':\r\n        return this.getType(ast.body);\r\n      case 'ArrayExpression':\r\n        return `Array(${ ast.elements.length })`;\r\n      case 'Literal':\r\n        const literalKey = `${ast.start},${ast.end}`;\r\n        if (this.literalTypes[literalKey]) {\r\n          return this.literalTypes[literalKey];\r\n        }\r\n        if (Number.isInteger(ast.value)) {\r\n          return 'LiteralInteger';\r\n        } else if (ast.value === true || ast.value === false) {\r\n          return 'Boolean';\r\n        } else {\r\n          return 'Number';\r\n        }\r\n        case 'AssignmentExpression':\r\n          return this.getType(ast.left);\r\n        case 'CallExpression':\r\n          if (this.isAstMathFunction(ast)) {\r\n            return 'Number';\r\n          }\r\n          if (!ast.callee || !ast.callee.name) {\r\n            if (ast.callee.type === 'SequenceExpression' && ast.callee.expressions[ast.callee.expressions.length - 1].property.name) {\r\n              const functionName = ast.callee.expressions[ast.callee.expressions.length - 1].property.name;\r\n              this.inferArgumentTypesIfNeeded(functionName, ast.arguments);\r\n              return this.lookupReturnType(functionName, ast, this);\r\n            }\r\n            throw this.astErrorOutput('Unknown call expression', ast);\r\n          }\r\n          if (ast.callee && ast.callee.name) {\r\n            const functionName = ast.callee.name;\r\n            this.inferArgumentTypesIfNeeded(functionName, ast.arguments);\r\n            return this.lookupReturnType(functionName, ast, this);\r\n          }\r\n          throw this.astErrorOutput(`Unhandled getType Type \"${ ast.type }\"`, ast);\r\n        case 'BinaryExpression':\r\n          // modulos is Number\r\n          switch (ast.operator) {\r\n            case '%':\r\n            case '/':\r\n              if (this.fixIntegerDivisionAccuracy) {\r\n                return 'Number';\r\n              } else {\r\n                break;\r\n              }\r\n              case '>':\r\n              case '<':\r\n                return 'Boolean';\r\n              case '&':\r\n              case '|':\r\n              case '^':\r\n              case '<<':\r\n              case '>>':\r\n              case '>>>':\r\n                return 'Integer';\r\n          }\r\n          const type = this.getType(ast.left);\r\n          if (this.isState('skip-literal-correction')) return type;\r\n          if (type === 'LiteralInteger') {\r\n            const rightType = this.getType(ast.right);\r\n            if (rightType === 'LiteralInteger') {\r\n              if (ast.left.value % 1 === 0) {\r\n                return 'Integer';\r\n              } else {\r\n                return 'Float';\r\n              }\r\n            }\r\n            return rightType;\r\n          }\r\n          return typeLookupMap[type] || type;\r\n        case 'UpdateExpression':\r\n          return this.getType(ast.argument);\r\n        case 'UnaryExpression':\r\n          if (ast.operator === '~') {\r\n            return 'Integer';\r\n          }\r\n          return this.getType(ast.argument);\r\n        case 'VariableDeclaration': {\r\n          const declarations = ast.declarations;\r\n          let lastType;\r\n          for (let i = 0; i < declarations.length; i++) {\r\n            const declaration = declarations[i];\r\n            lastType = this.getType(declaration);\r\n          }\r\n          if (!lastType) {\r\n            throw this.astErrorOutput(`Unable to find type for declaration`, ast);\r\n          }\r\n          return lastType;\r\n        }\r\n        case 'VariableDeclarator':\r\n          const declaration = this.getDeclaration(ast.id);\r\n          if (!declaration) {\r\n            throw this.astErrorOutput(`Unable to find declarator`, ast);\r\n          }\r\n\r\n          if (!declaration.valueType) {\r\n            throw this.astErrorOutput(`Unable to find declarator valueType`, ast);\r\n          }\r\n\r\n          return declaration.valueType;\r\n        case 'Identifier':\r\n          if (ast.name === 'Infinity') {\r\n            return 'Number';\r\n          }\r\n          if (this.isAstVariable(ast)) {\r\n            const signature = this.getVariableSignature(ast);\r\n            if (signature === 'value') {\r\n              const type = this.getVariableType(ast);\r\n              if (!type) {\r\n                throw this.astErrorOutput(`Unable to find identifier valueType`, ast);\r\n              }\r\n              return type;\r\n            }\r\n          }\r\n          const origin = this.findIdentifierOrigin(ast);\r\n          if (origin && origin.init) {\r\n            return this.getType(origin.init);\r\n          }\r\n          return null;\r\n        case 'ReturnStatement':\r\n          return this.getType(ast.argument);\r\n        case 'MemberExpression':\r\n          if (this.isAstMathFunction(ast)) {\r\n            switch (ast.property.name) {\r\n              case 'ceil':\r\n                return 'Integer';\r\n              case 'floor':\r\n                return 'Integer';\r\n              case 'round':\r\n                return 'Integer';\r\n            }\r\n            return 'Number';\r\n          }\r\n          if (this.isAstVariable(ast)) {\r\n            const variableSignature = this.getVariableSignature(ast);\r\n            switch (variableSignature) {\r\n              case 'value[]':\r\n                return this.getLookupType(this.getVariableType(ast.object));\r\n              case 'value[][]':\r\n                return this.getLookupType(this.getVariableType(ast.object.object));\r\n              case 'value[][][]':\r\n                return this.getLookupType(this.getVariableType(ast.object.object.object));\r\n              case 'value[][][][]':\r\n                return this.getLookupType(this.getVariableType(ast.object.object.object.object));\r\n              case 'value.thread.value':\r\n              case 'this.thread.value':\r\n                return 'Integer';\r\n              case 'this.output.value':\r\n                return this.dynamicOutput ? 'Integer' : 'LiteralInteger';\r\n              case 'this.constants.value':\r\n                return this.getConstantType(ast.property.name);\r\n              case 'this.constants.value[]':\r\n                return this.getLookupType(this.getConstantType(ast.object.property.name));\r\n              case 'this.constants.value[][]':\r\n                return this.getLookupType(this.getConstantType(ast.object.object.property.name));\r\n              case 'this.constants.value[][][]':\r\n                return this.getLookupType(this.getConstantType(ast.object.object.object.property.name));\r\n              case 'this.constants.value[][][][]':\r\n                return this.getLookupType(this.getConstantType(ast.object.object.object.object.property.name));\r\n              case 'fn()[]':\r\n                return this.getLookupType(this.getType(ast.object));\r\n              case 'fn()[][]':\r\n                return this.getLookupType(this.getType(ast.object));\r\n              case 'fn()[][][]':\r\n                return this.getLookupType(this.getType(ast.object));\r\n              case 'value.value':\r\n                if (this.isAstMathVariable(ast)) {\r\n                  return 'Number';\r\n                }\r\n                switch (ast.property.name) {\r\n                  case 'r':\r\n                    return this.getLookupType(this.getVariableType(ast.object));\r\n                  case 'g':\r\n                    return this.getLookupType(this.getVariableType(ast.object));\r\n                  case 'b':\r\n                    return this.getLookupType(this.getVariableType(ast.object));\r\n                  case 'a':\r\n                    return this.getLookupType(this.getVariableType(ast.object));\r\n                }\r\n                case '[][]':\r\n                  return 'Number';\r\n            }\r\n            throw this.astErrorOutput('Unhandled getType MemberExpression', ast);\r\n          }\r\n          throw this.astErrorOutput('Unhandled getType MemberExpression', ast);\r\n        case 'ConditionalExpression':\r\n          return this.getType(ast.consequent);\r\n        case 'FunctionDeclaration':\r\n        case 'FunctionExpression':\r\n          const lastReturn = this.findLastReturn(ast.body);\r\n          if (lastReturn) {\r\n            return this.getType(lastReturn);\r\n          }\r\n          return null;\r\n        case 'IfStatement':\r\n          return this.getType(ast.consequent);\r\n        default:\r\n          throw this.astErrorOutput(`Unhandled getType Type \"${ ast.type }\"`, ast);\r\n    }\r\n  }\r\n\r\n  inferArgumentTypesIfNeeded(functionName, args) {\r\n    // ensure arguments are filled in, so when we lookup return type, we already can infer it\r\n    for (let i = 0; i < args.length; i++) {\r\n      if (!this.needsArgumentType(functionName, i)) continue;\r\n      const type = this.getType(args[i]);\r\n      if (!type) {\r\n        throw this.astErrorOutput(`Unable to infer argument ${i}`, args[i]);\r\n      }\r\n      this.assignArgumentType(functionName, i, type);\r\n    }\r\n  }\r\n\r\n  isAstMathVariable(ast) {\r\n    const mathProperties = [\r\n      'E',\r\n      'PI',\r\n      'SQRT2',\r\n      'SQRT1_2',\r\n      'LN2',\r\n      'LN10',\r\n      'LOG2E',\r\n      'LOG10E',\r\n    ];\r\n    return ast.type === 'MemberExpression' &&\r\n      ast.object && ast.object.type === 'Identifier' &&\r\n      ast.object.name === 'Math' &&\r\n      ast.property &&\r\n      ast.property.type === 'Identifier' &&\r\n      mathProperties.indexOf(ast.property.name) > -1;\r\n  }\r\n\r\n  isAstMathFunction(ast) {\r\n    const mathFunctions = [\r\n      'abs',\r\n      'acos',\r\n      'asin',\r\n      'atan',\r\n      'atan2',\r\n      'ceil',\r\n      'cos',\r\n      'exp',\r\n      'floor',\r\n      'log',\r\n      'log2',\r\n      'max',\r\n      'min',\r\n      'pow',\r\n      'random',\r\n      'round',\r\n      'sign',\r\n      'sin',\r\n      'sqrt',\r\n      'tan',\r\n    ];\r\n    return ast.type === 'CallExpression' &&\r\n      ast.callee &&\r\n      ast.callee.type === 'MemberExpression' &&\r\n      ast.callee.object &&\r\n      ast.callee.object.type === 'Identifier' &&\r\n      ast.callee.object.name === 'Math' &&\r\n      ast.callee.property &&\r\n      ast.callee.property.type === 'Identifier' &&\r\n      mathFunctions.indexOf(ast.callee.property.name) > -1;\r\n  }\r\n\r\n  isAstVariable(ast) {\r\n    return ast.type === 'Identifier' || ast.type === 'MemberExpression';\r\n  }\r\n\r\n  isSafe(ast) {\r\n    return this.isSafeDependencies(this.getDependencies(ast));\r\n  }\r\n\r\n  isSafeDependencies(dependencies) {\r\n    return dependencies && dependencies.every ? dependencies.every(dependency => dependency.isSafe) : true;\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @param ast\r\n   * @param dependencies\r\n   * @param isNotSafe\r\n   * @return {Array}\r\n   */\r\n  getDependencies(ast, dependencies, isNotSafe) {\r\n    if (!dependencies) {\r\n      dependencies = [];\r\n    }\r\n    if (!ast) return null;\r\n    if (Array.isArray(ast)) {\r\n      for (let i = 0; i < ast.length; i++) {\r\n        this.getDependencies(ast[i], dependencies, isNotSafe);\r\n      }\r\n      return dependencies;\r\n    }\r\n    switch (ast.type) {\r\n      case 'AssignmentExpression':\r\n        this.getDependencies(ast.left, dependencies, isNotSafe);\r\n        this.getDependencies(ast.right, dependencies, isNotSafe);\r\n        return dependencies;\r\n      case 'Literal':\r\n        dependencies.push({\r\n          origin: 'literal',\r\n          value: ast.value,\r\n          isSafe: isNotSafe === true ? false : ast.value > -Infinity && ast.value < Infinity && !isNaN(ast.value)\r\n        });\r\n        break;\r\n      case 'VariableDeclarator':\r\n        return this.getDependencies(ast.init, dependencies, isNotSafe);\r\n      case 'Identifier':\r\n        const declaration = this.getDeclaration(ast);\r\n        if (declaration) {\r\n          dependencies.push({\r\n            name: ast.name,\r\n            origin: 'declaration',\r\n            isSafe: isNotSafe ? false : this.isSafeDependencies(declaration.dependencies),\r\n          });\r\n        } else if (this.argumentNames.indexOf(ast.name) > -1) {\r\n          dependencies.push({\r\n            name: ast.name,\r\n            origin: 'argument',\r\n            isSafe: false,\r\n          });\r\n        } else if (this.strictTypingChecking) {\r\n          throw new Error(`Cannot find identifier origin \"${ast.name}\"`);\r\n        }\r\n        break;\r\n      case 'FunctionDeclaration':\r\n        return this.getDependencies(ast.body.body[ast.body.body.length - 1], dependencies, isNotSafe);\r\n      case 'ReturnStatement':\r\n        return this.getDependencies(ast.argument, dependencies);\r\n      case 'BinaryExpression':\r\n        isNotSafe = (ast.operator === '/' || ast.operator === '*');\r\n        this.getDependencies(ast.left, dependencies, isNotSafe);\r\n        this.getDependencies(ast.right, dependencies, isNotSafe);\r\n        return dependencies;\r\n      case 'UnaryExpression':\r\n      case 'UpdateExpression':\r\n        return this.getDependencies(ast.argument, dependencies, isNotSafe);\r\n      case 'VariableDeclaration':\r\n        return this.getDependencies(ast.declarations, dependencies, isNotSafe);\r\n      case 'ArrayExpression':\r\n        dependencies.push({\r\n          origin: 'declaration',\r\n          isSafe: true,\r\n        });\r\n        return dependencies;\r\n      case 'CallExpression':\r\n        dependencies.push({\r\n          origin: 'function',\r\n          isSafe: true,\r\n        });\r\n        return dependencies;\r\n      case 'MemberExpression':\r\n        const details = this.getMemberExpressionDetails(ast);\r\n        switch (details.signature) {\r\n          case 'value[]':\r\n            this.getDependencies(ast.object, dependencies, isNotSafe);\r\n            break;\r\n          case 'value[][]':\r\n            this.getDependencies(ast.object.object, dependencies, isNotSafe);\r\n            break;\r\n          case 'value[][][]':\r\n            this.getDependencies(ast.object.object.object, dependencies, isNotSafe);\r\n            break;\r\n          case 'this.output.value':\r\n            if (this.dynamicOutput) {\r\n              dependencies.push({\r\n                name: details.name,\r\n                origin: 'output',\r\n                isSafe: false,\r\n              });\r\n            }\r\n            break;\r\n        }\r\n        if (details) {\r\n          if (details.property) {\r\n            this.getDependencies(details.property, dependencies, isNotSafe);\r\n          }\r\n          if (details.xProperty) {\r\n            this.getDependencies(details.xProperty, dependencies, isNotSafe);\r\n          }\r\n          if (details.yProperty) {\r\n            this.getDependencies(details.yProperty, dependencies, isNotSafe);\r\n          }\r\n          if (details.zProperty) {\r\n            this.getDependencies(details.zProperty, dependencies, isNotSafe);\r\n          }\r\n          return dependencies;\r\n        }\r\n        default:\r\n          throw this.astErrorOutput(`Unhandled type ${ ast.type } in getDependencies`, ast);\r\n    }\r\n    return dependencies;\r\n  }\r\n\r\n  getVariableSignature(ast) {\r\n    if (!this.isAstVariable(ast)) {\r\n      throw new Error(`ast of type \"${ ast.type }\" is not a variable signature`);\r\n    }\r\n    if (ast.type === 'Identifier') {\r\n      return 'value';\r\n    }\r\n    const signature = [];\r\n    while (true) {\r\n      if (!ast) break;\r\n      if (ast.computed) {\r\n        signature.push('[]');\r\n      } else if (ast.type === 'ThisExpression') {\r\n        signature.unshift('this');\r\n      } else if (ast.property && ast.property.name) {\r\n        if (\r\n          ast.property.name === 'x' ||\r\n          ast.property.name === 'y' ||\r\n          ast.property.name === 'z'\r\n        ) {\r\n          signature.unshift('.value');\r\n        } else if (\r\n          ast.property.name === 'constants' ||\r\n          ast.property.name === 'thread' ||\r\n          ast.property.name === 'output'\r\n        ) {\r\n          signature.unshift('.' + ast.property.name);\r\n        } else {\r\n          signature.unshift('.value');\r\n        }\r\n      } else if (ast.name) {\r\n        signature.unshift('value');\r\n      } else if (ast.callee && ast.callee.name) {\r\n        signature.unshift('fn()');\r\n      } else if (ast.elements) {\r\n        signature.unshift('[]');\r\n      } else {\r\n        signature.unshift('unknown');\r\n      }\r\n      ast = ast.object;\r\n    }\r\n\r\n    const signatureString = signature.join('');\r\n    const allowedExpressions = [\r\n      'value',\r\n      'value[]',\r\n      'value[][]',\r\n      'value[][][]',\r\n      'value[][][][]',\r\n      'value.value',\r\n      'value.thread.value',\r\n      'this.thread.value',\r\n      'this.output.value',\r\n      'this.constants.value',\r\n      'this.constants.value[]',\r\n      'this.constants.value[][]',\r\n      'this.constants.value[][][]',\r\n      'this.constants.value[][][][]',\r\n      'fn()[]',\r\n      'fn()[][]',\r\n      'fn()[][][]',\r\n      '[][]',\r\n    ];\r\n    if (allowedExpressions.indexOf(signatureString) > -1) {\r\n      return signatureString;\r\n    }\r\n    return null;\r\n  }\r\n\r\n  build() {\r\n    return this.toString().length > 0;\r\n  }\r\n\r\n  /**\r\n   * @desc Parses the abstract syntax tree for generically to its respective function\r\n   * @param {Object} ast - the AST object to parse\r\n   * @param {Array} retArr - return array string\r\n   * @returns {Array} the parsed string array\r\n   */\r\n  astGeneric(ast, retArr) {\r\n    if (ast === null) {\r\n      throw this.astErrorOutput('NULL ast', ast);\r\n    } else {\r\n      if (Array.isArray(ast)) {\r\n        for (let i = 0; i < ast.length; i++) {\r\n          this.astGeneric(ast[i], retArr);\r\n        }\r\n        return retArr;\r\n      }\r\n\r\n      switch (ast.type) {\r\n        case 'FunctionDeclaration':\r\n          return this.astFunctionDeclaration(ast, retArr);\r\n        case 'FunctionExpression':\r\n          return this.astFunctionExpression(ast, retArr);\r\n        case 'ReturnStatement':\r\n          return this.astReturnStatement(ast, retArr);\r\n        case 'Literal':\r\n          return this.astLiteral(ast, retArr);\r\n        case 'BinaryExpression':\r\n          return this.astBinaryExpression(ast, retArr);\r\n        case 'Identifier':\r\n          return this.astIdentifierExpression(ast, retArr);\r\n        case 'AssignmentExpression':\r\n          return this.astAssignmentExpression(ast, retArr);\r\n        case 'ExpressionStatement':\r\n          return this.astExpressionStatement(ast, retArr);\r\n        case 'EmptyStatement':\r\n          return this.astEmptyStatement(ast, retArr);\r\n        case 'BlockStatement':\r\n          return this.astBlockStatement(ast, retArr);\r\n        case 'IfStatement':\r\n          return this.astIfStatement(ast, retArr);\r\n        case 'SwitchStatement':\r\n          return this.astSwitchStatement(ast, retArr);\r\n        case 'BreakStatement':\r\n          return this.astBreakStatement(ast, retArr);\r\n        case 'ContinueStatement':\r\n          return this.astContinueStatement(ast, retArr);\r\n        case 'ForStatement':\r\n          return this.astForStatement(ast, retArr);\r\n        case 'WhileStatement':\r\n          return this.astWhileStatement(ast, retArr);\r\n        case 'DoWhileStatement':\r\n          return this.astDoWhileStatement(ast, retArr);\r\n        case 'VariableDeclaration':\r\n          return this.astVariableDeclaration(ast, retArr);\r\n        case 'VariableDeclarator':\r\n          return this.astVariableDeclarator(ast, retArr);\r\n        case 'ThisExpression':\r\n          return this.astThisExpression(ast, retArr);\r\n        case 'SequenceExpression':\r\n          return this.astSequenceExpression(ast, retArr);\r\n        case 'UnaryExpression':\r\n          return this.astUnaryExpression(ast, retArr);\r\n        case 'UpdateExpression':\r\n          return this.astUpdateExpression(ast, retArr);\r\n        case 'LogicalExpression':\r\n          return this.astLogicalExpression(ast, retArr);\r\n        case 'MemberExpression':\r\n          return this.astMemberExpression(ast, retArr);\r\n        case 'CallExpression':\r\n          return this.astCallExpression(ast, retArr);\r\n        case 'ArrayExpression':\r\n          return this.astArrayExpression(ast, retArr);\r\n        case 'DebuggerStatement':\r\n          return this.astDebuggerStatement(ast, retArr);\r\n        case 'ConditionalExpression':\r\n          return this.astConditionalExpression(ast, retArr);\r\n      }\r\n\r\n      throw this.astErrorOutput('Unknown ast type : ' + ast.type, ast);\r\n    }\r\n  }\r\n  /**\r\n   * @desc To throw the AST error, with its location.\r\n   * @param {string} error - the error message output\r\n   * @param {Object} ast - the AST object where the error is\r\n   */\r\n  astErrorOutput(error, ast) {\r\n    if (typeof this.source !== 'string') {\r\n      return new Error(error);\r\n    }\r\n\r\n    const debugString = getAstString(this.source, ast);\r\n    const leadingSource = this.source.substr(ast.start);\r\n    const splitLines = leadingSource.split(/\\n/);\r\n    const lineBefore = splitLines.length > 0 ? splitLines[splitLines.length - 1] : 0;\r\n    return new Error(`${error} on line ${ splitLines.length }, position ${ lineBefore.length }:\\n ${ debugString }`);\r\n  }\r\n\r\n  astDebuggerStatement(arrNode, retArr) {\r\n    return retArr;\r\n  }\r\n\r\n  astConditionalExpression(ast, retArr) {\r\n    if (ast.type !== 'ConditionalExpression') {\r\n      throw this.astErrorOutput('Not a conditional expression', ast);\r\n    }\r\n    retArr.push('(');\r\n    this.astGeneric(ast.test, retArr);\r\n    retArr.push('?');\r\n    this.astGeneric(ast.consequent, retArr);\r\n    retArr.push(':');\r\n    this.astGeneric(ast.alternate, retArr);\r\n    retArr.push(')');\r\n    return retArr;\r\n  }\r\n\r\n  /**\r\n   * @abstract\r\n   * @param {Object} ast\r\n   * @param {String[]} retArr\r\n   * @returns {String[]}\r\n   */\r\n  astFunction(ast, retArr) {\r\n    throw new Error(`\"astFunction\" not defined on ${ this.constructor.name }`);\r\n  }\r\n\r\n  /**\r\n   * @desc Parses the abstract syntax tree for to its *named function declaration*\r\n   * @param {Object} ast - the AST object to parse\r\n   * @param {Array} retArr - return array string\r\n   * @returns {Array} the append retArr\r\n   */\r\n  astFunctionDeclaration(ast, retArr) {\r\n    if (this.isChildFunction(ast)) {\r\n      return retArr;\r\n    }\r\n    return this.astFunction(ast, retArr);\r\n  }\r\n  astFunctionExpression(ast, retArr) {\r\n    if (this.isChildFunction(ast)) {\r\n      return retArr;\r\n    }\r\n    return this.astFunction(ast, retArr);\r\n  }\r\n  isChildFunction(ast) {\r\n    for (let i = 0; i < this.functions.length; i++) {\r\n      if (this.functions[i] === ast) {\r\n        return true;\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n  astReturnStatement(ast, retArr) {\r\n    return retArr;\r\n  }\r\n  astLiteral(ast, retArr) {\r\n    this.literalTypes[`${ast.start},${ast.end}`] = 'Number';\r\n    return retArr;\r\n  }\r\n  astBinaryExpression(ast, retArr) {\r\n    return retArr;\r\n  }\r\n  astIdentifierExpression(ast, retArr) {\r\n    return retArr;\r\n  }\r\n  astAssignmentExpression(ast, retArr) {\r\n    return retArr;\r\n  }\r\n  /**\r\n   * @desc Parses the abstract syntax tree for *generic expression* statement\r\n   * @param {Object} esNode - An ast Node\r\n   * @param {Array} retArr - return array string\r\n   * @returns {Array} the append retArr\r\n   */\r\n  astExpressionStatement(esNode, retArr) {\r\n    this.astGeneric(esNode.expression, retArr);\r\n    retArr.push(';');\r\n    return retArr;\r\n  }\r\n  /**\r\n   * @desc Parses the abstract syntax tree for an *Empty* Statement\r\n   * @param {Object} eNode - An ast Node\r\n   * @param {Array} retArr - return array string\r\n   * @returns {Array} the append retArr\r\n   */\r\n  astEmptyStatement(eNode, retArr) {\r\n    return retArr;\r\n  }\r\n  astBlockStatement(ast, retArr) {\r\n    return retArr;\r\n  }\r\n  astIfStatement(ast, retArr) {\r\n    return retArr;\r\n  }\r\n  astSwitchStatement(ast, retArr) {\r\n    return retArr;\r\n  }\r\n  /**\r\n   * @desc Parses the abstract syntax tree for *Break* Statement\r\n   * @param {Object} brNode - An ast Node\r\n   * @param {Array} retArr - return array string\r\n   * @returns {Array} the append retArr\r\n   */\r\n  astBreakStatement(brNode, retArr) {\r\n    retArr.push('break;');\r\n    return retArr;\r\n  }\r\n  /**\r\n   * @desc Parses the abstract syntax tree for *Continue* Statement\r\n   * @param {Object} crNode - An ast Node\r\n   * @param {Array} retArr - return array string\r\n   * @returns {Array} the append retArr\r\n   */\r\n  astContinueStatement(crNode, retArr) {\r\n    retArr.push('continue;\\n');\r\n    return retArr;\r\n  }\r\n  astForStatement(ast, retArr) {\r\n    return retArr;\r\n  }\r\n  astWhileStatement(ast, retArr) {\r\n    return retArr;\r\n  }\r\n  astDoWhileStatement(ast, retArr) {\r\n    return retArr;\r\n  }\r\n  /**\r\n   * @desc Parses the abstract syntax tree for *Variable Declaration*\r\n   * @param {Object} varDecNode - An ast Node\r\n   * @param {Array} retArr - return array string\r\n   * @returns {Array} the append retArr\r\n   */\r\n  astVariableDeclaration(varDecNode, retArr) {\r\n    const declarations = varDecNode.declarations;\r\n    if (!declarations || !declarations[0] || !declarations[0].init) {\r\n      throw this.astErrorOutput('Unexpected expression', varDecNode);\r\n    }\r\n    const result = [];\r\n    const firstDeclaration = declarations[0];\r\n    const init = firstDeclaration.init;\r\n    let type = this.isState('in-for-loop-init') ? 'Integer' : this.getType(init);\r\n    if (type === 'LiteralInteger') {\r\n      // We had the choice to go either float or int, choosing float\r\n      type = 'Number';\r\n    }\r\n    const markupType = typeMap[type];\r\n    if (!markupType) {\r\n      throw this.astErrorOutput(`Markup type ${ markupType } not handled`, varDecNode);\r\n    }\r\n    let dependencies = this.getDependencies(firstDeclaration.init);\r\n    throw new Error('remove me');\r\n    this.declarations[firstDeclaration.id.name] = Object.freeze({\r\n      type,\r\n      dependencies,\r\n      isSafe: dependencies.every(dependency => dependency.isSafe)\r\n    });\r\n    const initResult = [`${type} user_${firstDeclaration.id.name}=`];\r\n    this.astGeneric(init, initResult);\r\n    result.push(initResult.join(''));\r\n\r\n    // first declaration is done, now any added ones setup\r\n    for (let i = 1; i < declarations.length; i++) {\r\n      const declaration = declarations[i];\r\n      dependencies = this.getDependencies(declaration);\r\n      throw new Error('Remove me');\r\n      this.declarations[declaration.id.name] = Object.freeze({\r\n        type,\r\n        dependencies,\r\n        isSafe: false\r\n      });\r\n      this.astGeneric(declaration, result);\r\n    }\r\n\r\n    retArr.push(retArr, result.join(','));\r\n    retArr.push(';');\r\n    return retArr;\r\n  }\r\n  /**\r\n   * @desc Parses the abstract syntax tree for *Variable Declarator*\r\n   * @param {Object} iVarDecNode - An ast Node\r\n   * @param {Array} retArr - return array string\r\n   * @returns {Array} the append retArr\r\n   */\r\n  astVariableDeclarator(iVarDecNode, retArr) {\r\n    this.astGeneric(iVarDecNode.id, retArr);\r\n    if (iVarDecNode.init !== null) {\r\n      retArr.push('=');\r\n      this.astGeneric(iVarDecNode.init, retArr);\r\n    }\r\n    return retArr;\r\n  }\r\n  astThisExpression(ast, retArr) {\r\n    return retArr;\r\n  }\r\n  astSequenceExpression(sNode, retArr) {\r\n    for (let i = 0; i < sNode.expressions.length; i++) {\r\n      if (i > 0) {\r\n        retArr.push(',');\r\n      }\r\n      this.astGeneric(sNode.expressions, retArr);\r\n    }\r\n    return retArr;\r\n  }\r\n  /**\r\n   * @desc Parses the abstract syntax tree for *Unary* Expression\r\n   * @param {Object} uNode - An ast Node\r\n   * @param {Array} retArr - return array string\r\n   * @returns {Array} the append retArr\r\n   */\r\n  astUnaryExpression(uNode, retArr) {\r\n    const unaryResult = this.checkAndUpconvertBitwiseUnary(uNode, retArr);\r\n    if (unaryResult) {\r\n      return retArr;\r\n    }\r\n\r\n    if (uNode.prefix) {\r\n      retArr.push(uNode.operator);\r\n      this.astGeneric(uNode.argument, retArr);\r\n    } else {\r\n      this.astGeneric(uNode.argument, retArr);\r\n      retArr.push(uNode.operator);\r\n    }\r\n\r\n    return retArr;\r\n  }\r\n\r\n  checkAndUpconvertBitwiseUnary(uNode, retArr) {}\r\n\r\n  /**\r\n   * @desc Parses the abstract syntax tree for *Update* Expression\r\n   * @param {Object} uNode - An ast Node\r\n   * @param {Array} retArr - return array string\r\n   * @returns {Array} the append retArr\r\n   */\r\n  astUpdateExpression(uNode, retArr) {\r\n    if (uNode.prefix) {\r\n      retArr.push(uNode.operator);\r\n      this.astGeneric(uNode.argument, retArr);\r\n    } else {\r\n      this.astGeneric(uNode.argument, retArr);\r\n      retArr.push(uNode.operator);\r\n    }\r\n\r\n    return retArr;\r\n  }\r\n  /**\r\n   * @desc Parses the abstract syntax tree for *Logical* Expression\r\n   * @param {Object} logNode - An ast Node\r\n   * @param {Array} retArr - return array string\r\n   * @returns {Array} the append retArr\r\n   */\r\n  astLogicalExpression(logNode, retArr) {\r\n    retArr.push('(');\r\n    this.astGeneric(logNode.left, retArr);\r\n    retArr.push(logNode.operator);\r\n    this.astGeneric(logNode.right, retArr);\r\n    retArr.push(')');\r\n    return retArr;\r\n  }\r\n  astMemberExpression(ast, retArr) {\r\n    return retArr;\r\n  }\r\n  astCallExpression(ast, retArr) {\r\n    return retArr;\r\n  }\r\n  astArrayExpression(ast, retArr) {\r\n    return retArr;\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @param ast\r\n   * @return {IFunctionNodeMemberExpressionDetails}\r\n   */\r\n  getMemberExpressionDetails(ast) {\r\n    if (ast.type !== 'MemberExpression') {\r\n      throw this.astErrorOutput(`Expression ${ ast.type } not a MemberExpression`, ast);\r\n    }\r\n    let name = null;\r\n    let type = null;\r\n    const variableSignature = this.getVariableSignature(ast);\r\n    switch (variableSignature) {\r\n      case 'value':\r\n        return null;\r\n      case 'value.thread.value':\r\n      case 'this.thread.value':\r\n      case 'this.output.value':\r\n        return {\r\n          signature: variableSignature,\r\n            type: 'Integer',\r\n            name: ast.property.name\r\n        };\r\n      case 'value[]':\r\n        if (typeof ast.object.name !== 'string') {\r\n          throw this.astErrorOutput('Unexpected expression', ast);\r\n        }\r\n        name = ast.object.name;\r\n        return {\r\n          name,\r\n          origin: 'user',\r\n            signature: variableSignature,\r\n            type: this.getVariableType(ast.object),\r\n            xProperty: ast.property\r\n        };\r\n      case 'value[][]':\r\n        if (typeof ast.object.object.name !== 'string') {\r\n          throw this.astErrorOutput('Unexpected expression', ast);\r\n        }\r\n        name = ast.object.object.name;\r\n        return {\r\n          name,\r\n          origin: 'user',\r\n            signature: variableSignature,\r\n            type: this.getVariableType(ast.object.object),\r\n            yProperty: ast.object.property,\r\n            xProperty: ast.property,\r\n        };\r\n      case 'value[][][]':\r\n        if (typeof ast.object.object.object.name !== 'string') {\r\n          throw this.astErrorOutput('Unexpected expression', ast);\r\n        }\r\n        name = ast.object.object.object.name;\r\n        return {\r\n          name,\r\n          origin: 'user',\r\n            signature: variableSignature,\r\n            type: this.getVariableType(ast.object.object.object),\r\n            zProperty: ast.object.object.property,\r\n            yProperty: ast.object.property,\r\n            xProperty: ast.property,\r\n        };\r\n      case 'value[][][][]':\r\n        if (typeof ast.object.object.object.object.name !== 'string') {\r\n          throw this.astErrorOutput('Unexpected expression', ast);\r\n        }\r\n        name = ast.object.object.object.object.name;\r\n        return {\r\n          name,\r\n          origin: 'user',\r\n            signature: variableSignature,\r\n            type: this.getVariableType(ast.object.object.object.object),\r\n            zProperty: ast.object.object.property,\r\n            yProperty: ast.object.property,\r\n            xProperty: ast.property,\r\n        };\r\n      case 'value.value':\r\n        if (typeof ast.property.name !== 'string') {\r\n          throw this.astErrorOutput('Unexpected expression', ast);\r\n        }\r\n        if (this.isAstMathVariable(ast)) {\r\n          name = ast.property.name;\r\n          return {\r\n            name,\r\n            origin: 'Math',\r\n            type: 'Number',\r\n            signature: variableSignature,\r\n          };\r\n        }\r\n        switch (ast.property.name) {\r\n          case 'r':\r\n          case 'g':\r\n          case 'b':\r\n          case 'a':\r\n            name = ast.object.name;\r\n            return {\r\n              name,\r\n              property: ast.property.name,\r\n                origin: 'user',\r\n                signature: variableSignature,\r\n                type: 'Number'\r\n            };\r\n          default:\r\n            throw this.astErrorOutput('Unexpected expression', ast);\r\n        }\r\n        case 'this.constants.value':\r\n          if (typeof ast.property.name !== 'string') {\r\n            throw this.astErrorOutput('Unexpected expression', ast);\r\n          }\r\n          name = ast.property.name;\r\n          type = this.getConstantType(name);\r\n          if (!type) {\r\n            throw this.astErrorOutput('Constant has no type', ast);\r\n          }\r\n          return {\r\n            name,\r\n            type,\r\n            origin: 'constants',\r\n              signature: variableSignature,\r\n          };\r\n        case 'this.constants.value[]':\r\n          if (typeof ast.object.property.name !== 'string') {\r\n            throw this.astErrorOutput('Unexpected expression', ast);\r\n          }\r\n          name = ast.object.property.name;\r\n          type = this.getConstantType(name);\r\n          if (!type) {\r\n            throw this.astErrorOutput('Constant has no type', ast);\r\n          }\r\n          return {\r\n            name,\r\n            type,\r\n            origin: 'constants',\r\n              signature: variableSignature,\r\n              xProperty: ast.property,\r\n          };\r\n        case 'this.constants.value[][]': {\r\n          if (typeof ast.object.object.property.name !== 'string') {\r\n            throw this.astErrorOutput('Unexpected expression', ast);\r\n          }\r\n          name = ast.object.object.property.name;\r\n          type = this.getConstantType(name);\r\n          if (!type) {\r\n            throw this.astErrorOutput('Constant has no type', ast);\r\n          }\r\n          return {\r\n            name,\r\n            type,\r\n            origin: 'constants',\r\n            signature: variableSignature,\r\n            yProperty: ast.object.property,\r\n            xProperty: ast.property,\r\n          };\r\n        }\r\n        case 'this.constants.value[][][]': {\r\n          if (typeof ast.object.object.object.property.name !== 'string') {\r\n            throw this.astErrorOutput('Unexpected expression', ast);\r\n          }\r\n          name = ast.object.object.object.property.name;\r\n          type = this.getConstantType(name);\r\n          if (!type) {\r\n            throw this.astErrorOutput('Constant has no type', ast);\r\n          }\r\n          return {\r\n            name,\r\n            type,\r\n            origin: 'constants',\r\n            signature: variableSignature,\r\n            zProperty: ast.object.object.property,\r\n            yProperty: ast.object.property,\r\n            xProperty: ast.property,\r\n          };\r\n        }\r\n        case 'fn()[]':\r\n        case '[][]':\r\n          return {\r\n            signature: variableSignature,\r\n              property: ast.property,\r\n          };\r\n        default:\r\n          throw this.astErrorOutput('Unexpected expression', ast);\r\n    }\r\n  }\r\n\r\n  findIdentifierOrigin(astToFind) {\r\n    const stack = [this.ast];\r\n\r\n    while (stack.length > 0) {\r\n      const atNode = stack[0];\r\n      if (atNode.type === 'VariableDeclarator' && atNode.id && atNode.id.name && atNode.id.name === astToFind.name) {\r\n        return atNode;\r\n      }\r\n      stack.shift();\r\n      if (atNode.argument) {\r\n        stack.push(atNode.argument);\r\n      } else if (atNode.body) {\r\n        stack.push(atNode.body);\r\n      } else if (atNode.declarations) {\r\n        stack.push(atNode.declarations);\r\n      } else if (Array.isArray(atNode)) {\r\n        for (let i = 0; i < atNode.length; i++) {\r\n          stack.push(atNode[i]);\r\n        }\r\n      }\r\n    }\r\n    return null;\r\n  }\r\n\r\n  findLastReturn(ast) {\r\n    const stack = [ast || this.ast];\r\n\r\n    while (stack.length > 0) {\r\n      const atNode = stack.pop();\r\n      if (atNode.type === 'ReturnStatement') {\r\n        return atNode;\r\n      }\r\n      if (atNode.type === 'FunctionDeclaration') {\r\n        continue;\r\n      }\r\n      if (atNode.argument) {\r\n        stack.push(atNode.argument);\r\n      } else if (atNode.body) {\r\n        stack.push(atNode.body);\r\n      } else if (atNode.declarations) {\r\n        stack.push(atNode.declarations);\r\n      } else if (Array.isArray(atNode)) {\r\n        for (let i = 0; i < atNode.length; i++) {\r\n          stack.push(atNode[i]);\r\n        }\r\n      } else if (atNode.consequent) {\r\n        stack.push(atNode.consequent);\r\n      } else if (atNode.cases) {\r\n        stack.push(atNode.cases);\r\n      }\r\n    }\r\n    return null;\r\n  }\r\n\r\n  getInternalVariableName(name) {\r\n    if (!this._internalVariableNames.hasOwnProperty(name)) {\r\n      this._internalVariableNames[name] = 0;\r\n    }\r\n    this._internalVariableNames[name]++;\r\n    if (this._internalVariableNames[name] === 1) {\r\n      return name;\r\n    }\r\n    return name + this._internalVariableNames[name];\r\n  }\r\n\r\n  varWarn() {\r\n    console.warn('var declarations are deprecated, weird things happen when falling back to CPU because var scope differs in javascript than in most languages.  Use const or let');\r\n  }\r\n}\r\n\r\nconst typeLookupMap = {\r\n  'Number': 'Number',\r\n  'Float': 'Float',\r\n  'Integer': 'Integer',\r\n  'Array': 'Number',\r\n  'Array(2)': 'Number',\r\n  'Array(3)': 'Number',\r\n  'Array(4)': 'Number',\r\n  'Array2D': 'Number',\r\n  'Array3D': 'Number',\r\n  'Input': 'Number',\r\n  'HTMLImage': 'Array(4)',\r\n  'HTMLVideo': 'Array(4)',\r\n  'HTMLImageArray': 'Array(4)',\r\n  'NumberTexture': 'Number',\r\n  'MemoryOptimizedNumberTexture': 'Number',\r\n  'Array1D(2)': 'Array(2)',\r\n  'Array1D(3)': 'Array(3)',\r\n  'Array1D(4)': 'Array(4)',\r\n  'Array2D(2)': 'Array(2)',\r\n  'Array2D(3)': 'Array(3)',\r\n  'Array2D(4)': 'Array(4)',\r\n  'Array3D(2)': 'Array(2)',\r\n  'Array3D(3)': 'Array(3)',\r\n  'Array3D(4)': 'Array(4)',\r\n  'ArrayTexture(1)': 'Number',\r\n  'ArrayTexture(2)': 'Array(2)',\r\n  'ArrayTexture(3)': 'Array(3)',\r\n  'ArrayTexture(4)': 'Array(4)',\r\n};\r\n","import { FunctionNode } from '../function-node';\r\n\r\n/**\r\n * @desc [INTERNAL] Represents a single function, inside JS\r\n *\r\n * <p>This handles all the raw state, converted state, etc. Of a single function.</p>\r\n */\r\nexport class CPUFunctionNode extends FunctionNode {\r\n  /**\r\n   * @desc Parses the abstract syntax tree for to its *named function*\r\n   * @param {Object} ast - the AST object to parse\r\n   * @param {Array} retArr - return array string\r\n   * @returns {Array} the append retArr\r\n   */\r\n  astFunction(ast, retArr) {\r\n\r\n    // Setup function return type and name\r\n    if (!this.isRootKernel) {\r\n      retArr.push('function');\r\n      retArr.push(' ');\r\n      retArr.push(this.name);\r\n      retArr.push('(');\r\n\r\n      // Arguments handling\r\n      for (let i = 0; i < this.argumentNames.length; ++i) {\r\n        const argumentName = this.argumentNames[i];\r\n\r\n        if (i > 0) {\r\n          retArr.push(', ');\r\n        }\r\n        retArr.push('user_');\r\n        retArr.push(argumentName);\r\n      }\r\n\r\n      // Function opening\r\n      retArr.push(') {\\n');\r\n    }\r\n\r\n    // Body statement iteration\r\n    for (let i = 0; i < ast.body.body.length; ++i) {\r\n      this.astGeneric(ast.body.body[i], retArr);\r\n      retArr.push('\\n');\r\n    }\r\n\r\n    if (!this.isRootKernel) {\r\n      // Function closing\r\n      retArr.push('}\\n');\r\n    }\r\n    return retArr;\r\n  }\r\n\r\n  /**\r\n   * @desc Parses the abstract syntax tree for to *return* statement\r\n   * @param {Object} ast - the AST object to parse\r\n   * @param {Array} retArr - return array string\r\n   * @returns {Array} the append retArr\r\n   */\r\n  astReturnStatement(ast, retArr) {\r\n    const type = this.returnType || this.getType(ast.argument);\r\n\r\n    if (!this.returnType) {\r\n      this.returnType = type;\r\n    }\r\n\r\n    if (this.isRootKernel) {\r\n      retArr.push(this.leadingReturnStatement);\r\n      this.astGeneric(ast.argument, retArr);\r\n      retArr.push(';\\n');\r\n      retArr.push(this.followingReturnStatement);\r\n      retArr.push('continue;\\n');\r\n    } else if (this.isSubKernel) {\r\n      retArr.push(`subKernelResult_${ this.name } = `);\r\n      this.astGeneric(ast.argument, retArr);\r\n      retArr.push(';');\r\n      retArr.push(`return subKernelResult_${ this.name };`);\r\n    } else {\r\n      retArr.push('return ');\r\n      this.astGeneric(ast.argument, retArr);\r\n      retArr.push(';');\r\n    }\r\n    return retArr;\r\n  }\r\n\r\n  /**\r\n   * @desc Parses the abstract syntax tree for *literal value*\r\n   * @param {Object} ast - the AST object to parse\r\n   * @param {Array} retArr - return array string\r\n   * @returns {Array} the append retArr\r\n   */\r\n  astLiteral(ast, retArr) {\r\n\r\n    // Reject non numeric literals\r\n    if (isNaN(ast.value)) {\r\n      throw this.astErrorOutput(\r\n        'Non-numeric literal not supported : ' + ast.value,\r\n        ast\r\n      );\r\n    }\r\n\r\n    retArr.push(ast.value);\r\n\r\n    return retArr;\r\n  }\r\n\r\n  /**\r\n   * @desc Parses the abstract syntax tree for *binary* expression\r\n   * @param {Object} ast - the AST object to parse\r\n   * @param {Array} retArr - return array string\r\n   * @returns {Array} the append retArr\r\n   */\r\n  astBinaryExpression(ast, retArr) {\r\n    retArr.push('(');\r\n    this.astGeneric(ast.left, retArr);\r\n    retArr.push(ast.operator);\r\n    this.astGeneric(ast.right, retArr);\r\n    retArr.push(')');\r\n    return retArr;\r\n  }\r\n\r\n  /**\r\n   * @desc Parses the abstract syntax tree for *identifier* expression\r\n   * @param {Object} idtNode - An ast Node\r\n   * @param {Array} retArr - return array string\r\n   * @returns {Array} the append retArr\r\n   */\r\n  astIdentifierExpression(idtNode, retArr) {\r\n    if (idtNode.type !== 'Identifier') {\r\n      throw this.astErrorOutput(\r\n        'IdentifierExpression - not an Identifier',\r\n        idtNode\r\n      );\r\n    }\r\n\r\n    switch (idtNode.name) {\r\n      case 'Infinity':\r\n        retArr.push('Infinity');\r\n        break;\r\n      default:\r\n        if (this.constants && this.constants.hasOwnProperty(idtNode.name)) {\r\n          retArr.push('constants_' + idtNode.name);\r\n        } else {\r\n          const name = this.getKernelArgumentName(idtNode.name);\r\n          if (name) {\r\n            retArr.push('user_' + name);\r\n          } else {\r\n            retArr.push('user_' + idtNode.name);\r\n          }\r\n        }\r\n    }\r\n\r\n    return retArr;\r\n  }\r\n\r\n  /**\r\n   * @desc Parses the abstract syntax tree for *for-loop* expression\r\n   * @param {Object} forNode - An ast Node\r\n   * @param {Array} retArr - return array string\r\n   * @returns {Array} the parsed webgl string\r\n   */\r\n  astForStatement(forNode, retArr) {\r\n    if (forNode.type !== 'ForStatement') {\r\n      throw this.astErrorOutput('Invalid for statement', forNode);\r\n    }\r\n\r\n    const initArr = [];\r\n    const testArr = [];\r\n    const updateArr = [];\r\n    const bodyArr = [];\r\n    let isSafe = null;\r\n\r\n    if (forNode.init) {\r\n      this.pushState('in-for-loop-init');\r\n      this.astGeneric(forNode.init, initArr);\r\n      for (let i = 0; i < initArr.length; i++) {\r\n        if (initArr[i].includes && initArr[i].includes(',')) {\r\n          isSafe = false;\r\n        }\r\n      }\r\n      this.popState('in-for-loop-init');\r\n    } else {\r\n      isSafe = false;\r\n    }\r\n\r\n    if (forNode.test) {\r\n      this.astGeneric(forNode.test, testArr);\r\n    } else {\r\n      isSafe = false;\r\n    }\r\n\r\n    if (forNode.update) {\r\n      this.astGeneric(forNode.update, updateArr);\r\n    } else {\r\n      isSafe = false;\r\n    }\r\n\r\n    if (forNode.body) {\r\n      this.pushState('loop-body');\r\n      this.astGeneric(forNode.body, bodyArr);\r\n      this.popState('loop-body');\r\n    }\r\n\r\n    // have all parts, now make them safe\r\n    if (isSafe === null) {\r\n      isSafe = this.isSafe(forNode.init) && this.isSafe(forNode.test);\r\n    }\r\n\r\n    if (isSafe) {\r\n      retArr.push(`for (${initArr.join('')};${testArr.join('')};${updateArr.join('')}){\\n`);\r\n      retArr.push(bodyArr.join(''));\r\n      retArr.push('}\\n');\r\n    } else {\r\n      const iVariableName = this.getInternalVariableName('safeI');\r\n      if (initArr.length > 0) {\r\n        retArr.push(initArr.join(''), ';\\n');\r\n      }\r\n      retArr.push(`for (let ${iVariableName}=0;${iVariableName}<LOOP_MAX;${iVariableName}++){\\n`);\r\n      if (testArr.length > 0) {\r\n        retArr.push(`if (!${testArr.join('')}) break;\\n`);\r\n      }\r\n      retArr.push(bodyArr.join(''));\r\n      retArr.push(`\\n${updateArr.join('')};`);\r\n      retArr.push('}\\n');\r\n    }\r\n    return retArr;\r\n  }\r\n\r\n  /**\r\n   * @desc Parses the abstract syntax tree for *while* loop\r\n   * @param {Object} whileNode - An ast Node\r\n   * @param {Array} retArr - return array string\r\n   * @returns {Array} the parsed javascript string\r\n   */\r\n  astWhileStatement(whileNode, retArr) {\r\n    if (whileNode.type !== 'WhileStatement') {\r\n      throw this.astErrorOutput(\r\n        'Invalid while statement',\r\n        whileNode\r\n      );\r\n    }\r\n\r\n    retArr.push('for (let i = 0; i < LOOP_MAX; i++) {');\r\n    retArr.push('if (');\r\n    this.astGeneric(whileNode.test, retArr);\r\n    retArr.push(') {\\n');\r\n    this.astGeneric(whileNode.body, retArr);\r\n    retArr.push('} else {\\n');\r\n    retArr.push('break;\\n');\r\n    retArr.push('}\\n');\r\n    retArr.push('}\\n');\r\n\r\n    return retArr;\r\n  }\r\n\r\n  /**\r\n   * @desc Parses the abstract syntax tree for *do while* loop\r\n   * @param {Object} doWhileNode - An ast Node\r\n   * @param {Array} retArr - return array string\r\n   * @returns {Array} the parsed webgl string\r\n   */\r\n  astDoWhileStatement(doWhileNode, retArr) {\r\n    if (doWhileNode.type !== 'DoWhileStatement') {\r\n      throw this.astErrorOutput(\r\n        'Invalid while statement',\r\n        doWhileNode\r\n      );\r\n    }\r\n\r\n    retArr.push('for (let i = 0; i < LOOP_MAX; i++) {');\r\n    this.astGeneric(doWhileNode.body, retArr);\r\n    retArr.push('if (!');\r\n    this.astGeneric(doWhileNode.test, retArr);\r\n    retArr.push(') {\\n');\r\n    retArr.push('break;\\n');\r\n    retArr.push('}\\n');\r\n    retArr.push('}\\n');\r\n\r\n    return retArr;\r\n\r\n  }\r\n\r\n  /**\r\n   * @desc Parses the abstract syntax tree for *Assignment* Expression\r\n   * @param {Object} assNode - An ast Node\r\n   * @param {Array} retArr - return array string\r\n   * @returns {Array} the append retArr\r\n   */\r\n  astAssignmentExpression(assNode, retArr) {\r\n    const declaration = this.getDeclaration(assNode.left);\r\n    if (declaration && !declaration.assignable) {\r\n      throw new this.astErrorOutput(`Variable ${assNode.left.name} is not assignable here`, assNode);\r\n    }\r\n    this.astGeneric(assNode.left, retArr);\r\n    retArr.push(assNode.operator);\r\n    this.astGeneric(assNode.right, retArr);\r\n    return retArr;\r\n  }\r\n\r\n  /**\r\n   * @desc Parses the abstract syntax tree for *Block* statement\r\n   * @param {Object} bNode - the AST object to parse\r\n   * @param {Array} retArr - return array string\r\n   * @returns {Array} the append retArr\r\n   */\r\n  astBlockStatement(bNode, retArr) {\r\n    if (this.isState('loop-body')) {\r\n      this.pushState('block-body'); // this prevents recursive removal of braces\r\n      for (let i = 0; i < bNode.body.length; i++) {\r\n        this.astGeneric(bNode.body[i], retArr);\r\n      }\r\n      this.popState('block-body');\r\n    } else {\r\n      retArr.push('{\\n');\r\n      for (let i = 0; i < bNode.body.length; i++) {\r\n        this.astGeneric(bNode.body[i], retArr);\r\n      }\r\n      retArr.push('}\\n');\r\n    }\r\n    return retArr;\r\n  }\r\n\r\n  /**\r\n   * @desc Parses the abstract syntax tree for *Variable Declaration*\r\n   * @param {Object} varDecNode - An ast Node\r\n   * @param {Array} retArr - return array string\r\n   * @returns {Array} the append retArr\r\n   */\r\n  astVariableDeclaration(varDecNode, retArr) {\r\n    if (varDecNode.kind === 'var' && this.warnVarUsage) {\r\n      this.varWarn();\r\n    }\r\n    retArr.push(`${varDecNode.kind} `);\r\n    const { declarations } = varDecNode;\r\n    for (let i = 0; i < declarations.length; i++) {\r\n      if (i > 0) {\r\n        retArr.push(',');\r\n      }\r\n      this.astGeneric(declarations[i], retArr);\r\n    }\r\n    if (!this.isState('in-for-loop-init')) {\r\n      retArr.push(';');\r\n    }\r\n    return retArr;\r\n  }\r\n\r\n  /**\r\n   * @desc Parses the abstract syntax tree for *If* Statement\r\n   * @param {Object} ifNode - An ast Node\r\n   * @param {Array} retArr - return array string\r\n   * @returns {Array} the append retArr\r\n   */\r\n  astIfStatement(ifNode, retArr) {\r\n    retArr.push('if (');\r\n    this.astGeneric(ifNode.test, retArr);\r\n    retArr.push(')');\r\n    if (ifNode.consequent.type === 'BlockStatement') {\r\n      this.astGeneric(ifNode.consequent, retArr);\r\n    } else {\r\n      retArr.push(' {\\n');\r\n      this.astGeneric(ifNode.consequent, retArr);\r\n      retArr.push('\\n}\\n');\r\n    }\r\n\r\n    if (ifNode.alternate) {\r\n      retArr.push('else ');\r\n      if (ifNode.alternate.type === 'BlockStatement') {\r\n        this.astGeneric(ifNode.alternate, retArr);\r\n      } else {\r\n        retArr.push(' {\\n');\r\n        this.astGeneric(ifNode.alternate, retArr);\r\n        retArr.push('\\n}\\n');\r\n      }\r\n    }\r\n    return retArr;\r\n\r\n  }\r\n\r\n  astSwitchStatement(ast, retArr) {\r\n    const { discriminant, cases } = ast;\r\n    retArr.push('switch (');\r\n    this.astGeneric(discriminant, retArr);\r\n    retArr.push(') {\\n');\r\n    for (let i = 0; i < cases.length; i++) {\r\n      if (cases[i].test === null) {\r\n        retArr.push('default:\\n');\r\n        this.astGeneric(cases[i].consequent, retArr);\r\n        if (cases[i].consequent && cases[i].consequent.length > 0) {\r\n          retArr.push('break;\\n');\r\n        }\r\n        continue;\r\n      }\r\n      retArr.push('case ');\r\n      this.astGeneric(cases[i].test, retArr);\r\n      retArr.push(':\\n');\r\n      if (cases[i].consequent && cases[i].consequent.length > 0) {\r\n        this.astGeneric(cases[i].consequent, retArr);\r\n        retArr.push('break;\\n');\r\n      }\r\n    }\r\n    retArr.push('\\n}');\r\n  }\r\n\r\n  /**\r\n   * @desc Parses the abstract syntax tree for *This* expression\r\n   * @param {Object} tNode - An ast Node\r\n   * @param {Array} retArr - return array string\r\n   * @returns {Array} the append retArr\r\n   */\r\n  astThisExpression(tNode, retArr) {\r\n    retArr.push('_this');\r\n    return retArr;\r\n  }\r\n\r\n  /**\r\n   * @desc Parses the abstract syntax tree for *Member* Expression\r\n   * @param {Object} mNode - An ast Node\r\n   * @param {Array} retArr - return array string\r\n   * @returns {Array} the append retArr\r\n   */\r\n  astMemberExpression(mNode, retArr) {\r\n    const {\r\n      signature,\r\n      type,\r\n      property,\r\n      xProperty,\r\n      yProperty,\r\n      zProperty,\r\n      name,\r\n      origin\r\n    } = this.getMemberExpressionDetails(mNode);\r\n    switch (signature) {\r\n      case 'this.thread.value':\r\n        retArr.push(`_this.thread.${ name }`);\r\n        return retArr;\r\n      case 'this.output.value':\r\n        switch (name) {\r\n          case 'x':\r\n            retArr.push('outputX');\r\n            break;\r\n          case 'y':\r\n            retArr.push('outputY');\r\n            break;\r\n          case 'z':\r\n            retArr.push('outputZ');\r\n            break;\r\n          default:\r\n            throw this.astErrorOutput('Unexpected expression', mNode);\r\n        }\r\n        return retArr;\r\n      case 'value':\r\n        throw this.astErrorOutput('Unexpected expression', mNode);\r\n      case 'value[]':\r\n      case 'value[][]':\r\n      case 'value[][][]':\r\n      case 'value.value':\r\n        if (origin === 'Math') {\r\n          retArr.push(Math[name]);\r\n          return retArr;\r\n        }\r\n        switch (property) {\r\n          case 'r':\r\n            retArr.push(`user_${ name }[0]`);\r\n            return retArr;\r\n          case 'g':\r\n            retArr.push(`user_${ name }[1]`);\r\n            return retArr;\r\n          case 'b':\r\n            retArr.push(`user_${ name }[2]`);\r\n            return retArr;\r\n          case 'a':\r\n            retArr.push(`user_${ name }[3]`);\r\n            return retArr;\r\n        }\r\n        break;\r\n      case 'this.constants.value':\r\n      case 'this.constants.value[]':\r\n      case 'this.constants.value[][]':\r\n      case 'this.constants.value[][][]':\r\n        break;\r\n      case 'fn()[]':\r\n        this.astGeneric(mNode.object, retArr);\r\n        retArr.push('[');\r\n        this.astGeneric(mNode.property, retArr);\r\n        retArr.push(']');\r\n        return retArr;\r\n      default:\r\n        throw this.astErrorOutput('Unexpected expression', mNode);\r\n    }\r\n\r\n    if (!mNode.computed) {\r\n      // handle simple types\r\n      switch (type) {\r\n        case 'Number':\r\n        case 'Integer':\r\n        case 'Float':\r\n        case 'Boolean':\r\n          retArr.push(`${origin}_${name}`);\r\n          return retArr;\r\n      }\r\n    }\r\n\r\n    // handle more complex types\r\n    // argument may have come from a parent\r\n    const synonymName = this.getKernelArgumentName(name);\r\n    const markupName = `${origin}_${synonymName || name}`;\r\n\r\n    switch (type) {\r\n      case 'Array(2)':\r\n      case 'Array(3)':\r\n      case 'Array(4)':\r\n      case 'HTMLImageArray':\r\n      case 'ArrayTexture(1)':\r\n      case 'ArrayTexture(2)':\r\n      case 'ArrayTexture(3)':\r\n      case 'ArrayTexture(4)':\r\n      case 'HTMLImage':\r\n      default:\r\n        let size;\r\n        let isInput;\r\n        if (origin === 'constants') {\r\n          const constant = this.constants[name];\r\n          isInput = this.constantTypes[name] === 'Input';\r\n          size = isInput ? constant.size : null;\r\n        } else {\r\n          isInput = this.isInput(synonymName || name);\r\n          size = isInput ? this.argumentSizes[this.argumentNames.indexOf(name)] : null;\r\n        }\r\n        retArr.push(`${ markupName }`);\r\n        if (zProperty && yProperty) {\r\n          if (isInput) {\r\n            retArr.push('[(');\r\n            this.astGeneric(zProperty, retArr);\r\n            retArr.push(`*${ this.dynamicArguments ? '(outputY * outputX)' : size[1] * size[0] })+(`);\r\n            this.astGeneric(yProperty, retArr);\r\n            retArr.push(`*${ this.dynamicArguments ? 'outputX' : size[0] })+`);\r\n            this.astGeneric(xProperty, retArr);\r\n            retArr.push(']');\r\n          } else {\r\n            retArr.push('[');\r\n            this.astGeneric(zProperty, retArr);\r\n            retArr.push(']');\r\n            retArr.push('[');\r\n            this.astGeneric(yProperty, retArr);\r\n            retArr.push(']');\r\n            retArr.push('[');\r\n            this.astGeneric(xProperty, retArr);\r\n            retArr.push(']');\r\n          }\r\n        } else if (yProperty) {\r\n          if (isInput) {\r\n            retArr.push('[(');\r\n            this.astGeneric(yProperty, retArr);\r\n            retArr.push(`*${ this.dynamicArguments ? 'outputX' : size[0] })+`);\r\n            this.astGeneric(xProperty, retArr);\r\n            retArr.push(']');\r\n          } else {\r\n            retArr.push('[');\r\n            this.astGeneric(yProperty, retArr);\r\n            retArr.push(']');\r\n            retArr.push('[');\r\n            this.astGeneric(xProperty, retArr);\r\n            retArr.push(']');\r\n          }\r\n        } else if (typeof xProperty !== 'undefined') {\r\n          retArr.push('[');\r\n          this.astGeneric(xProperty, retArr);\r\n          retArr.push(']');\r\n        }\r\n    }\r\n    return retArr;\r\n  }\r\n\r\n  /**\r\n   * @desc Parses the abstract syntax tree for *call* expression\r\n   * @param {Object} ast - the AST object to parse\r\n   * @param {Array} retArr - return array string\r\n   * @returns  {Array} the append retArr\r\n   */\r\n  astCallExpression(ast, retArr) {\r\n    if (ast.type !== 'CallExpression') {\r\n      // Failure, unknown expression\r\n      throw this.astErrorOutput('Unknown CallExpression', ast);\r\n    }\r\n    // Get the full function call, unrolled\r\n    let functionName = this.astMemberExpressionUnroll(ast.callee);\r\n\r\n    // Register the function into the called registry\r\n    if (this.calledFunctions.indexOf(functionName) < 0) {\r\n      this.calledFunctions.push(functionName);\r\n    }\r\n\r\n    const isMathFunction = this.isAstMathFunction(ast);\r\n\r\n    // track the function was called\r\n    if (this.onFunctionCall) {\r\n      this.onFunctionCall(this.name, functionName, ast.arguments);\r\n    }\r\n\r\n    // Call the function\r\n    retArr.push(functionName);\r\n\r\n    // Open arguments space\r\n    retArr.push('(');\r\n    const targetTypes = this.lookupFunctionArgumentTypes(functionName) || [];\r\n    // Add the arguments\r\n    for (let i = 0; i < ast.arguments.length; ++i) {\r\n      const argument = ast.arguments[i];\r\n\r\n      // in order to track return type, even though this is CPU\r\n      let argumentType = this.getType(argument);\r\n      if (!targetTypes[i]) {\r\n        this.triggerImplyArgumentType(functionName, i, argumentType, this);\r\n      }\r\n\r\n      if (i > 0) {\r\n        retArr.push(', ');\r\n      }\r\n      this.astGeneric(argument, retArr);\r\n    }\r\n    // Close arguments space\r\n    retArr.push(')');\r\n\r\n    return retArr;\r\n  }\r\n\r\n  /**\r\n   * @desc Parses the abstract syntax tree for *Array* Expression\r\n   * @param {Object} arrNode - the AST object to parse\r\n   * @param {Array} retArr - return array string\r\n   * @returns {Array} the append retArr\r\n   */\r\n  astArrayExpression(arrNode, retArr) {\r\n    const arrLen = arrNode.elements.length;\r\n\r\n    retArr.push('new Float32Array([');\r\n    for (let i = 0; i < arrLen; ++i) {\r\n      if (i > 0) {\r\n        retArr.push(', ');\r\n      }\r\n      const subNode = arrNode.elements[i];\r\n      this.astGeneric(subNode, retArr)\r\n    }\r\n    retArr.push('])');\r\n\r\n    return retArr;\r\n  }\r\n\r\n  astDebuggerStatement(arrNode, retArr) {\r\n    retArr.push('debugger;');\r\n    return retArr;\r\n  }\r\n}\r\n","import { Kernel } from '../kernel';\r\nimport { FunctionBuilder } from '../function-builder';\r\nimport { CPUFunctionNode } from './function-node';\r\nimport { getVariableType, utils } from '../../utils';\r\nimport { cpuKernelString } from './kernel-string';\r\n\r\n/**\r\n * @desc Kernel Implementation for CPU.\r\n * <p>Instantiates properties to the CPU Kernel.</p>\r\n */\r\nexport class CPUKernel extends Kernel {\r\n  static getFeatures() {\r\n    return this.features;\r\n  }\r\n  static get features() {\r\n    return Object.freeze({\r\n      kernelMap: true,\r\n      isIntegerDivisionAccurate: true\r\n    });\r\n  }\r\n  static get isSupported() {\r\n    return true;\r\n  }\r\n  static isContextMatch(context) {\r\n    return false;\r\n  }\r\n  /**\r\n   * @desc The current mode in which gpu.js is executing.\r\n   */\r\n  static get mode() {\r\n    return 'cpu';\r\n  }\r\n\r\n  static nativeFunctionArguments() {\r\n    return null;\r\n  }\r\n\r\n  static nativeFunctionReturnType() {\r\n    return null;\r\n  }\r\n\r\n  static combineKernels(combinedKernel) {\r\n    return combinedKernel;\r\n  }\r\n\r\n  constructor(source, settings) {\r\n    super(source, settings);\r\n    this.mergeSettings(source.settings || settings);\r\n\r\n    this._imageData = null;\r\n    this._colorData = null;\r\n    this._kernelString = null;\r\n    this.thread = {\r\n      x: 0,\r\n      y: 0,\r\n      z: 0\r\n    };\r\n    this.translatedSources = null;\r\n  }\r\n\r\n  initCanvas() {\r\n    if (typeof document !== 'undefined') {\r\n      return document.createElement('canvas');\r\n    } else if (typeof OffscreenCanvas !== 'undefined') {\r\n      return new OffscreenCanvas(0, 0);\r\n    }\r\n  }\r\n\r\n  initContext() {\r\n    if (!this.canvas) return null;\r\n    return this.canvas.getContext('2d');\r\n  }\r\n\r\n  initPlugins(settings) {\r\n    return [];\r\n  }\r\n\r\n  /**\r\n   * @desc Validate settings related to Kernel, such as dimensions size, and auto output support.\r\n   * @param {IArguments} args\r\n   */\r\n  validateSettings(args) {\r\n    if (!this.output || this.output.length === 0) {\r\n      if (args.length !== 1) {\r\n        throw new Error('Auto output only supported for kernels with only one input');\r\n      }\r\n\r\n      const argType = getVariableType(args[0], this.strictIntegers);\r\n      if (argType === 'Array') {\r\n        this.output = utils.getDimensions(argType);\r\n      } else if (argType === 'NumberTexture' || argType === 'ArrayTexture(4)') {\r\n        this.output = args[0].output;\r\n      } else {\r\n        throw new Error('Auto output not supported for input type: ' + argType);\r\n      }\r\n    }\r\n\r\n    if (this.graphical) {\r\n      if (this.output.length !== 2) {\r\n        throw new Error('Output must have 2 dimensions on graphical mode');\r\n      }\r\n    }\r\n\r\n    this.checkOutput();\r\n  }\r\n\r\n  translateSource() {\r\n    this.leadingReturnStatement = this.output.length > 1 ? 'resultX[x] = ' : 'result[x] = ';\r\n    if (this.subKernels) {\r\n      const followingReturnStatement = []\r\n      for (let i = 0; i < this.subKernels.length; i++) {\r\n        const {\r\n          name\r\n        } = this.subKernels[i];\r\n        followingReturnStatement.push(this.output.length > 1 ? `resultX_${ name }[x] = subKernelResult_${ name };\\n` : `result_${ name }[x] = subKernelResult_${ name };\\n`);\r\n      }\r\n      this.followingReturnStatement = followingReturnStatement.join('');\r\n    }\r\n    const functionBuilder = FunctionBuilder.fromKernel(this, CPUFunctionNode);\r\n    this.translatedSources = functionBuilder.getPrototypes('kernel');\r\n    if (!this.graphical && !this.returnType) {\r\n      this.returnType = functionBuilder.getKernelResultType();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @desc Builds the Kernel, by generating the kernel\r\n   * string using thread dimensions, and arguments\r\n   * supplied to the kernel.\r\n   *\r\n   * <p>If the graphical flag is enabled, canvas is used.</p>\r\n   */\r\n  build() {\r\n    this.setupConstants();\r\n    this.setupArguments(arguments);\r\n    this.validateSettings(arguments);\r\n    this.translateSource();\r\n\r\n    if (this.graphical) {\r\n      const {\r\n        canvas,\r\n        output\r\n      } = this;\r\n      if (!canvas) {\r\n        throw new Error('no canvas available for using graphical output');\r\n      }\r\n      const width = output[0];\r\n      const height = output[1] || 1;\r\n      canvas.width = width;\r\n      canvas.height = height;\r\n      this._imageData = this.context.createImageData(width, height);\r\n      this._colorData = new Uint8ClampedArray(width * height * 4);\r\n    }\r\n\r\n    const kernelString = this.getKernelString();\r\n    this.kernelString = kernelString;\r\n\r\n    if (this.debug) {\r\n      console.log('Function output:');\r\n      console.log(kernelString);\r\n    }\r\n\r\n    try {\r\n      this.run = new Function([], kernelString).bind(this)();\r\n    } catch (e) {\r\n      console.error('An error occurred compiling the javascript: ', e);\r\n    }\r\n  }\r\n\r\n  color(r, g, b, a) {\r\n    if (typeof a === 'undefined') {\r\n      a = 1;\r\n    }\r\n\r\n    r = Math.floor(r * 255);\r\n    g = Math.floor(g * 255);\r\n    b = Math.floor(b * 255);\r\n    a = Math.floor(a * 255);\r\n\r\n    const width = this.output[0];\r\n    const height = this.output[1];\r\n\r\n    const x = this.thread.x;\r\n    const y = height - this.thread.y - 1;\r\n\r\n    const index = x + y * width;\r\n\r\n    this._colorData[index * 4 + 0] = r;\r\n    this._colorData[index * 4 + 1] = g;\r\n    this._colorData[index * 4 + 2] = b;\r\n    this._colorData[index * 4 + 3] = a;\r\n  }\r\n\r\n  /**\r\n   * @desc Generates kernel string for this kernel program.\r\n   *\r\n   * <p>If sub-kernels are supplied, they are also factored in.\r\n   * This string can be saved by calling the `toString` method\r\n   * and then can be reused later.</p>\r\n   *\r\n   * @returns {String} result\r\n   *\r\n   */\r\n  getKernelString() {\r\n    if (this._kernelString !== null) return this._kernelString;\r\n\r\n    let kernelThreadString = null;\r\n    let {\r\n      translatedSources\r\n    } = this;\r\n    if (translatedSources.length > 1) {\r\n      translatedSources = translatedSources.filter(fn => {\r\n        if (/^function/.test(fn)) return fn;\r\n        kernelThreadString = fn;\r\n        return false;\r\n      })\r\n    } else {\r\n      kernelThreadString = translatedSources.shift();\r\n    }\r\n    const kernelString = this._kernelString = `  const LOOP_MAX = ${ this._getLoopMaxString() }\r\n  ${ this.injectedNative || '' }\r\n  const constants = this.constants;\r\n  const _this = this;\r\n  return (${ this.argumentNames.map(argumentName => 'user_' + argumentName).join(', ') }) => {\r\n    ${ this._processConstants() }\r\n    ${ this._processArguments() }\r\n    ${ this.graphical ? this._graphicalKernelBody(kernelThreadString) : this._resultKernelBody(kernelThreadString) }\r\n    ${ translatedSources.length > 0 ? translatedSources.join('\\n') : '' }\r\n  };`;\r\n    return kernelString;\r\n  }\r\n\r\n  /**\r\n   * @desc Returns the *pre-compiled* Kernel as a JS Object String, that can be reused.\r\n   */\r\n  toString() {\r\n    return cpuKernelString(this);\r\n  }\r\n\r\n  /**\r\n   * @desc Get the maximum loop size String.\r\n   * @returns {String} result\r\n   */\r\n  _getLoopMaxString() {\r\n    return (\r\n      this.loopMaxIterations ?\r\n      ` ${ parseInt(this.loopMaxIterations) };` :\r\n      ' 1000;'\r\n    );\r\n  }\r\n\r\n  _processConstants() {\r\n    if (!this.constants) return '';\r\n\r\n    const result = [];\r\n    for (let p in this.constants) {\r\n      const type = this.constantTypes[p];\r\n      switch (type) {\r\n        case 'HTMLImage':\r\n          result.push(`    const constants_${p} = this._imageTo2DArray(this.constants.${p});\\n`);\r\n          break;\r\n        case 'HTMLImageArray':\r\n          result.push(`    const constants_${p} = this._imageTo3DArray(this.constants.${p});\\n`);\r\n          break;\r\n        case 'Input':\r\n          result.push(`    const constants_${p} = this.constants.${p}.value;\\n`);\r\n          break;\r\n        default:\r\n          result.push(`    const constants_${p} = this.constants.${p};\\n`);\r\n      }\r\n    }\r\n    return result.join('');\r\n  }\r\n\r\n  _processArguments() {\r\n    const result = [];\r\n    for (let i = 0; i < this.argumentTypes.length; i++) {\r\n      const variableName = `user_${this.argumentNames[i]}`;\r\n      switch (this.argumentTypes[i]) {\r\n        case 'HTMLImage':\r\n          result.push(`    ${variableName} = this._imageTo2DArray(${variableName});\\n`);\r\n          break;\r\n        case 'HTMLImageArray':\r\n          result.push(`    ${variableName} = this._imageTo3DArray(${variableName});\\n`);\r\n          break;\r\n        case 'Input':\r\n          result.push(`    ${variableName} = ${variableName}.value;\\n`);\r\n          break;\r\n        case 'ArrayTexture(1)':\r\n        case 'ArrayTexture(2)':\r\n        case 'ArrayTexture(3)':\r\n        case 'ArrayTexture(4)':\r\n        case 'NumberTexture':\r\n        case 'MemoryOptimizedNumberTexture':\r\n          result.push(`\r\n    if (${variableName}.toArray) {\r\n      if (!_this.textureCache) {\r\n        _this.textureCache = [];\r\n        _this.arrayCache = [];\r\n      }\r\n      const textureIndex = _this.textureCache.indexOf(${variableName});\r\n      if (textureIndex !== -1) {\r\n        ${variableName} = _this.arrayCache[textureIndex];\r\n      } else {\r\n        _this.textureCache.push(${variableName});\r\n        ${variableName} = ${variableName}.toArray();\r\n        _this.arrayCache.push(${variableName});\r\n      }\r\n    }`);\r\n          break;\r\n      }\r\n    }\r\n    return result.join('');\r\n  }\r\n\r\n  _imageTo2DArray(image) {\r\n    const canvas = this.canvas;\r\n    if (canvas.width < image.width) {\r\n      canvas.width = image.width;\r\n    }\r\n    if (canvas.height < image.height) {\r\n      canvas.height = image.height;\r\n    }\r\n    const ctx = this.context;\r\n    ctx.drawImage(image, 0, 0, image.width, image.height);\r\n    const pixelsData = ctx.getImageData(0, 0, image.width, image.height).data;\r\n    const imageArray = new Array(image.height);\r\n    let index = 0;\r\n    for (let y = image.height - 1; y >= 0; y--) {\r\n      const row = imageArray[y] = new Array(image.width);\r\n      for (let x = 0; x < image.width; x++) {\r\n        const pixel = new Float32Array(4);\r\n        pixel[0] = pixelsData[index++] / 255; // r\r\n        pixel[1] = pixelsData[index++] / 255; // g\r\n        pixel[2] = pixelsData[index++] / 255; // b\r\n        pixel[3] = pixelsData[index++] / 255; // a\r\n        row[x] = pixel;\r\n      }\r\n    }\r\n    return imageArray;\r\n  }\r\n\r\n  getPixels(flip) {\r\n    const [width, height] = this.output;\r\n    // cpu is not flipped by default\r\n    return flip ? utils.flipPixels(this._imageData.data, width, height) : this._imageData.data.slice(0);\r\n  }\r\n\r\n  _imageTo3DArray(images) {\r\n    const imagesArray = new Array(images.length);\r\n    for (let i = 0; i < images.length; i++) {\r\n      imagesArray[i] = this._imageTo2DArray(images[i]);\r\n    }\r\n    return imagesArray;\r\n  }\r\n\r\n  _resultKernelBody(kernelString) {\r\n    switch (this.output.length) {\r\n      case 1:\r\n        return this._resultKernel1DLoop(kernelString) + this._kernelOutput();\r\n      case 2:\r\n        return this._resultKernel2DLoop(kernelString) + this._kernelOutput();\r\n      case 3:\r\n        return this._resultKernel3DLoop(kernelString) + this._kernelOutput();\r\n      default:\r\n        throw new Error('unsupported size kernel');\r\n    }\r\n  }\r\n\r\n  _graphicalKernelBody(kernelThreadString) {\r\n    switch (this.output.length) {\r\n      case 2:\r\n        return this._graphicalKernel2DLoop(kernelThreadString) + this._graphicalOutput();\r\n      default:\r\n        throw new Error('unsupported size kernel');\r\n    }\r\n  }\r\n\r\n  _graphicalOutput() {\r\n    return `\r\n    this._imageData.data.set(this._colorData);\r\n    this.context.putImageData(this._imageData, 0, 0);\r\n    return;`\r\n  }\r\n\r\n  _getKernelResultTypeConstructorString() {\r\n    switch (this.returnType) {\r\n      case 'LiteralInteger':\r\n      case 'Number':\r\n      case 'Integer':\r\n      case 'Float':\r\n        return 'Float32Array';\r\n      case 'Array(2)':\r\n      case 'Array(3)':\r\n      case 'Array(4)':\r\n        return 'Array';\r\n      default:\r\n        if (this.graphical) {\r\n          return 'Float32Array';\r\n        }\r\n        throw new Error(`unhandled returnType ${ this.returnType }`);\r\n    }\r\n  }\r\n\r\n  _resultKernel1DLoop(kernelString) {\r\n    const {\r\n      output\r\n    } = this;\r\n    const constructorString = this._getKernelResultTypeConstructorString();\r\n    return `  const outputX = _this.output[0];\r\n    const result = new ${constructorString}(outputX);\r\n    ${ this._mapSubKernels(subKernel => `const result_${ subKernel.name } = new ${constructorString}(outputX);\\n`).join('    ') }\r\n    ${ this._mapSubKernels(subKernel => `let subKernelResult_${ subKernel.name };\\n`).join('    ') }\r\n    for (let x = 0; x < outputX; x++) {\r\n      this.thread.x = x;\r\n      this.thread.y = 0;\r\n      this.thread.z = 0;\r\n      ${ kernelString }\r\n    }`;\r\n  }\r\n\r\n  _resultKernel2DLoop(kernelString) {\r\n    const {\r\n      output\r\n    } = this;\r\n    const constructorString = this._getKernelResultTypeConstructorString();\r\n    return `  const outputX = _this.output[0];\r\n    const outputY = _this.output[1];\r\n    const result = new Array(outputY);\r\n    ${ this._mapSubKernels(subKernel => `const result_${ subKernel.name } = new Array(outputY);\\n`).join('    ') }\r\n    ${ this._mapSubKernels(subKernel => `let subKernelResult_${ subKernel.name };\\n`).join('    ') }\r\n    for (let y = 0; y < outputY; y++) {\r\n      this.thread.z = 0;\r\n      this.thread.y = y;\r\n      const resultX = result[y] = new ${constructorString}(outputX);\r\n      ${ this._mapSubKernels(subKernel => `const resultX_${ subKernel.name } = result_${subKernel.name}[y] = new ${constructorString}(outputX);\\n`).join('') }\r\n      for (let x = 0; x < outputX; x++) {\r\n        this.thread.x = x;\r\n        ${ kernelString }\r\n      }\r\n    }`;\r\n  }\r\n\r\n  _graphicalKernel2DLoop(kernelString) {\r\n    const {\r\n      output\r\n    } = this;\r\n    const constructorString = this._getKernelResultTypeConstructorString();\r\n    return `  const outputX = _this.output[0];\r\n    const outputY = _this.output[1];\r\n    ${ this._mapSubKernels(subKernel => `const result_${ subKernel.name } = new Array(outputY);\\n`).join('    ') }\r\n    ${ this._mapSubKernels(subKernel => `let subKernelResult_${ subKernel.name };\\n`).join('    ') }\r\n    for (let y = 0; y < outputY; y++) {\r\n      this.thread.z = 0;\r\n      this.thread.y = y;\r\n      ${ this._mapSubKernels(subKernel => `const resultX_${ subKernel.name } = result_${subKernel.name}[y] = new ${constructorString}(outputX);\\n`).join('') }\r\n      for (let x = 0; x < outputX; x++) {\r\n        this.thread.x = x;\r\n        ${ kernelString }\r\n      }\r\n    }`;\r\n  }\r\n\r\n  _resultKernel3DLoop(kernelString) {\r\n    const {\r\n      output\r\n    } = this;\r\n    const constructorString = this._getKernelResultTypeConstructorString();\r\n    return `  const outputX = _this.output[0];\r\n    const outputY = _this.output[1];\r\n    const outputZ = _this.output[2];\r\n    const result = new Array(outputZ);\r\n    ${ this._mapSubKernels(subKernel => `const result_${ subKernel.name } = new Array(outputZ);\\n`).join('    ') }\r\n    ${ this._mapSubKernels(subKernel => `let subKernelResult_${ subKernel.name };\\n`).join('    ') }\r\n    for (let z = 0; z < outputZ; z++) {\r\n      this.thread.z = z;\r\n      const resultY = result[z] = new Array(outputY);\r\n      ${ this._mapSubKernels(subKernel => `const resultY_${ subKernel.name } = result_${subKernel.name}[z] = new Array(outputY);\\n`).join('      ') }\r\n      for (let y = 0; y < outputY; y++) {\r\n        this.thread.y = y;\r\n        const resultX = resultY[y] = new ${constructorString}(outputX);\r\n        ${ this._mapSubKernels(subKernel => `const resultX_${ subKernel.name } = resultY_${subKernel.name}[y] = new ${constructorString}(outputX);\\n`).join('        ') }\r\n        for (let x = 0; x < outputX; x++) {\r\n          this.thread.x = x;\r\n          ${ kernelString }\r\n        }\r\n      }\r\n    }`;\r\n  }\r\n\r\n  _kernelOutput() {\r\n    if (!this.subKernels) {\r\n      return '\\n    return result;';\r\n    }\r\n    return `\\n    return {\r\n      result: result,\r\n      ${ this.subKernels.map(subKernel => `${ subKernel.property }: result_${ subKernel.name }`).join(',\\n      ') }\r\n    };`;\r\n  }\r\n\r\n  _mapSubKernels(fn) {\r\n    return this.subKernels === null ? [''] :\r\n      this.subKernels.map(fn);\r\n  }\r\n\r\n\r\n\r\n  destroy(removeCanvasReference) {\r\n    if (removeCanvasReference) {\r\n      delete this.canvas;\r\n    }\r\n  }\r\n\r\n  static destroyContext(context) {}\r\n\r\n  toJSON() {\r\n    const json = super.toJSON();\r\n    json.functionNodes = FunctionBuilder.fromKernel(this, CPUFunctionNode).toJSON();\r\n    return json;\r\n  }\r\n\r\n  setOutput(output) {\r\n    super.setOutput(output);\r\n    const [width, height] = this.output;\r\n    if (this.graphical) {\r\n      this._imageData = this.context.createImageData(width, height);\r\n      this._colorData = new Uint8ClampedArray(width * height * 4);\r\n    }\r\n  }\r\n}\r\n","import { utils } from '../../utils';\r\n\r\nfunction constantsToString(constants) {\r\n  const results = [];\r\n  for (const p in constants) {\r\n    const constant = constants[p];\r\n    switch (typeof constant) {\r\n      case 'number':\r\n      case 'boolean':\r\n        results.push(`${p}:${constant}`);\r\n    }\r\n  }\r\n  return `{ ${ results.join() } }`;\r\n}\r\n\r\nexport function cpuKernelString(cpuKernel, name) {\r\n  const header = [];\r\n  const thisProperties = [];\r\n  const beforeReturn = [];\r\n\r\n  const useFunctionKeyword = !/^function/.test(cpuKernel.color.toString());\r\n\r\n  header.push(\r\n    '  const { context, canvas, constants } = settings;',\r\n    `  const output = new Int32Array(${JSON.stringify(Array.from(cpuKernel.output))});`,\r\n    `  const _constants = ${constantsToString(cpuKernel.constants)};`,\r\n  );\r\n\r\n  thisProperties.push(\r\n    '    constants: _constants,',\r\n    '    context,',\r\n    '    output,',\r\n    '    thread: {x: 0, y: 0, z: 0},',\r\n  );\r\n\r\n  if (cpuKernel.graphical) {\r\n    header.push(`  const _imageData = context.createImageData(${cpuKernel.output[0]}, ${cpuKernel.output[1]});`);\r\n    header.push(`  const _colorData = new Uint8ClampedArray(${cpuKernel.output[0]} * ${cpuKernel.output[1]} * 4);`);\r\n\r\n    const colorFn = utils.flattenFunctionToString((useFunctionKeyword ? 'function ' : '') + cpuKernel.color.toString(), {\r\n      thisLookup: (propertyName) => {\r\n        switch (propertyName) {\r\n          case '_colorData':\r\n            return '_colorData';\r\n          case '_imageData':\r\n            return '_imageData';\r\n          case 'output':\r\n            return 'output';\r\n          case 'thread':\r\n            return 'this.thread';\r\n        }\r\n        return JSON.stringify(cpuKernel[propertyName]);\r\n      },\r\n      findDependency: (object, name) => {\r\n        return null;\r\n      }\r\n    });\r\n\r\n    const getPixelsFn = utils.flattenFunctionToString((useFunctionKeyword ? 'function ' : '') + cpuKernel.getPixels.toString(), {\r\n      thisLookup: (propertyName) => {\r\n        switch (propertyName) {\r\n          case '_colorData':\r\n            return '_colorData';\r\n          case '_imageData':\r\n            return '_imageData';\r\n          case 'output':\r\n            return 'output';\r\n          case 'thread':\r\n            return 'this.thread';\r\n        }\r\n        return JSON.stringify(cpuKernel[propertyName]);\r\n      },\r\n      findDependency: () => {\r\n        return null;\r\n      }\r\n    });\r\n\r\n    thisProperties.push(\r\n      '    _imageData,',\r\n      '    _colorData,',\r\n      `    color: ${colorFn},`,\r\n    );\r\n\r\n    beforeReturn.push(\r\n      `  kernel.getPixels = ${getPixelsFn};`\r\n    );\r\n  }\r\n\r\n  const constantTypes = [];\r\n  const constantKeys = Object.keys(cpuKernel.constantTypes);\r\n  for (let i = 0; i < constantKeys.length; i++) {\r\n    constantTypes.push(cpuKernel.constantTypes[constantKeys]);\r\n  }\r\n  if (cpuKernel.argumentTypes.indexOf('HTMLImageArray') !== -1 || constantTypes.indexOf('HTMLImageArray') !== -1) {\r\n    const flattenedImageTo3DArray = utils.flattenFunctionToString((useFunctionKeyword ? 'function ' : '') + cpuKernel._imageTo3DArray.toString(), {\r\n      doNotDefine: ['canvas'],\r\n      findDependency: (object, name) => {\r\n        if (object === 'this') {\r\n          return (useFunctionKeyword ? 'function ' : '') + cpuKernel[name].toString();\r\n        }\r\n        return null;\r\n      },\r\n      thisLookup: (propertyName) => {\r\n        switch (propertyName) {\r\n          case 'canvas':\r\n            return;\r\n          case 'context':\r\n            return 'context';\r\n        }\r\n      }\r\n    })\r\n    beforeReturn.push(flattenedImageTo3DArray);\r\n    thisProperties.push(`    _imageTo2DArray,`);\r\n    thisProperties.push(`    _imageTo3DArray,`);\r\n  } else if (cpuKernel.argumentTypes.indexOf('HTMLImage') !== -1 || constantTypes.indexOf('HTMLImage') !== -1) {\r\n    const flattenedImageTo2DArray = utils.flattenFunctionToString((useFunctionKeyword ? 'function ' : '') + cpuKernel._imageTo2DArray.toString(), {\r\n      findDependency: (object, name) => {\r\n        return null;\r\n      },\r\n      thisLookup: (propertyName) => {\r\n        switch (propertyName) {\r\n          case 'canvas':\r\n            return 'settings.canvas';\r\n          case 'context':\r\n            return 'settings.context';\r\n        }\r\n        throw new Error('unhandled thisLookup');\r\n      }\r\n    });\r\n    beforeReturn.push(flattenedImageTo2DArray);\r\n    thisProperties.push(`    _imageTo2DArray,`);\r\n  }\r\n\r\n  return `function(settings) {\r\n${ header.join('\\n') }\r\n  for (const p in constants) {\r\n    const constant = constants[p];\r\n    switch (typeof constant) {\r\n      case 'number':\r\n      case 'boolean':\r\n        continue;\r\n    }\r\n    _constants[p] = constant;\r\n  }\r\n  const kernel = (function() {\r\n${cpuKernel._kernelString}\r\n  })\r\n    .apply({ ${thisProperties.join('\\n')} });\r\n  ${ beforeReturn.join('\\n') }\r\n  return kernel;\r\n}`;\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { Texture } from '../../../texture';\r\n\r\nexport class GLTextureFloat extends Texture {\r\n  constructor(settings) {\r\n    super(settings);\r\n    this.type = 'ArrayTexture(1)';\r\n  }\r\n  renderRawOutput() {\r\n    const { context: gl } = this;\r\n    const framebuffer = gl.createFramebuffer();\r\n    gl.bindFramebuffer(gl.FRAMEBUFFER, framebuffer);\r\n    gl.framebufferTexture2D(\r\n      gl.FRAMEBUFFER,\r\n      gl.COLOR_ATTACHMENT0,\r\n      gl.TEXTURE_2D,\r\n      this.texture,\r\n      0\r\n    );\r\n    const result = new Float32Array(this.size[0] * this.size[1] * 4);\r\n    gl.readPixels(0, 0, this.size[0], this.size[1], gl.RGBA, gl.FLOAT, result);\r\n    return result;\r\n  }\r\n  renderValues() {\r\n    return this.renderRawOutput();\r\n  }\r\n  toArray() {\r\n    return utils.erectFloat(this.renderValues(), this.output[0]);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { GLTextureFloat } from './float';\r\n\r\nexport class GLTextureArray2Float extends GLTextureFloat {\r\n  constructor(settings) {\r\n    super(settings);\r\n    this.type = 'ArrayTexture(2)';\r\n  }\r\n  toArray() {\r\n    return utils.erectArray2(this.renderValues(), this.output[0], this.output[1]);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { GLTextureFloat } from './float';\r\n\r\nexport class GLTextureArray2Float2D extends GLTextureFloat {\r\n  constructor(settings) {\r\n    super(settings);\r\n    this.type = 'ArrayTexture(2)';\r\n  }\r\n  toArray() {\r\n    return utils.erect2DArray2(this.renderValues(), this.output[0], this.output[1]);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { GLTextureFloat } from './float';\r\n\r\nexport class GLTextureArray2Float3D extends GLTextureFloat {\r\n  constructor(settings) {\r\n    super(settings);\r\n    this.type = 'ArrayTexture(2)';\r\n  }\r\n  toArray() {\r\n    return utils.erect3DArray2(this.renderValues(), this.output[0], this.output[1], this.output[2]);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { GLTextureFloat } from './float';\r\n\r\nexport class GLTextureArray3Float extends GLTextureFloat {\r\n  constructor(settings) {\r\n    super(settings);\r\n    this.type = 'ArrayTexture(3)';\r\n  }\r\n  toArray() {\r\n    return utils.erectArray3(this.renderValues(), this.output[0]);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { GLTextureFloat } from './float';\r\n\r\nexport class GLTextureArray3Float2D extends GLTextureFloat {\r\n  constructor(settings) {\r\n    super(settings);\r\n    this.type = 'ArrayTexture(3)';\r\n  }\r\n  toArray() {\r\n    return utils.erect2DArray3(this.renderValues(), this.output[0], this.output[1]);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { GLTextureFloat } from './float';\r\n\r\nexport class GLTextureArray3Float3D extends GLTextureFloat {\r\n  constructor(settings) {\r\n    super(settings);\r\n    this.type = 'ArrayTexture(3)';\r\n  }\r\n  toArray() {\r\n    return utils.erect3DArray3(this.renderValues(), this.output[0], this.output[1], this.output[2]);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { GLTextureFloat } from './float';\r\n\r\nexport class GLTextureArray4Float extends GLTextureFloat {\r\n  constructor(settings) {\r\n    super(settings);\r\n    this.type = 'ArrayTexture(4)';\r\n  }\r\n  toArray() {\r\n    return utils.erectArray4(this.renderValues(), this.output[0]);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { GLTextureFloat } from './float';\r\n\r\nexport class GLTextureArray4Float2D extends GLTextureFloat {\r\n  constructor(settings) {\r\n    super(settings);\r\n    this.type = 'ArrayTexture(4)';\r\n  }\r\n  toArray() {\r\n    return utils.erect2DArray4(this.renderValues(), this.output[0], this.output[1]);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { GLTextureFloat } from './float';\r\n\r\nexport class GLTextureArray4Float3D extends GLTextureFloat {\r\n  constructor(settings) {\r\n    super(settings);\r\n    this.type = 'ArrayTexture(4)';\r\n  }\r\n  toArray() {\r\n    return utils.erect3DArray4(this.renderValues(), this.output[0], this.output[1], this.output[2]);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { GLTextureFloat } from './float';\r\n\r\nexport class GLTextureFloat2D extends GLTextureFloat {\r\n  constructor(settings) {\r\n    super(settings);\r\n    this.type = 'ArrayTexture(1)';\r\n  }\r\n  toArray() {\r\n    return utils.erect2DFloat(this.renderValues(), this.output[0], this.output[1]);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { GLTextureFloat } from './float';\r\n\r\nexport class GLTextureFloat3D extends GLTextureFloat {\r\n  constructor(settings) {\r\n    super(settings);\r\n    this.type = 'ArrayTexture(1)';\r\n  }\r\n  toArray() {\r\n    return utils.erect3DFloat(this.renderValues(), this.output[0], this.output[1], this.output[2]);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { GLTextureFloat } from './float';\r\n\r\nexport class GLTextureMemoryOptimized extends GLTextureFloat {\r\n  constructor(settings) {\r\n    super(settings);\r\n    this.type = 'MemoryOptimizedNumberTexture';\r\n  }\r\n  toArray() {\r\n    return utils.erectMemoryOptimizedFloat(this.renderValues(), this.output[0]);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { GLTextureFloat } from './float';\r\n\r\nexport class GLTextureMemoryOptimized2D extends GLTextureFloat {\r\n  constructor(settings) {\r\n    super(settings);\r\n    this.type = 'MemoryOptimizedNumberTexture';\r\n  }\r\n  toArray() {\r\n    return utils.erectMemoryOptimized2DFloat(this.renderValues(), this.output[0], this.output[1]);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { GLTextureFloat } from './float';\r\n\r\nexport class GLTextureMemoryOptimized3D extends GLTextureFloat {\r\n  constructor(settings) {\r\n    super(settings);\r\n    this.type = 'MemoryOptimizedNumberTexture';\r\n  }\r\n  toArray() {\r\n    return utils.erectMemoryOptimized3DFloat(this.renderValues(), this.output[0], this.output[1], this.output[2]);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { Texture } from '../../../texture';\r\n\r\nexport class GLTextureUnsigned extends Texture {\r\n  constructor(settings) {\r\n    super(settings);\r\n    this.type = 'NumberTexture';\r\n  }\r\n  renderRawOutput() {\r\n    const { context: gl } = this;\r\n    const framebuffer = gl.createFramebuffer();\r\n    gl.bindFramebuffer(gl.FRAMEBUFFER, framebuffer);\r\n    gl.framebufferTexture2D(\r\n      gl.FRAMEBUFFER,\r\n      gl.COLOR_ATTACHMENT0,\r\n      gl.TEXTURE_2D,\r\n      this.texture,\r\n      0\r\n    );\r\n    const result = new Uint8Array(this.size[0] * this.size[1] * 4);\r\n    gl.readPixels(0, 0, this.size[0], this.size[1], gl.RGBA, gl.UNSIGNED_BYTE, result);\r\n    return result;\r\n  }\r\n  renderValues() {\r\n    return new Float32Array(this.renderRawOutput().buffer);\r\n  }\r\n  toArray() {\r\n    return utils.erectPackedFloat(this.renderValues(), this.output[0]);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { GLTextureUnsigned } from './unsigned';\r\n\r\nexport class GLTextureUnsigned2D extends GLTextureUnsigned {\r\n  constructor(settings) {\r\n    super(settings);\r\n    this.type = 'NumberTexture';\r\n  }\r\n  toArray() {\r\n    return utils.erect2DPackedFloat(this.renderValues(), this.output[0], this.output[1]);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { GLTextureUnsigned } from './unsigned';\r\n\r\nexport class GLTextureUnsigned3D extends GLTextureUnsigned {\r\n  constructor(settings) {\r\n    super(settings);\r\n    this.type = 'NumberTexture';\r\n  }\r\n  toArray() {\r\n    return utils.erect3DPackedFloat(this.renderValues(), this.output[0], this.output[1], this.output[2]);\r\n  }\r\n}\r\n","import { GLTextureUnsigned } from './unsigned';\r\n\r\nexport class GLTextureGraphical extends GLTextureUnsigned {\r\n  constructor(settings) {\r\n    super(settings);\r\n    this.type = 'ArrayTexture(4)';\r\n  }\r\n  toArray() {\r\n    return this.renderValues();\r\n  }\r\n}\r\n","import { Kernel } from '../kernel';\r\nimport { utils } from '../../utils';\r\nimport { GLTextureArray2Float } from './texture/array-2-float';\r\nimport { GLTextureArray2Float2D } from './texture/array-2-float-2d';\r\nimport { GLTextureArray2Float3D } from './texture/array-2-float-3d';\r\nimport { GLTextureArray3Float } from './texture/array-3-float';\r\nimport { GLTextureArray3Float2D } from './texture/array-3-float-2d';\r\nimport { GLTextureArray3Float3D } from './texture/array-3-float-3d';\r\nimport { GLTextureArray4Float } from './texture/array-4-float';\r\nimport { GLTextureArray4Float2D } from './texture/array-4-float-2d';\r\nimport { GLTextureArray4Float3D } from './texture/array-4-float-3d';\r\nimport { GLTextureFloat } from './texture/float';\r\nimport { GLTextureFloat2D } from './texture/float-2d';\r\nimport { GLTextureFloat3D } from './texture/float-3d';\r\nimport { GLTextureMemoryOptimized } from './texture/memory-optimized';\r\nimport { GLTextureMemoryOptimized2D } from './texture/memory-optimized-2d';\r\nimport { GLTextureMemoryOptimized3D } from './texture/memory-optimized-3d';\r\nimport { GLTextureUnsigned } from './texture/unsigned';\r\nimport { GLTextureUnsigned2D } from './texture/unsigned-2d';\r\nimport { GLTextureUnsigned3D } from './texture/unsigned-3d';\r\nimport { GLTextureGraphical } from './texture/graphical';\r\n\r\n/**\r\n * @abstract\r\n * @extends Kernel\r\n */\r\nexport class GLKernel extends Kernel {\r\n  static get mode() {\r\n    return 'gpu';\r\n  }\r\n\r\n  static getIsFloatRead() {\r\n    const kernelString = `function kernelFunction() {\r\n      return 1;\r\n    }`;\r\n    const kernel = new this(kernelString, {\r\n      context: this.testContext,\r\n      canvas: this.testCanvas,\r\n      validate: false,\r\n      output: [1],\r\n      precision: 'single',\r\n      returnType: 'Number',\r\n      tactic: 'speed',\r\n    });\r\n    kernel.build();\r\n    kernel.run();\r\n    const result = kernel.renderOutput();\r\n    kernel.destroy(true);\r\n    return result[0] === 1;\r\n  }\r\n\r\n  static getIsIntegerDivisionAccurate() {\r\n    function kernelFunction(v1, v2) {\r\n      return v1[this.thread.x] / v2[this.thread.x];\r\n    }\r\n    const kernel = new this(kernelFunction.toString(), {\r\n      context: this.testContext,\r\n      canvas: this.testCanvas,\r\n      validate: false,\r\n      output: [2],\r\n      returnType: 'Number',\r\n      precision: 'unsigned',\r\n      tactic: 'speed',\r\n    });\r\n    const args = [\r\n      [6, 6030401],\r\n      [3, 3991]\r\n    ];\r\n    kernel.build.apply(kernel, args);\r\n    kernel.run.apply(kernel, args);\r\n    const result = kernel.renderOutput();\r\n    kernel.destroy(true);\r\n    // have we not got whole numbers for 6/3 or 6030401/3991\r\n    // add more here if others see this problem\r\n    return result[0] === 2 && result[1] === 1511;\r\n  }\r\n\r\n  /**\r\n   * @abstract\r\n   */\r\n  static get testCanvas() {\r\n    throw new Error(`\"testCanvas\" not defined on ${ this.name }`);\r\n  }\r\n\r\n  /**\r\n   * @abstract\r\n   */\r\n  static get testContext() {\r\n    throw new Error(`\"testContext\" not defined on ${ this.name }`);\r\n  }\r\n\r\n  /**\r\n   * @type {IKernelFeatures}\r\n   */\r\n  static get features() {\r\n    throw new Error(`\"features\" not defined on ${ this.name }`);\r\n  }\r\n\r\n  /**\r\n   * @abstract\r\n   */\r\n  static setupFeatureChecks() {\r\n    throw new Error(`\"setupFeatureChecks\" not defined on ${ this.name }`);\r\n  }\r\n\r\n  /**\r\n   * @desc Fix division by factor of 3 FP accuracy bug\r\n   * @param {Boolean} fix - should fix\r\n   */\r\n  setFixIntegerDivisionAccuracy(fix) {\r\n    this.fixIntegerDivisionAccuracy = fix;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * @desc Toggle output mode\r\n   * @param {String} flag - 'single' or 'unsigned'\r\n   */\r\n  setPrecision(flag) {\r\n    this.precision = flag;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * @desc Toggle texture output mode\r\n   * @param {Boolean} flag - true to enable floatTextures\r\n   * @deprecated\r\n   */\r\n  setFloatTextures(flag) {\r\n    utils.warnDeprecated('method', 'setFloatTextures', 'setOptimizeFloatMemory');\r\n    this.floatTextures = flag;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * A highly readable very forgiving micro-parser for a glsl function that gets argument types\r\n   * @param {String} source\r\n   * @returns {{argumentTypes: String[], argumentNames: String[]}}\r\n   */\r\n  static nativeFunctionArguments(source) {\r\n    const argumentTypes = [];\r\n    const argumentNames = [];\r\n    const states = [];\r\n    const isStartingVariableName = /^[a-zA-Z_]/;\r\n    const isVariableChar = /[a-zA-Z_0-9]/;\r\n    let i = 0;\r\n    let argumentName = null;\r\n    let argumentType = null;\r\n    while (i < source.length) {\r\n      const char = source[i];\r\n      const nextChar = source[i + 1];\r\n      const state = states.length > 0 ? states[states.length - 1] : null;\r\n\r\n      // begin MULTI_LINE_COMMENT handling\r\n      if (state === 'FUNCTION_ARGUMENTS' && char === '/' && nextChar === '*') {\r\n        states.push('MULTI_LINE_COMMENT');\r\n        i += 2;\r\n        continue;\r\n      } else if (state === 'MULTI_LINE_COMMENT' && char === '*' && nextChar === '/') {\r\n        states.pop();\r\n        i += 2;\r\n        continue;\r\n      }\r\n      // end MULTI_LINE_COMMENT handling\r\n\r\n      // begin COMMENT handling\r\n      else if (state === 'FUNCTION_ARGUMENTS' && char === '/' && nextChar === '/') {\r\n        states.push('COMMENT');\r\n        i += 2;\r\n        continue;\r\n      } else if (state === 'COMMENT' && char === '\\n') {\r\n        states.pop();\r\n        i++;\r\n        continue;\r\n      }\r\n      // end COMMENT handling\r\n\r\n      // being FUNCTION_ARGUMENTS handling\r\n      else if (state === null && char === '(') {\r\n        states.push('FUNCTION_ARGUMENTS');\r\n        i++;\r\n        continue;\r\n      } else if (state === 'FUNCTION_ARGUMENTS') {\r\n        if (char === ')') {\r\n          states.pop();\r\n          break;\r\n        }\r\n        if (char === 'f' && nextChar === 'l' && source[i + 2] === 'o' && source[i + 3] === 'a' && source[i + 4] === 't' && source[i + 5] === ' ') {\r\n          states.push('DECLARE_VARIABLE');\r\n          argumentType = 'float';\r\n          argumentName = '';\r\n          i += 6;\r\n          continue;\r\n        } else if (char === 'i' && nextChar === 'n' && source[i + 2] === 't' && source[i + 3] === ' ') {\r\n          states.push('DECLARE_VARIABLE');\r\n          argumentType = 'int';\r\n          argumentName = '';\r\n          i += 4;\r\n          continue;\r\n        } else if (char === 'v' && nextChar === 'e' && source[i + 2] === 'c' && source[i + 3] === '2' && source[i + 4] === ' ') {\r\n          states.push('DECLARE_VARIABLE');\r\n          argumentType = 'vec2';\r\n          argumentName = '';\r\n          i += 5;\r\n          continue;\r\n        } else if (char === 'v' && nextChar === 'e' && source[i + 2] === 'c' && source[i + 3] === '3' && source[i + 4] === ' ') {\r\n          states.push('DECLARE_VARIABLE');\r\n          argumentType = 'vec3';\r\n          argumentName = '';\r\n          i += 5;\r\n          continue;\r\n        } else if (char === 'v' && nextChar === 'e' && source[i + 2] === 'c' && source[i + 3] === '4' && source[i + 4] === ' ') {\r\n          states.push('DECLARE_VARIABLE');\r\n          argumentType = 'vec4';\r\n          argumentName = '';\r\n          i += 5;\r\n          continue;\r\n        }\r\n      }\r\n      // end FUNCTION_ARGUMENTS handling\r\n\r\n      // begin DECLARE_VARIABLE handling\r\n      else if (state === 'DECLARE_VARIABLE') {\r\n        if (argumentName === '') {\r\n          if (char === ' ') {\r\n            i++;\r\n            continue;\r\n          }\r\n          if (!isStartingVariableName.test(char)) {\r\n            throw new Error('variable name is not expected string');\r\n          }\r\n        }\r\n        argumentName += char;\r\n        if (!isVariableChar.test(nextChar)) {\r\n          states.pop();\r\n          argumentNames.push(argumentName);\r\n          argumentTypes.push(typeMap[argumentType]);\r\n        }\r\n      }\r\n      // end DECLARE_VARIABLE handling\r\n\r\n      // Progress to next character\r\n      i++;\r\n    }\r\n    if (states.length > 0) {\r\n      throw new Error('GLSL function was not parsable');\r\n    }\r\n    return {\r\n      argumentNames,\r\n      argumentTypes,\r\n    };\r\n  }\r\n\r\n  static nativeFunctionReturnType(source) {\r\n    return typeMap[source.match(/int|float|vec[2-4]/)[0]];\r\n  }\r\n\r\n  static combineKernels(combinedKernel, lastKernel) {\r\n    combinedKernel.apply(null, arguments);\r\n    const {\r\n      texSize,\r\n      context,\r\n      threadDim\r\n    } = lastKernel.texSize;\r\n    let result;\r\n    if (lastKernel.precision === 'single') {\r\n      const w = texSize[0];\r\n      const h = Math.ceil(texSize[1] / 4);\r\n      result = new Float32Array(w * h * 4 * 4);\r\n      context.readPixels(0, 0, w, h * 4, context.RGBA, context.FLOAT, result);\r\n    } else {\r\n      const bytes = new Uint8Array(texSize[0] * texSize[1] * 4);\r\n      context.readPixels(0, 0, texSize[0], texSize[1], context.RGBA, context.UNSIGNED_BYTE, bytes);\r\n      result = new Float32Array(bytes.buffer);\r\n    }\r\n\r\n    result = result.subarray(0, threadDim[0] * threadDim[1] * threadDim[2]);\r\n\r\n    if (lastKernel.output.length === 1) {\r\n      return result;\r\n    } else if (lastKernel.output.length === 2) {\r\n      return utils.splitArray(result, lastKernel.output[0]);\r\n    } else if (lastKernel.output.length === 3) {\r\n      const cube = utils.splitArray(result, lastKernel.output[0] * lastKernel.output[1]);\r\n      return cube.map(function(x) {\r\n        return utils.splitArray(x, lastKernel.output[0]);\r\n      });\r\n    }\r\n  }\r\n\r\n  constructor(source, settings) {\r\n    super(source, settings);\r\n    this.transferValues = null;\r\n    this.formatValues = null;\r\n    this.TextureConstructor = null;\r\n    this.renderOutput = null;\r\n    this.renderRawOutput = null;\r\n    this.texSize = null;\r\n    this.translatedSource = null;\r\n    this.renderStrategy = null;\r\n    this.compiledFragmentShader = null;\r\n    this.compiledVertexShader = null;\r\n  }\r\n\r\n  translateSource() {\r\n    throw new Error(`\"translateSource\" not defined on ${this.constructor.name}`);\r\n  }\r\n\r\n  /**\r\n   * Picks a render strategy for the now finally parsed kernel\r\n   * @param args\r\n   * @return {null|KernelOutput}\r\n   */\r\n  pickRenderStrategy(args) {\r\n    if (this.graphical) {\r\n      this.renderRawOutput = this.readPackedPixelsToUint8Array;\r\n      this.transferValues = (pixels) => pixels;\r\n      this.TextureConstructor = GLTextureGraphical;\r\n      return null;\r\n    }\r\n    if (this.precision === 'unsigned') {\r\n      this.renderRawOutput = this.readPackedPixelsToUint8Array;\r\n      this.transferValues = this.readPackedPixelsToFloat32Array;\r\n      if (this.pipeline) {\r\n        this.renderOutput = this.renderTexture;\r\n        if (this.subKernels !== null) {\r\n          this.renderKernels = this.renderKernelsToTextures;\r\n        }\r\n        switch (this.returnType) {\r\n          case 'LiteralInteger':\r\n          case 'Float':\r\n          case 'Number':\r\n          case 'Integer':\r\n            if (this.output[2] > 0) {\r\n              this.TextureConstructor = GLTextureUnsigned3D;\r\n              this.renderStrategy = renderStrategy.PackedPixelTo3DFloat;\r\n              return null;\r\n            } else if (this.output[1] > 0) {\r\n              this.TextureConstructor = GLTextureUnsigned2D;\r\n              this.renderStrategy = renderStrategy.PackedPixelTo2DFloat;\r\n              return null;\r\n            } else {\r\n              this.TextureConstructor = GLTextureUnsigned;\r\n              this.renderStrategy = renderStrategy.PackedPixelToFloat;\r\n              return null;\r\n            }\r\n            break;\r\n          case 'Array(2)':\r\n          case 'Array(3)':\r\n          case 'Array(4)':\r\n            return this.requestFallback(args);\r\n        }\r\n      } else {\r\n        if (this.subKernels !== null) {\r\n          this.renderKernels = this.renderKernelsToArrays;\r\n        }\r\n        switch (this.returnType) {\r\n          case 'LiteralInteger':\r\n          case 'Float':\r\n          case 'Number':\r\n          case 'Integer':\r\n            this.renderOutput = this.renderValues;\r\n            if (this.output[2] > 0) {\r\n              this.TextureConstructor = GLTextureUnsigned3D;\r\n              this.renderStrategy = renderStrategy.PackedPixelTo3DFloat;\r\n              this.formatValues = utils.erect3DPackedFloat;\r\n              return null;\r\n            } else if (this.output[1] > 0) {\r\n              this.TextureConstructor = GLTextureUnsigned2D;\r\n              this.renderStrategy = renderStrategy.PackedPixelTo2DFloat;\r\n              this.formatValues = utils.erect2DPackedFloat;\r\n              return null;\r\n            } else {\r\n              this.TextureConstructor = GLTextureUnsigned;\r\n              this.renderStrategy = renderStrategy.PackedPixelToFloat;\r\n              this.formatValues = utils.erectPackedFloat;\r\n              return null;\r\n            }\r\n\r\n            break;\r\n          case 'Array(2)':\r\n          case 'Array(3)':\r\n          case 'Array(4)':\r\n            return this.requestFallback(args);\r\n        }\r\n      }\r\n    } else if (this.precision === 'single') {\r\n      this.renderRawOutput = this.readFloatPixelsToFloat32Array;\r\n      this.transferValues = this.readFloatPixelsToFloat32Array;\r\n      if (this.pipeline) {\r\n        this.renderStrategy = renderStrategy.FloatTexture;\r\n        this.renderOutput = this.renderTexture;\r\n        if (this.subKernels !== null) {\r\n          this.renderKernels = this.renderKernelsToTextures;\r\n        }\r\n        switch (this.returnType) {\r\n          case 'LiteralInteger':\r\n          case 'Float':\r\n          case 'Number':\r\n          case 'Integer':\r\n            if (this.optimizeFloatMemory) {\r\n              if (this.output[2] > 0) {\r\n                this.TextureConstructor = GLTextureMemoryOptimized3D;\r\n                return null;\r\n              } else if (this.output[1] > 0) {\r\n                this.TextureConstructor = GLTextureMemoryOptimized2D;\r\n                return null;\r\n              } else {\r\n                this.TextureConstructor = GLTextureMemoryOptimized;\r\n                return null;\r\n              }\r\n            } else {\r\n              if (this.output[2] > 0) {\r\n                this.TextureConstructor = GLTextureFloat3D;\r\n                return null;\r\n              } else if (this.output[1] > 0) {\r\n                this.TextureConstructor = GLTextureFloat2D;\r\n                return null;\r\n              } else {\r\n                this.TextureConstructor = GLTextureFloat;\r\n                return null;\r\n              }\r\n            }\r\n            break;\r\n          case 'Array(2)':\r\n            if (this.output[2] > 0) {\r\n              this.TextureConstructor = GLTextureArray2Float3D;\r\n              return null;\r\n            } else if (this.output[1] > 0) {\r\n              this.TextureConstructor = GLTextureArray2Float2D;\r\n              return null;\r\n            } else {\r\n              this.TextureConstructor = GLTextureArray2Float;\r\n              return null;\r\n            }\r\n            break;\r\n          case 'Array(3)':\r\n            if (this.output[2] > 0) {\r\n              this.TextureConstructor = GLTextureArray3Float3D;\r\n              return null;\r\n            } else if (this.output[1] > 0) {\r\n              this.TextureConstructor = GLTextureArray3Float2D;\r\n              return null;\r\n            } else {\r\n              this.TextureConstructor = GLTextureArray3Float;\r\n              return null;\r\n            }\r\n            break;\r\n          case 'Array(4)':\r\n            if (this.output[2] > 0) {\r\n              this.TextureConstructor = GLTextureArray4Float3D;\r\n              return null;\r\n            } else if (this.output[1] > 0) {\r\n              this.TextureConstructor = GLTextureArray4Float2D;\r\n              return null;\r\n            } else {\r\n              this.TextureConstructor = GLTextureArray4Float;\r\n              return null;\r\n            }\r\n        }\r\n      }\r\n      this.renderOutput = this.renderValues;\r\n      if (this.subKernels !== null) {\r\n        this.renderKernels = this.renderKernelsToArrays;\r\n      }\r\n      if (this.optimizeFloatMemory) {\r\n        switch (this.returnType) {\r\n          case 'LiteralInteger':\r\n          case 'Float':\r\n          case 'Number':\r\n          case 'Integer':\r\n            if (this.output[2] > 0) {\r\n              this.TextureConstructor = GLTextureMemoryOptimized3D;\r\n              this.renderStrategy = renderStrategy.MemoryOptimizedFloatPixelToMemoryOptimized3DFloat;\r\n              this.formatValues = utils.erectMemoryOptimized3DFloat;\r\n              return null;\r\n            } else if (this.output[1] > 0) {\r\n              this.TextureConstructor = GLTextureMemoryOptimized2D;\r\n              this.renderStrategy = renderStrategy.MemoryOptimizedFloatPixelToMemoryOptimized2DFloat;\r\n              this.formatValues = utils.erectMemoryOptimized2DFloat;\r\n              return null;\r\n            } else {\r\n              this.TextureConstructor = GLTextureMemoryOptimized;\r\n              this.renderStrategy = renderStrategy.MemoryOptimizedFloatPixelToMemoryOptimizedFloat;\r\n              this.formatValues = utils.erectMemoryOptimizedFloat;\r\n              return null;\r\n            }\r\n            break;\r\n          case 'Array(2)':\r\n            if (this.output[2] > 0) {\r\n              this.TextureConstructor = GLTextureArray2Float3D;\r\n              this.renderStrategy = renderStrategy.FloatPixelTo3DArray2;\r\n              this.formatValues = utils.erect3DArray2;\r\n              return null;\r\n            } else if (this.output[1] > 0) {\r\n              this.TextureConstructor = GLTextureArray2Float2D;\r\n              this.renderStrategy = renderStrategy.FloatPixelTo2DArray2;\r\n              this.formatValues = utils.erect2DArray2;\r\n              return null;\r\n            } else {\r\n              this.TextureConstructor = GLTextureArray2Float;\r\n              this.renderStrategy = renderStrategy.FloatPixelToArray2;\r\n              this.formatValues = utils.erectArray2;\r\n              return null;\r\n            }\r\n            break;\r\n          case 'Array(3)':\r\n            if (this.output[2] > 0) {\r\n              this.TextureConstructor = GLTextureArray3Float3D;\r\n              this.renderStrategy = renderStrategy.FloatPixelTo3DArray3;\r\n              this.formatValues = utils.erect3DArray3;\r\n              return null;\r\n            } else if (this.output[1] > 0) {\r\n              this.TextureConstructor = GLTextureArray3Float2D;\r\n              this.renderStrategy = renderStrategy.FloatPixelTo2DArray3;\r\n              this.formatValues = utils.erect2DArray3;\r\n              return null;\r\n            } else {\r\n              this.TextureConstructor = GLTextureArray3Float;\r\n              this.renderStrategy = renderStrategy.FloatPixelToArray3;\r\n              this.formatValues = utils.erectArray3;\r\n              return null;\r\n            }\r\n            break;\r\n          case 'Array(4)':\r\n            if (this.output[2] > 0) {\r\n              this.TextureConstructor = GLTextureArray4Float3D;\r\n              this.renderStrategy = renderStrategy.FloatPixelTo3DArray4;\r\n              this.formatValues = utils.erect3DArray4;\r\n              return null;\r\n            } else if (this.output[1] > 0) {\r\n              this.TextureConstructor = GLTextureArray4Float2D;\r\n              this.renderStrategy = renderStrategy.FloatPixelTo2DArray4;\r\n              this.formatValues = utils.erect2DArray4;\r\n              return null;\r\n            } else {\r\n              this.TextureConstructor = GLTextureArray4Float;\r\n              this.renderStrategy = renderStrategy.FloatPixelToArray4;\r\n              this.formatValues = utils.erectArray4;\r\n              return null;\r\n            }\r\n        }\r\n      } else {\r\n        switch (this.returnType) {\r\n          case 'LiteralInteger':\r\n          case 'Float':\r\n          case 'Number':\r\n          case 'Integer':\r\n            if (this.output[2] > 0) {\r\n              this.TextureConstructor = GLTextureFloat3D;\r\n              this.renderStrategy = renderStrategy.FloatPixelTo3DFloat;\r\n              this.formatValues = utils.erect3DFloat;\r\n              return null;\r\n            } else if (this.output[1] > 0) {\r\n              this.TextureConstructor = GLTextureFloat2D;\r\n              this.renderStrategy = renderStrategy.FloatPixelTo2DFloat;\r\n              this.formatValues = utils.erect2DFloat;\r\n              return null;\r\n            } else {\r\n              this.TextureConstructor = GLTextureFloat;\r\n              this.renderStrategy = renderStrategy.FloatPixelToFloat;\r\n              this.formatValues = utils.erectFloat;\r\n              return null;\r\n            }\r\n            break;\r\n          case 'Array(2)':\r\n            if (this.output[2] > 0) {\r\n              this.TextureConstructor = GLTextureArray2Float3D;\r\n              this.renderStrategy = renderStrategy.FloatPixelTo3DArray2;\r\n              this.formatValues = utils.erect3DArray2;\r\n              return null;\r\n            } else if (this.output[1] > 0) {\r\n              this.TextureConstructor = GLTextureArray2Float2D;\r\n              this.renderStrategy = renderStrategy.FloatPixelTo2DArray2;\r\n              this.formatValues = utils.erect2DArray2;\r\n              return null;\r\n            } else {\r\n              this.TextureConstructor = GLTextureArray2Float;\r\n              this.renderStrategy = renderStrategy.FloatPixelToArray2;\r\n              this.formatValues = utils.erectArray2;\r\n              return null;\r\n            }\r\n            break;\r\n          case 'Array(3)':\r\n            if (this.output[2] > 0) {\r\n              this.TextureConstructor = GLTextureArray3Float3D;\r\n              this.renderStrategy = renderStrategy.FloatPixelTo3DArray3;\r\n              this.formatValues = utils.erect3DArray3;\r\n              return null;\r\n            } else if (this.output[1] > 0) {\r\n              this.TextureConstructor = GLTextureArray3Float2D;\r\n              this.renderStrategy = renderStrategy.FloatPixelTo2DArray3;\r\n              this.formatValues = utils.erect2DArray3;\r\n              return null;\r\n            } else {\r\n              this.TextureConstructor = GLTextureArray3Float;\r\n              this.renderStrategy = renderStrategy.FloatPixelToArray3;\r\n              this.formatValues = utils.erectArray3;\r\n              return null;\r\n            }\r\n            break;\r\n          case 'Array(4)':\r\n            if (this.output[2] > 0) {\r\n              this.TextureConstructor = GLTextureArray4Float3D;\r\n              this.renderStrategy = renderStrategy.FloatPixelTo3DArray4;\r\n              this.formatValues = utils.erect3DArray4;\r\n              return null;\r\n            } else if (this.output[1] > 0) {\r\n              this.TextureConstructor = GLTextureArray4Float2D;\r\n              this.renderStrategy = renderStrategy.FloatPixelTo2DArray4;\r\n              this.formatValues = utils.erect2DArray4;\r\n              return null;\r\n            } else {\r\n              this.TextureConstructor = GLTextureArray4Float;\r\n              this.renderStrategy = renderStrategy.FloatPixelToArray4;\r\n              this.formatValues = utils.erectArray4;\r\n              return null;\r\n            }\r\n        }\r\n      }\r\n    } else {\r\n      throw new Error(`unhandled precision of \"${this.precision}\"`);\r\n    }\r\n\r\n    throw new Error(`unhandled return type \"${this.returnType}\"`);\r\n  }\r\n\r\n  /**\r\n   * @abstract\r\n   * @returns String\r\n   */\r\n  getKernelString() {\r\n    throw new Error(`abstract method call`);\r\n  }\r\n\r\n  getMainResultTexture() {\r\n    switch (this.returnType) {\r\n      case 'LiteralInteger':\r\n      case 'Float':\r\n      case 'Integer':\r\n      case 'Number':\r\n        return this.getMainResultNumberTexture();\r\n      case 'Array(2)':\r\n        return this.getMainResultArray2Texture();\r\n      case 'Array(3)':\r\n        return this.getMainResultArray3Texture();\r\n      case 'Array(4)':\r\n        return this.getMainResultArray4Texture();\r\n      default:\r\n        throw new Error(`unhandled returnType type ${ this.returnType }`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @abstract\r\n   * @returns String[]\r\n   */\r\n  getMainResultKernelNumberTexture() {\r\n    throw new Error(`abstract method call`);\r\n  }\r\n  /**\r\n   * @abstract\r\n   * @returns String[]\r\n   */\r\n  getMainResultSubKernelNumberTexture() {\r\n    throw new Error(`abstract method call`);\r\n  }\r\n  /**\r\n   * @abstract\r\n   * @returns String[]\r\n   */\r\n  getMainResultKernelArray2Texture() {\r\n    throw new Error(`abstract method call`);\r\n  }\r\n  /**\r\n   * @abstract\r\n   * @returns String[]\r\n   */\r\n  getMainResultSubKernelArray2Texture() {\r\n    throw new Error(`abstract method call`);\r\n  }\r\n  /**\r\n   * @abstract\r\n   * @returns String[]\r\n   */\r\n  getMainResultKernelArray3Texture() {\r\n    throw new Error(`abstract method call`);\r\n  }\r\n  /**\r\n   * @abstract\r\n   * @returns String[]\r\n   */\r\n  getMainResultSubKernelArray3Texture() {\r\n    throw new Error(`abstract method call`);\r\n  }\r\n  /**\r\n   * @abstract\r\n   * @returns String[]\r\n   */\r\n  getMainResultKernelArray4Texture() {\r\n    throw new Error(`abstract method call`);\r\n  }\r\n  /**\r\n   * @abstract\r\n   * @returns String[]\r\n   */\r\n  getMainResultSubKernelArray4Texture() {\r\n    throw new Error(`abstract method call`);\r\n  }\r\n  /**\r\n   * @abstract\r\n   * @returns String[]\r\n   */\r\n  getMainResultGraphical() {\r\n    throw new Error(`abstract method call`);\r\n  }\r\n  /**\r\n   * @abstract\r\n   * @returns String[]\r\n   */\r\n  getMainResultMemoryOptimizedFloats() {\r\n    throw new Error(`abstract method call`);\r\n  }\r\n  /**\r\n   * @abstract\r\n   * @returns String[]\r\n   */\r\n  getMainResultPackedPixels() {\r\n    throw new Error(`abstract method call`);\r\n  }\r\n\r\n  getMainResultString() {\r\n    if (this.graphical) {\r\n      return this.getMainResultGraphical();\r\n    } else if (this.precision === 'single') {\r\n      if (this.optimizeFloatMemory) {\r\n        return this.getMainResultMemoryOptimizedFloats();\r\n      }\r\n      return this.getMainResultTexture();\r\n    } else {\r\n      return this.getMainResultPackedPixels();\r\n    }\r\n  }\r\n\r\n  getMainResultNumberTexture() {\r\n    return utils.linesToString(this.getMainResultKernelNumberTexture()) +\r\n      utils.linesToString(this.getMainResultSubKernelNumberTexture());\r\n  }\r\n\r\n  getMainResultArray2Texture() {\r\n    return utils.linesToString(this.getMainResultKernelArray2Texture()) +\r\n      utils.linesToString(this.getMainResultSubKernelArray2Texture());\r\n  }\r\n\r\n  getMainResultArray3Texture() {\r\n    return utils.linesToString(this.getMainResultKernelArray3Texture()) +\r\n      utils.linesToString(this.getMainResultSubKernelArray3Texture());\r\n  }\r\n\r\n  getMainResultArray4Texture() {\r\n    return utils.linesToString(this.getMainResultKernelArray4Texture()) +\r\n      utils.linesToString(this.getMainResultSubKernelArray4Texture());\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @return {string}\r\n   */\r\n  getFloatTacticDeclaration() {\r\n    switch (this.tactic) {\r\n      case 'speed':\r\n        return 'precision lowp float;\\n';\r\n      case 'performance':\r\n        return 'precision highp float;\\n';\r\n      case 'balanced':\r\n      default:\r\n        return 'precision mediump float;\\n';\r\n    }\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @return {string}\r\n   */\r\n  getIntTacticDeclaration() {\r\n    switch (this.tactic) {\r\n      case 'speed':\r\n        return 'precision lowp int;\\n';\r\n      case 'performance':\r\n        return 'precision highp int;\\n';\r\n      case 'balanced':\r\n      default:\r\n        return 'precision mediump int;\\n';\r\n    }\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @return {string}\r\n   */\r\n  getSampler2DTacticDeclaration() {\r\n    switch (this.tactic) {\r\n      case 'speed':\r\n        return 'precision lowp sampler2D;\\n';\r\n      case 'performance':\r\n        return 'precision highp sampler2D;\\n';\r\n      case 'balanced':\r\n      default:\r\n        return 'precision mediump sampler2D;\\n';\r\n    }\r\n  }\r\n\r\n  getSampler2DArrayTacticDeclaration() {\r\n    switch (this.tactic) {\r\n      case 'speed':\r\n        return 'precision lowp sampler2DArray;\\n';\r\n      case 'performance':\r\n        return 'precision highp sampler2DArray;\\n';\r\n      case 'balanced':\r\n      default:\r\n        return 'precision mediump sampler2DArray;\\n';\r\n    }\r\n  }\r\n\r\n  renderTexture() {\r\n    return new this.TextureConstructor({\r\n      texture: this.outputTexture,\r\n      size: this.texSize,\r\n      dimensions: this.threadDim,\r\n      output: this.output,\r\n      context: this.context,\r\n    });\r\n  }\r\n  readPackedPixelsToUint8Array() {\r\n    if (this.precision !== 'unsigned') throw new Error('Requires this.precision to be \"unsigned\"');\r\n    const {\r\n      texSize,\r\n      context: gl\r\n    } = this;\r\n    const result = new Uint8Array(texSize[0] * texSize[1] * 4);\r\n    gl.readPixels(0, 0, texSize[0], texSize[1], gl.RGBA, gl.UNSIGNED_BYTE, result);\r\n    return result;\r\n  }\r\n\r\n  readPackedPixelsToFloat32Array() {\r\n    return new Float32Array(this.readPackedPixelsToUint8Array().buffer);\r\n  }\r\n\r\n  readFloatPixelsToFloat32Array() {\r\n    if (this.precision !== 'single') throw new Error('Requires this.precision to be \"single\"');\r\n    const {\r\n      texSize,\r\n      context: gl\r\n    } = this;\r\n    const w = texSize[0];\r\n    const h = texSize[1];\r\n    const result = new Float32Array(w * h * 4);\r\n    gl.readPixels(0, 0, w, h, gl.RGBA, gl.FLOAT, result);\r\n    return result;\r\n  }\r\n\r\n  readMemoryOptimizedFloatPixelsToFloat32Array() {\r\n    if (this.precision !== 'single') throw new Error('Requires this.precision to be \"single\"');\r\n    const {\r\n      texSize,\r\n      context: gl\r\n    } = this;\r\n    const w = texSize[0];\r\n    const h = texSize[1];\r\n    const result = new Float32Array(w * h * 4);\r\n    gl.readPixels(0, 0, w, h, gl.RGBA, gl.FLOAT, result);\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @param {Boolean} [flip]\r\n   * @return {Uint8Array}\r\n   */\r\n  getPixels(flip) {\r\n    const {\r\n      context: gl,\r\n      output\r\n    } = this;\r\n    const [width, height] = output;\r\n    const pixels = new Uint8Array(width * height * 4);\r\n    gl.readPixels(0, 0, width, height, gl.RGBA, gl.UNSIGNED_BYTE, pixels);\r\n    // flipped by default, so invert\r\n    return new Uint8ClampedArray((flip ? pixels : utils.flipPixels(pixels, width, height)).buffer);\r\n  }\r\n\r\n  renderKernelsToArrays() {\r\n    const result = {\r\n      result: this.renderOutput(),\r\n    };\r\n    for (let i = 0; i < this.subKernels.length; i++) {\r\n      result[this.subKernels[i].property] = new this.TextureConstructor({\r\n        texture: this.subKernelOutputTextures[i],\r\n        size: this.texSize,\r\n        dimensions: this.threadDim,\r\n        output: this.output,\r\n        context: this.context,\r\n      }).toArray();\r\n    }\r\n    return result;\r\n  }\r\n\r\n  renderKernelsToTextures() {\r\n    const result = {\r\n      result: this.renderOutput(),\r\n    };\r\n    for (let i = 0; i < this.subKernels.length; i++) {\r\n      result[this.subKernels[i].property] = new this.TextureConstructor({\r\n        texture: this.subKernelOutputTextures[i],\r\n        size: this.texSize,\r\n        dimensions: this.threadDim,\r\n        output: this.output,\r\n        context: this.context,\r\n      });\r\n    }\r\n    return result;\r\n  }\r\n\r\n  setOutput(output) {\r\n    super.setOutput(output);\r\n    if (this.program) {\r\n      this.threadDim = [this.output[0], this.output[1] || 1, this.output[2] || 1];\r\n      this.texSize = utils.getKernelTextureSize({\r\n        optimizeFloatMemory: this.optimizeFloatMemory,\r\n        precision: this.precision,\r\n      }, this.output);\r\n      const { context: gl } = this;\r\n      gl.bindFramebuffer(gl.FRAMEBUFFER, this.framebuffer);\r\n      this.updateMaxTexSize();\r\n      this.framebuffer.width = this.texSize[0];\r\n      this.framebuffer.height = this.texSize[1];\r\n      this.context.viewport(0, 0, this.maxTexSize[0], this.maxTexSize[1]);\r\n      this.canvas.width = this.maxTexSize[0];\r\n      this.canvas.height = this.maxTexSize[1];\r\n      this._setupOutputTexture();\r\n      if (this.subKernels && this.subKernels.length > 0) {\r\n        this._setupSubOutputTextures();\r\n      }\r\n    }\r\n    return this;\r\n  }\r\n  renderValues() {\r\n    return this.formatValues(\r\n      this.transferValues(),\r\n      this.output[0],\r\n      this.output[1],\r\n      this.output[2]\r\n    );\r\n  }\r\n}\r\n\r\nexport const renderStrategy = Object.freeze({\r\n  PackedPixelToUint8Array: Symbol('PackedPixelToUint8Array'),\r\n  PackedPixelToFloat: Symbol('PackedPixelToFloat'),\r\n  PackedPixelTo2DFloat: Symbol('PackedPixelTo2DFloat'),\r\n  PackedPixelTo3DFloat: Symbol('PackedPixelTo3DFloat'),\r\n  PackedTexture: Symbol('PackedTexture'),\r\n  FloatPixelToFloat32Array: Symbol('FloatPixelToFloat32Array'),\r\n  FloatPixelToFloat: Symbol('FloatPixelToFloat'),\r\n  FloatPixelTo2DFloat: Symbol('FloatPixelTo2DFloat'),\r\n  FloatPixelTo3DFloat: Symbol('FloatPixelTo3DFloat'),\r\n  FloatPixelToArray2: Symbol('FloatPixelToArray2'),\r\n  FloatPixelTo2DArray2: Symbol('FloatPixelTo2DArray2'),\r\n  FloatPixelTo3DArray2: Symbol('FloatPixelTo3DArray2'),\r\n  FloatPixelToArray3: Symbol('FloatPixelToArray3'),\r\n  FloatPixelTo2DArray3: Symbol('FloatPixelTo2DArray3'),\r\n  FloatPixelTo3DArray3: Symbol('FloatPixelTo3DArray3'),\r\n  FloatPixelToArray4: Symbol('FloatPixelToArray4'),\r\n  FloatPixelTo2DArray4: Symbol('FloatPixelTo2DArray4'),\r\n  FloatPixelTo3DArray4: Symbol('FloatPixelTo3DArray4'),\r\n  FloatTexture: Symbol('FloatTexture'),\r\n  MemoryOptimizedFloatPixelToMemoryOptimizedFloat: Symbol('MemoryOptimizedFloatPixelToFloat'),\r\n  MemoryOptimizedFloatPixelToMemoryOptimized2DFloat: Symbol('MemoryOptimizedFloatPixelTo2DFloat'),\r\n  MemoryOptimizedFloatPixelToMemoryOptimized3DFloat: Symbol('MemoryOptimizedFloatPixelTo3DFloat'),\r\n});\r\n\r\nconst typeMap = {\r\n  int: 'Integer',\r\n  float: 'Number',\r\n  vec2: 'Array(2)',\r\n  vec3: 'Array(3)',\r\n  vec4: 'Array(4)',\r\n};\r\n","import { utils } from '../../utils';\r\nimport { FunctionNode } from '../function-node';\r\n// Closure capture for the ast function, prevent collision with existing AST functions\r\n// The prefixes to use\r\nconst jsMathPrefix = 'Math.';\r\nconst localPrefix = 'this.';\r\n\r\n/**\r\n * @desc [INTERNAL] Takes in a function node, and does all the AST voodoo required to toString its respective WebGL code\r\n * @extends FunctionNode\r\n * @returns the converted WebGL function string\r\n */\r\nexport class WebGLFunctionNode extends FunctionNode {\r\n  constructor(source, settings) {\r\n    super(source, settings);\r\n    if (settings && settings.hasOwnProperty('fixIntegerDivisionAccuracy')) {\r\n      this.fixIntegerDivisionAccuracy = settings.fixIntegerDivisionAccuracy;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @desc Parses the abstract syntax tree for to its *named function*\r\n   * @param {Object} ast - the AST object to parse\r\n   * @param {Array} retArr - return array string\r\n   * @returns {Array} the append retArr\r\n   */\r\n  astFunction(ast, retArr) {\r\n    // Setup function return type and name\r\n    if (this.isRootKernel) {\r\n      retArr.push('void');\r\n    } else {\r\n      // looking up return type, this is a little expensive, and can be avoided if returnType is set\r\n      let lastReturn = null;\r\n      if (!this.returnType) {\r\n        const lastReturn = this.findLastReturn();\r\n        if (lastReturn) {\r\n          this.returnType = this.getType(ast.body);\r\n          if (this.returnType === 'LiteralInteger') {\r\n            this.returnType = 'Number';\r\n          }\r\n        }\r\n      }\r\n\r\n      const { returnType } = this;\r\n      if (!returnType) {\r\n        retArr.push('void');\r\n      } else {\r\n        const type = typeMap[returnType];\r\n        if (!type) {\r\n          throw new Error(`unknown type ${returnType}`);\r\n        }\r\n        retArr.push(type);\r\n      }\r\n    }\r\n    retArr.push(' ');\r\n    retArr.push(this.name);\r\n    retArr.push('(');\r\n\r\n    if (!this.isRootKernel) {\r\n      // Arguments handling\r\n      for (let i = 0; i < this.argumentNames.length; ++i) {\r\n        const argumentName = this.argumentNames[i];\r\n\r\n        if (i > 0) {\r\n          retArr.push(', ');\r\n        }\r\n        let argumentType = this.argumentTypes[this.argumentNames.indexOf(argumentName)];\r\n        // The type is too loose ended, here we descide to solidify a type, lets go with float\r\n        if (!argumentType) {\r\n          throw this.astErrorOutput(`Unknown argument ${argumentName} type`, ast);\r\n        }\r\n        if (argumentType === 'LiteralInteger') {\r\n          this.argumentTypes[i] = argumentType = 'Number';\r\n        }\r\n        const type = typeMap[argumentType];\r\n        if (!type) {\r\n          throw this.astErrorOutput('Unexpected expression', ast);\r\n        }\r\n        retArr.push(type);\r\n        retArr.push(' ');\r\n        retArr.push('user_');\r\n        retArr.push(argumentName);\r\n      }\r\n    }\r\n\r\n    // Function opening\r\n    retArr.push(') {\\n');\r\n\r\n    // Body statement iteration\r\n    for (let i = 0; i < ast.body.body.length; ++i) {\r\n      this.astGeneric(ast.body.body[i], retArr);\r\n      retArr.push('\\n');\r\n    }\r\n\r\n    // Function closing\r\n    retArr.push('}\\n');\r\n    return retArr;\r\n  }\r\n\r\n  /**\r\n   * @desc Parses the abstract syntax tree for to *return* statement\r\n   * @param {Object} ast - the AST object to parse\r\n   * @param {Array} retArr - return array string\r\n   * @returns {Array} the append retArr\r\n   */\r\n  astReturnStatement(ast, retArr) {\r\n    if (!ast.argument) throw this.astErrorOutput('Unexpected return statement', ast);\r\n    this.pushState('skip-literal-correction');\r\n    const type = this.getType(ast.argument);\r\n    this.popState('skip-literal-correction');\r\n\r\n    const result = [];\r\n\r\n    if (!this.returnType) {\r\n      if (type === 'LiteralInteger' || type === 'Integer') {\r\n        this.returnType = 'Number';\r\n      } else {\r\n        this.returnType = type;\r\n      }\r\n    }\r\n\r\n    switch (this.returnType) {\r\n      case 'LiteralInteger':\r\n      case 'Number':\r\n      case 'Float':\r\n        switch (type) {\r\n          case 'Integer':\r\n            result.push('float(');\r\n            this.astGeneric(ast.argument, result);\r\n            result.push(')');\r\n            break;\r\n          case 'LiteralInteger':\r\n            this.castLiteralToFloat(ast.argument, result);\r\n\r\n            // Running astGeneric forces the LiteralInteger to pick a type, and here, if we are returning a float, yet\r\n            // the LiteralInteger has picked to be an integer because of constraints on it we cast it to float.\r\n            if (this.getType(ast) === 'Integer') {\r\n              result.unshift('float(');\r\n              result.push(')');\r\n            }\r\n            break;\r\n          default:\r\n            this.astGeneric(ast.argument, result);\r\n        }\r\n        break;\r\n      case 'Integer':\r\n        switch (type) {\r\n          case 'Float':\r\n          case 'Number':\r\n            this.castValueToInteger(ast.argument, result);\r\n            break;\r\n          case 'LiteralInteger':\r\n            this.castLiteralToInteger(ast.argument, result);\r\n            break;\r\n          default:\r\n            this.astGeneric(ast.argument, result);\r\n        }\r\n        break;\r\n      case 'Array(4)':\r\n      case 'Array(3)':\r\n      case 'Array(2)':\r\n      case 'Input':\r\n        this.astGeneric(ast.argument, result);\r\n        break;\r\n      default:\r\n        throw this.astErrorOutput(`unhandled return type ${this.returnType}`, ast);\r\n    }\r\n\r\n    if (this.isRootKernel) {\r\n      retArr.push(`kernelResult = ${ result.join('') };`);\r\n      retArr.push('return;');\r\n    } else if (this.isSubKernel) {\r\n      retArr.push(`subKernelResult_${ this.name } = ${ result.join('') };`);\r\n      retArr.push(`return subKernelResult_${ this.name };`);\r\n    } else {\r\n      retArr.push(`return ${ result.join('') };`);\r\n    }\r\n    return retArr;\r\n  }\r\n\r\n  /**\r\n   * @desc Parses the abstract syntax tree for *literal value*\r\n   *\r\n   * @param {Object} ast - the AST object to parse\r\n   * @param {Array} retArr - return array string\r\n   *\r\n   * @returns {Array} the append retArr\r\n   */\r\n  astLiteral(ast, retArr) {\r\n    // Reject non numeric literals\r\n    if (isNaN(ast.value)) {\r\n      throw this.astErrorOutput(\r\n        'Non-numeric literal not supported : ' + ast.value,\r\n        ast\r\n      );\r\n    }\r\n\r\n    const key = `${ast.start},${ast.end}`;\r\n    if (Number.isInteger(ast.value)) {\r\n      if (this.isState('in-for-loop-init') || this.isState('casting-to-integer') || this.isState('building-integer')) {\r\n        this.literalTypes[key] = 'Integer';\r\n        retArr.push(`${ast.value}`);\r\n      } else if (this.isState('casting-to-float') || this.isState('building-float')) {\r\n        this.literalTypes[key] = 'Number';\r\n        retArr.push(`${ast.value}.0`);\r\n      } else {\r\n        this.literalTypes[key] = 'Number';\r\n        retArr.push(`${ast.value}.0`);\r\n      }\r\n    } else if (this.isState('casting-to-integer') || this.isState('building-integer')) {\r\n      this.literalTypes[key] = 'Integer';\r\n      retArr.push(Math.round(ast.value));\r\n    } else {\r\n      this.literalTypes[key] = 'Number';\r\n      retArr.push(`${ast.value}`);\r\n    }\r\n    return retArr;\r\n  }\r\n\r\n  /**\r\n   * @desc Parses the abstract syntax tree for *binary* expression\r\n   * @param {Object} ast - the AST object to parse\r\n   * @param {Array} retArr - return array string\r\n   * @returns {Array} the append retArr\r\n   */\r\n  astBinaryExpression(ast, retArr) {\r\n    if (this.checkAndUpconvertOperator(ast, retArr)) {\r\n      return retArr;\r\n    }\r\n\r\n    if (this.fixIntegerDivisionAccuracy && ast.operator === '/') {\r\n      retArr.push('div_with_int_check(');\r\n      this.pushState('building-float');\r\n      switch (this.getType(ast.left)) {\r\n        case 'Integer':\r\n          this.castValueToFloat(ast.left, retArr);\r\n          break;\r\n        case 'LiteralInteger':\r\n          this.castLiteralToFloat(ast.left, retArr);\r\n          break;\r\n        default:\r\n          this.astGeneric(ast.left, retArr);\r\n      }\r\n      retArr.push(', ');\r\n      switch (this.getType(ast.right)) {\r\n        case 'Integer':\r\n          this.castValueToFloat(ast.right, retArr);\r\n          break;\r\n        case 'LiteralInteger':\r\n          this.castLiteralToFloat(ast.right, retArr);\r\n          break;\r\n        default:\r\n          this.astGeneric(ast.right, retArr);\r\n      }\r\n      this.popState('building-float');\r\n      retArr.push(')');\r\n      return retArr;\r\n    }\r\n\r\n    retArr.push('(');\r\n    const leftType = this.getType(ast.left) || 'Number';\r\n    const rightType = this.getType(ast.right) || 'Number';\r\n    if (!leftType || !rightType) {\r\n      throw this.astErrorOutput(`Unhandled binary expression`, ast);\r\n    }\r\n    const key = leftType + ' & ' + rightType;\r\n    switch (key) {\r\n      case 'Integer & Integer':\r\n        this.pushState('building-integer');\r\n        this.astGeneric(ast.left, retArr);\r\n        retArr.push(operatorMap[ast.operator] || ast.operator);\r\n        this.astGeneric(ast.right, retArr);\r\n        this.popState('building-integer');\r\n        break;\r\n      case 'Number & Float':\r\n      case 'Float & Number':\r\n      case 'Float & Float':\r\n      case 'Number & Number':\r\n        this.pushState('building-float');\r\n        this.astGeneric(ast.left, retArr);\r\n        retArr.push(operatorMap[ast.operator] || ast.operator);\r\n        this.astGeneric(ast.right, retArr);\r\n        this.popState('building-float');\r\n        break;\r\n      case 'LiteralInteger & LiteralInteger':\r\n        if (this.isState('casting-to-integer') || this.isState('building-integer')) {\r\n          this.pushState('building-integer');\r\n          this.astGeneric(ast.left, retArr);\r\n          retArr.push(operatorMap[ast.operator] || ast.operator);\r\n          this.astGeneric(ast.right, retArr);\r\n          this.popState('building-integer');\r\n        } else {\r\n          this.pushState('building-float');\r\n          this.castLiteralToFloat(ast.left, retArr);\r\n          retArr.push(operatorMap[ast.operator] || ast.operator);\r\n          this.castLiteralToFloat(ast.right, retArr);\r\n          this.popState('building-float');\r\n        }\r\n        break;\r\n\r\n      case 'Integer & Float':\r\n      case 'Integer & Number':\r\n        if (ast.operator === '>' || ast.operator === '<' && ast.right.type === 'Literal') {\r\n          // if right value is actually a float, don't loose that information, cast left to right rather than the usual right to left\r\n          if (!Number.isInteger(ast.right.value)) {\r\n            this.pushState('building-float');\r\n            this.castValueToFloat(ast.left, retArr);\r\n            retArr.push(operatorMap[ast.operator] || ast.operator);\r\n            this.astGeneric(ast.right, retArr);\r\n            this.popState('building-float');\r\n            break;\r\n          }\r\n        }\r\n        this.pushState('building-integer');\r\n        this.astGeneric(ast.left, retArr);\r\n        retArr.push(operatorMap[ast.operator] || ast.operator);\r\n        this.pushState('casting-to-integer');\r\n        if (ast.right.type === 'Literal') {\r\n          const literalResult = [];\r\n          this.astGeneric(ast.right, literalResult);\r\n          const literalType = this.getType(ast.right);\r\n          if (literalType === 'Integer') {\r\n            retArr.push(literalResult.join(''));\r\n          } else {\r\n            throw this.astErrorOutput(`Unhandled binary expression with literal`, ast);\r\n          }\r\n        } else {\r\n          retArr.push('int(');\r\n          this.astGeneric(ast.right, retArr);\r\n          retArr.push(')');\r\n        }\r\n        this.popState('casting-to-integer');\r\n        this.popState('building-integer');\r\n        break;\r\n      case 'Integer & LiteralInteger':\r\n        this.pushState('building-integer');\r\n        this.astGeneric(ast.left, retArr);\r\n        retArr.push(operatorMap[ast.operator] || ast.operator);\r\n        this.castLiteralToInteger(ast.right, retArr);\r\n        this.popState('building-integer');\r\n        break;\r\n\r\n      case 'Number & Integer':\r\n        this.pushState('building-float');\r\n        this.astGeneric(ast.left, retArr);\r\n        retArr.push(operatorMap[ast.operator] || ast.operator);\r\n        this.castValueToFloat(ast.right, retArr);\r\n        this.popState('building-float');\r\n        break;\r\n      case 'Float & LiteralInteger':\r\n      case 'Number & LiteralInteger':\r\n        if (this.isState('in-for-loop-test')) {\r\n          this.pushState('building-integer');\r\n          retArr.push('int(');\r\n          this.astGeneric(ast.left, retArr);\r\n          retArr.push(')');\r\n          retArr.push(operatorMap[ast.operator] || ast.operator);\r\n          this.castLiteralToInteger(ast.right, retArr);\r\n          this.popState('building-integer');\r\n        } else {\r\n          this.pushState('building-float');\r\n          this.astGeneric(ast.left, retArr);\r\n          retArr.push(operatorMap[ast.operator] || ast.operator);\r\n          this.castLiteralToFloat(ast.right, retArr);\r\n          this.popState('building-float');\r\n        }\r\n        break;\r\n      case 'LiteralInteger & Float':\r\n      case 'LiteralInteger & Number':\r\n        if (this.isState('in-for-loop-test') || this.isState('in-for-loop-init') || this.isState('casting-to-integer')) {\r\n          this.pushState('building-integer');\r\n          this.castLiteralToInteger(ast.left, retArr);\r\n          retArr.push(operatorMap[ast.operator] || ast.operator);\r\n          this.castValueToInteger(ast.right, retArr);\r\n          this.popState('building-integer');\r\n        } else {\r\n          this.pushState('building-float');\r\n          this.astGeneric(ast.left, retArr);\r\n          retArr.push(operatorMap[ast.operator] || ast.operator);\r\n          this.pushState('casting-to-float');\r\n          this.astGeneric(ast.right, retArr);\r\n          this.popState('casting-to-float');\r\n          this.popState('building-float');\r\n        }\r\n        break;\r\n      case 'LiteralInteger & Integer':\r\n        this.pushState('building-integer');\r\n        this.castLiteralToInteger(ast.left, retArr);\r\n        retArr.push(operatorMap[ast.operator] || ast.operator);\r\n        this.astGeneric(ast.right, retArr);\r\n        this.popState('building-integer');\r\n        break;\r\n\r\n      case 'Boolean & Boolean':\r\n        this.pushState('building-boolean');\r\n        this.astGeneric(ast.left, retArr);\r\n        retArr.push(operatorMap[ast.operator] || ast.operator);\r\n        this.astGeneric(ast.right, retArr);\r\n        this.popState('building-boolean');\r\n        break;\r\n\r\n      case 'Float & Integer':\r\n        this.pushState('building-float');\r\n        this.astGeneric(ast.left, retArr);\r\n        retArr.push(operatorMap[ast.operator] || ast.operator);\r\n        this.castValueToFloat(ast.right, retArr);\r\n        this.popState('building-float');\r\n        break;\r\n\r\n      default:\r\n        throw this.astErrorOutput(`Unhandled binary expression between ${key}`, ast);\r\n    }\r\n    retArr.push(')');\r\n\r\n    return retArr;\r\n  }\r\n\r\n  checkAndUpconvertOperator(ast, retArr) {\r\n    const bitwiseResult = this.checkAndUpconvertBitwiseOperators(ast, retArr);\r\n    if (bitwiseResult) {\r\n      return bitwiseResult;\r\n    }\r\n    const upconvertableOperators = {\r\n      '%': 'mod',\r\n      '**': 'pow',\r\n    };\r\n    const foundOperator = upconvertableOperators[ast.operator];\r\n    if (!foundOperator) return null;\r\n    retArr.push(foundOperator);\r\n    retArr.push('(');\r\n    switch (this.getType(ast.left)) {\r\n      case 'Integer':\r\n        this.castValueToFloat(ast.left, retArr);\r\n        break;\r\n      case 'LiteralInteger':\r\n        this.castLiteralToFloat(ast.left, retArr);\r\n        break;\r\n      default:\r\n        this.astGeneric(ast.left, retArr);\r\n    }\r\n    retArr.push(',');\r\n    switch (this.getType(ast.right)) {\r\n      case 'Integer':\r\n        this.castValueToFloat(ast.right, retArr);\r\n        break;\r\n      case 'LiteralInteger':\r\n        this.castLiteralToFloat(ast.right, retArr);\r\n        break;\r\n      default:\r\n        this.astGeneric(ast.right, retArr);\r\n    }\r\n    retArr.push(')');\r\n    return retArr;\r\n  }\r\n\r\n  checkAndUpconvertBitwiseOperators(ast, retArr) {\r\n    const upconvertableOperators = {\r\n      '&': 'bitwiseAnd',\r\n      '|': 'bitwiseOr',\r\n      '^': 'bitwiseXOR',\r\n      '<<': 'bitwiseZeroFillLeftShift',\r\n      '>>': 'bitwiseSignedRightShift',\r\n      '>>>': 'bitwiseZeroFillRightShift',\r\n    };\r\n    const foundOperator = upconvertableOperators[ast.operator];\r\n    if (!foundOperator) return null;\r\n    retArr.push(foundOperator);\r\n    retArr.push('(');\r\n    const leftType = this.getType(ast.left);\r\n    switch (leftType) {\r\n      case 'Number':\r\n      case 'Float':\r\n        this.castValueToInteger(ast.left, retArr);\r\n        break;\r\n      case 'LiteralInteger':\r\n        this.castLiteralToInteger(ast.left, retArr);\r\n        break;\r\n      default:\r\n        this.astGeneric(ast.left, retArr);\r\n    }\r\n    retArr.push(',');\r\n    const rightType = this.getType(ast.right);\r\n    switch (rightType) {\r\n      case 'Number':\r\n      case 'Float':\r\n        this.castValueToInteger(ast.right, retArr);\r\n        break;\r\n      case 'LiteralInteger':\r\n        this.castLiteralToInteger(ast.right, retArr);\r\n        break;\r\n      default:\r\n        this.astGeneric(ast.right, retArr);\r\n    }\r\n    retArr.push(')');\r\n    return retArr;\r\n  }\r\n\r\n  checkAndUpconvertBitwiseUnary(ast, retArr) {\r\n    const upconvertableOperators = {\r\n      '~': 'bitwiseNot',\r\n    };\r\n    const foundOperator = upconvertableOperators[ast.operator];\r\n    if (!foundOperator) return null;\r\n    retArr.push(foundOperator);\r\n    retArr.push('(');\r\n    switch (this.getType(ast.argument)) {\r\n      case 'Number':\r\n      case 'Float':\r\n        this.castValueToInteger(ast.argument, retArr);\r\n        break;\r\n      case 'LiteralInteger':\r\n        this.castLiteralToInteger(ast.argument, retArr);\r\n        break;\r\n      default:\r\n        this.astGeneric(ast.argument, retArr);\r\n    }\r\n    retArr.push(')');\r\n    return retArr;\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @param {Object} ast\r\n   * @param {Array} retArr\r\n   * @return {String[]}\r\n   */\r\n  castLiteralToInteger(ast, retArr) {\r\n    this.pushState('casting-to-integer');\r\n    this.astGeneric(ast, retArr);\r\n    this.popState('casting-to-integer');\r\n    return retArr;\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @param {Object} ast\r\n   * @param {Array} retArr\r\n   * @return {String[]}\r\n   */\r\n  castLiteralToFloat(ast, retArr) {\r\n    this.pushState('casting-to-float');\r\n    this.astGeneric(ast, retArr);\r\n    this.popState('casting-to-float');\r\n    return retArr;\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @param {Object} ast\r\n   * @param {Array} retArr\r\n   * @return {String[]}\r\n   */\r\n  castValueToInteger(ast, retArr) {\r\n    this.pushState('casting-to-integer');\r\n    retArr.push('int(');\r\n    this.astGeneric(ast, retArr);\r\n    retArr.push(')');\r\n    this.popState('casting-to-integer');\r\n    return retArr;\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @param {Object} ast\r\n   * @param {Array} retArr\r\n   * @return {String[]}\r\n   */\r\n  castValueToFloat(ast, retArr) {\r\n    this.pushState('casting-to-float');\r\n    retArr.push('float(');\r\n    this.astGeneric(ast, retArr);\r\n    retArr.push(')');\r\n    this.popState('casting-to-float');\r\n    return retArr;\r\n  }\r\n\r\n  /**\r\n   * @desc Parses the abstract syntax tree for *identifier* expression\r\n   * @param {Object} idtNode - An ast Node\r\n   * @param {Array} retArr - return array string\r\n   * @returns {Array} the append retArr\r\n   */\r\n  astIdentifierExpression(idtNode, retArr) {\r\n    if (idtNode.type !== 'Identifier') {\r\n      throw this.astErrorOutput('IdentifierExpression - not an Identifier', idtNode);\r\n    }\r\n\r\n    const type = this.getType(idtNode);\r\n\r\n    if (idtNode.name === 'Infinity') {\r\n      // https://stackoverflow.com/a/47543127/1324039\r\n      retArr.push('3.402823466e+38');\r\n    } else if (type === 'Boolean') {\r\n      if (this.argumentNames.indexOf(idtNode.name) > -1) {\r\n        retArr.push(`bool(user_${idtNode.name})`);\r\n      } else {\r\n        retArr.push(`user_${idtNode.name}`);\r\n      }\r\n    } else {\r\n      const userArgumentName = this.getKernelArgumentName(idtNode.name);\r\n      if (userArgumentName) {\r\n        retArr.push(`user_${userArgumentName}`);\r\n      } else {\r\n        retArr.push(`user_${idtNode.name}`);\r\n      }\r\n    }\r\n\r\n    return retArr;\r\n  }\r\n\r\n  /**\r\n   * @desc Parses the abstract syntax tree for *for-loop* expression\r\n   * @param {Object} forNode - An ast Node\r\n   * @param {Array} retArr - return array string\r\n   * @returns {Array} the parsed webgl string\r\n   */\r\n  astForStatement(forNode, retArr) {\r\n    if (forNode.type !== 'ForStatement') {\r\n      throw this.astErrorOutput('Invalid for statement', forNode);\r\n    }\r\n\r\n    const initArr = [];\r\n    const testArr = [];\r\n    const updateArr = [];\r\n    const bodyArr = [];\r\n    let isSafe = null;\r\n\r\n    if (forNode.init) {\r\n      this.pushState('in-for-loop-init');\r\n      this.astGeneric(forNode.init, initArr);\r\n      const { declarations } = forNode.init;\r\n      for (let i = 0; i < declarations.length; i++) {\r\n        if (declarations[i].init && declarations[i].init.type !== 'Literal') {\r\n          isSafe = false;\r\n        }\r\n      }\r\n      if (isSafe) {\r\n        for (let i = 0; i < initArr.length; i++) {\r\n          if (initArr[i].includes && initArr[i].includes(',')) {\r\n            isSafe = false;\r\n          }\r\n        }\r\n      }\r\n      this.popState('in-for-loop-init');\r\n    } else {\r\n      isSafe = false;\r\n    }\r\n\r\n    if (forNode.test) {\r\n      this.pushState('in-for-loop-test');\r\n      this.astGeneric(forNode.test, testArr);\r\n      this.popState('in-for-loop-test');\r\n    } else {\r\n      isSafe = false;\r\n    }\r\n\r\n    if (forNode.update) {\r\n      this.astGeneric(forNode.update, updateArr);\r\n    } else {\r\n      isSafe = false;\r\n    }\r\n\r\n    if (forNode.body) {\r\n      this.pushState('loop-body');\r\n      this.astGeneric(forNode.body, bodyArr);\r\n      this.popState('loop-body');\r\n    }\r\n\r\n    // have all parts, now make them safe\r\n    if (isSafe === null) {\r\n      isSafe = this.isSafe(forNode.init) && this.isSafe(forNode.test);\r\n    }\r\n\r\n    if (isSafe) {\r\n      retArr.push(`for (${initArr.join('')};${testArr.join('')};${updateArr.join('')}){\\n`);\r\n      retArr.push(bodyArr.join(''));\r\n      retArr.push('}\\n');\r\n    } else {\r\n      const iVariableName = this.getInternalVariableName('safeI');\r\n      if (initArr.length > 0) {\r\n        retArr.push(initArr.join(''), ';\\n');\r\n      }\r\n      retArr.push(`for (int ${iVariableName}=0;${iVariableName}<LOOP_MAX;${iVariableName}++){\\n`);\r\n      if (testArr.length > 0) {\r\n        retArr.push(`if (!${testArr.join('')}) break;\\n`);\r\n      }\r\n      retArr.push(bodyArr.join(''));\r\n      retArr.push(`\\n${updateArr.join('')};`);\r\n      retArr.push('}\\n');\r\n    }\r\n    return retArr;\r\n  }\r\n\r\n  /**\r\n   * @desc Parses the abstract syntax tree for *while* loop\r\n   * @param {Object} whileNode - An ast Node\r\n   * @param {Array} retArr - return array string\r\n   * @returns {Array} the parsed webgl string\r\n   */\r\n  astWhileStatement(whileNode, retArr) {\r\n    if (whileNode.type !== 'WhileStatement') {\r\n      throw this.astErrorOutput('Invalid while statement', whileNode);\r\n    }\r\n\r\n    const iVariableName = this.getInternalVariableName('safeI');\r\n    retArr.push(`for (int ${iVariableName}=0;${iVariableName}<LOOP_MAX;${iVariableName}++){\\n`);\r\n    retArr.push('if (!');\r\n    this.astGeneric(whileNode.test, retArr);\r\n    retArr.push(') break;\\n');\r\n    this.astGeneric(whileNode.body, retArr);\r\n    retArr.push('}\\n');\r\n\r\n    return retArr;\r\n  }\r\n\r\n  /**\r\n   * @desc Parses the abstract syntax tree for *do while* loop\r\n   * @param {Object} doWhileNode - An ast Node\r\n   * @param {Array} retArr - return array string\r\n   * @returns {Array} the parsed webgl string\r\n   */\r\n  astDoWhileStatement(doWhileNode, retArr) {\r\n    if (doWhileNode.type !== 'DoWhileStatement') {\r\n      throw this.astErrorOutput('Invalid while statement', doWhileNode);\r\n    }\r\n\r\n    const iVariableName = this.getInternalVariableName('safeI');\r\n    retArr.push(`for (int ${iVariableName}=0;${iVariableName}<LOOP_MAX;${iVariableName}++){\\n`);\r\n    this.astGeneric(doWhileNode.body, retArr);\r\n    retArr.push('if (!');\r\n    this.astGeneric(doWhileNode.test, retArr);\r\n    retArr.push(') break;\\n');\r\n    retArr.push('}\\n');\r\n\r\n    return retArr;\r\n  }\r\n\r\n\r\n  /**\r\n   * @desc Parses the abstract syntax tree for *Assignment* Expression\r\n   * @param {Object} assNode - An ast Node\r\n   * @param {Array} retArr - return array string\r\n   * @returns {Array} the append retArr\r\n   */\r\n  astAssignmentExpression(assNode, retArr) {\r\n    const declaration = this.getDeclaration(assNode.left);\r\n    if (declaration && !declaration.assignable) {\r\n      throw new this.astErrorOutput(`Variable ${assNode.left.name} is not assignable here`, assNode);\r\n    }\r\n    // TODO: casting needs implemented here\r\n    if (assNode.operator === '%=') {\r\n      this.astGeneric(assNode.left, retArr);\r\n      retArr.push('=');\r\n      retArr.push('mod(');\r\n      this.astGeneric(assNode.left, retArr);\r\n      retArr.push(',');\r\n      this.astGeneric(assNode.right, retArr);\r\n      retArr.push(')');\r\n    } else if (assNode.operator === '**=') {\r\n      this.astGeneric(assNode.left, retArr);\r\n      retArr.push('=');\r\n      retArr.push('pow(');\r\n      this.astGeneric(assNode.left, retArr);\r\n      retArr.push(',');\r\n      this.astGeneric(assNode.right, retArr);\r\n      retArr.push(')');\r\n    } else {\r\n      const leftType = this.getType(assNode.left);\r\n      const rightType = this.getType(assNode.right);\r\n      this.astGeneric(assNode.left, retArr);\r\n      retArr.push(assNode.operator);\r\n      if (leftType !== 'Integer' && rightType === 'Integer') {\r\n        retArr.push('float(');\r\n        this.astGeneric(assNode.right, retArr);\r\n        retArr.push(')');\r\n      } else {\r\n        this.astGeneric(assNode.right, retArr);\r\n      }\r\n      return retArr;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @desc Parses the abstract syntax tree for *Block* statement\r\n   * @param {Object} bNode - the AST object to parse\r\n   * @param {Array} retArr - return array string\r\n   * @returns {Array} the append retArr\r\n   */\r\n  astBlockStatement(bNode, retArr) {\r\n    if (this.isState('loop-body')) {\r\n      this.pushState('block-body'); // this prevents recursive removal of braces\r\n      for (let i = 0; i < bNode.body.length; i++) {\r\n        this.astGeneric(bNode.body[i], retArr);\r\n      }\r\n      this.popState('block-body');\r\n    } else {\r\n      retArr.push('{\\n');\r\n      for (let i = 0; i < bNode.body.length; i++) {\r\n        this.astGeneric(bNode.body[i], retArr);\r\n      }\r\n      retArr.push('}\\n');\r\n    }\r\n    return retArr;\r\n  }\r\n\r\n  /**\r\n   * @desc Parses the abstract syntax tree for *Variable Declaration*\r\n   * @param {Object} varDecNode - An ast Node\r\n   * @param {Array} retArr - return array string\r\n   * @returns {Array} the append retArr\r\n   */\r\n  astVariableDeclaration(varDecNode, retArr) {\r\n    if (varDecNode.kind === 'var' && this.warnVarUsage) {\r\n      this.varWarn();\r\n    }\r\n    const declarations = varDecNode.declarations;\r\n    if (!declarations || !declarations[0] || !declarations[0].init) {\r\n      throw this.astErrorOutput('Unexpected expression', varDecNode);\r\n    }\r\n    const result = [];\r\n    let lastType = null;\r\n    const inForLoopInit = this.isState('in-for-loop-init');\r\n    for (let i = 0; i < declarations.length; i++) {\r\n      const declaration = declarations[i];\r\n      const init = declaration.init;\r\n      const info = this.getDeclaration(declaration.id);\r\n      const valueType = info.valueType;\r\n      const actualType = this.getType(declaration.init);\r\n      let dependencies = info.dependencies;\r\n      let type = inForLoopInit ? 'Integer' : actualType;\r\n      if (type === 'LiteralInteger') {\r\n        // We had the choice to go either float or int, choosing float\r\n        type = 'Number';\r\n      }\r\n      const markupType = typeMap[type];\r\n      if (!markupType) {\r\n        throw this.astErrorOutput(`Markup type ${ markupType } not handled`, varDecNode);\r\n      }\r\n      const declarationResult = [];\r\n      if (actualType === 'Integer' && type === 'Integer' && !inForLoopInit) {\r\n        // Since we are assigning to a float, ensure valueType is reset to that\r\n        info.valueType = 'Number';\r\n        if (i === 0 || lastType === null) {\r\n          declarationResult.push('float ');\r\n        } else if (type !== lastType) {\r\n          throw new Error('Unhandled declaration');\r\n        } else {\r\n          declarationResult.push(',');\r\n        }\r\n        lastType = type;\r\n        declarationResult.push(`user_${declaration.id.name}=`);\r\n        declarationResult.push('float(');\r\n        this.astGeneric(init, declarationResult);\r\n        declarationResult.push(')');\r\n      } else {\r\n        // Since we are assigning to a float, ensure valueType is reset to that\r\n        info.valueType = type;\r\n        if (i === 0 || lastType === null) {\r\n          declarationResult.push(`${markupType} `);\r\n        } else if (type !== lastType) {\r\n          result.push(';');\r\n          declarationResult.push(`${markupType} `);\r\n        } else {\r\n          declarationResult.push(',');\r\n        }\r\n        lastType = type;\r\n        declarationResult.push(`user_${declaration.id.name}=`);\r\n        if (actualType === 'Number' && type === 'Integer') {\r\n          if (init.left && init.left.type === 'Literal') {\r\n            this.astGeneric(init, declarationResult);\r\n          } else {\r\n            declarationResult.push('int(');\r\n            this.astGeneric(init, declarationResult);\r\n            declarationResult.push(')');\r\n          }\r\n        } else {\r\n          this.astGeneric(init, declarationResult);\r\n        }\r\n      }\r\n      result.push(declarationResult.join(''));\r\n    }\r\n\r\n    retArr.push(result.join(''));\r\n    if (!inForLoopInit) {\r\n      retArr.push(';');\r\n    }\r\n    return retArr;\r\n  }\r\n\r\n  /**\r\n   * @desc Parses the abstract syntax tree for *If* Statement\r\n   * @param {Object} ifNode - An ast Node\r\n   * @param {Array} retArr - return array string\r\n   * @returns {Array} the append retArr\r\n   */\r\n  astIfStatement(ifNode, retArr) {\r\n    retArr.push('if (');\r\n    this.astGeneric(ifNode.test, retArr);\r\n    retArr.push(')');\r\n    if (ifNode.consequent.type === 'BlockStatement') {\r\n      this.astGeneric(ifNode.consequent, retArr);\r\n    } else {\r\n      retArr.push(' {\\n');\r\n      this.astGeneric(ifNode.consequent, retArr);\r\n      retArr.push('\\n}\\n');\r\n    }\r\n\r\n    if (ifNode.alternate) {\r\n      retArr.push('else ');\r\n      if (ifNode.alternate.type === 'BlockStatement') {\r\n        this.astGeneric(ifNode.alternate, retArr);\r\n      } else {\r\n        retArr.push(' {\\n');\r\n        this.astGeneric(ifNode.alternate, retArr);\r\n        retArr.push('\\n}\\n');\r\n      }\r\n    }\r\n    return retArr;\r\n  }\r\n\r\n  astSwitchStatement(ast, retArr) {\r\n    if (ast.type !== 'SwitchStatement') {\r\n      throw this.astErrorOutput('Invalid switch statement', ast);\r\n    }\r\n    const { discriminant, cases } = ast;\r\n    const type = this.getType(discriminant);\r\n    const varName = `switchDiscriminant${ast.start}_${ast.end}`;\r\n    switch (type) {\r\n      case 'Float':\r\n      case 'Number':\r\n        retArr.push(`float ${varName} = `);\r\n        this.astGeneric(discriminant, retArr);\r\n        retArr.push(';\\n');\r\n        break;\r\n      case 'Integer':\r\n        retArr.push(`int ${varName} = `);\r\n        this.astGeneric(discriminant, retArr);\r\n        retArr.push(';\\n');\r\n        break;\r\n    }\r\n    // switch with just a default:\r\n    if (cases.length === 1 && !cases[0].test) {\r\n      this.astGeneric(cases[0].consequent, retArr);\r\n      return retArr;\r\n    }\r\n\r\n    // regular switches:\r\n    let fallingThrough = false;\r\n    let defaultResult = [];\r\n    let movingDefaultToEnd = false;\r\n    let pastFirstIf = false;\r\n    for (let i = 0; i < cases.length; i++) {\r\n      // default\r\n      if (!cases[i].test) {\r\n        if (cases.length > i + 1) {\r\n          movingDefaultToEnd = true;\r\n          this.astGeneric(cases[i].consequent, defaultResult);\r\n          continue;\r\n        } else {\r\n          retArr.push(' else {\\n');\r\n        }\r\n      } else {\r\n        // all others\r\n        if (i === 0 || !pastFirstIf) {\r\n          pastFirstIf = true;\r\n          retArr.push(`if (${varName} == `);\r\n        } else {\r\n          if (fallingThrough) {\r\n            retArr.push(`${varName} == `);\r\n            fallingThrough = false;\r\n          } else {\r\n            retArr.push(` else if (${varName} == `);\r\n          }\r\n        }\r\n        if (type === 'Integer') {\r\n          const testType = this.getType(cases[i].test);\r\n          switch (testType) {\r\n            case 'Number':\r\n            case 'Float':\r\n              this.castValueToInteger(cases[i].test, retArr);\r\n              break;\r\n            case 'LiteralInteger':\r\n              this.castLiteralToInteger(cases[i].test, retArr);\r\n              break;\r\n          }\r\n        } else if (type === 'Float') {\r\n          const testType = this.getType(cases[i].test);\r\n          switch (testType) {\r\n            case 'LiteralInteger':\r\n              this.castLiteralToFloat(cases[i].test, retArr);\r\n              break;\r\n            case 'Integer':\r\n              this.castValueToFloat(cases[i].test, retArr);\r\n              break;\r\n          }\r\n        } else {\r\n          throw new Error('unhanlded');\r\n        }\r\n        if (!cases[i].consequent || cases[i].consequent.length === 0) {\r\n          fallingThrough = true;\r\n          retArr.push(' || ');\r\n          continue;\r\n        }\r\n        retArr.push(`) {\\n`);\r\n      }\r\n      this.astGeneric(cases[i].consequent, retArr);\r\n      retArr.push('\\n}');\r\n    }\r\n    if (movingDefaultToEnd) {\r\n      retArr.push(' else {');\r\n      retArr.push(defaultResult.join(''));\r\n      retArr.push('}');\r\n    }\r\n    return retArr;\r\n  }\r\n\r\n  /**\r\n   * @desc Parses the abstract syntax tree for *This* expression\r\n   * @param {Object} tNode - An ast Node\r\n   * @param {Array} retArr - return array string\r\n   * @returns {Array} the append retArr\r\n   */\r\n  astThisExpression(tNode, retArr) {\r\n    retArr.push('this');\r\n    return retArr;\r\n  }\r\n\r\n  /**\r\n   * @desc Parses the abstract syntax tree for *Member* Expression\r\n   * @param {Object} mNode - An ast Node\r\n   * @param {Array} retArr - return array string\r\n   * @returns {Array} the append retArr\r\n   */\r\n  astMemberExpression(mNode, retArr) {\r\n    const {\r\n      property,\r\n      name,\r\n      signature,\r\n      origin,\r\n      type,\r\n      xProperty,\r\n      yProperty,\r\n      zProperty\r\n    } = this.getMemberExpressionDetails(mNode);\r\n    switch (signature) {\r\n      case 'value.thread.value':\r\n      case 'this.thread.value':\r\n        if (name !== 'x' && name !== 'y' && name !== 'z') {\r\n          throw this.astErrorOutput('Unexpected expression, expected `this.thread.x`, `this.thread.y`, or `this.thread.z`', mNode);\r\n        }\r\n        retArr.push(`threadId.${name}`);\r\n        return retArr;\r\n      case 'this.output.value':\r\n        if (this.dynamicOutput) {\r\n          switch (name) {\r\n            case 'x':\r\n              if (this.isState('casting-to-float')) {\r\n                retArr.push('float(uOutputDim.x)');\r\n              } else {\r\n                retArr.push('uOutputDim.x');\r\n              }\r\n              break;\r\n            case 'y':\r\n              if (this.isState('casting-to-float')) {\r\n                retArr.push('float(uOutputDim.y)');\r\n              } else {\r\n                retArr.push('uOutputDim.y');\r\n              }\r\n              break;\r\n            case 'z':\r\n              if (this.isState('casting-to-float')) {\r\n                retArr.push('float(uOutputDim.z)');\r\n              } else {\r\n                retArr.push('uOutputDim.z');\r\n              }\r\n              break;\r\n            default:\r\n              throw this.astErrorOutput('Unexpected expression', mNode);\r\n          }\r\n        } else {\r\n          switch (name) {\r\n            case 'x':\r\n              if (this.isState('casting-to-integer')) {\r\n                retArr.push(this.output[0]);\r\n              } else {\r\n                retArr.push(this.output[0], '.0');\r\n              }\r\n              break;\r\n            case 'y':\r\n              if (this.isState('casting-to-integer')) {\r\n                retArr.push(this.output[1]);\r\n              } else {\r\n                retArr.push(this.output[1], '.0');\r\n              }\r\n              break;\r\n            case 'z':\r\n              if (this.isState('casting-to-integer')) {\r\n                retArr.push(this.output[2]);\r\n              } else {\r\n                retArr.push(this.output[2], '.0');\r\n              }\r\n              break;\r\n            default:\r\n              throw this.astErrorOutput('Unexpected expression', mNode);\r\n          }\r\n        }\r\n        return retArr;\r\n      case 'value':\r\n        throw this.astErrorOutput('Unexpected expression', mNode);\r\n      case 'value[]':\r\n      case 'value[][]':\r\n      case 'value[][][]':\r\n      case 'value[][][][]':\r\n      case 'value.value':\r\n        if (origin === 'Math') {\r\n          retArr.push(Math[name]);\r\n          return retArr;\r\n        }\r\n        switch (property) {\r\n          case 'r':\r\n            retArr.push(`user_${ name }.r`);\r\n            return retArr;\r\n          case 'g':\r\n            retArr.push(`user_${ name }.g`);\r\n            return retArr;\r\n          case 'b':\r\n            retArr.push(`user_${ name }.b`);\r\n            return retArr;\r\n          case 'a':\r\n            retArr.push(`user_${ name }.a`);\r\n            return retArr;\r\n        }\r\n        break;\r\n      case 'this.constants.value':\r\n        if (typeof xProperty === 'undefined') {\r\n          switch (type) {\r\n            case 'Array(2)':\r\n            case 'Array(3)':\r\n            case 'Array(4)':\r\n              retArr.push(`constants_${ name }`);\r\n              return retArr;\r\n          }\r\n        }\r\n        case 'this.constants.value[]':\r\n        case 'this.constants.value[][]':\r\n        case 'this.constants.value[][][]':\r\n        case 'this.constants.value[][][][]':\r\n          break;\r\n        case 'fn()[]':\r\n          this.astCallExpression(mNode.object, retArr);\r\n          retArr.push('[');\r\n          retArr.push(this.memberExpressionPropertyMarkup(property));\r\n          retArr.push(']');\r\n          return retArr;\r\n        case '[][]':\r\n          this.astArrayExpression(mNode.object, retArr);\r\n          retArr.push('[');\r\n          retArr.push(this.memberExpressionPropertyMarkup(property));\r\n          retArr.push(']');\r\n          return retArr;\r\n        default:\r\n          throw this.astErrorOutput('Unexpected expression', mNode);\r\n    }\r\n\r\n    if (mNode.computed === false) {\r\n      // handle simple types\r\n      switch (type) {\r\n        case 'Number':\r\n        case 'Integer':\r\n        case 'Float':\r\n        case 'Boolean':\r\n          retArr.push(`${origin}_${name}`);\r\n          return retArr;\r\n      }\r\n    }\r\n\r\n    // handle more complex types\r\n    // argument may have come from a parent\r\n    let synonymName = this.getKernelArgumentName(name);\r\n\r\n    const markupName = `${origin}_${synonymName || name}`;\r\n\r\n    switch (type) {\r\n      case 'Array(2)':\r\n      case 'Array(3)':\r\n      case 'Array(4)':\r\n        // Get from local vec4\r\n        this.astGeneric(mNode.object, retArr);\r\n        retArr.push('[');\r\n        retArr.push(this.memberExpressionPropertyMarkup(xProperty));\r\n        retArr.push(']');\r\n        break;\r\n      case 'HTMLImageArray':\r\n        retArr.push(`getImage3D(${ markupName }, ${ markupName }Size, ${ markupName }Dim, `);\r\n        this.memberExpressionXYZ(xProperty, yProperty, zProperty, retArr);\r\n        retArr.push(')');\r\n        break;\r\n      case 'ArrayTexture(1)':\r\n        retArr.push(`getFloatFromSampler2D(${ markupName }, ${ markupName }Size, ${ markupName }Dim, `);\r\n        this.memberExpressionXYZ(xProperty, yProperty, zProperty, retArr);\r\n        retArr.push(')');\r\n        break;\r\n      case 'Array1D(2)':\r\n      case 'Array2D(2)':\r\n      case 'Array3D(2)':\r\n        retArr.push(`getMemoryOptimizedVec2(${ markupName }, ${ markupName }Size, ${ markupName }Dim, `);\r\n        this.memberExpressionXYZ(xProperty, yProperty, zProperty, retArr);\r\n        retArr.push(')');\r\n        break;\r\n      case 'ArrayTexture(2)':\r\n        retArr.push(`getVec2FromSampler2D(${ markupName }, ${ markupName }Size, ${ markupName }Dim, `);\r\n        this.memberExpressionXYZ(xProperty, yProperty, zProperty, retArr);\r\n        retArr.push(')');\r\n        break;\r\n      case 'Array1D(3)':\r\n      case 'Array2D(3)':\r\n      case 'Array3D(3)':\r\n        retArr.push(`getMemoryOptimizedVec3(${ markupName }, ${ markupName }Size, ${ markupName }Dim, `);\r\n        this.memberExpressionXYZ(xProperty, yProperty, zProperty, retArr);\r\n        retArr.push(')');\r\n        break;\r\n      case 'ArrayTexture(3)':\r\n        retArr.push(`getVec3FromSampler2D(${ markupName }, ${ markupName }Size, ${ markupName }Dim, `);\r\n        this.memberExpressionXYZ(xProperty, yProperty, zProperty, retArr);\r\n        retArr.push(')');\r\n        break;\r\n      case 'Array1D(4)':\r\n      case 'Array2D(4)':\r\n      case 'Array3D(4)':\r\n        retArr.push(`getMemoryOptimizedVec4(${ markupName }, ${ markupName }Size, ${ markupName }Dim, `);\r\n        this.memberExpressionXYZ(xProperty, yProperty, zProperty, retArr);\r\n        retArr.push(')');\r\n        break;\r\n      case 'ArrayTexture(4)':\r\n      case 'HTMLImage':\r\n      case 'HTMLVideo':\r\n        retArr.push(`getVec4FromSampler2D(${ markupName }, ${ markupName }Size, ${ markupName }Dim, `);\r\n        this.memberExpressionXYZ(xProperty, yProperty, zProperty, retArr);\r\n        retArr.push(')');\r\n        break;\r\n      case 'NumberTexture':\r\n      case 'Array':\r\n      case 'Array2D':\r\n      case 'Array3D':\r\n      case 'Array4D':\r\n      case 'Input':\r\n      case 'Number':\r\n      case 'Float':\r\n      case 'Integer':\r\n        if (this.precision === 'single') {\r\n          // bitRatio is always 4 here, javascript doesn't yet have 8 or 16 bit support\r\n          // TODO: make 8 or 16 bit work anyway!\r\n          retArr.push(`getMemoryOptimized32(${markupName}, ${markupName}Size, ${markupName}Dim, `);\r\n          this.memberExpressionXYZ(xProperty, yProperty, zProperty, retArr);\r\n          retArr.push(')');\r\n        } else {\r\n          const bitRatio = (origin === 'user' ?\r\n            this.lookupFunctionArgumentBitRatio(this.name, name) :\r\n            this.constantBitRatios[name]\r\n          );\r\n          switch (bitRatio) {\r\n            case 1:\r\n              retArr.push(`get8(${markupName}, ${markupName}Size, ${markupName}Dim, `);\r\n              break;\r\n            case 2:\r\n              retArr.push(`get16(${markupName}, ${markupName}Size, ${markupName}Dim, `);\r\n              break;\r\n            case 4:\r\n            case 0:\r\n              retArr.push(`get32(${markupName}, ${markupName}Size, ${markupName}Dim, `);\r\n              break;\r\n            default:\r\n              throw new Error(`unhandled bit ratio of ${bitRatio}`);\r\n          }\r\n          this.memberExpressionXYZ(xProperty, yProperty, zProperty, retArr);\r\n          retArr.push(')');\r\n        }\r\n        break;\r\n      case 'MemoryOptimizedNumberTexture':\r\n        retArr.push(`getMemoryOptimized32(${ markupName }, ${ markupName }Size, ${ markupName }Dim, `);\r\n        this.memberExpressionXYZ(xProperty, yProperty, zProperty, retArr);\r\n        retArr.push(')');\r\n        break;\r\n      default:\r\n        throw new Error(`unhandled member expression \"${ type }\"`);\r\n    }\r\n    return retArr;\r\n  }\r\n\r\n  /**\r\n   * @desc Parses the abstract syntax tree for *call* expression\r\n   * @param {Object} ast - the AST object to parse\r\n   * @param {Array} retArr - return array string\r\n   * @returns  {Array} the append retArr\r\n   */\r\n  astCallExpression(ast, retArr) {\r\n    if (!ast.callee) {\r\n      throw this.astErrorOutput('Unknown CallExpression', ast);\r\n    }\r\n\r\n    let functionName = null;\r\n    const isMathFunction = this.isAstMathFunction(ast);\r\n\r\n    // Its a math operator or this.something(), remove the prefix\r\n    if (isMathFunction || (ast.callee.object && ast.callee.object.type === 'ThisExpression')) {\r\n      functionName = ast.callee.property.name;\r\n    }\r\n    // Issue #212, BABEL!\r\n    else if (ast.callee.type === 'SequenceExpression' && ast.callee.expressions[0].type === 'Literal' && !isNaN(ast.callee.expressions[0].raw)) {\r\n      functionName = ast.callee.expressions[1].property.name;\r\n    } else {\r\n      functionName = ast.callee.name;\r\n    }\r\n\r\n    if (!functionName) {\r\n      throw this.astErrorOutput(`Unhandled function, couldn't find name`, ast);\r\n    }\r\n\r\n    // if this if grows to more than one, lets use a switch\r\n    if (functionName === 'atan2') {\r\n      functionName = 'atan';\r\n    }\r\n\r\n    // Register the function into the called registry\r\n    if (this.calledFunctions.indexOf(functionName) < 0) {\r\n      this.calledFunctions.push(functionName);\r\n    }\r\n\r\n    if (functionName === 'random' && this.plugins && this.plugins.length > 0) {\r\n      for (let i = 0; i < this.plugins.length; i++) {\r\n        const plugin = this.plugins[i];\r\n        if (plugin.functionMatch === 'Math.random()' && plugin.functionReplace) {\r\n          retArr.push(plugin.functionReplace);\r\n          return retArr;\r\n        }\r\n      }\r\n    }\r\n\r\n    // track the function was called\r\n    if (this.onFunctionCall) {\r\n      this.onFunctionCall(this.name, functionName, ast.arguments);\r\n    }\r\n\r\n    // Call the function\r\n    retArr.push(functionName);\r\n\r\n    // Open arguments space\r\n    retArr.push('(');\r\n\r\n    // Add the arguments\r\n    if (isMathFunction) {\r\n      for (let i = 0; i < ast.arguments.length; ++i) {\r\n        const argument = ast.arguments[i];\r\n        const argumentType = this.getType(argument);\r\n        if (i > 0) {\r\n          retArr.push(', ');\r\n        }\r\n\r\n        switch (argumentType) {\r\n          case 'Integer':\r\n            this.castValueToFloat(argument, retArr);\r\n            break;\r\n          default:\r\n            this.astGeneric(argument, retArr);\r\n            break;\r\n        }\r\n      }\r\n    } else {\r\n      const targetTypes = this.lookupFunctionArgumentTypes(functionName) || [];\r\n      for (let i = 0; i < ast.arguments.length; ++i) {\r\n        const argument = ast.arguments[i];\r\n        let targetType = targetTypes[i];\r\n        if (i > 0) {\r\n          retArr.push(', ');\r\n        }\r\n        const argumentType = this.getType(argument);\r\n        if (!targetType) {\r\n          this.triggerImplyArgumentType(functionName, i, argumentType, this);\r\n          targetType = argumentType;\r\n        }\r\n        switch (argumentType) {\r\n          case 'Number':\r\n          case 'Float':\r\n            if (targetType === 'Integer') {\r\n              retArr.push('int(');\r\n              this.astGeneric(argument, retArr);\r\n              retArr.push(')');\r\n              continue;\r\n            } else if (targetType === 'Number' || targetType === 'Float') {\r\n              this.astGeneric(argument, retArr);\r\n              continue;\r\n            } else if (targetType === 'LiteralInteger') {\r\n              this.castLiteralToFloat(argument, retArr);\r\n              continue;\r\n            }\r\n            break;\r\n          case 'Integer':\r\n            if (targetType === 'Number' || targetType === 'Float') {\r\n              retArr.push('float(');\r\n              this.astGeneric(argument, retArr);\r\n              retArr.push(')');\r\n              continue;\r\n            } else if (targetType === 'Integer') {\r\n              this.astGeneric(argument, retArr);\r\n              continue;\r\n            }\r\n            break;\r\n          case 'LiteralInteger':\r\n            if (targetType === 'Integer') {\r\n              this.castLiteralToInteger(argument, retArr);\r\n              continue;\r\n            } else if (targetType === 'Number' || targetType === 'Float') {\r\n              this.castLiteralToFloat(argument, retArr);\r\n              continue;\r\n            } else if (targetType === 'LiteralInteger') {\r\n              this.astGeneric(argument, retArr);\r\n              continue;\r\n            }\r\n            break;\r\n          case 'Array(2)':\r\n          case 'Array(3)':\r\n          case 'Array(4)':\r\n            if (targetType === argumentType) {\r\n              this.astGeneric(argument, retArr);\r\n              continue;\r\n            }\r\n            break;\r\n          case 'ArrayTexture(1)':\r\n          case 'ArrayTexture(2)':\r\n          case 'ArrayTexture(3)':\r\n          case 'ArrayTexture(4)':\r\n          case 'Array':\r\n          case 'Input':\r\n            if (targetType === argumentType) {\r\n              this.triggerTrackArgumentSynonym(this.name, argument.name, functionName, i);\r\n              this.astGeneric(argument, retArr);\r\n              continue;\r\n            }\r\n            break;\r\n        }\r\n        throw this.astErrorOutput(`Unhandled argument combination of ${ argumentType } and ${ targetType } for argument named \"${ argument.name }\"`, ast);\r\n      }\r\n    }\r\n    // Close arguments space\r\n    retArr.push(')');\r\n\r\n    return retArr;\r\n  }\r\n\r\n  /**\r\n   * @desc Parses the abstract syntax tree for *Array* Expression\r\n   * @param {Object} arrNode - the AST object to parse\r\n   * @param {Array} retArr - return array string\r\n   * @returns {Array} the append retArr\r\n   */\r\n  astArrayExpression(arrNode, retArr) {\r\n    const arrLen = arrNode.elements.length;\r\n\r\n    retArr.push('vec' + arrLen + '(');\r\n    for (let i = 0; i < arrLen; ++i) {\r\n      if (i > 0) {\r\n        retArr.push(', ');\r\n      }\r\n      const subNode = arrNode.elements[i];\r\n      this.astGeneric(subNode, retArr)\r\n    }\r\n    retArr.push(')');\r\n\r\n    return retArr;\r\n  }\r\n\r\n  memberExpressionXYZ(x, y, z, retArr) {\r\n    if (z) {\r\n      retArr.push(this.memberExpressionPropertyMarkup(z), ', ');\r\n    } else {\r\n      retArr.push('0, ');\r\n    }\r\n    if (y) {\r\n      retArr.push(this.memberExpressionPropertyMarkup(y), ', ');\r\n    } else {\r\n      retArr.push('0, ');\r\n    }\r\n    retArr.push(this.memberExpressionPropertyMarkup(x));\r\n    return retArr;\r\n  }\r\n\r\n  memberExpressionPropertyMarkup(property) {\r\n    if (!property) {\r\n      throw new Error('Property not set');\r\n    }\r\n    const type = this.getType(property);\r\n    const result = [];\r\n    switch (type) {\r\n      case 'Number':\r\n      case 'Float':\r\n        this.castValueToInteger(property, result);\r\n        break;\r\n      case 'LiteralInteger':\r\n        this.castLiteralToInteger(property, result);\r\n        break;\r\n      default:\r\n        this.astGeneric(property, result);\r\n    }\r\n    return result.join('');\r\n  }\r\n}\r\n\r\nconst typeMap = {\r\n  'Array': 'sampler2D',\r\n  'Array(2)': 'vec2',\r\n  'Array(3)': 'vec3',\r\n  'Array(4)': 'vec4',\r\n  'Array2D': 'sampler2D',\r\n  'Array3D': 'sampler2D',\r\n  'Boolean': 'bool',\r\n  'Float': 'float',\r\n  'Input': 'sampler2D',\r\n  'Integer': 'int',\r\n  'Number': 'float',\r\n  'LiteralInteger': 'float',\r\n  'NumberTexture': 'sampler2D',\r\n  'MemoryOptimizedNumberTexture': 'sampler2D',\r\n  'ArrayTexture(1)': 'sampler2D',\r\n  'ArrayTexture(2)': 'sampler2D',\r\n  'ArrayTexture(3)': 'sampler2D',\r\n  'ArrayTexture(4)': 'sampler2D',\r\n};\r\n\r\nconst operatorMap = {\r\n  '===': '==',\r\n  '!==': '!='\r\n};\r\n","const source = `\r\n\r\nuniform highp float triangle_noise_seed;\r\nhighp float triangle_noise_shift = 0.000001;\r\n\r\n//https://www.shadertoy.com/view/4t2SDh\r\n//note: uniformly distributed, normalized rand, [0;1[\r\nfloat nrand( vec2 n )\r\n{\r\n  return fract(sin(dot(n.xy, vec2(12.9898, 78.233)))* 43758.5453);\r\n}\r\n//note: remaps v to [0;1] in interval [a;b]\r\nfloat remap( float a, float b, float v )\r\n{\r\n  return clamp( (v-a) / (b-a), 0.0, 1.0 );\r\n}\r\n\r\nfloat n4rand( vec2 n )\r\n{\r\n  float t = fract( triangle_noise_seed + triangle_noise_shift );\r\n  float nrnd0 = nrand( n + 0.07*t );\r\n  float nrnd1 = nrand( n + 0.11*t );\r\n  float nrnd2 = nrand( n + 0.13*t );\r\n  float nrnd3 = nrand( n + 0.17*t );\r\n  float result = (nrnd0+nrnd1+nrnd2+nrnd3) / 4.0;\r\n  triangle_noise_shift = result + 0.000001;\r\n  return result;\r\n}`;\r\n\r\nconst name = 'triangle-noise-noise';\r\n\r\nconst functionMatch = 'Math.random()';\r\n\r\nconst functionReplace = 'n4rand(vTexCoord)';\r\n\r\nconst functionReturnType = 'Number';\r\n\r\nconst onBeforeRun = (kernel) => {\r\n  kernel.setUniform1f('triangle_noise_seed', Math.random());\r\n};\r\n\r\n/**\r\n * @type IPlugin\r\n */\r\nexport default {\r\n  name,\r\n  onBeforeRun,\r\n  functionMatch,\r\n  functionReplace,\r\n  functionReturnType,\r\n  source\r\n};\r\n","// language=GLSL\r\nexport const fragmentShader = `__HEADER__;\r\n__FLOAT_TACTIC_DECLARATION__;\r\n__INT_TACTIC_DECLARATION__;\r\n__SAMPLER_2D_TACTIC_DECLARATION__;\r\n\r\nconst int LOOP_MAX = __LOOP_MAX__;\r\n\r\n__PLUGINS__;\r\n__CONSTANTS__;\r\n\r\nvarying vec2 vTexCoord;\r\n\r\nvec4 round(vec4 x) {\r\n  return floor(x + 0.5);\r\n}\r\n\r\nfloat round(float x) {\r\n  return floor(x + 0.5);\r\n}\r\n\r\nconst int BIT_COUNT = 32;\r\nint modi(int x, int y) {\r\n  return x - y * (x / y);\r\n}\r\n\r\nint bitwiseOr(int a, int b) {\r\n  int result = 0;\r\n  int n = 1;\r\n\r\n  for (int i = 0; i < BIT_COUNT; i++) {\r\n    if ((modi(a, 2) == 1) || (modi(b, 2) == 1)) {\r\n      result += n;\r\n    }\r\n    a = a / 2;\r\n    b = b / 2;\r\n    n = n * 2;\r\n    if(!(a > 0 || b > 0)) {\r\n      break;\r\n    }\r\n  }\r\n  return result;\r\n}\r\nint bitwiseXOR(int a, int b) {\r\n  int result = 0;\r\n  int n = 1;\r\n\r\n  for (int i = 0; i < BIT_COUNT; i++) {\r\n    if ((modi(a, 2) == 1) != (modi(b, 2) == 1)) {\r\n      result += n;\r\n    }\r\n    a = a / 2;\r\n    b = b / 2;\r\n    n = n * 2;\r\n    if(!(a > 0 || b > 0)) {\r\n      break;\r\n    }\r\n  }\r\n  return result;\r\n}\r\nint bitwiseAnd(int a, int b) {\r\n  int result = 0;\r\n  int n = 1;\r\n  for (int i = 0; i < BIT_COUNT; i++) {\r\n    if ((modi(a, 2) == 1) && (modi(b, 2) == 1)) {\r\n      result += n;\r\n    }\r\n    a = a / 2;\r\n    b = b / 2;\r\n    n = n * 2;\r\n    if(!(a > 0 && b > 0)) {\r\n      break;\r\n    }\r\n  }\r\n  return result;\r\n}\r\nint bitwiseNot(int a) {\r\n  int result = 0;\r\n  int n = 1;\r\n\r\n  for (int i = 0; i < BIT_COUNT; i++) {\r\n    if (modi(a, 2) == 0) {\r\n      result += n;\r\n    }\r\n    a = a / 2;\r\n    n = n * 2;\r\n  }\r\n  return result;\r\n}\r\nint bitwiseZeroFillLeftShift(int n, int shift) {\r\n  int maxBytes = BIT_COUNT;\r\n  for (int i = 0; i < BIT_COUNT; i++) {\r\n    if (maxBytes >= n) {\r\n      break;\r\n    }\r\n    maxBytes *= 2;\r\n  }\r\n  for (int i = 0; i < BIT_COUNT; i++) {\r\n    if (i >= shift) {\r\n      break;\r\n    }\r\n    n *= 2;\r\n  }\r\n\r\n  int result = 0;\r\n  int byteVal = 1;\r\n  for (int i = 0; i < BIT_COUNT; i++) {\r\n    if (i >= maxBytes) break;\r\n    if (modi(n, 2) > 0) { result += byteVal; }\r\n    n = int(n / 2);\r\n    byteVal *= 2;\r\n  }\r\n  return result;\r\n}\r\n\r\nint bitwiseSignedRightShift(int num, int shifts) {\r\n  return int(floor(float(num) / pow(2.0, float(shifts))));\r\n}\r\n\r\nint bitwiseZeroFillRightShift(int n, int shift) {\r\n  int maxBytes = BIT_COUNT;\r\n  for (int i = 0; i < BIT_COUNT; i++) {\r\n    if (maxBytes >= n) {\r\n      break;\r\n    }\r\n    maxBytes *= 2;\r\n  }\r\n  for (int i = 0; i < BIT_COUNT; i++) {\r\n    if (i >= shift) {\r\n      break;\r\n    }\r\n    n /= 2;\r\n  }\r\n  int result = 0;\r\n  int byteVal = 1;\r\n  for (int i = 0; i < BIT_COUNT; i++) {\r\n    if (i >= maxBytes) break;\r\n    if (modi(n, 2) > 0) { result += byteVal; }\r\n    n = int(n / 2);\r\n    byteVal *= 2;\r\n  }\r\n  return result;\r\n}\r\n\r\nvec2 integerMod(vec2 x, float y) {\r\n  vec2 res = floor(mod(x, y));\r\n  return res * step(1.0 - floor(y), -res);\r\n}\r\n\r\nvec3 integerMod(vec3 x, float y) {\r\n  vec3 res = floor(mod(x, y));\r\n  return res * step(1.0 - floor(y), -res);\r\n}\r\n\r\nvec4 integerMod(vec4 x, vec4 y) {\r\n  vec4 res = floor(mod(x, y));\r\n  return res * step(1.0 - floor(y), -res);\r\n}\r\n\r\nfloat integerMod(float x, float y) {\r\n  float res = floor(mod(x, y));\r\n  return res * (res > floor(y) - 1.0 ? 0.0 : 1.0);\r\n}\r\n\r\nint integerMod(int x, int y) {\r\n  return x - (y * int(x / y));\r\n}\r\n\r\n__DIVIDE_WITH_INTEGER_CHECK__;\r\n\r\n// Here be dragons!\r\n// DO NOT OPTIMIZE THIS CODE\r\n// YOU WILL BREAK SOMETHING ON SOMEBODY\\'S MACHINE\r\n// LEAVE IT AS IT IS, LEST YOU WASTE YOUR OWN TIME\r\nconst vec2 MAGIC_VEC = vec2(1.0, -256.0);\r\nconst vec4 SCALE_FACTOR = vec4(1.0, 256.0, 65536.0, 0.0);\r\nconst vec4 SCALE_FACTOR_INV = vec4(1.0, 0.00390625, 0.0000152587890625, 0.0); // 1, 1/256, 1/65536\r\nfloat decode32(vec4 texel) {\r\n  __DECODE32_ENDIANNESS__;\r\n  texel *= 255.0;\r\n  vec2 gte128;\r\n  gte128.x = texel.b >= 128.0 ? 1.0 : 0.0;\r\n  gte128.y = texel.a >= 128.0 ? 1.0 : 0.0;\r\n  float exponent = 2.0 * texel.a - 127.0 + dot(gte128, MAGIC_VEC);\r\n  float res = exp2(round(exponent));\r\n  texel.b = texel.b - 128.0 * gte128.x;\r\n  res = dot(texel, SCALE_FACTOR) * exp2(round(exponent-23.0)) + res;\r\n  res *= gte128.y * -2.0 + 1.0;\r\n  return res;\r\n}\r\n\r\nfloat decode16(vec4 texel, int index) {\r\n  int channel = integerMod(index, 2);\r\n  if (channel == 0) return texel.r * 255.0 + texel.g * 65280.0;\r\n  if (channel == 1) return texel.b * 255.0 + texel.a * 65280.0;\r\n  return 0.0;\r\n}\r\n\r\nfloat decode8(vec4 texel, int index) {\r\n  int channel = integerMod(index, 4);\r\n  if (channel == 0) return texel.r * 255.0;\r\n  if (channel == 1) return texel.g * 255.0;\r\n  if (channel == 2) return texel.b * 255.0;\r\n  if (channel == 3) return texel.a * 255.0;\r\n  return 0.0;\r\n}\r\n\r\nvec4 legacyEncode32(float f) {\r\n  float F = abs(f);\r\n  float sign = f < 0.0 ? 1.0 : 0.0;\r\n  float exponent = floor(log2(F));\r\n  float mantissa = (exp2(-exponent) * F);\r\n  // exponent += floor(log2(mantissa));\r\n  vec4 texel = vec4(F * exp2(23.0-exponent)) * SCALE_FACTOR_INV;\r\n  texel.rg = integerMod(texel.rg, 256.0);\r\n  texel.b = integerMod(texel.b, 128.0);\r\n  texel.a = exponent*0.5 + 63.5;\r\n  texel.ba += vec2(integerMod(exponent+127.0, 2.0), sign) * 128.0;\r\n  texel = floor(texel);\r\n  texel *= 0.003921569; // 1/255\r\n  __ENCODE32_ENDIANNESS__;\r\n  return texel;\r\n}\r\n\r\n// https://github.com/gpujs/gpu.js/wiki/Encoder-details\r\nvec4 encode32(float value) {\r\n  if (value == 0.0) return vec4(0, 0, 0, 0);\r\n\r\n  float exponent;\r\n  float mantissa;\r\n  vec4  result;\r\n  float sgn;\r\n\r\n  sgn = step(0.0, -value);\r\n  value = abs(value);\r\n\r\n  exponent = floor(log2(value));\r\n\r\n  mantissa = value*pow(2.0, -exponent)-1.0;\r\n  exponent = exponent+127.0;\r\n  result   = vec4(0,0,0,0);\r\n\r\n  result.a = floor(exponent/2.0);\r\n  exponent = exponent - result.a*2.0;\r\n  result.a = result.a + 128.0*sgn;\r\n\r\n  result.b = floor(mantissa * 128.0);\r\n  mantissa = mantissa - result.b / 128.0;\r\n  result.b = result.b + exponent*128.0;\r\n\r\n  result.g = floor(mantissa*32768.0);\r\n  mantissa = mantissa - result.g/32768.0;\r\n\r\n  result.r = floor(mantissa*8388608.0);\r\n  return result/255.0;\r\n}\r\n// Dragons end here\r\n\r\nint index;\r\nivec3 threadId;\r\n\r\nivec3 indexTo3D(int idx, ivec3 texDim) {\r\n  int z = int(idx / (texDim.x * texDim.y));\r\n  idx -= z * int(texDim.x * texDim.y);\r\n  int y = int(idx / texDim.x);\r\n  int x = int(integerMod(idx, texDim.x));\r\n  return ivec3(x, y, z);\r\n}\r\n\r\nfloat get32(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\r\n  int index = x + texDim.x * (y + texDim.y * z);\r\n  int w = texSize.x;\r\n  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;\r\n  vec4 texel = texture2D(tex, st / vec2(texSize));\r\n  return decode32(texel);\r\n}\r\n\r\nfloat get16(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\r\n  int index = x + texDim.x * (y + texDim.y * z);\r\n  int w = texSize.x * 2;\r\n  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;\r\n  vec4 texel = texture2D(tex, st / vec2(texSize.x * 2, texSize.y));\r\n  return decode16(texel, index);\r\n}\r\n\r\nfloat get8(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\r\n  int index = x + texDim.x * (y + texDim.y * z);\r\n  int w = texSize.x * 4;\r\n  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;\r\n  vec4 texel = texture2D(tex, st / vec2(texSize.x * 4, texSize.y));\r\n  return decode8(texel, index);\r\n}\r\n\r\nfloat getMemoryOptimized32(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\r\n  int index = x + texDim.x * (y + texDim.y * z);\r\n  int channel = integerMod(index, 4);\r\n  index = index / 4;\r\n  int w = texSize.x;\r\n  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;\r\n  vec4 texel = texture2D(tex, st / vec2(texSize));\r\n  if (channel == 0) return texel.r;\r\n  if (channel == 1) return texel.g;\r\n  if (channel == 2) return texel.b;\r\n  if (channel == 3) return texel.a;\r\n  return 0.0;\r\n}\r\n\r\nvec4 getImage2D(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\r\n  int index = x + texDim.x * (y + texDim.y * z);\r\n  int w = texSize.x;\r\n  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;\r\n  return texture2D(tex, st / vec2(texSize));\r\n}\r\n\r\nfloat getFloatFromSampler2D(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\r\n  vec4 result = getImage2D(tex, texSize, texDim, z, y, x);\r\n  return result[0];\r\n}\r\n\r\nvec2 getVec2FromSampler2D(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\r\n  vec4 result = getImage2D(tex, texSize, texDim, z, y, x);\r\n  return vec2(result[0], result[1]);\r\n}\r\n\r\nvec2 getMemoryOptimizedVec2(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\r\n  int index = x + (texDim.x * (y + (texDim.y * z)));\r\n  int channel = integerMod(index, 2);\r\n  index = index / 2;\r\n  int w = texSize.x;\r\n  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;\r\n  vec4 texel = texture2D(tex, st / vec2(texSize));\r\n  if (channel == 0) return vec2(texel.r, texel.g);\r\n  if (channel == 1) return vec2(texel.b, texel.a);\r\n  return vec2(0.0, 0.0);\r\n}\r\n\r\nvec3 getVec3FromSampler2D(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\r\n  vec4 result = getImage2D(tex, texSize, texDim, z, y, x);\r\n  return vec3(result[0], result[1], result[2]);\r\n}\r\n\r\nvec3 getMemoryOptimizedVec3(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\r\n  int fieldIndex = 3 * (x + texDim.x * (y + texDim.y * z));\r\n  int vectorIndex = fieldIndex / 4;\r\n  int vectorOffset = fieldIndex - vectorIndex * 4;\r\n  int readY = vectorIndex / texSize.x;\r\n  int readX = vectorIndex - readY * texSize.x;\r\n  vec4 tex1 = texture2D(tex, (vec2(readX, readY) + 0.5) / vec2(texSize));\r\n\r\n  if (vectorOffset == 0) {\r\n    return tex1.xyz;\r\n  } else if (vectorOffset == 1) {\r\n    return tex1.yzw;\r\n  } else {\r\n    readX++;\r\n    if (readX >= texSize.x) {\r\n      readX = 0;\r\n      readY++;\r\n    }\r\n    vec4 tex2 = texture2D(tex, vec2(readX, readY) / vec2(texSize));\r\n    if (vectorOffset == 2) {\r\n      return vec3(tex1.z, tex1.w, tex2.x);\r\n    } else {\r\n      return vec3(tex1.w, tex2.x, tex2.y);\r\n    }\r\n  }\r\n}\r\n\r\nvec4 getVec4FromSampler2D(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\r\n  return getImage2D(tex, texSize, texDim, z, y, x);\r\n}\r\n\r\nvec4 getMemoryOptimizedVec4(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\r\n  int index = x + texDim.x * (y + texDim.y * z);\r\n  int channel = integerMod(index, 2);\r\n  int w = texSize.x;\r\n  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;\r\n  vec4 texel = texture2D(tex, st / vec2(texSize));\r\n  return vec4(texel.r, texel.g, texel.b, texel.a);\r\n}\r\n\r\nvec4 actualColor;\r\nvoid color(float r, float g, float b, float a) {\r\n  actualColor = vec4(r,g,b,a);\r\n}\r\n\r\nvoid color(float r, float g, float b) {\r\n  color(r,g,b,1.0);\r\n}\r\n\r\nvoid color(sampler2D image) {\r\n  actualColor = texture2D(image, vTexCoord);\r\n}\r\n\r\n__INJECTED_NATIVE__;\r\n__MAIN_CONSTANTS__;\r\n__MAIN_ARGUMENTS__;\r\n__KERNEL__;\r\n\r\nvoid main(void) {\r\n  index = int(vTexCoord.s * float(uTexSize.x)) + int(vTexCoord.t * float(uTexSize.y)) * uTexSize.x;\r\n  __MAIN_RESULT__;\r\n}`;\r\n","// language=GLSL\r\nexport const vertexShader = `__FLOAT_TACTIC_DECLARATION__;\r\n__INT_TACTIC_DECLARATION__;\r\n__SAMPLER_2D_TACTIC_DECLARATION__;\r\n\r\nattribute vec2 aPos;\r\nattribute vec2 aTexCoord;\r\n\r\nvarying vec2 vTexCoord;\r\nuniform vec2 ratio;\r\n\r\nvoid main(void) {\r\n  gl_Position = vec4((aPos + vec2(1)) * ratio + vec2(-1), 0, 1);\r\n  vTexCoord = aTexCoord;\r\n}`;\r\n","/**\n *\n * @param {WebGLRenderingContext} gl\n * @param {IGLWiretapOptions} [options]\n * @returns {GLWiretapProxy}\n */\nfunction glWiretap(gl, options = {}) {\n  const {\n    contextName = 'gl',\n    throwGetError,\n    useTrackablePrimitives,\n    readPixelsFile,\n    recording = [],\n    variables = {},\n    onReadPixels,\n    onUnrecognizedArgumentLookup,\n  } = options;\n  const proxy = new Proxy(gl, { get: listen });\n  const contextVariables = [];\n  const entityNames = {};\n  let imageCount = 0;\n  let indent = '';\n  let readPixelsVariableName;\n  return proxy;\n  function listen(obj, property) {\n    switch (property) {\n      case 'addComment': return addComment;\n      case 'checkThrowError': return checkThrowError;\n      case 'getReadPixelsVariableName': return readPixelsVariableName;\n      case 'insertVariable': return insertVariable;\n      case 'reset': return reset;\n      case 'setIndent': return setIndent;\n      case 'toString': return toString;\n      case 'getContextVariableName': return getContextVariableName;\n    }\n    if (typeof gl[property] === 'function') {\n      return function() { // need arguments from this, fyi\n        switch (property) {\n          case 'getError':\n            if (throwGetError) {\n              recording.push(`${indent}if (${contextName}.getError() !== ${contextName}.NONE) throw new Error('error');`);\n            } else {\n              recording.push(`${indent}${contextName}.getError();`); // flush out errors\n            }\n            return gl.getError();\n          case 'getExtension': {\n            const variableName = `${contextName}Variables${contextVariables.length}`;\n            recording.push(`${indent}const ${variableName} = ${contextName}.getExtension('${arguments[0]}');`);\n            const extension = gl.getExtension(arguments[0]);\n            if (extension && typeof extension === 'object') {\n              const tappedExtension = glExtensionWiretap(extension, {\n                getEntity,\n                useTrackablePrimitives,\n                recording,\n                contextName: variableName,\n                contextVariables,\n                variables,\n                indent,\n                onUnrecognizedArgumentLookup,\n              });\n              contextVariables.push(tappedExtension);\n              return tappedExtension;\n            } else {\n              contextVariables.push(null);\n            }\n            return extension;\n          }\n          case 'readPixels':\n            const i = contextVariables.indexOf(arguments[6]);\n            let targetVariableName;\n            if (i === -1) {\n              const variableName = getVariableName(arguments[6]);\n              if (variableName) {\n                targetVariableName = variableName;\n                recording.push(`${indent}${variableName}`);\n              } else {\n                targetVariableName = `${contextName}Variable${contextVariables.length}`;\n                contextVariables.push(arguments[6]);\n                recording.push(`${indent}const ${targetVariableName} = new ${arguments[6].constructor.name}(${arguments[6].length});`);\n              }\n            } else {\n              targetVariableName = `${contextName}Variable${i}`;\n            }\n            readPixelsVariableName = targetVariableName;\n            const argumentAsStrings = [\n              arguments[0],\n              arguments[1],\n              arguments[2],\n              arguments[3],\n              getEntity(arguments[4]),\n              getEntity(arguments[5]),\n              targetVariableName\n            ];\n            recording.push(`${indent}${contextName}.readPixels(${argumentAsStrings.join(', ')});`);\n            if (readPixelsFile) {\n              writePPM(arguments[2], arguments[3]);\n            }\n            if (onReadPixels) {\n              onReadPixels(targetVariableName, argumentAsStrings);\n            }\n            return gl.readPixels.apply(gl, arguments);\n          case 'drawBuffers':\n            recording.push(`${indent}${contextName}.drawBuffers([${argumentsToString(arguments[0], { contextName, contextVariables, getEntity, addVariable, variables, onUnrecognizedArgumentLookup } )}]);`);\n            return gl.drawBuffers(arguments[0]);\n        }\n        let result = gl[property].apply(gl, arguments);\n        switch (typeof result) {\n          case 'undefined':\n            recording.push(`${indent}${methodCallToString(property, arguments)};`);\n            return;\n          case 'number':\n          case 'boolean':\n            if (useTrackablePrimitives && contextVariables.indexOf(trackablePrimitive(result)) === -1) {\n              recording.push(`${indent}const ${contextName}Variable${contextVariables.length} = ${methodCallToString(property, arguments)};`);\n              contextVariables.push(result = trackablePrimitive(result));\n              break;\n            }\n          default:\n            if (result === null) {\n              recording.push(`${methodCallToString(property, arguments)};`);\n            } else {\n              recording.push(`${indent}const ${contextName}Variable${contextVariables.length} = ${methodCallToString(property, arguments)};`);\n            }\n\n            contextVariables.push(result);\n        }\n        return result;\n      }\n    }\n    entityNames[gl[property]] = property;\n    return gl[property];\n  }\n  function toString() {\n    return recording.join('\\n');\n  }\n  function reset() {\n    while (recording.length > 0) {\n      recording.pop();\n    }\n  }\n  function insertVariable(name, value) {\n    variables[name] = value;\n  }\n  function getEntity(value) {\n    const name = entityNames[value];\n    if (name) {\n      return contextName + '.' + name;\n    }\n    return value;\n  }\n  function setIndent(spaces) {\n    indent = ' '.repeat(spaces);\n  }\n  function addVariable(value, source) {\n    const variableName = `${contextName}Variable${contextVariables.length}`;\n    recording.push(`${indent}const ${variableName} = ${source};`);\n    contextVariables.push(value);\n    return variableName;\n  }\n  function writePPM(width, height) {\n    const sourceVariable = `${contextName}Variable${contextVariables.length}`;\n    const imageVariable = `imageDatum${imageCount}`;\n    recording.push(`${indent}let ${imageVariable} = [\"P3\\\\n# ${readPixelsFile}.ppm\\\\n\", ${width}, ' ', ${height}, \"\\\\n255\\\\n\"].join(\"\");`);\n    recording.push(`${indent}for (let i = 0; i < ${imageVariable}.length; i += 4) {`);\n    recording.push(`${indent}  ${imageVariable} += ${sourceVariable}[i] + ' ' + ${sourceVariable}[i + 1] + ' ' + ${sourceVariable}[i + 2] + ' ';`);\n    recording.push(`${indent}}`);\n    recording.push(`${indent}if (typeof require !== \"undefined\") {`);\n    recording.push(`${indent}  require('fs').writeFileSync('./${readPixelsFile}.ppm', ${imageVariable});`);\n    recording.push(`${indent}}`);\n    imageCount++;\n  }\n  function addComment(value) {\n    recording.push(`${indent}// ${value}`);\n  }\n  function checkThrowError() {\n    recording.push(`${indent}(() => {\n${indent}const error = ${contextName}.getError();\n${indent}if (error !== ${contextName}.NONE) {\n${indent}  const names = Object.getOwnPropertyNames(gl);\n${indent}  for (let i = 0; i < names.length; i++) {\n${indent}    const name = names[i];\n${indent}    if (${contextName}[name] === error) {\n${indent}      throw new Error('${contextName} threw ' + name);\n${indent}    }\n${indent}  }\n${indent}}\n${indent}})();`);\n  }\n  function methodCallToString(method, args) {\n    return `${contextName}.${method}(${argumentsToString(args, { contextName, contextVariables, getEntity, addVariable, variables, onUnrecognizedArgumentLookup })})`;\n  }\n\n  function getVariableName(value) {\n    if (variables) {\n      for (const name in variables) {\n        if (variables[name] === value) {\n          return name;\n        }\n      }\n    }\n    return null;\n  }\n\n  function getContextVariableName(value) {\n    const i = contextVariables.indexOf(value);\n    if (i !== -1) {\n      return `${contextName}Variable${i}`;\n    }\n    return null;\n  }\n}\n\n/**\n *\n * @param extension\n * @param {IGLExtensionWiretapOptions} options\n * @returns {*}\n */\nfunction glExtensionWiretap(extension, options) {\n  const proxy = new Proxy(extension, { get: listen });\n  const extensionEntityNames = {};\n  const {\n    contextName,\n    contextVariables,\n    getEntity,\n    useTrackablePrimitives,\n    recording,\n    variables,\n    indent,\n    onUnrecognizedArgumentLookup,\n  } = options;\n  return proxy;\n  function listen(obj, property) {\n    if (typeof obj[property] === 'function') {\n      return function() {\n        switch (property) {\n          case 'drawBuffersWEBGL':\n            recording.push(`${indent}${contextName}.drawBuffersWEBGL([${argumentsToString(arguments[0], { contextName, contextVariables, getEntity: getExtensionEntity, addVariable, variables, onUnrecognizedArgumentLookup })}]);`);\n            return extension.drawBuffersWEBGL(arguments[0]);\n        }\n        let result = extension[property].apply(extension, arguments);\n        switch (typeof result) {\n          case 'undefined':\n            recording.push(`${indent}${methodCallToString(property, arguments)};`);\n            return;\n          case 'number':\n          case 'boolean':\n            if (useTrackablePrimitives && contextVariables.indexOf(trackablePrimitive(result)) === -1) {\n              recording.push(`${indent}const ${contextName}Variable${contextVariables.length} = ${methodCallToString(property, arguments)};`);\n              contextVariables.push(result = trackablePrimitive(result));\n            } else {\n              recording.push(`${indent}const ${contextName}Variable${contextVariables.length} = ${methodCallToString(property, arguments)};`);\n              contextVariables.push(result);\n            }\n            break;\n          default:\n            if (result === null) {\n              recording.push(`${methodCallToString(property, arguments)};`);\n            } else {\n              recording.push(`${indent}const ${contextName}Variable${contextVariables.length} = ${methodCallToString(property, arguments)};`);\n            }\n            contextVariables.push(result);\n        }\n        return result;\n      };\n    }\n    extensionEntityNames[extension[property]] = property;\n    return extension[property];\n  }\n\n  function getExtensionEntity(value) {\n    if (extensionEntityNames.hasOwnProperty(value)) {\n      return `${contextName}.${extensionEntityNames[value]}`;\n    }\n    return getEntity(value);\n  }\n\n  function methodCallToString(method, args) {\n    return `${contextName}.${method}(${argumentsToString(args, { contextName, contextVariables, getEntity: getExtensionEntity, addVariable, variables, onUnrecognizedArgumentLookup })})`;\n  }\n\n  function addVariable(value, source) {\n    const variableName = `${contextName}Variable${contextVariables.length}`;\n    contextVariables.push(value);\n    recording.push(`${indent}const ${variableName} = ${source};`);\n    return variableName;\n  }\n}\n\nfunction argumentsToString(args, options) {\n  const { variables } = options;\n  return (Array.from(args).map((arg) => {\n    const variableName = getVariableName(arg);\n    if (variableName) {\n      return variableName;\n    }\n    return argumentToString(arg, options);\n  }).join(', '));\n\n  function getVariableName(value) {\n    if (variables) {\n      for (const name in variables) {\n        if (variables[name] === value) {\n          return name;\n        }\n      }\n    }\n    return null;\n  }\n}\n\nfunction argumentToString(arg, options) {\n  const { contextName, contextVariables, getEntity, addVariable, onUnrecognizedArgumentLookup } = options;\n  if (typeof arg === 'undefined') {\n    return 'undefined';\n  }\n  if (arg === null) {\n    return 'null';\n  }\n  const i = contextVariables.indexOf(arg);\n  if (i > -1) {\n    return `${contextName}Variable${i}`;\n  }\n  switch (arg.constructor.name) {\n    case 'String':\n      const hasLines = /\\n/.test(arg);\n      const hasSingleQuotes = /'/.test(arg);\n      const hasDoubleQuotes = /\"/.test(arg);\n      if (hasLines) {\n        return '`' + arg + '`';\n      } else if (hasSingleQuotes && !hasDoubleQuotes) {\n        return '\"' + arg + '\"';\n      } else if (!hasSingleQuotes && hasDoubleQuotes) {\n        return \"'\" + arg + \"'\";\n      } else {\n        return '\\'' + arg + '\\'';\n      }\n    case 'Number': return getEntity(arg);\n    case 'Boolean': return getEntity(arg);\n    case 'Array':\n      return addVariable(arg, `new ${arg.constructor.name}(${Array.from(arg).join(',')})`);\n    case 'Float32Array':\n    case 'Uint8Array':\n    case 'Uint16Array':\n    case 'Int32Array':\n      return addVariable(arg, `new ${arg.constructor.name}(${JSON.stringify(Array.from(arg))})`);\n    default:\n      if (onUnrecognizedArgumentLookup) {\n        const instantiationString = onUnrecognizedArgumentLookup(arg);\n        if (instantiationString) {\n          return instantiationString;\n        }\n      }\n      throw new Error(`unrecognized argument type ${arg.constructor.name}`);\n  }\n}\n\nfunction trackablePrimitive(value) {\n  // wrapped in object, so track-able\n  return new value.constructor(value);\n}\n\nif (typeof module !== 'undefined') {\n  module.exports = { glWiretap, glExtensionWiretap };\n}\n\nif (typeof window !== 'undefined') {\n  glWiretap.glExtensionWiretap = glExtensionWiretap;\n  window.glWiretap = glWiretap;\n}\n","import { glWiretap } from 'gl-wiretap';\r\nimport { utils } from '../../utils';\r\n\r\nfunction toStringWithoutUtils(fn) {\r\n  return fn.toString()\r\n    .replace('=>', '')\r\n    .replace(/^function /, '')\r\n    .replace(/utils[.]/g, '/*utils.*/');\r\n}\r\n\r\n/**\r\n *\r\n * @param {Kernel} Kernel\r\n * @param {KernelVariable[]} args\r\n * @param {Kernel} originKernel\r\n * @param {string} [setupContextString]\r\n * @param {string} [destroyContextString]\r\n * @returns {string}\r\n */\r\nexport function glKernelString(Kernel, args, originKernel, setupContextString, destroyContextString) {\r\n  const postResult = [];\r\n  const context = glWiretap(originKernel.context, {\r\n    useTrackablePrimitives: true,\r\n    onReadPixels: (targetName) => {\r\n      if (kernel.subKernels) {\r\n        if (!subKernelsResultVariableSetup) {\r\n          postResult.push(`    const result = { result: ${getRenderString(targetName, kernel)} };`);\r\n          subKernelsResultVariableSetup = true;\r\n        } else {\r\n          const property = kernel.subKernels[subKernelsResultIndex++].property;\r\n          postResult.push(`    result${isNaN(property) ? '.' + property : `[${property}]`} = ${getRenderString(targetName, kernel)};`);\r\n        }\r\n        if (subKernelsResultIndex === kernel.subKernels.length) {\r\n          postResult.push('    return result;');\r\n        }\r\n        return;\r\n      }\r\n      if (targetName) {\r\n        postResult.push(`    return ${getRenderString(targetName, kernel)};`);\r\n      } else {\r\n        postResult.push(`    return null;`);\r\n      }\r\n    },\r\n    onUnrecognizedArgumentLookup: (argument) => {\r\n      for (let i = 0; i < kernel.kernelConstants.length; i++) {\r\n        const value = kernel.kernelConstants[i];\r\n        if (value.type === 'HTMLImageArray') {\r\n          const constant = kernel.constants[value.name];\r\n          const variable = `uploadValue_${value.name}[${constant.indexOf(value.uploadValue)}]`;\r\n          context.insertVariable(variable, kernel.constants);\r\n          return variable;\r\n        } else if (value.uploadValue === argument) {\r\n          const variable = `uploadValue_${value.name}`;\r\n          context.insertVariable(variable, value);\r\n          return variable;\r\n        }\r\n      }\r\n    }\r\n  });\r\n  let subKernelsResultVariableSetup = false;\r\n  let subKernelsResultIndex = 0;\r\n  const {\r\n    source,\r\n    canvas,\r\n    output,\r\n    pipeline,\r\n    graphical,\r\n    loopMaxIterations,\r\n    constants,\r\n    optimizeFloatMemory,\r\n    precision,\r\n    fixIntegerDivisionAccuracy,\r\n    functions,\r\n    nativeFunctions,\r\n    subKernels,\r\n    immutable,\r\n    argumentTypes,\r\n    constantTypes,\r\n    kernelArguments,\r\n    kernelConstants,\r\n  } = originKernel;\r\n  const kernel = new Kernel(source, {\r\n    canvas,\r\n    context,\r\n    checkContext: false,\r\n    output,\r\n    pipeline,\r\n    graphical,\r\n    loopMaxIterations,\r\n    constants,\r\n    optimizeFloatMemory,\r\n    precision,\r\n    fixIntegerDivisionAccuracy,\r\n    functions,\r\n    nativeFunctions,\r\n    subKernels,\r\n    immutable,\r\n    argumentTypes,\r\n    constantTypes,\r\n  });\r\n  let result = [];\r\n  context.setIndent(2);\r\n  kernel.build.apply(kernel, args);\r\n  result.push(context.toString());\r\n  context.reset();\r\n  const upgradedArguments = Array.from(args).map(arg => {\r\n    switch (typeof arg) {\r\n      case 'number':\r\n      case 'boolean':\r\n        return new arg.constructor(arg);\r\n    }\r\n    return arg;\r\n  });\r\n  kernel.kernelArguments.forEach((kernelArgument, i) => {\r\n    switch (kernelArgument.type) {\r\n      // primitives\r\n      case 'Integer':\r\n      case 'Boolean':\r\n      case 'Number':\r\n      case 'Float':\r\n        // non-primitives\r\n      case 'Array':\r\n      case 'Array(2)':\r\n      case 'Array(3)':\r\n      case 'Array(4)':\r\n      case 'HTMLImage':\r\n      case 'HTMLVideo':\r\n        context.insertVariable(`uploadValue_${kernelArgument.name}`, upgradedArguments[i]);\r\n        break;\r\n      case 'HTMLImageArray':\r\n        for (let imageIndex = 0; imageIndex < args[i].length; imageIndex++) {\r\n          const arg = args[i];\r\n          context.insertVariable(`uploadValue_${kernelArgument.name}[${imageIndex}]`, arg[imageIndex]);\r\n        }\r\n        break;\r\n      case 'Input':\r\n        context.insertVariable(`uploadValue_${kernelArgument.name}`, kernelArgument.uploadValue);\r\n        break;\r\n      case 'MemoryOptimizedNumberTexture':\r\n      case 'NumberTexture':\r\n      case 'Array1D(2)':\r\n      case 'Array1D(3)':\r\n      case 'Array1D(4)':\r\n      case 'Array2D(2)':\r\n      case 'Array2D(3)':\r\n      case 'Array2D(4)':\r\n      case 'Array3D(2)':\r\n      case 'Array3D(3)':\r\n      case 'Array3D(4)':\r\n      case 'ArrayTexture(1)':\r\n      case 'ArrayTexture(2)':\r\n      case 'ArrayTexture(3)':\r\n      case 'ArrayTexture(4)':\r\n        context.insertVariable(`uploadValue_${kernelArgument.name}`, upgradedArguments[i].texture);\r\n        break;\r\n      default:\r\n        throw new Error(`unhandled kernelArgumentType insertion for glWiretap of type ${kernelArgument.type}`);\r\n    }\r\n  });\r\n  result.push('/** start of injected functions **/');\r\n  result.push(`function ${toStringWithoutUtils(utils.flattenTo)}`);\r\n  result.push(`function ${toStringWithoutUtils(utils.flatten2dArrayTo)}`);\r\n  result.push(`function ${toStringWithoutUtils(utils.flatten3dArrayTo)}`);\r\n  result.push(`function ${toStringWithoutUtils(utils.isArray)}`);\r\n  if (kernel.renderOutput !== kernel.renderTexture && kernel.formatValues) {\r\n    result.push(\r\n      `  const renderOutput = function ${toStringWithoutUtils(kernel.formatValues)};`\r\n    );\r\n  }\r\n  result.push('/** end of injected functions **/');\r\n  result.push(`  const innerKernel = function (${kernel.kernelArguments.map(kernelArgument => kernelArgument.varName).join(', ')}) {`);\r\n  context.setIndent(4);\r\n  kernel.run.apply(kernel, upgradedArguments);\r\n  if (kernel.renderKernels) {\r\n    kernel.renderKernels();\r\n  } else if (kernel.renderOutput) {\r\n    kernel.renderOutput();\r\n  }\r\n  result.push('/** start setup uploads for kernel values **/');\r\n  kernel.kernelArguments.forEach(kernelArgument => {\r\n    result.push(kernelArgument.getStringValueHandler());\r\n  });\r\n  result.push('/** end setup uploads for kernel values **/');\r\n  result.push(context.toString());\r\n  if (kernel.renderOutput === kernel.renderTexture) {\r\n    context.reset();\r\n    const results = kernel.renderKernels();\r\n    const textureName = context.getContextVariableName(kernel.outputTexture);\r\n    result.push(`    return {\r\n      result: {\r\n        texture: ${ textureName },\r\n        type: '${ results.result.type }',\r\n        toArray: ${ getToArrayString(results.result, textureName) }\r\n      },`);\r\n    const { subKernels, subKernelOutputTextures } = kernel;\r\n    for (let i = 0; i < subKernels.length; i++) {\r\n      const texture = subKernelOutputTextures[i];\r\n      const subKernel = subKernels[i];\r\n      const subKernelResult = results[subKernel.property];\r\n      const subKernelTextureName = context.getContextVariableName(texture);\r\n      result.push(`\r\n      ${subKernel.property}: {\r\n        texture: ${ subKernelTextureName },\r\n        type: '${ subKernelResult.type }',\r\n        toArray: ${ getToArrayString(subKernelResult, subKernelTextureName) }\r\n      },`);\r\n    }\r\n    result.push(`    };`);\r\n  }\r\n  result.push(`    ${destroyContextString ? '\\n' + destroyContextString + '    ': ''}`);\r\n  result.push(postResult.join('\\n'));\r\n  result.push('  };');\r\n  if (kernel.graphical) {\r\n    result.push(getGetPixelsString(kernel));\r\n    result.push(`innerKernel.getPixels = getPixels;`);\r\n  }\r\n  result.push('  return innerKernel;');\r\n\r\n  let constantsUpload = [];\r\n  kernelConstants.forEach((kernelConstant) => {\r\n    constantsUpload.push(`${  kernelConstant.getStringValueHandler()}`);\r\n  });\r\n  return `function kernel(settings) {\r\n  const { context, constants } = settings;\r\n  ${constantsUpload.join('')}\r\n  ${setupContextString ? setupContextString : ''}\r\n${result.join('\\n')}\r\n}`;\r\n}\r\n\r\nfunction getRenderString(targetName, kernel) {\r\n  const readBackValue = kernel.precision === 'single' ? targetName : `new Float32Array(${targetName}.buffer)`;\r\n  if (kernel.output[2]) {\r\n    return `renderOutput(${readBackValue}, ${kernel.output[0]}, ${kernel.output[1]}, ${kernel.output[2]})`;\r\n  }\r\n  if (kernel.output[1]) {\r\n    return `renderOutput(${readBackValue}, ${kernel.output[0]}, ${kernel.output[1]})`;\r\n  }\r\n\r\n  return `renderOutput(${readBackValue}, ${kernel.output[0]})`;\r\n}\r\n\r\nfunction getGetPixelsString(kernel) {\r\n  const getPixels = kernel.getPixels.toString();\r\n  const useFunctionKeyword = !/^function/.test(getPixels);\r\n  return utils.flattenFunctionToString(`${useFunctionKeyword ? 'function ' : ''}${ getPixels }`, {\r\n    findDependency: (object, name) => {\r\n      if (object === 'utils') {\r\n        return `const ${name} = ${utils[name].toString()};`;\r\n      }\r\n      return null;\r\n    },\r\n    thisLookup: (property) => {\r\n      if (property === 'context') {\r\n        return null;\r\n      }\r\n      if (kernel.hasOwnProperty(property)) {\r\n        return JSON.stringify(kernel[property]);\r\n      }\r\n      throw new Error(`unhandled thisLookup ${ property }`);\r\n    }\r\n  });\r\n}\r\n\r\nfunction getToArrayString(kernelResult, textureName) {\r\n  const toArray = kernelResult.toArray.toString();\r\n  const useFunctionKeyword = !/^function/.test(toArray);\r\n  const flattenedFunctions = utils.flattenFunctionToString(`${useFunctionKeyword ? 'function ' : ''}${ toArray }`, {\r\n    findDependency: (object, name) => {\r\n      if (object === 'utils') {\r\n        return `const ${name} = ${utils[name].toString()};`;\r\n      } else if (object === 'this') {\r\n        return `${useFunctionKeyword ? 'function ' : ''}${kernelResult[name].toString()}`;\r\n      } else {\r\n        throw new Error('unhandled fromObject');\r\n      }\r\n    },\r\n    thisLookup: (property) => {\r\n      if (property === 'texture') {\r\n        return textureName;\r\n      }\r\n      if (kernelResult.hasOwnProperty(property)) {\r\n        return JSON.stringify(kernelResult[property]);\r\n      }\r\n      throw new Error(`unhandled thisLookup ${ property }`);\r\n    }\r\n  });\r\n  return `() => {\r\n  ${flattenedFunctions}\r\n  return toArray();\r\n  }`;\r\n}\r\n","/**\r\n * @class KernelValue\r\n */\r\nexport class KernelValue {\r\n  /**\r\n   *\r\n   * @param {IKernelArgumentSettings} settings\r\n   */\r\n  constructor(value, settings) {\r\n    const {\r\n      name,\r\n      kernel,\r\n      context,\r\n      checkContext,\r\n      onRequestContextHandle,\r\n      onUpdateValueMismatch,\r\n      origin,\r\n      strictIntegers,\r\n      type,\r\n      tactic,\r\n    } = settings;\r\n    if (!name) {\r\n      throw new Error('name not set');\r\n    }\r\n    if (!type) {\r\n      throw new Error('type not set');\r\n    }\r\n    if (!origin) {\r\n      throw new Error('origin not set');\r\n    }\r\n    if (!tactic) {\r\n      throw new Error('tactic not set');\r\n    }\r\n    if (origin !== 'user' && origin !== 'constants') {\r\n      throw new Error(`origin must be \"user\" or \"constants\" value is \"${ origin }\"`);\r\n    }\r\n    if (!onRequestContextHandle) {\r\n      throw new Error('onRequestContextHandle is not set');\r\n    }\r\n    this.name = name;\r\n    this.origin = origin;\r\n    this.tactic = tactic;\r\n    this.id = `${this.origin}_${name}`;\r\n    this.varName = origin === 'constants' ? `constants.${name}` : name;\r\n    this.kernel = kernel;\r\n    this.strictIntegers = strictIntegers;\r\n    // handle textures\r\n    this.type = value.type || type;\r\n    this.size = value.size || null;\r\n    this.index = null;\r\n    this.context = context;\r\n    this.checkContext = checkContext !== null && checkContext !== undefined ? checkContext : true;\r\n    this.contextHandle = null;\r\n    this.onRequestContextHandle = onRequestContextHandle;\r\n    this.onUpdateValueMismatch = onUpdateValueMismatch;\r\n  }\r\n\r\n  getSource() {\r\n    throw new Error(`\"getSource\" not defined on ${ this.constructor.name }`);\r\n  }\r\n\r\n  updateValue(value) {\r\n    throw new Error(`\"updateValue\" not defined on ${ this.constructor.name }`);\r\n  }\r\n\r\n  getFocusString() {\r\n    throw new Error(`\"getFocusString\" not defined on ${ this.constructor.name }`);\r\n  }\r\n}\r\n","import { Input } from '../../../input';\r\nimport { KernelValue } from '../../kernel-value';\r\nimport { utils } from '../../../utils';\r\n\r\nexport class WebGLKernelValue extends KernelValue {\r\n  /**\r\n   *\r\n   * @param {IWebGLKernerlValueSettings} settings\r\n   */\r\n  constructor(value, settings) {\r\n    super(value, settings);\r\n    this.dimensionsId = null;\r\n    this.sizeId = null;\r\n    this.initialValueConstructor = value.constructor;\r\n    this.onRequestTexture = settings.onRequestTexture;\r\n    this.onRequestIndex = settings.onRequestIndex;\r\n    this.uploadValue = null;\r\n    this.textureSize = null;\r\n    this.bitRatio = null;\r\n  }\r\n\r\n  requestTexture() {\r\n    this.texture = this.onRequestTexture();\r\n    this.setupTexture();\r\n  }\r\n\r\n  setupTexture() {\r\n    this.contextHandle = this.onRequestContextHandle();\r\n    this.index = this.onRequestIndex();\r\n    this.dimensionsId = this.id + 'Dim';\r\n    this.sizeId = this.id + 'Size';\r\n  }\r\n\r\n  getTransferArrayType(value) {\r\n    if (Array.isArray(value[0])) {\r\n      return this.getTransferArrayType(value[0]);\r\n    }\r\n    switch (value.constructor) {\r\n      case Array:\r\n      case Int32Array:\r\n      case Int16Array:\r\n      case Int8Array:\r\n        return Float32Array;\r\n      case Uint8ClampedArray:\r\n      case Uint8Array:\r\n      case Uint16Array:\r\n      case Uint32Array:\r\n      case Float32Array:\r\n      case Float64Array:\r\n        return value.constructor;\r\n    }\r\n    console.warn('Unfamiliar constructor type.  Will go ahead and use, but likley this may result in a transfer of zeros');\r\n    return value.constructor;\r\n  }\r\n  /**\r\n   * @desc Adds kernel parameters to the Value Texture,\r\n   * binding it to the context, etc.\r\n   *\r\n   * @param {Array|Float32Array|Uint16Array} value - The actual Value supplied to the kernel\r\n   * @param {Number} length - the expected total length of the output array\r\n   * @param {Object} [Type]\r\n   * @returns {Float32Array|Uint16Array|Uint8Array} flattened array to transfer\r\n   */\r\n  formatArrayTransfer(value, length, Type) {\r\n    if (utils.isArray(value[0]) || this.optimizeFloatMemory) {\r\n      // not already flat\r\n      const valuesFlat = new Float32Array(length);\r\n      utils.flattenTo(value, valuesFlat);\r\n      return valuesFlat;\r\n    } else {\r\n      switch (value.constructor) {\r\n        case Uint8ClampedArray:\r\n        case Uint8Array:\r\n        case Int8Array:\r\n        case Uint16Array:\r\n        case Int16Array:\r\n        case Float32Array:\r\n        case Int32Array: {\r\n          const valuesFlat = new(Type || value.constructor)(length);\r\n          utils.flattenTo(value, valuesFlat);\r\n          return valuesFlat;\r\n        }\r\n        default: {\r\n          const valuesFlat = new Float32Array(length);\r\n          utils.flattenTo(value, valuesFlat);\r\n          return valuesFlat;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * bit storage ratio of source to target 'buffer', i.e. if 8bit array -> 32bit tex = 4\r\n   * @param value\r\n   * @returns {number}\r\n   */\r\n  getBitRatio(value) {\r\n    if (Array.isArray(value[0])) {\r\n      return this.getBitRatio(value[0]);\r\n    } else if (value.constructor === Input) {\r\n      return this.getBitRatio(value.value);\r\n    }\r\n    switch (value.constructor) {\r\n      case Uint8ClampedArray:\r\n      case Uint8Array:\r\n      case Int8Array:\r\n        return 1;\r\n      case Uint16Array:\r\n      case Int16Array:\r\n        return 2;\r\n      case Float32Array:\r\n      case Int32Array:\r\n      default:\r\n        return 4;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Used for when we want a string output of our kernel, so we can still input values to the kernel\r\n   */\r\n  getStringValueHandler() {\r\n    throw new Error(`\"getStringValueHandler\" not implemented on ${this.constructor.name}`);\r\n  }\r\n\r\n  getVariablePrecisionString() {\r\n    switch (this.tactic) {\r\n      case 'speed':\r\n        return 'lowp';\r\n      case 'performance':\r\n        return 'highp';\r\n      case 'balanced':\r\n      default:\r\n        return 'mediump';\r\n    }\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { WebGLKernelValue } from './index';\r\n\r\nexport class WebGLKernelValueBoolean extends WebGLKernelValue {\r\n  constructor(value, settings) {\r\n    super(value, settings);\r\n    this.uploadValue = value;\r\n  }\r\n  getSource(value) {\r\n    if (this.origin === 'constants') {\r\n      return `const bool ${this.id} = ${value};\\n`;\r\n    }\r\n    return `uniform bool ${this.id};\\n`;\r\n  }\r\n\r\n  getStringValueHandler() {\r\n    return `const uploadValue_${this.name} = ${this.varName};\\n`;\r\n  }\r\n\r\n  updateValue(value) {\r\n    if (this.origin === 'constants') return;\r\n    this.kernel.setUniform1i(this.id, this.uploadValue = value);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { WebGLKernelValue } from './index';\r\n\r\nexport class WebGLKernelValueFloat extends WebGLKernelValue {\r\n  constructor(value, settings) {\r\n    super(value, settings);\r\n    this.uploadValue = value;\r\n  }\r\n  getStringValueHandler() {\r\n    return `const uploadValue_${this.name} = ${this.varName};\\n`;\r\n  }\r\n  getSource(value) {\r\n    if (this.origin === 'constants') {\r\n      if (Number.isInteger(value)) {\r\n        return `const float ${this.id} = ${value}.0;\\n`;\r\n      }\r\n      return `const float ${this.id} = ${value};\\n`;\r\n    }\r\n    return `uniform float ${this.id};\\n`;\r\n  }\r\n\r\n  updateValue(value) {\r\n    if (this.origin === 'constants') return;\r\n    this.kernel.setUniform1f(this.id, this.uploadValue = value);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { WebGLKernelValue } from './index';\r\n\r\nexport class WebGLKernelValueInteger extends WebGLKernelValue {\r\n  constructor(value, settings) {\r\n    super(value, settings);\r\n    this.uploadValue = value;\r\n  }\r\n  getStringValueHandler() {\r\n    return `const uploadValue_${this.name} = ${this.varName};\\n`;\r\n  }\r\n  getSource(value) {\r\n    if (this.origin === 'constants') {\r\n      return `const int ${this.id} = ${ parseInt(value) };\\n`;\r\n    }\r\n    return `uniform int ${this.id};\\n`;\r\n  }\r\n\r\n  updateValue(value) {\r\n    if (this.origin === 'constants') return;\r\n    this.kernel.setUniform1i(this.id, this.uploadValue = value);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { WebGLKernelValue } from './index';\r\n\r\nexport class WebGLKernelValueHTMLImage extends WebGLKernelValue {\r\n  constructor(value, settings) {\r\n    super(value, settings);\r\n    const { width, height } = value;\r\n    this.dimensions = [width, height, 1];\r\n    this.requestTexture();\r\n    this.textureSize = [width, height];\r\n    this.uploadValue = value;\r\n  }\r\n\r\n  getStringValueHandler() {\r\n    return `const uploadValue_${this.name} = ${this.varName};\\n`;\r\n  }\r\n\r\n  getSource() {\r\n    return utils.linesToString([\r\n      `uniform sampler2D ${this.id}`,\r\n      `ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,\r\n      `ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`,\r\n    ]);\r\n  }\r\n\r\n  updateValue(inputImage) {\r\n    if (inputImage.constructor !== this.initialValueConstructor) {\r\n      this.onUpdateValueMismatch();\r\n      return;\r\n    }\r\n    const { context: gl } = this;\r\n    gl.activeTexture(this.contextHandle);\r\n    gl.bindTexture(gl.TEXTURE_2D, this.texture);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\r\n    gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, true);\r\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, this.uploadValue = inputImage);\r\n    this.kernel.setUniform1i(this.id, this.index);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { WebGLKernelValueHTMLImage } from './html-image';\r\n\r\nexport class WebGLKernelValueDynamicHTMLImage extends WebGLKernelValueHTMLImage {\r\n  getSource() {\r\n    return utils.linesToString([\r\n      `uniform sampler2D ${this.id}`,\r\n      `uniform ivec2 ${this.sizeId}`,\r\n      `uniform ivec3 ${this.dimensionsId}`,\r\n    ]);\r\n  }\r\n\r\n  updateValue(value) {\r\n    const { width, height } = value;\r\n    this.dimensions = [width, height, 1];\r\n    this.textureSize = [width, height];\r\n    this.kernel.setUniform3iv(this.dimensionsId, this.dimensions);\r\n    this.kernel.setUniform2iv(this.sizeId, this.textureSize);\r\n    super.updateValue(value);\r\n  }\r\n}\r\n","import { WebGLKernelValueHTMLImage } from './html-image';\r\n\r\nexport class WebGLKernelValueHTMLVideo extends WebGLKernelValueHTMLImage {}\r\n","import { WebGLKernelValueDynamicHTMLImage } from './dynamic-html-image';\r\n\r\nexport class WebGLKernelValueDynamicHTMLVideo extends WebGLKernelValueDynamicHTMLImage {}\r\n","import { utils } from '../../../utils';\r\nimport { WebGLKernelValue } from './index';\r\n\r\nexport class WebGLKernelValueSingleInput extends WebGLKernelValue {\r\n  constructor(value, settings) {\r\n    super(value, settings);\r\n    this.requestTexture();\r\n    this.bitRatio = 4;\r\n    let [w, h, d] = value.size;\r\n    this.dimensions = new Int32Array([w || 1, h || 1, d || 1]);\r\n    this.textureSize = utils.getMemoryOptimizedFloatTextureSize(this.dimensions, this.bitRatio);\r\n    this.uploadArrayLength = this.textureSize[0] * this.textureSize[1] * this.bitRatio;\r\n    this.uploadValue = new Float32Array(this.uploadArrayLength);\r\n  }\r\n\r\n  getStringValueHandler() {\r\n    return utils.linesToString([\r\n      `const uploadValue_${this.name} = new Float32Array(${this.uploadArrayLength})`,\r\n      `flattenTo(${this.varName}.value, uploadValue_${this.name})`,\r\n    ]);\r\n  }\r\n\r\n  getSource() {\r\n    return utils.linesToString([\r\n      `uniform sampler2D ${this.id}`,\r\n      `ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,\r\n      `ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`,\r\n    ]);\r\n  }\r\n\r\n  updateValue(input) {\r\n    if (input.constructor !== this.initialValueConstructor) {\r\n      this.onUpdateValueMismatch();\r\n      return;\r\n    }\r\n    const { context: gl } = this;\r\n    utils.flattenTo(input.value, this.uploadValue);\r\n    gl.activeTexture(this.contextHandle);\r\n    gl.bindTexture(gl.TEXTURE_2D, this.texture);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\r\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, this.textureSize[0], this.textureSize[1], 0, gl.RGBA, gl.FLOAT, this.uploadValue);\r\n    this.kernel.setUniform1i(this.id, this.index);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { WebGLKernelValue } from './index';\r\n\r\nexport class WebGLKernelValueUnsignedInput extends WebGLKernelValue {\r\n  constructor(value, settings) {\r\n    super(value, settings);\r\n    this.requestTexture();\r\n    this.bitRatio = this.getBitRatio(value);\r\n    const [w, h, d] = value.size;\r\n    this.dimensions = new Int32Array([w || 1, h || 1, d || 1]);\r\n    this.textureSize = utils.getMemoryOptimizedPackedTextureSize(this.dimensions, this.bitRatio);\r\n    this.uploadArrayLength = this.textureSize[0] * this.textureSize[1] * (4 / this.bitRatio);\r\n    this.TranserArrayType = this.getTransferArrayType(value.value);\r\n    this.preUploadValue = new this.TranserArrayType(this.uploadArrayLength);\r\n    this.uploadValue = new Uint8Array(this.preUploadValue.buffer);\r\n  }\r\n\r\n  getStringValueHandler() {\r\n    return utils.linesToString([\r\n      `const preUploadValue_${this.name} = new ${this.TranserArrayType.name}(${this.uploadArrayLength})`,\r\n      `const uploadValue_${this.name} = new Uint8Array(preUploadValue_${this.name}.buffer)`,\r\n      `flattenTo(${this.varName}.value, preUploadValue_${this.name})`,\r\n    ]);\r\n  }\r\n\r\n  getSource() {\r\n    return utils.linesToString([\r\n      `uniform sampler2D ${this.id}`,\r\n      `ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,\r\n      `ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`,\r\n    ]);\r\n  }\r\n\r\n  updateValue(input) {\r\n    if (input.constructor !== this.initialValueConstructor) {\r\n      this.onUpdateValueMismatch();\r\n      return;\r\n    }\r\n    const { context: gl } = this;\r\n    utils.flattenTo(input.value, this.preUploadValue);\r\n    gl.activeTexture(this.contextHandle);\r\n    gl.bindTexture(gl.TEXTURE_2D, this.texture);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\r\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, this.textureSize[0], this.textureSize[1], 0, gl.RGBA, gl.UNSIGNED_BYTE, this.uploadValue);\r\n    this.kernel.setUniform1i(this.id, this.index);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { WebGLKernelValueUnsignedInput } from './unsigned-input';\r\n\r\nexport class WebGLKernelValueDynamicUnsignedInput extends WebGLKernelValueUnsignedInput {\r\n  getSource() {\r\n    return utils.linesToString([\r\n      `uniform sampler2D ${this.id}`,\r\n      `uniform ivec2 ${this.sizeId}`,\r\n      `uniform ivec3 ${this.dimensionsId}`,\r\n    ]);\r\n  }\r\n\r\n  updateValue(value) {\r\n    let [w, h, d] = value.size;\r\n    this.dimensions = new Int32Array([w || 1, h || 1, d || 1]);\r\n    this.textureSize = utils.getMemoryOptimizedPackedTextureSize(this.dimensions, this.bitRatio);\r\n    this.uploadArrayLength = this.textureSize[0] * this.textureSize[1] * (4 / this.bitRatio);\r\n    const Type = this.getTransferArrayType(value.value);\r\n    this.preUploadValue = new Type(this.uploadArrayLength);\r\n    this.uploadValue = new Uint8Array(this.preUploadValue.buffer);\r\n    this.kernel.setUniform3iv(this.dimensionsId, this.dimensions);\r\n    this.kernel.setUniform2iv(this.sizeId, this.textureSize);\r\n    super.updateValue(value);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { WebGLKernelValue } from './index';\r\n\r\nexport class WebGLKernelValueMemoryOptimizedNumberTexture extends WebGLKernelValue {\r\n  constructor(value, settings) {\r\n    super(value, settings);\r\n    this.setupTexture();\r\n    this.dimensions = value.dimensions;\r\n    this.textureSize = value.size;\r\n    this.uploadValue = value.texture;\r\n  }\r\n\r\n  getStringValueHandler() {\r\n    return `const uploadValue_${this.name} = ${this.varName}.texture;\\n`;\r\n  }\r\n\r\n  getSource() {\r\n    return utils.linesToString([\r\n      `uniform sampler2D ${this.id}`,\r\n      `ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,\r\n      `ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`,\r\n    ]);\r\n  }\r\n\r\n  updateValue(inputTexture) {\r\n    if (inputTexture.constructor !== this.initialValueConstructor) {\r\n      this.onUpdateValueMismatch();\r\n      return;\r\n    }\r\n    if (this.checkContext && inputTexture.context !== this.context) {\r\n      throw new Error(`Value ${this.name} (${this.type }) must be from same context`);\r\n    }\r\n    const { context: gl } = this;\r\n    gl.activeTexture(this.contextHandle);\r\n    gl.bindTexture(gl.TEXTURE_2D, this.uploadValue = inputTexture.texture);\r\n    this.kernel.setUniform1i(this.id, this.index);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { WebGLKernelValueMemoryOptimizedNumberTexture } from './memory-optimized-number-texture';\r\n\r\nexport class WebGLKernelValueDynamicMemoryOptimizedNumberTexture extends WebGLKernelValueMemoryOptimizedNumberTexture {\r\n  getSource() {\r\n    return utils.linesToString([\r\n      `uniform sampler2D ${this.id}`,\r\n      `uniform ivec2 ${this.sizeId}`,\r\n      `uniform ivec3 ${this.dimensionsId}`,\r\n    ]);\r\n  }\r\n\r\n  updateValue(inputTexture) {\r\n    this.dimensions = inputTexture.dimensions;\r\n    this.textureSize = inputTexture.size;\r\n    this.kernel.setUniform3iv(this.dimensionsId, this.dimensions);\r\n    this.kernel.setUniform2iv(this.sizeId, this.textureSize);\r\n    super.updateValue(inputTexture);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { WebGLKernelValue } from './index';\r\n\r\nexport class WebGLKernelValueNumberTexture extends WebGLKernelValue {\r\n  constructor(value, settings) {\r\n    super(value, settings);\r\n    this.setupTexture();\r\n    const { size: textureSize, dimensions } = value;\r\n    this.bitRatio = this.getBitRatio(value);\r\n    this.dimensions = dimensions;\r\n    this.textureSize = textureSize;\r\n    this.uploadValue = value.texture;\r\n  }\r\n\r\n  getStringValueHandler() {\r\n    return `const uploadValue_${this.name} = ${this.varName}.texture;\\n`;\r\n  }\r\n\r\n  getSource() {\r\n    return utils.linesToString([\r\n      `uniform sampler2D ${this.id}`,\r\n      `ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,\r\n      `ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`,\r\n    ]);\r\n  }\r\n\r\n  updateValue(inputTexture) {\r\n    if (inputTexture.constructor !== this.initialValueConstructor) {\r\n      this.onUpdateValueMismatch();\r\n      return;\r\n    }\r\n    if (this.checkContext && inputTexture.context !== this.context) {\r\n      throw new Error(`Value ${this.name} (${this.type}) must be from same context`);\r\n    }\r\n    const { context: gl } = this;\r\n    gl.activeTexture(this.contextHandle);\r\n    gl.bindTexture(gl.TEXTURE_2D, this.uploadValue = inputTexture.texture);\r\n    this.kernel.setUniform1i(this.id, this.index);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { WebGLKernelValueNumberTexture } from './number-texture';\r\n\r\nexport class WebGLKernelValueDynamicNumberTexture extends WebGLKernelValueNumberTexture {\r\n  getSource() {\r\n    return utils.linesToString([\r\n      `uniform sampler2D ${this.id}`,\r\n      `uniform ivec2 ${this.sizeId}`,\r\n      `uniform ivec3 ${this.dimensionsId}`,\r\n    ]);\r\n  }\r\n\r\n  updateValue(value) {\r\n    this.dimensions = value.dimensions;\r\n    this.textureSize = value.size;\r\n    this.kernel.setUniform3iv(this.dimensionsId, this.dimensions);\r\n    this.kernel.setUniform2iv(this.sizeId, this.textureSize);\r\n    super.updateValue(value);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { WebGLKernelValue } from './index';\r\n\r\nexport class WebGLKernelValueSingleArray extends WebGLKernelValue {\r\n  constructor(value, settings) {\r\n    super(value, settings);\r\n    this.requestTexture();\r\n    this.bitRatio = 4;\r\n    this.dimensions = utils.getDimensions(value, true);\r\n    this.textureSize = utils.getMemoryOptimizedFloatTextureSize(this.dimensions, this.bitRatio);\r\n    this.uploadArrayLength = this.textureSize[0] * this.textureSize[1] * this.bitRatio;\r\n    this.uploadValue = new Float32Array(this.uploadArrayLength);\r\n  }\r\n\r\n  getStringValueHandler() {\r\n    return utils.linesToString([\r\n      `const uploadValue_${this.name} = new Float32Array(${this.uploadArrayLength})`,\r\n      `flattenTo(${this.varName}, uploadValue_${this.name})`,\r\n    ]);\r\n  }\r\n\r\n  getSource() {\r\n    return utils.linesToString([\r\n      `uniform sampler2D ${this.id}`,\r\n      `ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,\r\n      `ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`,\r\n    ]);\r\n  }\r\n\r\n  updateValue(value) {\r\n    if (value.constructor !== this.initialValueConstructor) {\r\n      this.onUpdateValueMismatch();\r\n      return;\r\n    }\r\n    const { context: gl } = this;\r\n    utils.flattenTo(value, this.uploadValue);\r\n    gl.activeTexture(this.contextHandle);\r\n    gl.bindTexture(gl.TEXTURE_2D, this.texture);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\r\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, this.textureSize[0], this.textureSize[1], 0, gl.RGBA, gl.FLOAT, this.uploadValue);\r\n    this.kernel.setUniform1i(this.id, this.index);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { WebGLKernelValueSingleArray } from './single-array';\r\n\r\nexport class WebGLKernelValueDynamicSingleArray extends WebGLKernelValueSingleArray {\r\n  getSource() {\r\n    return utils.linesToString([\r\n      `uniform sampler2D ${this.id}`,\r\n      `uniform ivec2 ${this.sizeId}`,\r\n      `uniform ivec3 ${this.dimensionsId}`,\r\n    ]);\r\n  }\r\n\r\n  updateValue(value) {\r\n    this.dimensions = utils.getDimensions(value, true);\r\n    this.textureSize = utils.getMemoryOptimizedFloatTextureSize(this.dimensions, this.bitRatio);\r\n    this.uploadArrayLength = this.textureSize[0] * this.textureSize[1] * this.bitRatio;\r\n    this.uploadValue = new Float32Array(this.uploadArrayLength);\r\n    this.kernel.setUniform3iv(this.dimensionsId, this.dimensions);\r\n    this.kernel.setUniform2iv(this.sizeId, this.textureSize);\r\n    super.updateValue(value);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { WebGLKernelValue } from './index';\r\n\r\nexport class WebGLKernelValueSingleArray1DI extends WebGLKernelValue {\r\n  constructor(value, settings) {\r\n    super(value, settings);\r\n    this.requestTexture();\r\n    this.bitRatio = 4;\r\n    this.setShape(value);\r\n  }\r\n\r\n  setShape(value) {\r\n    const valueDimensions = utils.getDimensions(value, true);\r\n    this.textureSize = utils.getMemoryOptimizedFloatTextureSize(valueDimensions, this.bitRatio);\r\n    this.dimensions = new Int32Array([valueDimensions[1], 1, 1]);\r\n    this.uploadArrayLength = this.textureSize[0] * this.textureSize[1] * this.bitRatio;\r\n    this.uploadValue = new Float32Array(this.uploadArrayLength);\r\n  }\r\n\r\n  getStringValueHandler() {\r\n    return utils.linesToString([\r\n      `const uploadValue_${this.name} = new Float32Array(${this.uploadArrayLength})`,\r\n      `flattenTo(${this.varName}, uploadValue_${this.name})`,\r\n    ]);\r\n  }\r\n\r\n  getSource() {\r\n    return utils.linesToString([\r\n      `uniform sampler2D ${this.id}`,\r\n      `ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,\r\n      `ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`,\r\n    ]);\r\n  }\r\n\r\n  updateValue(value) {\r\n    if (value.constructor !== this.initialValueConstructor) {\r\n      this.onUpdateValueMismatch();\r\n      return;\r\n    }\r\n    const { context: gl } = this;\r\n    utils.flatten2dArrayTo(value, this.uploadValue);\r\n    gl.activeTexture(this.contextHandle);\r\n    gl.bindTexture(gl.TEXTURE_2D, this.texture);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\r\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, this.textureSize[0], this.textureSize[1], 0, gl.RGBA, gl.FLOAT, this.uploadValue);\r\n    this.kernel.setUniform1i(this.id, this.index);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { WebGLKernelValueSingleArray1DI } from './single-array1d-i';\r\n\r\nexport class WebGLKernelValueDynamicSingleArray1DI extends WebGLKernelValueSingleArray1DI {\r\n  getSource() {\r\n    return utils.linesToString([\r\n      `uniform sampler2D ${this.id}`,\r\n      `uniform ivec2 ${this.sizeId}`,\r\n      `uniform ivec3 ${this.dimensionsId}`,\r\n    ]);\r\n  }\r\n\r\n  updateValue(value) {\r\n    this.setShape(value);\r\n    this.kernel.setUniform3iv(this.dimensionsId, this.dimensions);\r\n    this.kernel.setUniform2iv(this.sizeId, this.textureSize);\r\n    super.updateValue(value);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { WebGLKernelValue } from './index';\r\n\r\nexport class WebGLKernelValueSingleArray2DI extends WebGLKernelValue {\r\n  constructor(value, settings) {\r\n    super(value, settings);\r\n    this.requestTexture();\r\n    this.bitRatio = 4;\r\n    this.setShape(value);\r\n  }\r\n\r\n  setShape(value) {\r\n    const valueDimensions = utils.getDimensions(value, true);\r\n    this.textureSize = utils.getMemoryOptimizedFloatTextureSize(valueDimensions, this.bitRatio);\r\n    this.dimensions = new Int32Array([valueDimensions[1], valueDimensions[2], 1]);\r\n    this.uploadArrayLength = this.textureSize[0] * this.textureSize[1] * this.bitRatio;\r\n    this.uploadValue = new Float32Array(this.uploadArrayLength);\r\n  }\r\n\r\n  getStringValueHandler() {\r\n    return utils.linesToString([\r\n      `const uploadValue_${this.name} = new Float32Array(${this.uploadArrayLength})`,\r\n      `flattenTo(${this.varName}, uploadValue_${this.name})`,\r\n    ]);\r\n  }\r\n\r\n  getSource() {\r\n    return utils.linesToString([\r\n      `uniform sampler2D ${this.id}`,\r\n      `ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,\r\n      `ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`,\r\n    ]);\r\n  }\r\n\r\n  updateValue(value) {\r\n    if (value.constructor !== this.initialValueConstructor) {\r\n      this.onUpdateValueMismatch();\r\n      return;\r\n    }\r\n    const { context: gl } = this;\r\n    utils.flatten3dArrayTo(value, this.uploadValue);\r\n    gl.activeTexture(this.contextHandle);\r\n    gl.bindTexture(gl.TEXTURE_2D, this.texture);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\r\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, this.textureSize[0], this.textureSize[1], 0, gl.RGBA, gl.FLOAT, this.uploadValue);\r\n    this.kernel.setUniform1i(this.id, this.index);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { WebGLKernelValueSingleArray2DI } from './single-array2d-i';\r\n\r\nexport class WebGLKernelValueDynamicSingleArray2DI extends WebGLKernelValueSingleArray2DI {\r\n  getSource() {\r\n    return utils.linesToString([\r\n      `uniform sampler2D ${this.id}`,\r\n      `uniform ivec2 ${this.sizeId}`,\r\n      `uniform ivec3 ${this.dimensionsId}`,\r\n    ]);\r\n  }\r\n\r\n  updateValue(value) {\r\n    this.setShape(value);\r\n    this.kernel.setUniform3iv(this.dimensionsId, this.dimensions);\r\n    this.kernel.setUniform2iv(this.sizeId, this.textureSize);\r\n    super.updateValue(value);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { WebGLKernelValue } from './index';\r\n\r\nexport class WebGLKernelValueSingleArray3DI extends WebGLKernelValue {\r\n  constructor(value, settings) {\r\n    super(value, settings);\r\n    this.requestTexture();\r\n    this.bitRatio = 4;\r\n    this.setShape(value);\r\n  }\r\n\r\n  setShape(value) {\r\n    const valueDimensions = utils.getDimensions(value, true);\r\n    this.textureSize = utils.getMemoryOptimizedFloatTextureSize(valueDimensions, this.bitRatio);\r\n    this.dimensions = new Int32Array([valueDimensions[1], valueDimensions[2], valueDimensions[3]]);\r\n    this.uploadArrayLength = this.textureSize[0] * this.textureSize[1] * this.bitRatio;\r\n    this.uploadValue = new Float32Array(this.uploadArrayLength);\r\n  }\r\n\r\n  getStringValueHandler() {\r\n    return utils.linesToString([\r\n      `const uploadValue_${this.name} = new Float32Array(${this.uploadArrayLength})`,\r\n      `flattenTo(${this.varName}, uploadValue_${this.name})`,\r\n    ]);\r\n  }\r\n\r\n  getSource() {\r\n    return utils.linesToString([\r\n      `uniform sampler2D ${this.id}`,\r\n      `ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,\r\n      `ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`,\r\n    ]);\r\n  }\r\n\r\n  updateValue(value) {\r\n    if (value.constructor !== this.initialValueConstructor) {\r\n      this.onUpdateValueMismatch();\r\n      return;\r\n    }\r\n    const { context: gl } = this;\r\n    utils.flatten4dArrayTo(value, this.uploadValue);\r\n    gl.activeTexture(this.contextHandle);\r\n    gl.bindTexture(gl.TEXTURE_2D, this.texture);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\r\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, this.textureSize[0], this.textureSize[1], 0, gl.RGBA, gl.FLOAT, this.uploadValue);\r\n    this.kernel.setUniform1i(this.id, this.index);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { WebGLKernelValueSingleArray3DI } from './single-array3d-i';\r\n\r\nexport class WebGLKernelValueDynamicSingleArray3DI extends WebGLKernelValueSingleArray3DI {\r\n  getSource() {\r\n    return utils.linesToString([\r\n      `uniform sampler2D ${this.id}`,\r\n      `uniform ivec2 ${this.sizeId}`,\r\n      `uniform ivec3 ${this.dimensionsId}`,\r\n    ]);\r\n  }\r\n\r\n  updateValue(value) {\r\n    this.setShape(value);\r\n    this.kernel.setUniform3iv(this.dimensionsId, this.dimensions);\r\n    this.kernel.setUniform2iv(this.sizeId, this.textureSize);\r\n    super.updateValue(value);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { WebGLKernelValue } from './index';\r\n\r\nexport class WebGLKernelValueSingleArray2 extends WebGLKernelValue {\r\n  constructor(value, settings) {\r\n    super(value, settings);\r\n    this.uploadValue = value;\r\n  }\r\n  getSource(value) {\r\n    if (this.origin === 'constants') {\r\n      return `const vec2 ${this.id} = vec2(${value[0]},${value[1]});\\n`;\r\n    }\r\n    return `uniform vec2 ${this.id};\\n`;\r\n  }\r\n\r\n  getStringValueHandler() {\r\n    return `const uploadValue_${this.name} = ${this.varName};\\n`;\r\n  }\r\n\r\n  updateValue(value) {\r\n    if (this.origin === 'constants') return;\r\n    this.kernel.setUniform2fv(this.id, this.uploadValue = value);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { WebGLKernelValue } from './index';\r\n\r\nexport class WebGLKernelValueSingleArray3 extends WebGLKernelValue {\r\n  constructor(value, settings) {\r\n    super(value, settings);\r\n    this.uploadValue = value;\r\n  }\r\n  getSource(value) {\r\n    if (this.origin === 'constants') {\r\n      return `const vec3 ${this.id} = vec3(${value[0]},${value[1]},${value[2]});\\n`;\r\n    }\r\n    return `uniform vec3 ${this.id};\\n`;\r\n  }\r\n\r\n  getStringValueHandler() {\r\n    return `const uploadValue_${this.name} = ${this.varName};\\n`;\r\n  }\r\n\r\n  updateValue(value) {\r\n    if (this.origin === 'constants') return;\r\n    this.kernel.setUniform3fv(this.id, this.uploadValue = value);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { WebGLKernelValue } from './index';\r\n\r\nexport class WebGLKernelValueSingleArray4 extends WebGLKernelValue {\r\n  constructor(value, settings) {\r\n    super(value, settings);\r\n    this.uploadValue = value;\r\n  }\r\n  getSource(value) {\r\n    if (this.origin === 'constants') {\r\n      return `const vec4 ${this.id} = vec4(${value[0]},${value[1]},${value[2]},${value[3]});\\n`;\r\n    }\r\n    return `uniform vec4 ${this.id};\\n`;\r\n  }\r\n\r\n  getStringValueHandler() {\r\n    return `const uploadValue_${this.name} = ${this.varName};\\n`;\r\n  }\r\n\r\n  updateValue(value) {\r\n    if (this.origin === 'constants') return;\r\n    this.kernel.setUniform4fv(this.id, this.uploadValue = value);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { WebGLKernelValue } from './index';\r\n\r\nexport class WebGLKernelValueUnsignedArray extends WebGLKernelValue {\r\n  constructor(value, settings) {\r\n    super(value, settings);\r\n    this.requestTexture();\r\n    this.bitRatio = this.getBitRatio(value);\r\n    this.dimensions = utils.getDimensions(value, true);\r\n    this.textureSize = utils.getMemoryOptimizedPackedTextureSize(this.dimensions, this.bitRatio);\r\n    this.uploadArrayLength = this.textureSize[0] * this.textureSize[1] * (4 / this.bitRatio);\r\n    this.TranserArrayType = this.getTransferArrayType(value);\r\n    this.preUploadValue = new this.TranserArrayType(this.uploadArrayLength);\r\n    this.uploadValue = new Uint8Array(this.preUploadValue.buffer);\r\n  }\r\n\r\n  getStringValueHandler() {\r\n    return utils.linesToString([\r\n      `const preUploadValue_${this.name} = new ${this.TranserArrayType.name}(${this.uploadArrayLength})`,\r\n      `const uploadValue_${this.name} = new Uint8Array(preUploadValue_${this.name}.buffer)`,\r\n      `flattenTo(${this.varName}, preUploadValue_${this.name})`,\r\n    ]);\r\n  }\r\n\r\n  getSource() {\r\n    return utils.linesToString([\r\n      `uniform sampler2D ${this.id}`,\r\n      `ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,\r\n      `ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`,\r\n    ]);\r\n  }\r\n\r\n  updateValue(value) {\r\n    if (value.constructor !== this.initialValueConstructor) {\r\n      this.onUpdateValueMismatch();\r\n      return;\r\n    }\r\n    const { context: gl } = this;\r\n    utils.flattenTo(value, this.preUploadValue);\r\n    gl.activeTexture(this.contextHandle);\r\n    gl.bindTexture(gl.TEXTURE_2D, this.texture);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\r\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, this.textureSize[0], this.textureSize[1], 0, gl.RGBA, gl.UNSIGNED_BYTE, this.uploadValue);\r\n    this.kernel.setUniform1i(this.id, this.index);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { WebGLKernelValueUnsignedArray } from './unsigned-array';\r\n\r\nexport class WebGLKernelValueDynamicUnsignedArray extends WebGLKernelValueUnsignedArray {\r\n  getSource() {\r\n    return utils.linesToString([\r\n      `uniform sampler2D ${this.id}`,\r\n      `uniform ivec2 ${this.sizeId}`,\r\n      `uniform ivec3 ${this.dimensionsId}`,\r\n    ]);\r\n  }\r\n\r\n  updateValue(value) {\r\n    this.dimensions = utils.getDimensions(value, true);\r\n    this.textureSize = utils.getMemoryOptimizedPackedTextureSize(this.dimensions, this.bitRatio);\r\n    this.uploadArrayLength = this.textureSize[0] * this.textureSize[1] * (4 / this.bitRatio);\r\n    const Type = this.getTransferArrayType(value);\r\n    this.preUploadValue = new Type(this.uploadArrayLength);\r\n    this.uploadValue = new Uint8Array(this.preUploadValue.buffer);\r\n    this.kernel.setUniform3iv(this.dimensionsId, this.dimensions);\r\n    this.kernel.setUniform2iv(this.sizeId, this.textureSize);\r\n    super.updateValue(value);\r\n  }\r\n}\r\n","import { WebGLKernelValueBoolean } from './kernel-value/boolean';\r\nimport { WebGLKernelValueFloat } from './kernel-value/float';\r\nimport { WebGLKernelValueInteger } from './kernel-value/integer';\r\n\r\nimport { WebGLKernelValueHTMLImage } from './kernel-value/html-image';\r\nimport { WebGLKernelValueDynamicHTMLImage } from './kernel-value/dynamic-html-image';\r\n\r\nimport { WebGLKernelValueHTMLVideo } from './kernel-value/html-video';\r\nimport { WebGLKernelValueDynamicHTMLVideo } from './kernel-value/dynamic-html-video';\r\n\r\nimport { WebGLKernelValueSingleInput } from './kernel-value/single-input';\r\nimport { WebGLKernelValueDynamicSingleInput } from './kernel-value/dynamic-single-input';\r\n\r\nimport { WebGLKernelValueUnsignedInput } from './kernel-value/unsigned-input';\r\nimport { WebGLKernelValueDynamicUnsignedInput } from './kernel-value/dynamic-unsigned-input';\r\n\r\nimport { WebGLKernelValueMemoryOptimizedNumberTexture } from './kernel-value/memory-optimized-number-texture';\r\nimport { WebGLKernelValueDynamicMemoryOptimizedNumberTexture } from './kernel-value/dynamic-memory-optimized-number-texture';\r\n\r\nimport { WebGLKernelValueNumberTexture } from './kernel-value/number-texture';\r\nimport { WebGLKernelValueDynamicNumberTexture } from './kernel-value/dynamic-number-texture';\r\n\r\nimport { WebGLKernelValueSingleArray } from './kernel-value/single-array';\r\nimport { WebGLKernelValueDynamicSingleArray } from './kernel-value/dynamic-single-array';\r\n\r\nimport { WebGLKernelValueSingleArray1DI } from './kernel-value/single-array1d-i';\r\nimport { WebGLKernelValueDynamicSingleArray1DI } from './kernel-value/dynamic-single-array1d-i';\r\n\r\nimport { WebGLKernelValueSingleArray2DI } from './kernel-value/single-array2d-i';\r\nimport { WebGLKernelValueDynamicSingleArray2DI } from './kernel-value/dynamic-single-array2d-i';\r\n\r\nimport { WebGLKernelValueSingleArray3DI } from './kernel-value/single-array3d-i';\r\nimport { WebGLKernelValueDynamicSingleArray3DI } from './kernel-value/dynamic-single-array3d-i';\r\n\r\nimport { WebGLKernelValueSingleArray2 } from './kernel-value/single-array2';\r\nimport { WebGLKernelValueSingleArray3 } from './kernel-value/single-array3';\r\nimport { WebGLKernelValueSingleArray4 } from './kernel-value/single-array4';\r\n\r\nimport { WebGLKernelValueUnsignedArray } from './kernel-value/unsigned-array';\r\nimport { WebGLKernelValueDynamicUnsignedArray } from './kernel-value/dynamic-unsigned-array';\r\n\r\nconst kernelValueMaps = {\r\n  unsigned: {\r\n    dynamic: {\r\n      'Boolean': WebGLKernelValueBoolean,\r\n      'Integer': WebGLKernelValueInteger,\r\n      'Float': WebGLKernelValueFloat,\r\n      'Array': WebGLKernelValueDynamicUnsignedArray,\r\n      'Array(2)': false,\r\n      'Array(3)': false,\r\n      'Array(4)': false,\r\n      'Array1D(2)': false,\r\n      'Array1D(3)': false,\r\n      'Array1D(4)': false,\r\n      'Array2D(2)': false,\r\n      'Array2D(3)': false,\r\n      'Array2D(4)': false,\r\n      'Array3D(2)': false,\r\n      'Array3D(3)': false,\r\n      'Array3D(4)': false,\r\n      'Input': WebGLKernelValueDynamicUnsignedInput,\r\n      'NumberTexture': WebGLKernelValueDynamicNumberTexture,\r\n      'ArrayTexture(1)': WebGLKernelValueDynamicNumberTexture,\r\n      'ArrayTexture(2)': WebGLKernelValueDynamicNumberTexture,\r\n      'ArrayTexture(3)': WebGLKernelValueDynamicNumberTexture,\r\n      'ArrayTexture(4)': WebGLKernelValueDynamicNumberTexture,\r\n      'MemoryOptimizedNumberTexture': WebGLKernelValueDynamicMemoryOptimizedNumberTexture,\r\n      'HTMLImage': WebGLKernelValueDynamicHTMLImage,\r\n      'HTMLImageArray': false,\r\n      'HTMLVideo': WebGLKernelValueDynamicHTMLVideo,\r\n    },\r\n    static: {\r\n      'Boolean': WebGLKernelValueBoolean,\r\n      'Float': WebGLKernelValueFloat,\r\n      'Integer': WebGLKernelValueInteger,\r\n      'Array': WebGLKernelValueUnsignedArray,\r\n      'Array(2)': false,\r\n      'Array(3)': false,\r\n      'Array(4)': false,\r\n      'Array1D(2)': false,\r\n      'Array1D(3)': false,\r\n      'Array1D(4)': false,\r\n      'Array2D(2)': false,\r\n      'Array2D(3)': false,\r\n      'Array2D(4)': false,\r\n      'Array3D(2)': false,\r\n      'Array3D(3)': false,\r\n      'Array3D(4)': false,\r\n      'Input': WebGLKernelValueUnsignedInput,\r\n      'NumberTexture': WebGLKernelValueNumberTexture,\r\n      'ArrayTexture(1)': WebGLKernelValueNumberTexture,\r\n      'ArrayTexture(2)': WebGLKernelValueNumberTexture,\r\n      'ArrayTexture(3)': WebGLKernelValueNumberTexture,\r\n      'ArrayTexture(4)': WebGLKernelValueNumberTexture,\r\n      'MemoryOptimizedNumberTexture': WebGLKernelValueDynamicMemoryOptimizedNumberTexture,\r\n      'HTMLImage': WebGLKernelValueHTMLImage,\r\n      'HTMLImageArray': false,\r\n      'HTMLVideo': WebGLKernelValueHTMLVideo,\r\n    }\r\n  },\r\n  single: {\r\n    dynamic: {\r\n      'Boolean': WebGLKernelValueBoolean,\r\n      'Integer': WebGLKernelValueInteger,\r\n      'Float': WebGLKernelValueFloat,\r\n      'Array': WebGLKernelValueDynamicSingleArray,\r\n      'Array(2)': WebGLKernelValueSingleArray2,\r\n      'Array(3)': WebGLKernelValueSingleArray3,\r\n      'Array(4)': WebGLKernelValueSingleArray4,\r\n      'Array1D(2)': WebGLKernelValueDynamicSingleArray1DI,\r\n      'Array1D(3)': WebGLKernelValueDynamicSingleArray1DI,\r\n      'Array1D(4)': WebGLKernelValueDynamicSingleArray1DI,\r\n      'Array2D(2)': WebGLKernelValueDynamicSingleArray2DI,\r\n      'Array2D(3)': WebGLKernelValueDynamicSingleArray2DI,\r\n      'Array2D(4)': WebGLKernelValueDynamicSingleArray2DI,\r\n      'Array3D(2)': WebGLKernelValueDynamicSingleArray3DI,\r\n      'Array3D(3)': WebGLKernelValueDynamicSingleArray3DI,\r\n      'Array3D(4)': WebGLKernelValueDynamicSingleArray3DI,\r\n      'Array': WebGLKernelValueDynamicSingleArray,\r\n      'Input': WebGLKernelValueDynamicSingleInput,\r\n      'NumberTexture': WebGLKernelValueDynamicNumberTexture,\r\n      'ArrayTexture(1)': WebGLKernelValueDynamicNumberTexture,\r\n      'ArrayTexture(2)': WebGLKernelValueDynamicNumberTexture,\r\n      'ArrayTexture(3)': WebGLKernelValueDynamicNumberTexture,\r\n      'ArrayTexture(4)': WebGLKernelValueDynamicNumberTexture,\r\n      'MemoryOptimizedNumberTexture': WebGLKernelValueDynamicMemoryOptimizedNumberTexture,\r\n      'HTMLImage': WebGLKernelValueDynamicHTMLImage,\r\n      'HTMLImageArray': false,\r\n      'HTMLVideo': WebGLKernelValueDynamicHTMLVideo,\r\n    },\r\n    static: {\r\n      'Boolean': WebGLKernelValueBoolean,\r\n      'Float': WebGLKernelValueFloat,\r\n      'Integer': WebGLKernelValueInteger,\r\n      'Array': WebGLKernelValueSingleArray,\r\n      'Array(2)': WebGLKernelValueSingleArray2,\r\n      'Array(3)': WebGLKernelValueSingleArray3,\r\n      'Array(4)': WebGLKernelValueSingleArray4,\r\n      'Array1D(2)': WebGLKernelValueSingleArray1DI,\r\n      'Array1D(3)': WebGLKernelValueSingleArray1DI,\r\n      'Array1D(4)': WebGLKernelValueSingleArray1DI,\r\n      'Array2D(2)': WebGLKernelValueSingleArray2DI,\r\n      'Array2D(3)': WebGLKernelValueSingleArray2DI,\r\n      'Array2D(4)': WebGLKernelValueSingleArray2DI,\r\n      'Array3D(2)': WebGLKernelValueSingleArray3DI,\r\n      'Array3D(3)': WebGLKernelValueSingleArray3DI,\r\n      'Array3D(4)': WebGLKernelValueSingleArray3DI,\r\n      'Input': WebGLKernelValueSingleInput,\r\n      'NumberTexture': WebGLKernelValueNumberTexture,\r\n      'ArrayTexture(1)': WebGLKernelValueNumberTexture,\r\n      'ArrayTexture(2)': WebGLKernelValueNumberTexture,\r\n      'ArrayTexture(3)': WebGLKernelValueNumberTexture,\r\n      'ArrayTexture(4)': WebGLKernelValueNumberTexture,\r\n      'MemoryOptimizedNumberTexture': WebGLKernelValueMemoryOptimizedNumberTexture,\r\n      'HTMLImage': WebGLKernelValueHTMLImage,\r\n      'HTMLImageArray': false,\r\n      'HTMLVideo': WebGLKernelValueHTMLVideo,\r\n    }\r\n  },\r\n};\r\n\r\nexport function lookupKernelValueType(type, dynamic, precision, value) {\r\n  if (!type) {\r\n    throw new Error('type missing');\r\n  }\r\n  if (!dynamic) {\r\n    throw new Error('dynamic missing');\r\n  }\r\n  if (!precision) {\r\n    throw new Error('precision missing');\r\n  }\r\n  if (value.type) {\r\n    type = value.type;\r\n  }\r\n  const types = kernelValueMaps[precision][dynamic];\r\n  if (types[type] === false) {\r\n    return null;\r\n  } else if (types[type] === undefined) {\r\n    throw new Error(`Could not find a KernelValue for ${ type }`);\r\n  }\r\n  return types[type];\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { WebGLKernelValueSingleInput } from './single-input';\r\n\r\nexport class WebGLKernelValueDynamicSingleInput extends WebGLKernelValueSingleInput {\r\n  getSource() {\r\n    return utils.linesToString([\r\n      `uniform sampler2D ${this.id}`,\r\n      `uniform ivec2 ${this.sizeId}`,\r\n      `uniform ivec3 ${this.dimensionsId}`,\r\n    ]);\r\n  }\r\n\r\n  updateValue(value) {\r\n    let [w, h, d] = value.size;\r\n    this.dimensions = new Int32Array([w || 1, h || 1, d || 1]);\r\n    this.textureSize = utils.getMemoryOptimizedFloatTextureSize(this.dimensions, this.bitRatio);\r\n    this.uploadArrayLength = this.textureSize[0] * this.textureSize[1] * this.bitRatio;\r\n    this.uploadValue = new Float32Array(this.uploadArrayLength);\r\n    this.kernel.setUniform3iv(this.dimensionsId, this.dimensions);\r\n    this.kernel.setUniform2iv(this.sizeId, this.textureSize);\r\n    super.updateValue(value);\r\n  }\r\n}\r\n","import { GLKernel } from '../gl/kernel';\r\nimport { FunctionBuilder } from '../function-builder';\r\nimport { WebGLFunctionNode } from './function-node';\r\nimport { utils } from '../../utils';\r\nimport triangleNoise from '../../plugins/triangle-noise';\r\nimport { fragmentShader } from './fragment-shader';\r\nimport { vertexShader } from './vertex-shader';\r\nimport { glKernelString } from '../gl/kernel-string';\r\nimport { lookupKernelValueType } from './kernel-value-maps';\r\n\r\nlet isSupported = null;\r\nlet testCanvas = null;\r\nlet testContext = null;\r\nlet testExtensions = null;\r\nlet features = null;\r\n\r\nconst plugins = [triangleNoise];\r\nconst canvases = [];\r\nconst maxTexSizes = {};\r\n\r\n/**\r\n * @desc Kernel Implementation for WebGL.\r\n *\r\n * This builds the shaders and runs them on the GPU, then outputs the result\r\n * back as float (enabled by default) and Texture.\r\n *\r\n * @prop {Object} textureCache - webGl Texture cache\r\n * @prop {Object} programUniformLocationCache - Location of program variables in memory\r\n * @prop {Object} framebuffer - Webgl frameBuffer\r\n * @prop {Object} buffer - WebGL buffer\r\n * @prop {Object} program - The webGl Program\r\n * @prop {Object} functionBuilder - Function Builder instance bound to this Kernel\r\n * @prop {Boolean} pipeline - Set output type to FAST mode (GPU to GPU via Textures), instead of float\r\n * @prop {String} endianness - Endian information like Little-endian, Big-endian.\r\n * @prop {Array} argumentTypes - Types of parameters sent to the Kernel\r\n * @prop {String} compiledFragmentShader - Compiled fragment shader string\r\n * @prop {String} compiledVertexShader - Compiled Vertical shader string\r\n * @extends GLKernel\r\n */\r\nexport class WebGLKernel extends GLKernel {\r\n  static get isSupported() {\r\n    if (isSupported !== null) {\r\n      return isSupported;\r\n    }\r\n    this.setupFeatureChecks();\r\n    isSupported = this.isContextMatch(testContext);\r\n    return isSupported;\r\n  }\r\n\r\n  static setupFeatureChecks() {\r\n    if (typeof document !== 'undefined') {\r\n      testCanvas = document.createElement('canvas');\r\n    } else if (typeof OffscreenCanvas !== 'undefined') {\r\n      testCanvas = new OffscreenCanvas(0, 0);\r\n    }\r\n    if (!testCanvas) return;\r\n    testContext = testCanvas.getContext('webgl') || testCanvas.getContext('experimental-webgl');\r\n    if (!testContext || !testContext.getExtension) return;\r\n    testExtensions = {\r\n      OES_texture_float: testContext.getExtension('OES_texture_float'),\r\n      OES_texture_float_linear: testContext.getExtension('OES_texture_float_linear'),\r\n      OES_element_index_uint: testContext.getExtension('OES_element_index_uint'),\r\n      WEBGL_draw_buffers: testContext.getExtension('WEBGL_draw_buffers'),\r\n    };\r\n    features = this.getFeatures();\r\n  }\r\n\r\n  static isContextMatch(context) {\r\n    if (typeof WebGLRenderingContext !== 'undefined') {\r\n      return context instanceof WebGLRenderingContext;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  static getFeatures() {\r\n    const isDrawBuffers = this.getIsDrawBuffers();\r\n    return Object.freeze({\r\n      isFloatRead: this.getIsFloatRead(),\r\n      isIntegerDivisionAccurate: this.getIsIntegerDivisionAccurate(),\r\n      isTextureFloat: this.getIsTextureFloat(),\r\n      isDrawBuffers,\r\n      kernelMap: isDrawBuffers,\r\n      channelCount: this.getChannelCount(),\r\n    });\r\n  }\r\n\r\n  static getIsTextureFloat() {\r\n    return Boolean(testExtensions.OES_texture_float);\r\n  }\r\n\r\n  static getIsDrawBuffers() {\r\n    return Boolean(testExtensions.WEBGL_draw_buffers);\r\n  }\r\n\r\n  static getChannelCount() {\r\n    return testExtensions.WEBGL_draw_buffers ?\r\n      testContext.getParameter(testExtensions.WEBGL_draw_buffers.MAX_DRAW_BUFFERS_WEBGL) :\r\n      1;\r\n  }\r\n\r\n  static lookupKernelValueType(type, dynamic, precision, value) {\r\n    return lookupKernelValueType(type, dynamic, precision, value);\r\n  }\r\n\r\n  static get testCanvas() {\r\n    return testCanvas;\r\n  }\r\n\r\n  static get testContext() {\r\n    return testContext;\r\n  }\r\n\r\n  static get features() {\r\n    return features;\r\n  }\r\n\r\n  static get fragmentShader() {\r\n    return fragmentShader;\r\n  }\r\n\r\n  static get vertexShader() {\r\n    return vertexShader;\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @param {String} source\r\n   * @param {IKernelSettings} settings\r\n   */\r\n  constructor(source, settings) {\r\n    super(source, settings);\r\n    this.program = null;\r\n    this.pipeline = settings.pipeline;\r\n    this.endianness = utils.systemEndianness();\r\n    this.extensions = {};\r\n    this.subKernelOutputTextures = null;\r\n    this.kernelArguments = null;\r\n    this.argumentTextureCount = 0;\r\n    this.constantTextureCount = 0;\r\n    this.compiledFragmentShader = null;\r\n    this.compiledVertexShader = null;\r\n    this.fragShader = null;\r\n    this.vertShader = null;\r\n    this.drawBuffersMap = null;\r\n    this.outputTexture = null;\r\n\r\n    /**\r\n     *\r\n     * @type {Int32Array|null}\r\n     */\r\n    this.maxTexSize = null;\r\n    this.switchingKernels = false;\r\n    this.onRequestSwitchKernel = null;\r\n\r\n    this.mergeSettings(source.settings || settings);\r\n\r\n    /**\r\n     * The thread dimensions, x, y and z\r\n     * @type {Array|null}\r\n     */\r\n    this.threadDim = null;\r\n    this.framebuffer = null;\r\n    this.buffer = null;\r\n    this.textureCache = {};\r\n    this.programUniformLocationCache = {};\r\n    this.uniform1fCache = {};\r\n    this.uniform1iCache = {};\r\n    this.uniform2fCache = {};\r\n    this.uniform2fvCache = {};\r\n    this.uniform2ivCache = {};\r\n    this.uniform3fvCache = {};\r\n    this.uniform3ivCache = {};\r\n    this.uniform4fvCache = {};\r\n    this.uniform4ivCache = {};\r\n  }\r\n\r\n  initCanvas() {\r\n    if (typeof document !== 'undefined') {\r\n      const canvas = document.createElement('canvas');\r\n      // Default width and height, to fix webgl issue in safari\r\n      canvas.width = 2;\r\n      canvas.height = 2;\r\n      return canvas;\r\n    } else if (typeof OffscreenCanvas !== 'undefined') {\r\n      return new OffscreenCanvas(0, 0);\r\n    }\r\n  }\r\n\r\n  initContext() {\r\n    const settings = {\r\n      alpha: false,\r\n      depth: false,\r\n      antialias: false\r\n    };\r\n    return this.canvas.getContext('webgl', settings) || this.canvas.getContext('experimental-webgl', settings);\r\n  }\r\n\r\n  initPlugins(settings) {\r\n    // default plugins\r\n    const pluginsToUse = [];\r\n    const { source } = this;\r\n    if (typeof source === 'string') {\r\n      for (let i = 0; i < plugins.length; i++) {\r\n        const plugin = plugins[i];\r\n        if (source.match(plugin.functionMatch)) {\r\n          pluginsToUse.push(plugin);\r\n        }\r\n      }\r\n    } else if (typeof source === 'object') {\r\n      // `source` is from object, json\r\n      if (settings.pluginNames) { //TODO: in context of JSON support, pluginNames may not exist here\r\n        for (let i = 0; i < plugins.length; i++) {\r\n          const plugin = plugins[i];\r\n          const usePlugin = settings.pluginNames.some(pluginName => pluginName === plugin.name);\r\n          if (usePlugin) {\r\n            pluginsToUse.push(plugin);\r\n          }\r\n        }\r\n      }\r\n    }\r\n    return pluginsToUse;\r\n  }\r\n\r\n  initExtensions() {\r\n    this.extensions = {\r\n      OES_texture_float: this.context.getExtension('OES_texture_float'),\r\n      OES_texture_float_linear: this.context.getExtension('OES_texture_float_linear'),\r\n      OES_element_index_uint: this.context.getExtension('OES_element_index_uint'),\r\n      WEBGL_draw_buffers: this.context.getExtension('WEBGL_draw_buffers'),\r\n      WEBGL_color_buffer_float: this.context.getExtension('WEBGL_color_buffer_float'),\r\n    };\r\n  }\r\n\r\n  /**\r\n   * @desc Validate settings related to Kernel, such as dimensions size, and auto output support.\r\n   * @param {IArguments} args\r\n   */\r\n  validateSettings(args) {\r\n    if (!this.validate) {\r\n      this.texSize = utils.getKernelTextureSize({\r\n        optimizeFloatMemory: this.optimizeFloatMemory,\r\n        precision: this.precision,\r\n      }, this.output);\r\n      return;\r\n    }\r\n\r\n    const { features } = this.constructor;\r\n    if (this.optimizeFloatMemory === true && !features.isTextureFloat) {\r\n      throw new Error('Float textures are not supported');\r\n    } else if (this.precision === 'single' && !features.isFloatRead) {\r\n      throw new Error('Single precision not supported');\r\n    } else if (!this.graphical && this.precision === null && features.isTextureFloat) {\r\n      this.precision = features.isFloatRead ? 'single' : 'unsigned';\r\n    }\r\n\r\n    if (this.subKernels && this.subKernels.length > 0 && !this.extensions.WEBGL_draw_buffers) {\r\n      throw new Error('could not instantiate draw buffers extension');\r\n    }\r\n\r\n    if (this.fixIntegerDivisionAccuracy === null) {\r\n      this.fixIntegerDivisionAccuracy = !features.isIntegerDivisionAccurate;\r\n    } else if (this.fixIntegerDivisionAccuracy && features.isIntegerDivisionAccurate) {\r\n      this.fixIntegerDivisionAccuracy = false;\r\n    }\r\n\r\n    this.checkOutput();\r\n\r\n    if (!this.output || this.output.length === 0) {\r\n      if (args.length !== 1) {\r\n        throw new Error('Auto output only supported for kernels with only one input');\r\n      }\r\n\r\n      const argType = utils.getVariableType(args[0], this.strictIntegers);\r\n      if (argType === 'Array') {\r\n        this.output = utils.getDimensions(argType);\r\n      } else if (argType === 'NumberTexture' || argType === 'ArrayTexture(4)') {\r\n        this.output = args[0].output;\r\n      } else {\r\n        throw new Error('Auto output not supported for input type: ' + argType);\r\n      }\r\n    }\r\n\r\n    if (this.graphical) {\r\n      if (this.output.length !== 2) {\r\n        throw new Error('Output must have 2 dimensions on graphical mode');\r\n      }\r\n\r\n      if (this.precision === 'precision') {\r\n        this.precision = 'unsigned';\r\n        console.warn('Cannot use graphical mode and single precision at the same time');\r\n      }\r\n\r\n      this.texSize = utils.clone(this.output);\r\n      return;\r\n    } else if (this.precision === null && features.isTextureFloat) {\r\n      this.precision = 'single';\r\n    }\r\n\r\n    this.texSize = utils.getKernelTextureSize({\r\n      optimizeFloatMemory: this.optimizeFloatMemory,\r\n      precision: this.precision,\r\n    }, this.output);\r\n  }\r\n\r\n  updateMaxTexSize() {\r\n    const { texSize, canvas } = this;\r\n    if (this.maxTexSize === null) {\r\n      let canvasIndex = canvases.indexOf(canvas);\r\n      if (canvasIndex === -1) {\r\n        canvasIndex = canvases.length;\r\n        canvases.push(canvas);\r\n        maxTexSizes[canvasIndex] = [texSize[0], texSize[1]];\r\n      }\r\n      this.maxTexSize = maxTexSizes[canvasIndex];\r\n    }\r\n    if (this.maxTexSize[0] < texSize[0]) {\r\n      this.maxTexSize[0] = texSize[0];\r\n    }\r\n    if (this.maxTexSize[1] < texSize[1]) {\r\n      this.maxTexSize[1] = texSize[1];\r\n    }\r\n  }\r\n\r\n  // TODO: move channel checks to new place\r\n  _oldtranslateSource() {\r\n    const functionBuilder = FunctionBuilder.fromKernel(this, WebGLFunctionNode, {\r\n      fixIntegerDivisionAccuracy: this.fixIntegerDivisionAccuracy\r\n    });\r\n\r\n    // need this line to automatically get returnType\r\n    const translatedSource = functionBuilder.getPrototypeString('kernel');\r\n\r\n    if (!this.returnType) {\r\n      this.returnType = functionBuilder.getKernelResultType();\r\n    }\r\n\r\n    let requiredChannels = 0;\r\n    const returnTypes = functionBuilder.getReturnTypes();\r\n    for (let i = 0; i < returnTypes.length; i++) {\r\n      switch (returnTypes[i]) {\r\n        case 'Float':\r\n        case 'Number':\r\n        case 'Integer':\r\n          requiredChannels++;\r\n          break;\r\n        case 'Array(2)':\r\n          requiredChannels += 2;\r\n          break;\r\n        case 'Array(3)':\r\n          requiredChannels += 3;\r\n          break;\r\n        case 'Array(4)':\r\n          requiredChannels += 4;\r\n          break;\r\n      }\r\n    }\r\n\r\n    if (features && requiredChannels > features.channelCount) {\r\n      throw new Error('Too many channels!');\r\n    }\r\n\r\n    return this.translatedSource = translatedSource;\r\n  }\r\n\r\n  setupArguments(args) {\r\n    this.kernelArguments = [];\r\n    this.argumentTextureCount = 0;\r\n    const needsArgumentTypes = this.argumentTypes === null;\r\n    // TODO: remove\r\n    if (needsArgumentTypes) {\r\n      this.argumentTypes = [];\r\n    }\r\n    this.argumentSizes = [];\r\n    this.argumentBitRatios = [];\r\n    // TODO: end remove\r\n\r\n    if (args.length < this.argumentNames.length) {\r\n      throw new Error('not enough arguments for kernel');\r\n    } else if (args.length > this.argumentNames.length) {\r\n      throw new Error('too many arguments for kernel');\r\n    }\r\n\r\n    const { context: gl } = this;\r\n    let textureIndexes = 0;\r\n    for (let index = 0; index < args.length; index++) {\r\n      const value = args[index];\r\n      const name = this.argumentNames[index];\r\n      let type;\r\n      if (needsArgumentTypes) {\r\n        type = utils.getVariableType(value, this.strictIntegers);\r\n        this.argumentTypes.push(type);\r\n      } else {\r\n        type = this.argumentTypes[index];\r\n      }\r\n      const KernelValue = this.constructor.lookupKernelValueType(type, this.dynamicArguments ? 'dynamic' : 'static', this.precision, args[index]);\r\n      if (KernelValue === null) {\r\n        return this.requestFallback(args);\r\n      }\r\n      const kernelArgument = new KernelValue(value, {\r\n        name,\r\n        type,\r\n        tactic: this.tactic,\r\n        origin: 'user',\r\n        context: gl,\r\n        checkContext: this.checkContext,\r\n        kernel: this,\r\n        strictIntegers: this.strictIntegers,\r\n        onRequestTexture: () => {\r\n          return this.context.createTexture();\r\n        },\r\n        onRequestIndex: () => {\r\n          return textureIndexes++;\r\n        },\r\n        onUpdateValueMismatch: () => {\r\n          this.switchingKernels = true;\r\n        },\r\n        onRequestContextHandle: () => {\r\n          return gl.TEXTURE0 + this.constantTextureCount + this.argumentTextureCount++;\r\n        }\r\n      });\r\n      this.kernelArguments.push(kernelArgument);\r\n      this.argumentSizes.push(kernelArgument.textureSize);\r\n      this.argumentBitRatios[index] = kernelArgument.bitRatio;\r\n    }\r\n  }\r\n\r\n  setupConstants(args) {\r\n    const { context: gl } = this;\r\n    this.kernelConstants = [];\r\n    let needsConstantTypes = this.constantTypes === null;\r\n    if (needsConstantTypes) {\r\n      this.constantTypes = {};\r\n    }\r\n    this.constantBitRatios = {};\r\n    let textureIndexes = 0;\r\n    for (const name in this.constants) {\r\n      const value = this.constants[name];\r\n      let type;\r\n      if (needsConstantTypes) {\r\n        type = utils.getVariableType(value, this.strictIntegers);\r\n        this.constantTypes[name] = type;\r\n      } else {\r\n        type = this.constantTypes[name];\r\n      }\r\n      const KernelValue = this.constructor.lookupKernelValueType(type, 'static', this.precision, value);\r\n      if (KernelValue === null) {\r\n        return this.requestFallback(args);\r\n      }\r\n      const kernelValue = new KernelValue(value, {\r\n        name,\r\n        type,\r\n        tactic: this.tactic,\r\n        origin: 'constants',\r\n        context: this.context,\r\n        checkContext: this.checkContext,\r\n        kernel: this,\r\n        strictIntegers: this.strictIntegers,\r\n        onRequestTexture: () => {\r\n          return this.context.createTexture();\r\n        },\r\n        onRequestIndex: () => {\r\n          return textureIndexes++;\r\n        },\r\n        onRequestContextHandle: () => {\r\n          return gl.TEXTURE0 + this.constantTextureCount++;\r\n        }\r\n      });\r\n      this.constantBitRatios[name] = kernelValue.bitRatio;\r\n      this.kernelConstants.push(kernelValue);\r\n    }\r\n  }\r\n\r\n  build() {\r\n    this.initExtensions();\r\n    this.validateSettings(arguments);\r\n    this.setupConstants(arguments);\r\n    if (this.fallbackRequested) return;\r\n    this.setupArguments(arguments);\r\n    if (this.fallbackRequested) return;\r\n    this.updateMaxTexSize();\r\n    this.translateSource();\r\n    const failureResult = this.pickRenderStrategy(arguments);\r\n    if (failureResult) {\r\n      return failureResult;\r\n    }\r\n    const { texSize, context: gl, canvas } = this;\r\n    gl.enable(gl.SCISSOR_TEST);\r\n    if (this.pipeline && this.precision === 'single') {\r\n      gl.viewport(0, 0, this.maxTexSize[0], this.maxTexSize[1]);\r\n      canvas.width = this.maxTexSize[0];\r\n      canvas.height = this.maxTexSize[1];\r\n    } else {\r\n      gl.viewport(0, 0, this.maxTexSize[0], this.maxTexSize[1]);\r\n      canvas.width = this.maxTexSize[0];\r\n      canvas.height = this.maxTexSize[1];\r\n    }\r\n    const threadDim = this.threadDim = Array.from(this.output);\r\n    while (threadDim.length < 3) {\r\n      threadDim.push(1);\r\n    }\r\n\r\n    const compiledVertexShader = this.getVertexShader(arguments);\r\n    const vertShader = gl.createShader(gl.VERTEX_SHADER);\r\n    gl.shaderSource(vertShader, compiledVertexShader);\r\n    gl.compileShader(vertShader);\r\n    this.vertShader = vertShader;\r\n\r\n    const compiledFragmentShader = this.getFragmentShader(arguments);\r\n    const fragShader = gl.createShader(gl.FRAGMENT_SHADER);\r\n    gl.shaderSource(fragShader, compiledFragmentShader);\r\n    gl.compileShader(fragShader);\r\n    this.fragShader = fragShader;\r\n\r\n    if (this.debug) {\r\n      console.log('GLSL Shader Output:');\r\n      console.log(compiledFragmentShader);\r\n    }\r\n\r\n    if (!gl.getShaderParameter(vertShader, gl.COMPILE_STATUS)) {\r\n      throw new Error('Error compiling vertex shader: ' + gl.getShaderInfoLog(vertShader));\r\n    }\r\n    if (!gl.getShaderParameter(fragShader, gl.COMPILE_STATUS)) {\r\n      throw new Error('Error compiling fragment shader: ' + gl.getShaderInfoLog(fragShader));\r\n    }\r\n\r\n    const program = this.program = gl.createProgram();\r\n    gl.attachShader(program, vertShader);\r\n    gl.attachShader(program, fragShader);\r\n    gl.linkProgram(program);\r\n    this.framebuffer = gl.createFramebuffer();\r\n    this.framebuffer.width = texSize[0];\r\n    this.framebuffer.height = texSize[1];\r\n\r\n    const vertices = new Float32Array([-1, -1,\r\n      1, -1, -1, 1,\r\n      1, 1\r\n    ]);\r\n    const texCoords = new Float32Array([\r\n      0, 0,\r\n      1, 0,\r\n      0, 1,\r\n      1, 1\r\n    ]);\r\n\r\n    const texCoordOffset = vertices.byteLength;\r\n\r\n    let buffer = this.buffer;\r\n    if (!buffer) {\r\n      buffer = this.buffer = gl.createBuffer();\r\n      gl.bindBuffer(gl.ARRAY_BUFFER, buffer);\r\n      gl.bufferData(gl.ARRAY_BUFFER, vertices.byteLength + texCoords.byteLength, gl.STATIC_DRAW);\r\n    } else {\r\n      gl.bindBuffer(gl.ARRAY_BUFFER, buffer);\r\n    }\r\n\r\n    gl.bufferSubData(gl.ARRAY_BUFFER, 0, vertices);\r\n    gl.bufferSubData(gl.ARRAY_BUFFER, texCoordOffset, texCoords);\r\n\r\n    const aPosLoc = gl.getAttribLocation(this.program, 'aPos');\r\n    gl.enableVertexAttribArray(aPosLoc);\r\n    gl.vertexAttribPointer(aPosLoc, 2, gl.FLOAT, false, 0, 0);\r\n    const aTexCoordLoc = gl.getAttribLocation(this.program, 'aTexCoord');\r\n    gl.enableVertexAttribArray(aTexCoordLoc);\r\n    gl.vertexAttribPointer(aTexCoordLoc, 2, gl.FLOAT, false, 0, texCoordOffset);\r\n    gl.bindFramebuffer(gl.FRAMEBUFFER, this.framebuffer);\r\n\r\n    let i = 0;\r\n    gl.useProgram(this.program);\r\n    for (let p in this.constants) {\r\n      this.kernelConstants[i++].updateValue(this.constants[p]);\r\n    }\r\n\r\n    if (!this.immutable) {\r\n      this._setupOutputTexture();\r\n      if (\r\n        this.subKernels !== null &&\r\n        this.subKernels.length > 0\r\n      ) {\r\n        this._setupSubOutputTextures();\r\n      }\r\n    }\r\n  }\r\n\r\n  translateSource() {\r\n    const functionBuilder = FunctionBuilder.fromKernel(this, WebGLFunctionNode, {\r\n      fixIntegerDivisionAccuracy: this.fixIntegerDivisionAccuracy\r\n    });\r\n    this.translatedSource = functionBuilder.getPrototypeString('kernel');\r\n    if (!this.graphical && !this.returnType) {\r\n      this.returnType = functionBuilder.getKernelResultType();\r\n    }\r\n\r\n    if (this.subKernels && this.subKernels.length > 0) {\r\n      for (let i = 0; i < this.subKernels.length; i++) {\r\n        const subKernel = this.subKernels[i];\r\n        if (!subKernel.returnType) {\r\n          subKernel.returnType = functionBuilder.getSubKernelResultType(i);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  run() {\r\n    const { kernelArguments } = this;\r\n    const texSize = this.texSize;\r\n    const gl = this.context;\r\n\r\n    gl.useProgram(this.program);\r\n    gl.scissor(0, 0, texSize[0], texSize[1]);\r\n\r\n    if (this.dynamicOutput) {\r\n      this.setUniform3iv('uOutputDim', this.threadDim);\r\n      this.setUniform2iv('uTexSize', texSize);\r\n    }\r\n\r\n    this.setUniform2f('ratio', texSize[0] / this.maxTexSize[0], texSize[1] / this.maxTexSize[1]);\r\n\r\n    this.switchingKernels = false;\r\n    for (let i = 0; i < kernelArguments.length; i++) {\r\n      kernelArguments[i].updateValue(arguments[i]);\r\n      if (this.switchingKernels) return;\r\n    }\r\n\r\n    if (this.plugins) {\r\n      for (let i = 0; i < this.plugins.length; i++) {\r\n        const plugin = this.plugins[i];\r\n        if (plugin.onBeforeRun) {\r\n          plugin.onBeforeRun(this);\r\n        }\r\n      }\r\n    }\r\n\r\n    if (this.graphical) {\r\n      if (this.pipeline) {\r\n        gl.bindRenderbuffer(gl.RENDERBUFFER, null);\r\n        gl.bindFramebuffer(gl.FRAMEBUFFER, this.framebuffer);\r\n        if (!this.outputTexture || this.immutable) {\r\n          this._setupOutputTexture();\r\n        }\r\n        gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\r\n        return new this.TextureConstructor({\r\n          texture: this.outputTexture,\r\n          size: texSize,\r\n          dimensions: this.threadDim,\r\n          output: this.output,\r\n          context: this.context,\r\n        });\r\n      }\r\n      gl.bindRenderbuffer(gl.RENDERBUFFER, null);\r\n      gl.bindFramebuffer(gl.FRAMEBUFFER, null);\r\n      gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\r\n      return;\r\n    }\r\n\r\n    gl.bindFramebuffer(gl.FRAMEBUFFER, this.framebuffer);\r\n    if (this.immutable) {\r\n      this._setupOutputTexture();\r\n    }\r\n\r\n    if (this.subKernels !== null) {\r\n      if (this.immutable) {\r\n        this._setupSubOutputTextures();\r\n      }\r\n      this.extensions.WEBGL_draw_buffers.drawBuffersWEBGL(this.drawBuffersMap);\r\n    }\r\n\r\n    gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\r\n  }\r\n\r\n  /**\r\n   * @desc This return defined outputTexture, which is setup in .build(), or if immutable, is defined in .run()\r\n   * @returns {Object} Output Texture Cache\r\n   */\r\n  getOutputTexture() {\r\n    return this.outputTexture;\r\n  }\r\n\r\n  /**\r\n   * @desc Setup and replace output texture\r\n   */\r\n  _setupOutputTexture() {\r\n    const gl = this.context;\r\n    const texSize = this.texSize;\r\n    const texture = this.outputTexture = this.context.createTexture();\r\n    gl.activeTexture(gl.TEXTURE0 + this.constantTextureCount + this.argumentTextureCount);\r\n    gl.bindTexture(gl.TEXTURE_2D, texture);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\r\n    // if (this.precision === 'single') {\r\n    //   gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, texSize[0], texSize[1], 0, gl.RGBA, gl.FLOAT, null);\r\n    // } else {\r\n    //   gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, texSize[0], texSize[1], 0, gl.RGBA, gl.UNSIGNED_BYTE, null);\r\n    // }\r\n    if (this.precision === 'single') {\r\n      if (this.pipeline) {\r\n        // TODO: investigate if webgl1 can handle gl.RED usage in gl.texImage2D, otherwise, simplify the below\r\n        switch (this.returnType) {\r\n          case 'Number':\r\n          case 'Float':\r\n          case 'Integer':\r\n            if (this.optimizeFloatMemory) {\r\n              gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, texSize[0], texSize[1], 0, gl.RGBA, gl.FLOAT, null);\r\n            } else {\r\n              gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, texSize[0], texSize[1], 0, gl.RGBA, gl.FLOAT, null);\r\n            }\r\n            break;\r\n          case 'Array(2)':\r\n            gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, texSize[0], texSize[1], 0, gl.RGBA, gl.FLOAT, null);\r\n            break;\r\n          case 'Array(3)':\r\n            gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, texSize[0], texSize[1], 0, gl.RGBA, gl.FLOAT, null);\r\n            break;\r\n          case 'Array(4)':\r\n            gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, texSize[0], texSize[1], 0, gl.RGBA, gl.FLOAT, null);\r\n            break;\r\n          default:\r\n            if (!this.graphical) {\r\n              throw new Error('Unhandled return type');\r\n            }\r\n        }\r\n      } else {\r\n        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, texSize[0], texSize[1], 0, gl.RGBA, gl.FLOAT, null);\r\n      }\r\n    } else {\r\n      gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, texSize[0], texSize[1], 0, gl.RGBA, gl.UNSIGNED_BYTE, null);\r\n    }\r\n    gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, texture, 0);\r\n  }\r\n\r\n  /**\r\n   * @desc Setup and replace sub-output textures\r\n   */\r\n  _setupSubOutputTextures() {\r\n    const gl = this.context;\r\n    const texSize = this.texSize;\r\n    this.drawBuffersMap = [gl.COLOR_ATTACHMENT0];\r\n    this.subKernelOutputTextures = [];\r\n    for (let i = 0; i < this.subKernels.length; i++) {\r\n      const texture = this.context.createTexture();\r\n      this.subKernelOutputTextures.push(texture);\r\n      this.drawBuffersMap.push(gl.COLOR_ATTACHMENT0 + i + 1);\r\n      gl.activeTexture(gl.TEXTURE0 + this.constantTextureCount + this.argumentTextureCount + i);\r\n      gl.bindTexture(gl.TEXTURE_2D, texture);\r\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\r\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\r\n      if (this.precision === 'single') {\r\n        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, texSize[0], texSize[1], 0, gl.RGBA, gl.FLOAT, null);\r\n      } else {\r\n        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, texSize[0], texSize[1], 0, gl.RGBA, gl.UNSIGNED_BYTE, null);\r\n      }\r\n      gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0 + i + 1, gl.TEXTURE_2D, texture, 0);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @desc This uses *getTextureCache** to get the Texture Cache of the argument supplied\r\n   * @param {String} name - Name of the argument\r\n   */\r\n  getArgumentTexture(name) {\r\n    return this.getTextureCache(`ARGUMENT_${name}`);\r\n  }\r\n\r\n  /**\r\n   * @desc Returns the Texture Cache of the supplied parameter (can be kernel, sub-kernel or argument)\r\n   * @param {String} name - Name of the subkernel, argument, or kernel.\r\n   * @returns {Object} Texture cache\r\n   */\r\n  getTextureCache(name) {\r\n    if (this.textureCache.hasOwnProperty(name)) {\r\n      return this.textureCache[name];\r\n    }\r\n    return this.textureCache[name] = this.context.createTexture();\r\n  }\r\n\r\n  /**\r\n   * @desc removes a texture from the kernel's cache\r\n   * @param {String} name - Name of texture\r\n   */\r\n  detachTextureCache(name) {\r\n    delete this.textureCache[name];\r\n  }\r\n\r\n  setUniform1f(name, value) {\r\n    if (this.uniform1fCache.hasOwnProperty(name)) {\r\n      const cache = this.uniform1fCache[name];\r\n      if (value === cache) {\r\n        return;\r\n      }\r\n    }\r\n    this.uniform1fCache[name] = value;\r\n    const loc = this.getUniformLocation(name);\r\n    this.context.uniform1f(loc, value);\r\n  }\r\n\r\n  setUniform1i(name, value) {\r\n    if (this.uniform1iCache.hasOwnProperty(name)) {\r\n      const cache = this.uniform1iCache[name];\r\n      if (value === cache) {\r\n        return;\r\n      }\r\n    }\r\n    this.uniform1iCache[name] = value;\r\n    const loc = this.getUniformLocation(name);\r\n    this.context.uniform1i(loc, value);\r\n  }\r\n\r\n  setUniform2f(name, value1, value2) {\r\n    if (this.uniform2fCache.hasOwnProperty(name)) {\r\n      const cache = this.uniform2fCache[name];\r\n      if (\r\n        value1 === cache[0] &&\r\n        value2 === cache[1]\r\n      ) {\r\n        return;\r\n      }\r\n    }\r\n    this.uniform2fCache[name] = [value1, value2];\r\n    const loc = this.getUniformLocation(name);\r\n    this.context.uniform2f(loc, value1, value2);\r\n  }\r\n\r\n  setUniform2fv(name, value) {\r\n    if (this.uniform2fvCache.hasOwnProperty(name)) {\r\n      const cache = this.uniform2fvCache[name];\r\n      if (\r\n        value[0] === cache[0] &&\r\n        value[1] === cache[1]\r\n      ) {\r\n        return;\r\n      }\r\n    }\r\n    this.uniform2fvCache[name] = value;\r\n    const loc = this.getUniformLocation(name);\r\n    this.context.uniform2fv(loc, value);\r\n  }\r\n\r\n  setUniform2iv(name, value) {\r\n    if (this.uniform2ivCache.hasOwnProperty(name)) {\r\n      const cache = this.uniform2ivCache[name];\r\n      if (\r\n        value[0] === cache[0] &&\r\n        value[1] === cache[1]\r\n      ) {\r\n        return;\r\n      }\r\n    }\r\n    this.uniform2ivCache[name] = value;\r\n    const loc = this.getUniformLocation(name);\r\n    this.context.uniform2iv(loc, value);\r\n  }\r\n\r\n  setUniform3fv(name, value) {\r\n    if (this.uniform3fvCache.hasOwnProperty(name)) {\r\n      const cache = this.uniform3fvCache[name];\r\n      if (\r\n        value[0] === cache[0] &&\r\n        value[1] === cache[1] &&\r\n        value[2] === cache[2]\r\n      ) {\r\n        return;\r\n      }\r\n    }\r\n    this.uniform3fvCache[name] = value;\r\n    const loc = this.getUniformLocation(name);\r\n    this.context.uniform3fv(loc, value);\r\n  }\r\n\r\n  setUniform3iv(name, value) {\r\n    if (this.uniform3ivCache.hasOwnProperty(name)) {\r\n      const cache = this.uniform3ivCache[name];\r\n      if (\r\n        value[0] === cache[0] &&\r\n        value[1] === cache[1] &&\r\n        value[2] === cache[2]\r\n      ) {\r\n        return;\r\n      }\r\n    }\r\n    this.uniform3ivCache[name] = value;\r\n    const loc = this.getUniformLocation(name);\r\n    this.context.uniform3iv(loc, value);\r\n  }\r\n\r\n  setUniform3fv(name, value) {\r\n    if (this.uniform3fvCache.hasOwnProperty(name)) {\r\n      const cache = this.uniform3fvCache[name];\r\n      if (\r\n        value[0] === cache[0] &&\r\n        value[1] === cache[1] &&\r\n        value[2] === cache[2]\r\n      ) {\r\n        return;\r\n      }\r\n    }\r\n    this.uniform3fvCache[name] = value;\r\n    const loc = this.getUniformLocation(name);\r\n    this.context.uniform3fv(loc, value);\r\n  }\r\n\r\n  setUniform4iv(name, value) {\r\n    if (this.uniform4ivCache.hasOwnProperty(name)) {\r\n      const cache = this.uniform4ivCache[name];\r\n      if (\r\n        value[0] === cache[0] &&\r\n        value[1] === cache[1] &&\r\n        value[2] === cache[2] &&\r\n        value[3] === cache[3]\r\n      ) {\r\n        return;\r\n      }\r\n    }\r\n    this.uniform4ivCache[name] = value;\r\n    const loc = this.getUniformLocation(name);\r\n    this.context.uniform4iv(loc, value);\r\n  }\r\n\r\n  setUniform4fv(name, value) {\r\n    if (this.uniform4fvCache.hasOwnProperty(name)) {\r\n      const cache = this.uniform4fvCache[name];\r\n      if (\r\n        value[0] === cache[0] &&\r\n        value[1] === cache[1] &&\r\n        value[2] === cache[2] &&\r\n        value[3] === cache[3]\r\n      ) {\r\n        return;\r\n      }\r\n    }\r\n    this.uniform4fvCache[name] = value;\r\n    const loc = this.getUniformLocation(name);\r\n    this.context.uniform4fv(loc, value);\r\n  }\r\n\r\n  /**\r\n   * @desc Return WebGlUniformLocation for various variables\r\n   * related to webGl program, such as user-defined variables,\r\n   * as well as, dimension sizes, etc.\r\n   */\r\n  getUniformLocation(name) {\r\n    if (this.programUniformLocationCache.hasOwnProperty(name)) {\r\n      return this.programUniformLocationCache[name];\r\n    }\r\n    return this.programUniformLocationCache[name] = this.context.getUniformLocation(this.program, name);\r\n  }\r\n\r\n  /**\r\n   * @desc Generate Shader artifacts for the kernel program.\r\n   * The final object contains HEADER, KERNEL, MAIN_RESULT, and others.\r\n   *\r\n   * @param {Array} args - The actual parameters sent to the Kernel\r\n   * @returns {Object} An object containing the Shader Artifacts(CONSTANTS, HEADER, KERNEL, etc.)\r\n   */\r\n  _getFragShaderArtifactMap(args) {\r\n    return {\r\n      HEADER: this._getHeaderString(),\r\n      LOOP_MAX: this._getLoopMaxString(),\r\n      PLUGINS: this._getPluginsString(),\r\n      CONSTANTS: this._getConstantsString(),\r\n      DECODE32_ENDIANNESS: this._getDecode32EndiannessString(),\r\n      ENCODE32_ENDIANNESS: this._getEncode32EndiannessString(),\r\n      DIVIDE_WITH_INTEGER_CHECK: this._getDivideWithIntegerCheckString(),\r\n      INJECTED_NATIVE: this._getInjectedNative(),\r\n      MAIN_CONSTANTS: this._getMainConstantsString(),\r\n      MAIN_ARGUMENTS: this._getMainArgumentsString(args),\r\n      KERNEL: this.getKernelString(),\r\n      MAIN_RESULT: this.getMainResultString(),\r\n      FLOAT_TACTIC_DECLARATION: this.getFloatTacticDeclaration(),\r\n      INT_TACTIC_DECLARATION: this.getIntTacticDeclaration(),\r\n      SAMPLER_2D_TACTIC_DECLARATION: this.getSampler2DTacticDeclaration(),\r\n      SAMPLER_2D_ARRAY_TACTIC_DECLARATION: this.getSampler2DArrayTacticDeclaration(),\r\n    };\r\n  }\r\n\r\n  /**\r\n   * @desc Generate Shader artifacts for the kernel program.\r\n   * The final object contains HEADER, KERNEL, MAIN_RESULT, and others.\r\n   *\r\n   * @param {Array} args - The actual parameters sent to the Kernel\r\n   * @returns {Object} An object containing the Shader Artifacts(CONSTANTS, HEADER, KERNEL, etc.)\r\n   */\r\n  _getVertShaderArtifactMap(args) {\r\n    return {\r\n      FLOAT_TACTIC_DECLARATION: this.getFloatTacticDeclaration(),\r\n      INT_TACTIC_DECLARATION: this.getIntTacticDeclaration(),\r\n      SAMPLER_2D_TACTIC_DECLARATION: this.getSampler2DTacticDeclaration(),\r\n      SAMPLER_2D_ARRAY_TACTIC_DECLARATION: this.getSampler2DArrayTacticDeclaration(),\r\n    };\r\n  }\r\n\r\n  /**\r\n   * @desc Get the header string for the program.\r\n   * This returns an empty string if no sub-kernels are defined.\r\n   *\r\n   * @returns {String} result\r\n   */\r\n  _getHeaderString() {\r\n    return (\r\n      this.subKernels !== null ?\r\n      '#extension GL_EXT_draw_buffers : require\\n' :\r\n      ''\r\n    );\r\n  }\r\n\r\n  /**\r\n   * @desc Get the maximum loop size String.\r\n   * @returns {String} result\r\n   */\r\n  _getLoopMaxString() {\r\n    return (\r\n      this.loopMaxIterations ?\r\n      ` ${parseInt(this.loopMaxIterations)};\\n` :\r\n      ' 1000;\\n'\r\n    );\r\n  }\r\n\r\n  _getPluginsString() {\r\n    if (!this.plugins) return '\\n';\r\n    return this.plugins.map(plugin => plugin.source && this.source.match(plugin.functionMatch) ? plugin.source : '').join('\\n');\r\n  }\r\n\r\n  /**\r\n   * @desc Generate transpiled glsl Strings for constant parameters sent to a kernel\r\n   * @returns {String} result\r\n   */\r\n  _getConstantsString() {\r\n    const result = [];\r\n    const { threadDim, texSize } = this;\r\n    if (this.dynamicOutput) {\r\n      result.push(\r\n        'uniform ivec3 uOutputDim',\r\n        'uniform ivec2 uTexSize'\r\n      );\r\n    } else {\r\n      result.push(\r\n        `ivec3 uOutputDim = ivec3(${threadDim[0]}, ${threadDim[1]}, ${threadDim[2]})`,\r\n        `ivec2 uTexSize = ivec2(${texSize[0]}, ${texSize[1]})`\r\n      );\r\n    }\r\n    return utils.linesToString(result);\r\n  }\r\n\r\n  /**\r\n   * @desc Get texture coordinate string for the program\r\n   * @returns {String} result\r\n   */\r\n  _getTextureCoordinate() {\r\n    const subKernels = this.subKernels;\r\n    if (subKernels === null || subKernels.length < 1) {\r\n      return 'varying vec2 vTexCoord;\\n';\r\n    } else {\r\n      return 'out vec2 vTexCoord;\\n';\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @desc Get Decode32 endianness string for little-endian and big-endian\r\n   * @returns {String} result\r\n   */\r\n  _getDecode32EndiannessString() {\r\n    return (\r\n      this.endianness === 'LE' ?\r\n      '' :\r\n      '  texel.rgba = texel.abgr;\\n'\r\n    );\r\n  }\r\n\r\n  /**\r\n   * @desc Get Encode32 endianness string for little-endian and big-endian\r\n   * @returns {String} result\r\n   */\r\n  _getEncode32EndiannessString() {\r\n    return (\r\n      this.endianness === 'LE' ?\r\n      '' :\r\n      '  texel.rgba = texel.abgr;\\n'\r\n    );\r\n  }\r\n\r\n  /**\r\n   * @desc if fixIntegerDivisionAccuracy provide method to replace /\r\n   * @returns {String} result\r\n   */\r\n  _getDivideWithIntegerCheckString() {\r\n    return this.fixIntegerDivisionAccuracy ?\r\n      `float div_with_int_check(float x, float y) {\r\n  if (floor(x) == x && floor(y) == y && integerMod(x, y) == 0.0) {\r\n    return float(int(x)/int(y));\r\n  }\r\n  return x / y;\r\n}` :\r\n      '';\r\n  }\r\n\r\n  /**\r\n   * @desc Generate transpiled glsl Strings for user-defined parameters sent to a kernel\r\n   * @param {Array} args - The actual parameters sent to the Kernel\r\n   * @returns {String} result\r\n   */\r\n  _getMainArgumentsString(args) {\r\n    const results = [];\r\n    const { argumentNames } = this;\r\n    for (let i = 0; i < argumentNames.length; i++) {\r\n      results.push(this.kernelArguments[i].getSource(args[i]));\r\n    }\r\n    return results.join('');\r\n  }\r\n\r\n  _getInjectedNative() {\r\n    return this.injectedNative || '';\r\n  }\r\n\r\n  _getMainConstantsString() {\r\n    const result = [];\r\n    const { constants } = this;\r\n    if (constants) {\r\n      let i = 0;\r\n      for (const name in constants) {\r\n        result.push(this.kernelConstants[i++].getSource(this.constants[name]));\r\n      }\r\n    }\r\n    return result.join('');\r\n  }\r\n\r\n  /**\r\n   * @desc Get Kernel program string (in *glsl*) for a kernel.\r\n   * @returns {String} result\r\n   */\r\n  getKernelString() {\r\n    let kernelResultDeclaration;\r\n    switch (this.returnType) {\r\n      case 'Array(2)':\r\n        kernelResultDeclaration = 'vec2 kernelResult';\r\n        break;\r\n      case 'Array(3)':\r\n        kernelResultDeclaration = 'vec3 kernelResult';\r\n        break;\r\n      case 'Array(4)':\r\n        kernelResultDeclaration = 'vec4 kernelResult';\r\n        break;\r\n      case 'LiteralInteger':\r\n      case 'Float':\r\n      case 'Number':\r\n      case 'Integer':\r\n        kernelResultDeclaration = 'float kernelResult';\r\n        break;\r\n      default:\r\n        if (this.graphical) {\r\n          kernelResultDeclaration = 'float kernelResult';\r\n        } else {\r\n          throw new Error(`unrecognized output type \"${ this.returnType }\"`);\r\n        }\r\n    }\r\n\r\n    const result = [];\r\n    const subKernels = this.subKernels;\r\n    if (subKernels !== null) {\r\n      result.push(\r\n        kernelResultDeclaration\r\n      );\r\n      switch (this.returnType) {\r\n        case 'Number':\r\n        case 'Float':\r\n        case 'Integer':\r\n          for (let i = 0; i < subKernels.length; i++) {\r\n            const subKernel = subKernels[i];\r\n            result.push(\r\n              subKernel.returnType === 'Integer' ?\r\n              `int subKernelResult_${ subKernel.name } = 0` :\r\n              `float subKernelResult_${ subKernel.name } = 0.0`\r\n            );\r\n          }\r\n          break;\r\n        case 'Array(2)':\r\n          for (let i = 0; i < subKernels.length; i++) {\r\n            result.push(\r\n              `vec2 subKernelResult_${ subKernels[i].name }`\r\n            );\r\n          }\r\n          break;\r\n        case 'Array(3)':\r\n          for (let i = 0; i < subKernels.length; i++) {\r\n            result.push(\r\n              `vec3 subKernelResult_${ subKernels[i].name }`\r\n            );\r\n          }\r\n          break;\r\n        case 'Array(4)':\r\n          for (let i = 0; i < subKernels.length; i++) {\r\n            result.push(\r\n              `vec4 subKernelResult_${ subKernels[i].name }`\r\n            );\r\n          }\r\n          break;\r\n      }\r\n    } else {\r\n      result.push(\r\n        kernelResultDeclaration\r\n      );\r\n    }\r\n\r\n    return utils.linesToString(result) + this.translatedSource;\r\n  }\r\n\r\n  getMainResultGraphical() {\r\n    return utils.linesToString([\r\n      '  threadId = indexTo3D(index, uOutputDim)',\r\n      '  kernel()',\r\n      '  gl_FragColor = actualColor',\r\n    ]);\r\n  }\r\n\r\n  getMainResultPackedPixels() {\r\n    switch (this.returnType) {\r\n      case 'LiteralInteger':\r\n      case 'Number':\r\n      case 'Integer':\r\n      case 'Float':\r\n        return this.getMainResultKernelPackedPixels() +\r\n          this.getMainResultSubKernelPackedPixels();\r\n      default:\r\n        throw new Error(`packed output only usable with Numbers, \"${this.returnType}\" specified`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @return {String}\r\n   */\r\n  getMainResultKernelPackedPixels() {\r\n    return utils.linesToString([\r\n      '  threadId = indexTo3D(index, uOutputDim)',\r\n      '  kernel()',\r\n      `  gl_FragData[0] = ${this.useLegacyEncoder ? 'legacyEncode32' : 'encode32'}(kernelResult)`\r\n    ]);\r\n  }\r\n\r\n  /**\r\n   * @return {String}\r\n   */\r\n  getMainResultSubKernelPackedPixels() {\r\n    const result = [];\r\n    if (!this.subKernels) return '';\r\n    for (let i = 0; i < this.subKernels.length; i++) {\r\n      const subKernel = this.subKernels[i];\r\n      if (subKernel.returnType === 'Integer') {\r\n        result.push(\r\n          `  gl_FragData[${i + 1}] = ${this.useLegacyEncoder ? 'legacyEncode32' : 'encode32'}(float(subKernelResult_${this.subKernels[i].name}))`\r\n        );\r\n      } else {\r\n        result.push(\r\n          `  gl_FragData[${i + 1}] = ${this.useLegacyEncoder ? 'legacyEncode32' : 'encode32'}(subKernelResult_${this.subKernels[i].name})`\r\n        );\r\n      }\r\n    }\r\n    return utils.linesToString(result);\r\n  }\r\n\r\n  getMainResultMemoryOptimizedFloats() {\r\n    const result = [\r\n      '  index *= 4',\r\n    ];\r\n\r\n    switch (this.returnType) {\r\n      case 'Number':\r\n      case 'Integer':\r\n      case 'Float':\r\n        const channels = ['r', 'g', 'b', 'a'];\r\n        for (let i = 0; i < channels.length; i++) {\r\n          const channel = channels[i];\r\n          this.getMainResultKernelMemoryOptimizedFloats(result, channel);\r\n          this.getMainResultSubKernelMemoryOptimizedFloats(result, channel);\r\n          if (i + 1 < channels.length) {\r\n            result.push('  index += 1');\r\n          }\r\n        }\r\n        break;\r\n      default:\r\n        throw new Error(`optimized output only usable with Numbers, ${this.returnType} specified`);\r\n    }\r\n\r\n    return utils.linesToString(result);\r\n  }\r\n\r\n  getMainResultKernelMemoryOptimizedFloats(result, channel) {\r\n    result.push(\r\n      '  threadId = indexTo3D(index, uOutputDim)',\r\n      '  kernel()',\r\n      `  gl_FragData[0].${channel} = kernelResult`,\r\n    );\r\n  }\r\n\r\n  getMainResultSubKernelMemoryOptimizedFloats(result, channel) {\r\n    if (!this.subKernels) return result;\r\n    for (let i = 0; i < this.subKernels.length; i++) {\r\n      const subKernel = this.subKernels[i];\r\n      if (subKernel.returnType === 'Integer') {\r\n        result.push(\r\n          `  gl_FragData[${i + 1}].${channel} = float(subKernelResult_${this.subKernels[i].name})`,\r\n        );\r\n      } else {\r\n        result.push(\r\n          `  gl_FragData[${i + 1}].${channel} = subKernelResult_${this.subKernels[i].name}`,\r\n        );\r\n      }\r\n    }\r\n  }\r\n\r\n  getMainResultKernelNumberTexture() {\r\n    return [\r\n      '  threadId = indexTo3D(index, uOutputDim)',\r\n      '  kernel()',\r\n      '  gl_FragData[0][0] = kernelResult',\r\n    ];\r\n  }\r\n\r\n  getMainResultSubKernelNumberTexture() {\r\n    const result = [];\r\n    if (!this.subKernels) return result;\r\n    for (let i = 0; i < this.subKernels.length; ++i) {\r\n      const subKernel = this.subKernels[i];\r\n      if (subKernel.returnType === 'Integer') {\r\n        result.push(\r\n          `  gl_FragData[${i + 1}][0] = float(subKernelResult_${subKernel.name})`,\r\n        );\r\n      } else {\r\n        result.push(\r\n          `  gl_FragData[${i + 1}][0] = subKernelResult_${subKernel.name}`,\r\n        );\r\n      }\r\n    }\r\n    return result;\r\n  }\r\n\r\n  getMainResultKernelArray2Texture() {\r\n    return [\r\n      '  threadId = indexTo3D(index, uOutputDim)',\r\n      '  kernel()',\r\n      '  gl_FragData[0][0] = kernelResult[0]',\r\n      '  gl_FragData[0][1] = kernelResult[1]',\r\n    ];\r\n  }\r\n\r\n  getMainResultSubKernelArray2Texture() {\r\n    const result = [];\r\n    if (!this.subKernels) return result;\r\n    for (let i = 0; i < this.subKernels.length; ++i) {\r\n      result.push(\r\n        `  gl_FragData[${i + 1}][0] = subKernelResult_${this.subKernels[i].name}[0]`,\r\n        `  gl_FragData[${i + 1}][1] = subKernelResult_${this.subKernels[i].name}[1]`,\r\n      );\r\n    }\r\n    return result;\r\n  }\r\n\r\n  getMainResultKernelArray3Texture() {\r\n    return [\r\n      '  threadId = indexTo3D(index, uOutputDim)',\r\n      '  kernel()',\r\n      '  gl_FragData[0][0] = kernelResult[0]',\r\n      '  gl_FragData[0][1] = kernelResult[1]',\r\n      '  gl_FragData[0][2] = kernelResult[2]',\r\n    ];\r\n  }\r\n\r\n  getMainResultSubKernelArray3Texture() {\r\n    const result = [];\r\n    if (!this.subKernels) return result;\r\n    for (let i = 0; i < this.subKernels.length; ++i) {\r\n      result.push(\r\n        `  gl_FragData[${i + 1}][0] = subKernelResult_${this.subKernels[i].name}[0]`,\r\n        `  gl_FragData[${i + 1}][1] = subKernelResult_${this.subKernels[i].name}[1]`,\r\n        `  gl_FragData[${i + 1}][2] = subKernelResult_${this.subKernels[i].name}[2]`,\r\n      );\r\n    }\r\n    return result;\r\n  }\r\n\r\n  getMainResultKernelArray4Texture() {\r\n    return [\r\n      '  threadId = indexTo3D(index, uOutputDim)',\r\n      '  kernel()',\r\n      '  gl_FragData[0] = kernelResult',\r\n    ];\r\n  }\r\n\r\n  getMainResultSubKernelArray4Texture() {\r\n    const result = [];\r\n    if (!this.subKernels) return result;\r\n    switch (this.returnType) {\r\n      case 'Number':\r\n      case 'Float':\r\n      case 'Integer':\r\n        for (let i = 0; i < this.subKernels.length; ++i) {\r\n          const subKernel = this.subKernels[i];\r\n          if (subKernel.returnType === 'Integer') {\r\n            result.push(\r\n              `  gl_FragData[${i + 1}] = float(subKernelResult_${this.subKernels[i].name})`,\r\n            );\r\n          } else {\r\n            result.push(\r\n              `  gl_FragData[${i + 1}] = subKernelResult_${this.subKernels[i].name}`,\r\n            );\r\n          }\r\n        }\r\n        break;\r\n      case 'Array(2)':\r\n        for (let i = 0; i < this.subKernels.length; ++i) {\r\n          result.push(\r\n            `  gl_FragData[${i + 1}][0] = subKernelResult_${this.subKernels[i].name}[0]`,\r\n            `  gl_FragData[${i + 1}][1] = subKernelResult_${this.subKernels[i].name}[1]`,\r\n          );\r\n        }\r\n        break;\r\n      case 'Array(3)':\r\n        for (let i = 0; i < this.subKernels.length; ++i) {\r\n          result.push(\r\n            `  gl_FragData[${i + 1}][0] = subKernelResult_${this.subKernels[i].name}[0]`,\r\n            `  gl_FragData[${i + 1}][1] = subKernelResult_${this.subKernels[i].name}[1]`,\r\n            `  gl_FragData[${i + 1}][2] = subKernelResult_${this.subKernels[i].name}[2]`,\r\n          );\r\n        }\r\n        break;\r\n      case 'Array(4)':\r\n        for (let i = 0; i < this.subKernels.length; ++i) {\r\n          result.push(\r\n            `  gl_FragData[${i + 1}][0] = subKernelResult_${this.subKernels[i].name}[0]`,\r\n            `  gl_FragData[${i + 1}][1] = subKernelResult_${this.subKernels[i].name}[1]`,\r\n            `  gl_FragData[${i + 1}][2] = subKernelResult_${this.subKernels[i].name}[2]`,\r\n            `  gl_FragData[${i + 1}][3] = subKernelResult_${this.subKernels[i].name}[3]`,\r\n          );\r\n        }\r\n        break;\r\n    }\r\n\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * @param {String} src - Shader string\r\n   * @param {Object} map - Variables/Constants associated with shader\r\n   */\r\n  replaceArtifacts(src, map) {\r\n    return src.replace(/[ ]*__([A-Z]+[0-9]*([_]?[A-Z]*[0-9]?)*)__;\\n/g, (match, artifact) => {\r\n      if (map.hasOwnProperty(artifact)) {\r\n        return map[artifact];\r\n      }\r\n      throw `unhandled artifact ${artifact}`;\r\n    });\r\n  }\r\n\r\n  /**\r\n   * @desc Get the fragment shader String.\r\n   * If the String hasn't been compiled yet,\r\n   * then this method compiles it as well\r\n   *\r\n   * @param {Array} args - The actual parameters sent to the Kernel\r\n   * @returns {string} Fragment Shader string\r\n   */\r\n  getFragmentShader(args) {\r\n    if (this.compiledFragmentShader !== null) {\r\n      return this.compiledFragmentShader;\r\n    }\r\n    return this.compiledFragmentShader = this.replaceArtifacts(this.constructor.fragmentShader, this._getFragShaderArtifactMap(args));\r\n  }\r\n\r\n  /**\r\n   * @desc Get the vertical shader String\r\n   * @param {Array|IArguments} args - The actual parameters sent to the Kernel\r\n   * @returns {string} Vertical Shader string\r\n   */\r\n  getVertexShader(args) {\r\n    if (this.compiledVertexShader !== null) {\r\n      return this.compiledVertexShader;\r\n    }\r\n    return this.compiledVertexShader = this.replaceArtifacts(this.constructor.vertexShader, this._getVertShaderArtifactMap(args));\r\n  }\r\n\r\n  /**\r\n   * @desc Returns the *pre-compiled* Kernel as a JS Object String, that can be reused.\r\n   */\r\n  toString() {\r\n    const setupContextString = utils.linesToString([\r\n      `const gl = context`,\r\n    ]);\r\n    return glKernelString(this.constructor, arguments, this, setupContextString);\r\n  }\r\n\r\n  destroy(removeCanvasReferences) {\r\n    if (this.outputTexture) {\r\n      this.context.deleteTexture(this.outputTexture);\r\n    }\r\n    if (this.buffer) {\r\n      this.context.deleteBuffer(this.buffer);\r\n    }\r\n    if (this.framebuffer) {\r\n      this.context.deleteFramebuffer(this.framebuffer);\r\n    }\r\n    if (this.vertShader) {\r\n      this.context.deleteShader(this.vertShader);\r\n    }\r\n    if (this.fragShader) {\r\n      this.context.deleteShader(this.fragShader);\r\n    }\r\n    if (this.program) {\r\n      this.context.deleteProgram(this.program);\r\n    }\r\n\r\n    const keys = Object.keys(this.textureCache);\r\n\r\n    for (let i = 0; i < keys.length; i++) {\r\n      const name = keys[i];\r\n      this.context.deleteTexture(this.textureCache[name]);\r\n    }\r\n\r\n    if (this.subKernelOutputTextures) {\r\n      for (let i = 0; i < this.subKernelOutputTextures.length; i++) {\r\n        this.context.deleteTexture(this.subKernelOutputTextures[i]);\r\n      }\r\n    }\r\n    if (removeCanvasReferences) {\r\n      const idx = canvases.indexOf(this.canvas);\r\n      if (idx >= 0) {\r\n        canvases[idx] = null;\r\n        maxTexSizes[idx] = null;\r\n      }\r\n    }\r\n    this.destroyExtensions();\r\n    delete this.context;\r\n    delete this.canvas;\r\n  }\r\n\r\n  destroyExtensions() {\r\n    this.extensions.OES_texture_float = null;\r\n    this.extensions.OES_texture_float_linear = null;\r\n    this.extensions.OES_element_index_uint = null;\r\n    this.extensions.WEBGL_draw_buffers = null;\r\n  }\r\n\r\n  static destroyContext(context) {\r\n    const extension = context.getExtension('WEBGL_lose_context');\r\n    if (extension) {\r\n      extension.loseContext();\r\n    }\r\n  }\r\n\r\n  toJSON() {\r\n    const json = super.toJSON();\r\n    json.functionNodes = FunctionBuilder.fromKernel(this, WebGLFunctionNode).toJSON();\r\n    return json;\r\n  }\r\n}\r\n","import { WebGLFunctionNode } from '../web-gl/function-node';\r\n\r\n/**\r\n * @class WebGL2FunctionNode\r\n * @desc [INTERNAL] Takes in a function node, and does all the AST voodoo required to toString its respective webGL code.\r\n * @extends WebGLFunctionNode\r\n * @returns the converted webGL function string\r\n */\r\nexport class WebGL2FunctionNode extends WebGLFunctionNode {\r\n\r\n  /**\r\n   * @desc Parses the abstract syntax tree for *identifier* expression\r\n   * @param {Object} idtNode - An ast Node\r\n   * @param {Array} retArr - return array string\r\n   * @returns {Array} the append retArr\r\n   */\r\n  astIdentifierExpression(idtNode, retArr) {\r\n    if (idtNode.type !== 'Identifier') {\r\n      throw this.astErrorOutput(\r\n        'IdentifierExpression - not an Identifier',\r\n        idtNode\r\n      );\r\n    }\r\n\r\n    const type = this.getType(idtNode);\r\n\r\n    if (idtNode.name === 'Infinity') {\r\n      retArr.push('intBitsToFloat(2139095039)');\r\n    } else if (type === 'Boolean') {\r\n      if (this.argumentNames.indexOf(idtNode.name) > -1) {\r\n        retArr.push(`bool(user_${idtNode.name})`);\r\n      } else {\r\n        retArr.push(`user_${idtNode.name}`);\r\n      }\r\n    } else {\r\n      const userArgumentName = this.getKernelArgumentName(idtNode.name);\r\n      if (userArgumentName) {\r\n        retArr.push(`user_${userArgumentName}`);\r\n      } else {\r\n        retArr.push(`user_${idtNode.name}`);\r\n      }\r\n    }\r\n\r\n    return retArr;\r\n  }\r\n}\r\n","// language=GLSL\r\nexport const fragmentShader = `#version 300 es\r\n__HEADER__;\r\n__FLOAT_TACTIC_DECLARATION__;\r\n__INT_TACTIC_DECLARATION__;\r\n__SAMPLER_2D_TACTIC_DECLARATION__;\r\n__SAMPLER_2D_ARRAY_TACTIC_DECLARATION__;\r\n\r\nconst int LOOP_MAX = __LOOP_MAX__;\r\n\r\n__PLUGINS__;\r\n__CONSTANTS__;\r\n\r\nin vec2 vTexCoord;\r\n\r\nconst int BIT_COUNT = 32;\r\nint modi(int x, int y) {\r\n  return x - y * (x / y);\r\n}\r\n\r\nint bitwiseOr(int a, int b) {\r\n  int result = 0;\r\n  int n = 1;\r\n\r\n  for (int i = 0; i < BIT_COUNT; i++) {\r\n    if ((modi(a, 2) == 1) || (modi(b, 2) == 1)) {\r\n      result += n;\r\n    }\r\n    a = a / 2;\r\n    b = b / 2;\r\n    n = n * 2;\r\n    if(!(a > 0 || b > 0)) {\r\n      break;\r\n    }\r\n  }\r\n  return result;\r\n}\r\nint bitwiseXOR(int a, int b) {\r\n  int result = 0;\r\n  int n = 1;\r\n\r\n  for (int i = 0; i < BIT_COUNT; i++) {\r\n    if ((modi(a, 2) == 1) != (modi(b, 2) == 1)) {\r\n      result += n;\r\n    }\r\n    a = a / 2;\r\n    b = b / 2;\r\n    n = n * 2;\r\n    if(!(a > 0 || b > 0)) {\r\n      break;\r\n    }\r\n  }\r\n  return result;\r\n}\r\nint bitwiseAnd(int a, int b) {\r\n  int result = 0;\r\n  int n = 1;\r\n  for (int i = 0; i < BIT_COUNT; i++) {\r\n    if ((modi(a, 2) == 1) && (modi(b, 2) == 1)) {\r\n      result += n;\r\n    }\r\n    a = a / 2;\r\n    b = b / 2;\r\n    n = n * 2;\r\n    if(!(a > 0 && b > 0)) {\r\n      break;\r\n    }\r\n  }\r\n  return result;\r\n}\r\nint bitwiseNot(int a) {\r\n  int result = 0;\r\n  int n = 1;\r\n\r\n  for (int i = 0; i < BIT_COUNT; i++) {\r\n    if (modi(a, 2) == 0) {\r\n      result += n;\r\n    }\r\n    a = a / 2;\r\n    n = n * 2;\r\n  }\r\n  return result;\r\n}\r\nint bitwiseZeroFillLeftShift(int n, int shift) {\r\n  int maxBytes = BIT_COUNT;\r\n  for (int i = 0; i < BIT_COUNT; i++) {\r\n    if (maxBytes >= n) {\r\n      break;\r\n    }\r\n    maxBytes *= 2;\r\n  }\r\n  for (int i = 0; i < BIT_COUNT; i++) {\r\n    if (i >= shift) {\r\n      break;\r\n    }\r\n    n *= 2;\r\n  }\r\n\r\n  int result = 0;\r\n  int byteVal = 1;\r\n  for (int i = 0; i < BIT_COUNT; i++) {\r\n    if (i >= maxBytes) break;\r\n    if (modi(n, 2) > 0) { result += byteVal; }\r\n    n = int(n / 2);\r\n    byteVal *= 2;\r\n  }\r\n  return result;\r\n}\r\n\r\nint bitwiseSignedRightShift(int num, int shifts) {\r\n  return int(floor(float(num) / pow(2.0, float(shifts))));\r\n}\r\n\r\nint bitwiseZeroFillRightShift(int n, int shift) {\r\n  int maxBytes = BIT_COUNT;\r\n  for (int i = 0; i < BIT_COUNT; i++) {\r\n    if (maxBytes >= n) {\r\n      break;\r\n    }\r\n    maxBytes *= 2;\r\n  }\r\n  for (int i = 0; i < BIT_COUNT; i++) {\r\n    if (i >= shift) {\r\n      break;\r\n    }\r\n    n /= 2;\r\n  }\r\n  int result = 0;\r\n  int byteVal = 1;\r\n  for (int i = 0; i < BIT_COUNT; i++) {\r\n    if (i >= maxBytes) break;\r\n    if (modi(n, 2) > 0) { result += byteVal; }\r\n    n = int(n / 2);\r\n    byteVal *= 2;\r\n  }\r\n  return result;\r\n}\r\n\r\nvec2 integerMod(vec2 x, float y) {\r\n  vec2 res = floor(mod(x, y));\r\n  return res * step(1.0 - floor(y), -res);\r\n}\r\n\r\nvec3 integerMod(vec3 x, float y) {\r\n  vec3 res = floor(mod(x, y));\r\n  return res * step(1.0 - floor(y), -res);\r\n}\r\n\r\nvec4 integerMod(vec4 x, vec4 y) {\r\n  vec4 res = floor(mod(x, y));\r\n  return res * step(1.0 - floor(y), -res);\r\n}\r\n\r\nfloat integerMod(float x, float y) {\r\n  float res = floor(mod(x, y));\r\n  return res * (res > floor(y) - 1.0 ? 0.0 : 1.0);\r\n}\r\n\r\nint integerMod(int x, int y) {\r\n  return x - (y * int(x/y));\r\n}\r\n\r\n__DIVIDE_WITH_INTEGER_CHECK__;\r\n\r\n// Here be dragons!\r\n// DO NOT OPTIMIZE THIS CODE\r\n// YOU WILL BREAK SOMETHING ON SOMEBODY\\'S MACHINE\r\n// LEAVE IT AS IT IS, LEST YOU WASTE YOUR OWN TIME\r\nconst vec2 MAGIC_VEC = vec2(1.0, -256.0);\r\nconst vec4 SCALE_FACTOR = vec4(1.0, 256.0, 65536.0, 0.0);\r\nconst vec4 SCALE_FACTOR_INV = vec4(1.0, 0.00390625, 0.0000152587890625, 0.0); // 1, 1/256, 1/65536\r\nfloat decode32(vec4 texel) {\r\n  __DECODE32_ENDIANNESS__;\r\n  texel *= 255.0;\r\n  vec2 gte128;\r\n  gte128.x = texel.b >= 128.0 ? 1.0 : 0.0;\r\n  gte128.y = texel.a >= 128.0 ? 1.0 : 0.0;\r\n  float exponent = 2.0 * texel.a - 127.0 + dot(gte128, MAGIC_VEC);\r\n  float res = exp2(round(exponent));\r\n  texel.b = texel.b - 128.0 * gte128.x;\r\n  res = dot(texel, SCALE_FACTOR) * exp2(round(exponent-23.0)) + res;\r\n  res *= gte128.y * -2.0 + 1.0;\r\n  return res;\r\n}\r\n\r\nfloat decode16(vec4 texel, int index) {\r\n  int channel = integerMod(index, 2);\r\n  return texel[channel*2] * 255.0 + texel[channel*2 + 1] * 65280.0;\r\n}\r\n\r\nfloat decode8(vec4 texel, int index) {\r\n  int channel = integerMod(index, 4);\r\n  return texel[channel] * 255.0;\r\n}\r\n\r\nvec4 legacyEncode32(float f) {\r\n  float F = abs(f);\r\n  float sign = f < 0.0 ? 1.0 : 0.0;\r\n  float exponent = floor(log2(F));\r\n  float mantissa = (exp2(-exponent) * F);\r\n  // exponent += floor(log2(mantissa));\r\n  vec4 texel = vec4(F * exp2(23.0-exponent)) * SCALE_FACTOR_INV;\r\n  texel.rg = integerMod(texel.rg, 256.0);\r\n  texel.b = integerMod(texel.b, 128.0);\r\n  texel.a = exponent*0.5 + 63.5;\r\n  texel.ba += vec2(integerMod(exponent+127.0, 2.0), sign) * 128.0;\r\n  texel = floor(texel);\r\n  texel *= 0.003921569; // 1/255\r\n  __ENCODE32_ENDIANNESS__;\r\n  return texel;\r\n}\r\n\r\n// https://github.com/gpujs/gpu.js/wiki/Encoder-details\r\nvec4 encode32(float value) {\r\n  if (value == 0.0) return vec4(0, 0, 0, 0);\r\n\r\n  float exponent;\r\n  float mantissa;\r\n  vec4  result;\r\n  float sgn;\r\n\r\n  sgn = step(0.0, -value);\r\n  value = abs(value);\r\n\r\n  exponent = floor(log2(value));\r\n\r\n  mantissa = value*pow(2.0, -exponent)-1.0;\r\n  exponent = exponent+127.0;\r\n  result   = vec4(0,0,0,0);\r\n\r\n  result.a = floor(exponent/2.0);\r\n  exponent = exponent - result.a*2.0;\r\n  result.a = result.a + 128.0*sgn;\r\n\r\n  result.b = floor(mantissa * 128.0);\r\n  mantissa = mantissa - result.b / 128.0;\r\n  result.b = result.b + exponent*128.0;\r\n\r\n  result.g = floor(mantissa*32768.0);\r\n  mantissa = mantissa - result.g/32768.0;\r\n\r\n  result.r = floor(mantissa*8388608.0);\r\n  return result/255.0;\r\n}\r\n// Dragons end here\r\n\r\nint index;\r\nivec3 threadId;\r\n\r\nivec3 indexTo3D(int idx, ivec3 texDim) {\r\n  int z = int(idx / (texDim.x * texDim.y));\r\n  idx -= z * int(texDim.x * texDim.y);\r\n  int y = int(idx / texDim.x);\r\n  int x = int(integerMod(idx, texDim.x));\r\n  return ivec3(x, y, z);\r\n}\r\n\r\nfloat get32(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\r\n  int index = x + texDim.x * (y + texDim.y * z);\r\n  int w = texSize.x;\r\n  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;\r\n  vec4 texel = texture(tex, st / vec2(texSize));\r\n  return decode32(texel);\r\n}\r\n\r\nfloat get16(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\r\n  int index = x + (texDim.x * (y + (texDim.y * z)));\r\n  int w = texSize.x * 2;\r\n  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;\r\n  vec4 texel = texture(tex, st / vec2(texSize.x * 2, texSize.y));\r\n  return decode16(texel, index);\r\n}\r\n\r\nfloat get8(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\r\n  int index = x + (texDim.x * (y + (texDim.y * z)));\r\n  int w = texSize.x * 4;\r\n  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;\r\n  vec4 texel = texture(tex, st / vec2(texSize.x * 4, texSize.y));\r\n  return decode8(texel, index);\r\n}\r\n\r\nfloat getMemoryOptimized32(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\r\n  int index = x + (texDim.x * (y + (texDim.y * z)));\r\n  int channel = integerMod(index, 4);\r\n  index = index / 4;\r\n  int w = texSize.x;\r\n  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;\r\n  index = index / 4;\r\n  vec4 texel = texture(tex, st / vec2(texSize));\r\n  return texel[channel];\r\n}\r\n\r\nvec4 getImage2D(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\r\n  int index = x + texDim.x * (y + texDim.y * z);\r\n  int w = texSize.x;\r\n  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;\r\n  return texture(tex, st / vec2(texSize));\r\n}\r\n\r\nvec4 getImage3D(sampler2DArray tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\r\n  int index = x + texDim.x * (y + texDim.y * z);\r\n  int w = texSize.x;\r\n  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;\r\n  return texture(tex, vec3(st / vec2(texSize), z));\r\n}\r\n\r\nfloat getFloatFromSampler2D(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\r\n  vec4 result = getImage2D(tex, texSize, texDim, z, y, x);\r\n  return result[0];\r\n}\r\n\r\nvec2 getVec2FromSampler2D(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\r\n  vec4 result = getImage2D(tex, texSize, texDim, z, y, x);\r\n  return vec2(result[0], result[1]);\r\n}\r\n\r\nvec2 getMemoryOptimizedVec2(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\r\n  int index = x + texDim.x * (y + texDim.y * z);\r\n  int channel = integerMod(index, 2);\r\n  index = index / 2;\r\n  int w = texSize.x;\r\n  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;\r\n  vec4 texel = texture(tex, st / vec2(texSize));\r\n  if (channel == 0) return vec2(texel.r, texel.g);\r\n  if (channel == 1) return vec2(texel.b, texel.a);\r\n  return vec2(0.0, 0.0);\r\n}\r\n\r\nvec3 getVec3FromSampler2D(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\r\n  vec4 result = getImage2D(tex, texSize, texDim, z, y, x);\r\n  return vec3(result[0], result[1], result[2]);\r\n}\r\n\r\nvec3 getMemoryOptimizedVec3(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\r\n  int fieldIndex = 3 * (x + texDim.x * (y + texDim.y * z));\r\n  int vectorIndex = fieldIndex / 4;\r\n  int vectorOffset = fieldIndex - vectorIndex * 4;\r\n  int readY = vectorIndex / texSize.x;\r\n  int readX = vectorIndex - readY * texSize.x;\r\n  vec4 tex1 = texture(tex, (vec2(readX, readY) + 0.5) / vec2(texSize));\r\n\r\n  if (vectorOffset == 0) {\r\n    return tex1.xyz;\r\n  } else if (vectorOffset == 1) {\r\n    return tex1.yzw;\r\n  } else {\r\n    readX++;\r\n    if (readX >= texSize.x) {\r\n      readX = 0;\r\n      readY++;\r\n    }\r\n    vec4 tex2 = texture(tex, vec2(readX, readY) / vec2(texSize));\r\n    if (vectorOffset == 2) {\r\n      return vec3(tex1.z, tex1.w, tex2.x);\r\n    } else {\r\n      return vec3(tex1.w, tex2.x, tex2.y);\r\n    }\r\n  }\r\n}\r\n\r\nvec4 getVec4FromSampler2D(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\r\n  return getImage2D(tex, texSize, texDim, z, y, x);\r\n}\r\n\r\nvec4 getMemoryOptimizedVec4(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\r\n  int index = x + texDim.x * (y + texDim.y * z);\r\n  int channel = integerMod(index, 2);\r\n  int w = texSize.x;\r\n  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;\r\n  vec4 texel = texture(tex, st / vec2(texSize));\r\n  return vec4(texel.r, texel.g, texel.b, texel.a);\r\n}\r\n\r\nvec4 actualColor;\r\nvoid color(float r, float g, float b, float a) {\r\n  actualColor = vec4(r,g,b,a);\r\n}\r\n\r\nvoid color(float r, float g, float b) {\r\n  color(r,g,b,1.0);\r\n}\r\n\r\n__INJECTED_NATIVE__;\r\n__MAIN_CONSTANTS__;\r\n__MAIN_ARGUMENTS__;\r\n__KERNEL__;\r\n\r\nvoid main(void) {\r\n  index = int(vTexCoord.s * float(uTexSize.x)) + int(vTexCoord.t * float(uTexSize.y)) * uTexSize.x;\r\n  __MAIN_RESULT__;\r\n}`;\r\n","// language=GLSL\r\nexport const vertexShader = `#version 300 es\r\n__FLOAT_TACTIC_DECLARATION__;\r\n__INT_TACTIC_DECLARATION__;\r\n__SAMPLER_2D_TACTIC_DECLARATION__;\r\n\r\nin vec2 aPos;\r\nin vec2 aTexCoord;\r\n\r\nout vec2 vTexCoord;\r\nuniform vec2 ratio;\r\n\r\nvoid main(void) {\r\n  gl_Position = vec4((aPos + vec2(1)) * ratio + vec2(-1), 0, 1);\r\n  vTexCoord = aTexCoord;\r\n}`;\r\n","import { WebGLKernelValueBoolean } from '../../web-gl/kernel-value/boolean';\r\n\r\nexport class WebGL2KernelValueBoolean extends WebGLKernelValueBoolean {}\r\n","import { WebGLKernelValueFloat } from '../../web-gl/kernel-value/float';\r\n\r\nexport class WebGL2KernelValueFloat extends WebGLKernelValueFloat {}\r\n","import { WebGLKernelValueInteger } from '../../web-gl/kernel-value/integer';\r\n\r\nexport class WebGL2KernelValueInteger extends WebGLKernelValueInteger {\r\n  getSource(value) {\r\n    const variablePrecision = this.getVariablePrecisionString();\r\n    if (this.origin === 'constants') {\r\n      return `const ${ variablePrecision } int ${this.id} = ${ parseInt(value) };\\n`;\r\n    }\r\n    return `uniform ${ variablePrecision } int ${this.id};\\n`;\r\n  }\r\n\r\n  updateValue(value) {\r\n    if (this.origin === 'constants') return;\r\n    this.kernel.setUniform1i(this.id, this.uploadValue = value);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { WebGLKernelValueHTMLImage } from '../../web-gl/kernel-value/html-image';\r\n\r\nexport class WebGL2KernelValueHTMLImage extends WebGLKernelValueHTMLImage {\r\n  getSource() {\r\n    const variablePrecision = this.getVariablePrecisionString();\r\n    return utils.linesToString([\r\n      `uniform ${ variablePrecision } sampler2D ${this.id}`,\r\n      `${ variablePrecision } ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,\r\n      `${ variablePrecision } ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`,\r\n    ]);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { WebGLKernelValueDynamicHTMLImage } from '../../web-gl/kernel-value/dynamic-html-image';\r\n\r\nexport class WebGL2KernelValueDynamicHTMLImage extends WebGLKernelValueDynamicHTMLImage {\r\n  getSource() {\r\n    const variablePrecision = this.getVariablePrecisionString();\r\n    return utils.linesToString([\r\n      `uniform ${ variablePrecision } sampler2D ${this.id}`,\r\n      `uniform ${ variablePrecision } ivec2 ${this.sizeId}`,\r\n      `uniform ${ variablePrecision } ivec3 ${this.dimensionsId}`,\r\n    ]);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { WebGLKernelValue } from '../../web-gl/kernel-value/index';\r\n\r\nexport class WebGL2KernelValueHtmlImageArray extends WebGLKernelValue {\r\n  constructor(value, settings) {\r\n    super(value, settings);\r\n    this.requestTexture();\r\n    this.dimensions = [value[0].width, value[0].height, value.length];\r\n    this.textureSize = [value[0].width, value[0].height];\r\n  }\r\n  getStringValueHandler() {\r\n    return `const uploadValue_${this.name} = ${this.varName};\\n`;\r\n  }\r\n  getSource() {\r\n    const variablePrecision = this.getVariablePrecisionString();\r\n    return utils.linesToString([\r\n      `uniform ${ variablePrecision } sampler2DArray ${this.id}`,\r\n      `${ variablePrecision } ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,\r\n      `${ variablePrecision } ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`,\r\n    ]);\r\n  }\r\n\r\n  updateValue(images) {\r\n    const { context: gl } = this;\r\n    gl.activeTexture(this.contextHandle);\r\n    gl.bindTexture(gl.TEXTURE_2D_ARRAY, this.texture);\r\n    gl.texParameteri(gl.TEXTURE_2D_ARRAY, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\r\n    gl.texParameteri(gl.TEXTURE_2D_ARRAY, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\r\n    gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, true);\r\n    // Upload the images into the texture.\r\n    gl.texImage3D(\r\n      gl.TEXTURE_2D_ARRAY,\r\n      0,\r\n      gl.RGBA,\r\n      images[0].width,\r\n      images[0].height,\r\n      images.length,\r\n      0,\r\n      gl.RGBA,\r\n      gl.UNSIGNED_BYTE,\r\n      null\r\n    );\r\n    for (let i = 0; i < images.length; i++) {\r\n      const xOffset = 0;\r\n      const yOffset = 0;\r\n      const imageDepth = 1;\r\n      gl.texSubImage3D(\r\n        gl.TEXTURE_2D_ARRAY,\r\n        0,\r\n        xOffset,\r\n        yOffset,\r\n        i,\r\n        images[i].width,\r\n        images[i].height,\r\n        imageDepth,\r\n        gl.RGBA,\r\n        gl.UNSIGNED_BYTE,\r\n        this.uploadValue = images[i]\r\n      );\r\n    }\r\n    this.kernel.setUniform1i(this.id, this.index);\r\n  }\r\n}\r\n","import { WebGL2KernelValueHtmlImageArray } from './html-image-array';\r\n\r\nexport class WebGL2KernelValueDynamicHtmlImageArray extends WebGL2KernelValueHtmlImageArray {\r\n  getSource() {\r\n    const variablePrecision = this.getVariablePrecisionString();\r\n    return utils.linesToString([\r\n      `uniform ${ variablePrecision } sampler2DArray ${this.id}`,\r\n      `uniform ${ variablePrecision } ivec2 ${this.sizeId}`,\r\n      `uniform ${ variablePrecision } ivec3 ${this.dimensionsId}`,\r\n    ]);\r\n  }\r\n\r\n  updateValue(images) {\r\n    this.dimensions = [images[0].width, images[0].height, images.length];\r\n    this.textureSize = [images[0].width, images[0].height];\r\n    this.kernel.setUniform3iv(this.dimensionsId, this.dimensions);\r\n    this.kernel.setUniform2iv(this.sizeId, this.textureSize);\r\n    super.updateValue(images);\r\n  }\r\n}\r\n","import { WebGL2KernelValueHTMLImage } from './html-image';\r\n\r\nexport class WebGL2KernelValueHTMLVideo extends WebGL2KernelValueHTMLImage {}\r\n","import { WebGL2KernelValueDynamicHTMLImage } from './dynamic-html-image';\r\n\r\nexport class WebGL2KernelValueDynamicHTMLVideo extends WebGL2KernelValueDynamicHTMLImage {}\r\n","import { utils } from '../../../utils';\r\nimport { WebGLKernelValueSingleInput } from '../../web-gl/kernel-value/single-input';\r\n\r\nexport class WebGL2KernelValueSingleInput extends WebGLKernelValueSingleInput {\r\n  getSource() {\r\n    const variablePrecision = this.getVariablePrecisionString();\r\n    return utils.linesToString([\r\n      `uniform ${ variablePrecision } sampler2D ${this.id}`,\r\n      `${ variablePrecision } ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,\r\n      `${ variablePrecision } ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`,\r\n    ]);\r\n  }\r\n\r\n  updateValue(input) {\r\n    const { context: gl } = this;\r\n    utils.flattenTo(input.value, this.uploadValue);\r\n    gl.activeTexture(this.contextHandle);\r\n    gl.bindTexture(gl.TEXTURE_2D, this.texture);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\r\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA32F, this.textureSize[0], this.textureSize[1], 0, gl.RGBA, gl.FLOAT, this.uploadValue);\r\n    this.kernel.setUniform1i(this.id, this.index);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { WebGLKernelValueDynamicMemoryOptimizedNumberTexture } from '../../web-gl/kernel-value/dynamic-memory-optimized-number-texture';\r\n\r\nexport class WebGL2KernelValueDynamicMemoryOptimizedNumberTexture extends WebGLKernelValueDynamicMemoryOptimizedNumberTexture {\r\n  getSource() {\r\n    return utils.linesToString([\r\n      `uniform sampler2D ${this.id}`,\r\n      `uniform ivec2 ${this.sizeId}`,\r\n      `uniform ivec3 ${this.dimensionsId}`,\r\n    ]);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { WebGLKernelValueNumberTexture } from '../../web-gl/kernel-value/number-texture';\r\n\r\nexport class WebGL2KernelValueNumberTexture extends WebGLKernelValueNumberTexture {\r\n  getSource() {\r\n    const variablePrecision = this.getVariablePrecisionString();\r\n    return utils.linesToString([\r\n      `uniform ${ variablePrecision } sampler2D ${this.id}`,\r\n      `${ variablePrecision } ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,\r\n      `${ variablePrecision } ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`,\r\n    ]);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { WebGLKernelValueDynamicNumberTexture } from '../../web-gl/kernel-value/dynamic-number-texture';\r\n\r\nexport class WebGL2KernelValueDynamicNumberTexture extends WebGLKernelValueDynamicNumberTexture {\r\n  getSource() {\r\n    const variablePrecision = this.getVariablePrecisionString();\r\n    return utils.linesToString([\r\n      `uniform ${ variablePrecision } sampler2D ${this.id}`,\r\n      `uniform ${ variablePrecision } ivec2 ${this.sizeId}`,\r\n      `uniform ${ variablePrecision } ivec3 ${this.dimensionsId}`,\r\n    ]);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { WebGLKernelValueSingleArray } from '../../web-gl/kernel-value/single-array';\r\n\r\nexport class WebGL2KernelValueSingleArray extends WebGLKernelValueSingleArray {\r\n  getSource() {\r\n    const variablePrecision = this.getVariablePrecisionString();\r\n    return utils.linesToString([\r\n      `uniform ${ variablePrecision } sampler2D ${this.id}`,\r\n      `${ variablePrecision } ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,\r\n      `${ variablePrecision } ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`,\r\n    ]);\r\n  }\r\n\r\n  updateValue(value) {\r\n    if (value.constructor !== this.initialValueConstructor) {\r\n      this.onUpdateValueMismatch();\r\n      return;\r\n    }\r\n    const { context: gl } = this;\r\n    utils.flattenTo(value, this.uploadValue);\r\n    gl.activeTexture(this.contextHandle);\r\n    gl.bindTexture(gl.TEXTURE_2D, this.texture);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\r\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA32F, this.textureSize[0], this.textureSize[1], 0, gl.RGBA, gl.FLOAT, this.uploadValue);\r\n    this.kernel.setUniform1i(this.id, this.index);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { WebGLKernelValueSingleArray1DI } from '../../web-gl/kernel-value/single-array1d-i';\r\n\r\nexport class WebGL2KernelValueSingleArray1DI extends WebGLKernelValueSingleArray1DI {\r\n  updateValue(value) {\r\n    if (value.constructor !== this.initialValueConstructor) {\r\n      this.onUpdateValueMismatch();\r\n      return;\r\n    }\r\n    const { context: gl } = this;\r\n    utils.flattenTo(value, this.uploadValue);\r\n    gl.activeTexture(this.contextHandle);\r\n    gl.bindTexture(gl.TEXTURE_2D, this.texture);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\r\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA32F, this.textureSize[0], this.textureSize[1], 0, gl.RGBA, gl.FLOAT, this.uploadValue);\r\n    this.kernel.setUniform1i(this.id, this.index);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { WebGL2KernelValueSingleArray1DI } from '../../web-gl2/kernel-value/single-array1d-i';\r\n\r\nexport class WebGL2KernelValueDynamicSingleArray1DI extends WebGL2KernelValueSingleArray1DI {\r\n  getSource() {\r\n    const variablePrecision = this.getVariablePrecisionString();\r\n    return utils.linesToString([\r\n      `uniform ${ variablePrecision } sampler2D ${this.id}`,\r\n      `uniform ${ variablePrecision } ivec2 ${this.sizeId}`,\r\n      `uniform ${ variablePrecision } ivec3 ${this.dimensionsId}`,\r\n    ]);\r\n  }\r\n\r\n  updateValue(value) {\r\n    this.setShape(value);\r\n    this.kernel.setUniform3iv(this.dimensionsId, this.dimensions);\r\n    this.kernel.setUniform2iv(this.sizeId, this.textureSize);\r\n    super.updateValue(value);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { WebGLKernelValueSingleArray2DI } from '../../web-gl/kernel-value/single-array2d-i';\r\n\r\nexport class WebGL2KernelValueSingleArray2DI extends WebGLKernelValueSingleArray2DI {\r\n  updateValue(value) {\r\n    if (value.constructor !== this.initialValueConstructor) {\r\n      this.onUpdateValueMismatch();\r\n      return;\r\n    }\r\n    const { context: gl } = this;\r\n    utils.flattenTo(value, this.uploadValue);\r\n    gl.activeTexture(this.contextHandle);\r\n    gl.bindTexture(gl.TEXTURE_2D, this.texture);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\r\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA32F, this.textureSize[0], this.textureSize[1], 0, gl.RGBA, gl.FLOAT, this.uploadValue);\r\n    this.kernel.setUniform1i(this.id, this.index);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { WebGL2KernelValueSingleArray2DI } from '../../web-gl2/kernel-value/single-array2d-i';\r\n\r\nexport class WebGL2KernelValueDynamicSingleArray2DI extends WebGL2KernelValueSingleArray2DI {\r\n  getSource() {\r\n    const variablePrecision = this.getVariablePrecisionString();\r\n    return utils.linesToString([\r\n      `uniform ${ variablePrecision } sampler2D ${this.id}`,\r\n      `uniform ${ variablePrecision } ivec2 ${this.sizeId}`,\r\n      `uniform ${ variablePrecision } ivec3 ${this.dimensionsId}`,\r\n    ]);\r\n  }\r\n\r\n  updateValue(value) {\r\n    this.setShape(value);\r\n    this.kernel.setUniform3iv(this.dimensionsId, this.dimensions);\r\n    this.kernel.setUniform2iv(this.sizeId, this.textureSize);\r\n    super.updateValue(value);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { WebGLKernelValueSingleArray3DI } from '../../web-gl/kernel-value/single-array3d-i';\r\n\r\nexport class WebGL2KernelValueSingleArray3DI extends WebGLKernelValueSingleArray3DI {\r\n  updateValue(value) {\r\n    if (value.constructor !== this.initialValueConstructor) {\r\n      this.onUpdateValueMismatch();\r\n      return;\r\n    }\r\n    const { context: gl } = this;\r\n    utils.flattenTo(value, this.uploadValue);\r\n    gl.activeTexture(this.contextHandle);\r\n    gl.bindTexture(gl.TEXTURE_2D, this.texture);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\r\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA32F, this.textureSize[0], this.textureSize[1], 0, gl.RGBA, gl.FLOAT, this.uploadValue);\r\n    this.kernel.setUniform1i(this.id, this.index);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { WebGL2KernelValueSingleArray3DI } from '../../web-gl2/kernel-value/single-array3d-i';\r\n\r\nexport class WebGL2KernelValueDynamicSingleArray3DI extends WebGL2KernelValueSingleArray3DI {\r\n  getSource() {\r\n    const variablePrecision = this.getVariablePrecisionString();\r\n    return utils.linesToString([\r\n      `uniform ${ variablePrecision } sampler2D ${this.id}`,\r\n      `uniform ${ variablePrecision } ivec2 ${this.sizeId}`,\r\n      `uniform ${ variablePrecision } ivec3 ${this.dimensionsId}`,\r\n    ]);\r\n  }\r\n\r\n  updateValue(value) {\r\n    this.setShape(value);\r\n    this.kernel.setUniform3iv(this.dimensionsId, this.dimensions);\r\n    this.kernel.setUniform2iv(this.sizeId, this.textureSize);\r\n    super.updateValue(value);\r\n  }\r\n}\r\n","import { WebGLKernelValueSingleArray2 } from '../../web-gl/kernel-value/single-array2';\r\n\r\nexport class WebGL2KernelValueSingleArray2 extends WebGLKernelValueSingleArray2 {}\r\n","import { WebGLKernelValueSingleArray3 } from '../../web-gl/kernel-value/single-array3';\r\n\r\nexport class WebGL2KernelValueSingleArray3 extends WebGLKernelValueSingleArray3 {}\r\n","import { WebGLKernelValueSingleArray4 } from '../../web-gl/kernel-value/single-array4';\r\n\r\nexport class WebGL2KernelValueSingleArray4 extends WebGLKernelValueSingleArray4 {}\r\n","import { WebGL2KernelValueBoolean } from './kernel-value/boolean';\r\nimport { WebGL2KernelValueFloat } from './kernel-value/float';\r\nimport { WebGL2KernelValueInteger } from './kernel-value/integer';\r\n\r\nimport { WebGL2KernelValueHTMLImage } from './kernel-value/html-image';\r\nimport { WebGL2KernelValueDynamicHTMLImage } from './kernel-value/dynamic-html-image';\r\n\r\nimport { WebGL2KernelValueHtmlImageArray } from './kernel-value/html-image-array';\r\nimport { WebGL2KernelValueDynamicHtmlImageArray } from './kernel-value/dynamic-html-image-array';\r\n\r\nimport { WebGL2KernelValueHTMLVideo } from './kernel-value/html-video';\r\nimport { WebGL2KernelValueDynamicHTMLVideo } from './kernel-value/dynamic-html-video';\r\n\r\nimport { WebGL2KernelValueSingleInput } from './kernel-value/single-input';\r\nimport { WebGL2KernelValueDynamicSingleInput } from './kernel-value/dynamic-single-input';\r\n\r\nimport { WebGL2KernelValueUnsignedInput } from './kernel-value/unsigned-input';\r\nimport { WebGL2KernelValueDynamicUnsignedInput } from './kernel-value/dynamic-unsigned-input';\r\n\r\nimport { WebGL2KernelValueMemoryOptimizedNumberTexture } from './kernel-value/memory-optimized-number-texture';\r\nimport { WebGL2KernelValueDynamicMemoryOptimizedNumberTexture } from './kernel-value/dynamic-memory-optimized-number-texture';\r\n\r\nimport { WebGL2KernelValueNumberTexture } from './kernel-value/number-texture';\r\nimport { WebGL2KernelValueDynamicNumberTexture } from './kernel-value/dynamic-number-texture';\r\n\r\nimport { WebGL2KernelValueSingleArray } from './kernel-value/single-array';\r\nimport { WebGL2KernelValueDynamicSingleArray } from './kernel-value/dynamic-single-array';\r\n\r\nimport { WebGL2KernelValueSingleArray1DI } from './kernel-value/single-array1d-i';\r\nimport { WebGL2KernelValueDynamicSingleArray1DI } from './kernel-value/dynamic-single-array1d-i';\r\n\r\nimport { WebGL2KernelValueSingleArray2DI } from './kernel-value/single-array2d-i';\r\nimport { WebGL2KernelValueDynamicSingleArray2DI } from './kernel-value/dynamic-single-array2d-i';\r\n\r\nimport { WebGL2KernelValueSingleArray3DI } from './kernel-value/single-array3d-i';\r\nimport { WebGL2KernelValueDynamicSingleArray3DI } from './kernel-value/dynamic-single-array3d-i';\r\n\r\nimport { WebGL2KernelValueSingleArray2 } from './kernel-value/single-array2';\r\nimport { WebGL2KernelValueSingleArray3 } from './kernel-value/single-array3';\r\nimport { WebGL2KernelValueSingleArray4 } from './kernel-value/single-array4';\r\n\r\nimport { WebGL2KernelValueUnsignedArray } from './kernel-value/unsigned-array';\r\nimport { WebGL2KernelValueDynamicUnsignedArray } from './kernel-value/dynamic-unsigned-array';\r\n\r\nconst kernelValueMaps = {\r\n  unsigned: {\r\n    dynamic: {\r\n      'Boolean': WebGL2KernelValueBoolean,\r\n      'Integer': WebGL2KernelValueInteger,\r\n      'Float': WebGL2KernelValueFloat,\r\n      'Array': WebGL2KernelValueDynamicUnsignedArray,\r\n      'Array(2)': false,\r\n      'Array(3)': false,\r\n      'Array(4)': false,\r\n      'Array1D(2)': false,\r\n      'Array1D(3)': false,\r\n      'Array1D(4)': false,\r\n      'Array2D(2)': false,\r\n      'Array2D(3)': false,\r\n      'Array2D(4)': false,\r\n      'Array3D(2)': false,\r\n      'Array3D(3)': false,\r\n      'Array3D(4)': false,\r\n      'Input': WebGL2KernelValueDynamicUnsignedInput,\r\n      'NumberTexture': WebGL2KernelValueDynamicNumberTexture,\r\n      'ArrayTexture(1)': WebGL2KernelValueDynamicNumberTexture,\r\n      'ArrayTexture(2)': WebGL2KernelValueDynamicNumberTexture,\r\n      'ArrayTexture(3)': WebGL2KernelValueDynamicNumberTexture,\r\n      'ArrayTexture(4)': WebGL2KernelValueDynamicNumberTexture,\r\n      'MemoryOptimizedNumberTexture': WebGL2KernelValueDynamicMemoryOptimizedNumberTexture,\r\n      'HTMLImage': WebGL2KernelValueDynamicHTMLImage,\r\n      'HTMLImageArray': WebGL2KernelValueDynamicHtmlImageArray,\r\n      'HTMLVideo': WebGL2KernelValueDynamicHTMLVideo,\r\n    },\r\n    static: {\r\n      'Boolean': WebGL2KernelValueBoolean,\r\n      'Float': WebGL2KernelValueFloat,\r\n      'Integer': WebGL2KernelValueInteger,\r\n      'Array': WebGL2KernelValueUnsignedArray,\r\n      'Array(2)': false,\r\n      'Array(3)': false,\r\n      'Array(4)': false,\r\n      'Array1D(2)': false,\r\n      'Array1D(3)': false,\r\n      'Array1D(4)': false,\r\n      'Array2D(2)': false,\r\n      'Array2D(3)': false,\r\n      'Array2D(4)': false,\r\n      'Array3D(2)': false,\r\n      'Array3D(3)': false,\r\n      'Array3D(4)': false,\r\n      'Input': WebGL2KernelValueUnsignedInput,\r\n      'NumberTexture': WebGL2KernelValueNumberTexture,\r\n      'ArrayTexture(1)': WebGL2KernelValueNumberTexture,\r\n      'ArrayTexture(2)': WebGL2KernelValueNumberTexture,\r\n      'ArrayTexture(3)': WebGL2KernelValueNumberTexture,\r\n      'ArrayTexture(4)': WebGL2KernelValueNumberTexture,\r\n      'MemoryOptimizedNumberTexture': WebGL2KernelValueDynamicMemoryOptimizedNumberTexture,\r\n      'HTMLImage': WebGL2KernelValueHTMLImage,\r\n      'HTMLImageArray': WebGL2KernelValueHtmlImageArray,\r\n      'HTMLVideo': WebGL2KernelValueHTMLVideo,\r\n    }\r\n  },\r\n  single: {\r\n    dynamic: {\r\n      'Boolean': WebGL2KernelValueBoolean,\r\n      'Integer': WebGL2KernelValueInteger,\r\n      'Float': WebGL2KernelValueFloat,\r\n      'Array': WebGL2KernelValueDynamicSingleArray,\r\n      'Array(2)': WebGL2KernelValueSingleArray2,\r\n      'Array(3)': WebGL2KernelValueSingleArray3,\r\n      'Array(4)': WebGL2KernelValueSingleArray4,\r\n      'Array1D(2)': WebGL2KernelValueDynamicSingleArray1DI,\r\n      'Array1D(3)': WebGL2KernelValueDynamicSingleArray1DI,\r\n      'Array1D(4)': WebGL2KernelValueDynamicSingleArray1DI,\r\n      'Array2D(2)': WebGL2KernelValueDynamicSingleArray2DI,\r\n      'Array2D(3)': WebGL2KernelValueDynamicSingleArray2DI,\r\n      'Array2D(4)': WebGL2KernelValueDynamicSingleArray2DI,\r\n      'Array3D(2)': WebGL2KernelValueDynamicSingleArray3DI,\r\n      'Array3D(3)': WebGL2KernelValueDynamicSingleArray3DI,\r\n      'Array3D(4)': WebGL2KernelValueDynamicSingleArray3DI,\r\n      'Input': WebGL2KernelValueDynamicSingleInput,\r\n      'NumberTexture': WebGL2KernelValueDynamicNumberTexture,\r\n      'ArrayTexture(1)': WebGL2KernelValueDynamicNumberTexture,\r\n      'ArrayTexture(2)': WebGL2KernelValueDynamicNumberTexture,\r\n      'ArrayTexture(3)': WebGL2KernelValueDynamicNumberTexture,\r\n      'ArrayTexture(4)': WebGL2KernelValueDynamicNumberTexture,\r\n      'MemoryOptimizedNumberTexture': WebGL2KernelValueDynamicMemoryOptimizedNumberTexture,\r\n      'HTMLImage': WebGL2KernelValueDynamicHTMLImage,\r\n      'HTMLImageArray': WebGL2KernelValueDynamicHtmlImageArray,\r\n      'HTMLVideo': WebGL2KernelValueDynamicHTMLVideo,\r\n    },\r\n    static: {\r\n      'Boolean': WebGL2KernelValueBoolean,\r\n      'Float': WebGL2KernelValueFloat,\r\n      'Integer': WebGL2KernelValueInteger,\r\n      'Array': WebGL2KernelValueSingleArray,\r\n      'Array(2)': WebGL2KernelValueSingleArray2,\r\n      'Array(3)': WebGL2KernelValueSingleArray3,\r\n      'Array(4)': WebGL2KernelValueSingleArray4,\r\n      'Array1D(2)': WebGL2KernelValueSingleArray1DI,\r\n      'Array1D(3)': WebGL2KernelValueSingleArray1DI,\r\n      'Array1D(4)': WebGL2KernelValueSingleArray1DI,\r\n      'Array2D(2)': WebGL2KernelValueSingleArray2DI,\r\n      'Array2D(3)': WebGL2KernelValueSingleArray2DI,\r\n      'Array2D(4)': WebGL2KernelValueSingleArray2DI,\r\n      'Array3D(2)': WebGL2KernelValueSingleArray3DI,\r\n      'Array3D(3)': WebGL2KernelValueSingleArray3DI,\r\n      'Array3D(4)': WebGL2KernelValueSingleArray3DI,\r\n      'Input': WebGL2KernelValueSingleInput,\r\n      'NumberTexture': WebGL2KernelValueNumberTexture,\r\n      'ArrayTexture(1)': WebGL2KernelValueNumberTexture,\r\n      'ArrayTexture(2)': WebGL2KernelValueNumberTexture,\r\n      'ArrayTexture(3)': WebGL2KernelValueNumberTexture,\r\n      'ArrayTexture(4)': WebGL2KernelValueNumberTexture,\r\n      'MemoryOptimizedNumberTexture': WebGL2KernelValueMemoryOptimizedNumberTexture,\r\n      'HTMLImage': WebGL2KernelValueHTMLImage,\r\n      'HTMLImageArray': WebGL2KernelValueHtmlImageArray,\r\n      'HTMLVideo': WebGL2KernelValueHTMLVideo,\r\n    }\r\n  },\r\n};\r\n\r\nexport function lookupKernelValueType(type, dynamic, precision, value) {\r\n  if (!type) {\r\n    throw new Error('type missing');\r\n  }\r\n  if (!dynamic) {\r\n    throw new Error('dynamic missing');\r\n  }\r\n  if (!precision) {\r\n    throw new Error('precision missing');\r\n  }\r\n  if (value.type) {\r\n    type = value.type;\r\n  }\r\n  const types = kernelValueMaps[precision][dynamic];\r\n  if (types[type] === false) {\r\n    return null;\r\n  } else if (types[type] === undefined) {\r\n    throw new Error(`Could not find a KernelValue for ${ type }`);\r\n  }\r\n  return types[type];\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { WebGLKernelValueDynamicUnsignedArray } from '../../web-gl/kernel-value/dynamic-unsigned-array';\r\n\r\nexport class WebGL2KernelValueDynamicUnsignedArray extends WebGLKernelValueDynamicUnsignedArray {\r\n  getSource() {\r\n    const variablePrecision = this.getVariablePrecisionString();\r\n    return utils.linesToString([\r\n      `uniform ${ variablePrecision } sampler2D ${this.id}`,\r\n      `uniform ${ variablePrecision } ivec2 ${this.sizeId}`,\r\n      `uniform ${ variablePrecision } ivec3 ${this.dimensionsId}`,\r\n    ]);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { WebGLKernelValueDynamicUnsignedInput } from '../../web-gl/kernel-value/dynamic-unsigned-input';\r\n\r\nexport class WebGL2KernelValueDynamicUnsignedInput extends WebGLKernelValueDynamicUnsignedInput {\r\n  getSource() {\r\n    const variablePrecision = this.getVariablePrecisionString();\r\n    return utils.linesToString([\r\n      `uniform ${ variablePrecision } sampler2D ${this.id}`,\r\n      `uniform ${ variablePrecision } ivec2 ${this.sizeId}`,\r\n      `uniform ${ variablePrecision } ivec3 ${this.dimensionsId}`,\r\n    ]);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { WebGLKernelValueUnsignedArray } from '../../web-gl/kernel-value/unsigned-array';\r\n\r\nexport class WebGL2KernelValueUnsignedArray extends WebGLKernelValueUnsignedArray {\r\n  getSource() {\r\n    const variablePrecision = this.getVariablePrecisionString();\r\n    return utils.linesToString([\r\n      `uniform ${ variablePrecision } sampler2D ${this.id}`,\r\n      `${ variablePrecision } ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,\r\n      `${ variablePrecision } ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`,\r\n    ]);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { WebGLKernelValueUnsignedInput } from '../../web-gl/kernel-value/unsigned-input';\r\n\r\nexport class WebGL2KernelValueUnsignedInput extends WebGLKernelValueUnsignedInput {\r\n  getSource() {\r\n    const variablePrecision = this.getVariablePrecisionString();\r\n    return utils.linesToString([\r\n      `uniform ${ variablePrecision } sampler2D ${this.id}`,\r\n      `${ variablePrecision } ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,\r\n      `${ variablePrecision } ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`,\r\n    ]);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { WebGL2KernelValueSingleArray } from '../../web-gl2/kernel-value/single-array';\r\n\r\nexport class WebGL2KernelValueDynamicSingleArray extends WebGL2KernelValueSingleArray {\r\n  getSource() {\r\n    const variablePrecision = this.getVariablePrecisionString();\r\n    return utils.linesToString([\r\n      `uniform ${ variablePrecision } sampler2D ${this.id}`,\r\n      `uniform ${ variablePrecision } ivec2 ${this.sizeId}`,\r\n      `uniform ${ variablePrecision } ivec3 ${this.dimensionsId}`,\r\n    ]);\r\n  }\r\n\r\n  updateValue(value) {\r\n    this.dimensions = utils.getDimensions(value, true);\r\n    this.textureSize = utils.getMemoryOptimizedFloatTextureSize(this.dimensions, this.bitRatio);\r\n    this.uploadArrayLength = this.textureSize[0] * this.textureSize[1] * this.bitRatio;\r\n    this.uploadValue = new Float32Array(this.uploadArrayLength);\r\n    this.kernel.setUniform3iv(this.dimensionsId, this.dimensions);\r\n    this.kernel.setUniform2iv(this.sizeId, this.textureSize);\r\n    super.updateValue(value);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { WebGL2KernelValueSingleInput } from '../../web-gl2/kernel-value/single-input';\r\n\r\nexport class WebGL2KernelValueDynamicSingleInput extends WebGL2KernelValueSingleInput {\r\n  getSource() {\r\n    const variablePrecision = this.getVariablePrecisionString();\r\n    return utils.linesToString([\r\n      `uniform ${ variablePrecision } sampler2D ${this.id}`,\r\n      `uniform ${ variablePrecision } ivec2 ${this.sizeId}`,\r\n      `uniform ${ variablePrecision } ivec3 ${this.dimensionsId}`,\r\n    ]);\r\n  }\r\n\r\n  updateValue(value) {\r\n    let [w, h, d] = value.size;\r\n    this.dimensions = new Int32Array([w || 1, h || 1, d || 1]);\r\n    this.textureSize = utils.getMemoryOptimizedFloatTextureSize(this.dimensions, this.bitRatio);\r\n    this.uploadArrayLength = this.textureSize[0] * this.textureSize[1] * this.bitRatio;\r\n    this.uploadValue = new Float32Array(this.uploadArrayLength);\r\n    this.kernel.setUniform3iv(this.dimensionsId, this.dimensions);\r\n    this.kernel.setUniform2iv(this.sizeId, this.textureSize);\r\n    super.updateValue(value);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { WebGLKernelValueMemoryOptimizedNumberTexture } from '../../web-gl/kernel-value/memory-optimized-number-texture';\r\n\r\nexport class WebGL2KernelValueMemoryOptimizedNumberTexture extends WebGLKernelValueMemoryOptimizedNumberTexture {\r\n  getSource() {\r\n    const variablePrecision = this.getVariablePrecisionString();\r\n    return utils.linesToString([\r\n      `uniform sampler2D ${this.id}`,\r\n      `${ variablePrecision } ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,\r\n      `${ variablePrecision } ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`,\r\n    ]);\r\n  }\r\n}\r\n","import { WebGLKernel } from '../web-gl/kernel';\r\nimport { WebGL2FunctionNode } from './function-node';\r\nimport { FunctionBuilder } from '../function-builder';\r\nimport { utils } from '../../utils';\r\nimport { fragmentShader } from './fragment-shader';\r\nimport { vertexShader } from './vertex-shader';\r\nimport { lookupKernelValueType } from './kernel-value-maps';\r\n\r\nlet isSupported = null;\r\nlet testCanvas = null;\r\nlet testContext = null;\r\nlet testExtensions = null;\r\n\r\n/**\r\n *\r\n * @type {IKernelFeatures}\r\n */\r\nlet features = null;\r\n\r\n/**\r\n * @extends WebGLKernel\r\n */\r\nexport class WebGL2Kernel extends WebGLKernel {\r\n  static get isSupported() {\r\n    if (isSupported !== null) {\r\n      return isSupported;\r\n    }\r\n    this.setupFeatureChecks();\r\n    isSupported = this.isContextMatch(testContext);\r\n    return isSupported;\r\n  }\r\n\r\n  static setupFeatureChecks() {\r\n    if (typeof document !== 'undefined') {\r\n      testCanvas = document.createElement('canvas');\r\n    } else if (typeof OffscreenCanvas !== 'undefined') {\r\n      testCanvas = new OffscreenCanvas(0, 0);\r\n    }\r\n    if (!testCanvas) return;\r\n    testContext = testCanvas.getContext('webgl2');\r\n    if (!testContext || !testContext.getExtension) return;\r\n    testExtensions = {\r\n      EXT_color_buffer_float: testContext.getExtension('EXT_color_buffer_float'),\r\n      OES_texture_float_linear: testContext.getExtension('OES_texture_float_linear'),\r\n    };\r\n    features = this.getFeatures();\r\n  }\r\n\r\n  static isContextMatch(context) {\r\n    // from global\r\n    if (typeof WebGL2RenderingContext !== 'undefined') {\r\n      return context instanceof WebGL2RenderingContext;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  static getFeatures() {\r\n    return Object.freeze({\r\n      isFloatRead: this.getIsFloatRead(),\r\n      isIntegerDivisionAccurate: this.getIsIntegerDivisionAccurate(),\r\n      kernelMap: true,\r\n      isTextureFloat: true,\r\n      channelCount: this.getChannelCount(),\r\n    });\r\n  }\r\n\r\n  static getIsTextureFloat() {\r\n    return true;\r\n  }\r\n\r\n  static getIsIntegerDivisionAccurate() {\r\n    return super.getIsIntegerDivisionAccurate();\r\n  }\r\n\r\n  static getChannelCount() {\r\n    return testContext.getParameter(testContext.MAX_DRAW_BUFFERS);\r\n  }\r\n\r\n  static lookupKernelValueType(type, dynamic, precision, value) {\r\n    return lookupKernelValueType(type, dynamic, precision, value);\r\n  }\r\n\r\n  static get testCanvas() {\r\n    return testCanvas;\r\n  }\r\n\r\n  static get testContext() {\r\n    return testContext;\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @returns {{isFloatRead: Boolean, isIntegerDivisionAccurate: Boolean, kernelMap: Boolean, isTextureFloat: Boolean}}\r\n   */\r\n  static get features() {\r\n    return features;\r\n  }\r\n\r\n  static get fragmentShader() {\r\n    return fragmentShader;\r\n  }\r\n  static get vertexShader() {\r\n    return vertexShader;\r\n  }\r\n\r\n  initContext() {\r\n    const settings = {\r\n      alpha: false,\r\n      depth: false,\r\n      antialias: false\r\n    };\r\n    const context = this.canvas.getContext('webgl2', settings);\r\n    return context;\r\n  }\r\n\r\n  initExtensions() {\r\n    this.extensions = {\r\n      EXT_color_buffer_float: this.context.getExtension('EXT_color_buffer_float'),\r\n      OES_texture_float_linear: this.context.getExtension('OES_texture_float_linear'),\r\n    };\r\n  }\r\n\r\n  /**\r\n   * @desc Validate settings related to Kernel, such as dimensions size, and auto output support.\r\n   * @param {IArguments} args\r\n   */\r\n  validateSettings(args) {\r\n    if (!this.validate) {\r\n      this.texSize = utils.getKernelTextureSize({\r\n        optimizeFloatMemory: this.optimizeFloatMemory,\r\n        precision: this.precision,\r\n      }, this.output);\r\n      return;\r\n    }\r\n\r\n    const features = this.constructor.features;\r\n    if (this.precision === 'single' && !features.isFloatRead) {\r\n      throw new Error('Float texture outputs are not supported');\r\n    } else if (!this.graphical && this.precision === null) {\r\n      this.precision = features.isFloatRead ? 'single' : 'unsigned';\r\n    }\r\n\r\n    if (this.fixIntegerDivisionAccuracy === null) {\r\n      this.fixIntegerDivisionAccuracy = !features.isIntegerDivisionAccurate;\r\n    } else if (this.fixIntegerDivisionAccuracy && features.isIntegerDivisionAccurate) {\r\n      this.fixIntegerDivisionAccuracy = false;\r\n    }\r\n\r\n    this.checkOutput();\r\n\r\n    if (!this.output || this.output.length === 0) {\r\n      if (args.length !== 1) {\r\n        throw new Error('Auto output only supported for kernels with only one input');\r\n      }\r\n\r\n      const argType = utils.getVariableType(args[0], this.strictIntegers);\r\n      switch (argType) {\r\n        case 'Array':\r\n          this.output = utils.getDimensions(argType);\r\n          break;\r\n        case 'NumberTexture':\r\n        case 'MemoryOptimizedNumberTexture':\r\n        case 'ArrayTexture(1)':\r\n        case 'ArrayTexture(2)':\r\n        case 'ArrayTexture(3)':\r\n        case 'ArrayTexture(4)':\r\n          this.output = args[0].output;\r\n          break;\r\n        default:\r\n          throw new Error('Auto output not supported for input type: ' + argType);\r\n      }\r\n    }\r\n\r\n    if (this.graphical) {\r\n      if (this.output.length !== 2) {\r\n        throw new Error('Output must have 2 dimensions on graphical mode');\r\n      }\r\n\r\n      if (this.precision === 'single') {\r\n        console.warn('Cannot use graphical mode and single precision at the same time');\r\n        this.precision = 'unsigned';\r\n      }\r\n\r\n      this.texSize = utils.clone(this.output);\r\n      return;\r\n    } else if (!this.graphical && this.precision === null && features.isTextureFloat) {\r\n      this.precision = 'single';\r\n    }\r\n\r\n    this.texSize = utils.getKernelTextureSize({\r\n      optimizeFloatMemory: this.optimizeFloatMemory,\r\n      precision: this.precision,\r\n    }, this.output);\r\n  }\r\n\r\n  translateSource() {\r\n    const functionBuilder = FunctionBuilder.fromKernel(this, WebGL2FunctionNode, {\r\n      fixIntegerDivisionAccuracy: this.fixIntegerDivisionAccuracy\r\n    });\r\n    this.translatedSource = functionBuilder.getPrototypeString('kernel');\r\n    if (!this.graphical && !this.returnType) {\r\n      this.returnType = functionBuilder.getKernelResultType();\r\n    }\r\n\r\n    if (this.subKernels && this.subKernels.length > 0) {\r\n      for (let i = 0; i < this.subKernels.length; i++) {\r\n        const subKernel = this.subKernels[i];\r\n        if (!subKernel.returnType) {\r\n          subKernel.returnType = functionBuilder.getSubKernelResultType(i);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  run() {\r\n    const { kernelArguments, texSize } = this;\r\n    const gl = this.context;\r\n\r\n    gl.useProgram(this.program);\r\n    gl.scissor(0, 0, texSize[0], texSize[1]);\r\n\r\n    if (this.dynamicOutput) {\r\n      this.setUniform3iv('uOutputDim', new Int32Array(this.threadDim));\r\n      this.setUniform2iv('uTexSize', texSize);\r\n    }\r\n\r\n    this.setUniform2f('ratio', texSize[0] / this.maxTexSize[0], texSize[1] / this.maxTexSize[1]);\r\n\r\n    for (let i = 0; i < kernelArguments.length; i++) {\r\n      kernelArguments[i].updateValue(arguments[i]);\r\n      if (this.switchingKernels) return;\r\n    }\r\n\r\n    if (this.plugins) {\r\n      for (let i = 0; i < this.plugins.length; i++) {\r\n        const plugin = this.plugins[i];\r\n        if (plugin.onBeforeRun) {\r\n          plugin.onBeforeRun(this);\r\n        }\r\n      }\r\n    }\r\n\r\n    if (this.graphical) {\r\n      if (this.pipeline) {\r\n        gl.bindRenderbuffer(gl.RENDERBUFFER, null);\r\n        gl.bindFramebuffer(gl.FRAMEBUFFER, this.framebuffer);\r\n        if (!this.outputTexture || this.immutable) {\r\n          this._setupOutputTexture();\r\n        }\r\n        gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\r\n        return new this.TextureConstructor({\r\n          texture: this.outputTexture,\r\n          size: texSize,\r\n          dimensions: this.threadDim,\r\n          output: this.output,\r\n          context: this.context\r\n        });\r\n      }\r\n      gl.bindRenderbuffer(gl.RENDERBUFFER, null);\r\n      gl.bindFramebuffer(gl.FRAMEBUFFER, null);\r\n      gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\r\n      return;\r\n    }\r\n\r\n    gl.bindFramebuffer(gl.FRAMEBUFFER, this.framebuffer);\r\n    if (this.immutable) {\r\n      this._setupOutputTexture();\r\n    }\r\n\r\n    if (this.subKernels !== null) {\r\n      if (this.immutable) {\r\n        this._setupSubOutputTextures();\r\n      }\r\n      gl.drawBuffers(this.drawBuffersMap);\r\n    }\r\n\r\n    gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\r\n  }\r\n\r\n  drawBuffers() {\r\n    this.context.drawBuffers(this.drawBuffersMap);\r\n  }\r\n\r\n  getOutputTexture() {\r\n    return this.outputTexture;\r\n  }\r\n\r\n  _setupOutputTexture() {\r\n    const { texSize } = this;\r\n    const gl = this.context;\r\n    const texture = this.outputTexture = gl.createTexture();\r\n    gl.activeTexture(gl.TEXTURE0 + this.constantTextureCount + this.argumentTextureCount);\r\n    gl.bindTexture(gl.TEXTURE_2D, texture);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\r\n    if (this.precision === 'single') {\r\n      if (this.pipeline) {\r\n        switch (this.returnType) {\r\n          case 'Number':\r\n          case 'Float':\r\n          case 'Integer':\r\n            if (this.optimizeFloatMemory) {\r\n              gl.texStorage2D(gl.TEXTURE_2D, 1, gl.RGBA32F, texSize[0], texSize[1]);\r\n            } else {\r\n              gl.texStorage2D(gl.TEXTURE_2D, 1, gl.R32F, texSize[0], texSize[1]);\r\n            }\r\n            break;\r\n          case 'Array(2)':\r\n            gl.texStorage2D(gl.TEXTURE_2D, 1, gl.RG32F, texSize[0], texSize[1]);\r\n            break;\r\n          case 'Array(3)': // there is _no_ 3 channel format which is guaranteed to be color-renderable\r\n          case 'Array(4)':\r\n            gl.texStorage2D(gl.TEXTURE_2D, 1, gl.RGBA32F, texSize[0], texSize[1]);\r\n            break;\r\n          default:\r\n            throw new Error('Unhandled return type');\r\n        }\r\n      } else {\r\n        gl.texStorage2D(gl.TEXTURE_2D, 1, gl.RGBA32F, texSize[0], texSize[1]);\r\n      }\r\n    } else {\r\n      gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, texSize[0], texSize[1], 0, gl.RGBA, gl.UNSIGNED_BYTE, null);\r\n    }\r\n    gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, texture, 0);\r\n  }\r\n\r\n  _setupSubOutputTextures() {\r\n    const { texSize } = this;\r\n    const gl = this.context;\r\n    this.drawBuffersMap = [gl.COLOR_ATTACHMENT0];\r\n    this.subKernelOutputTextures = [];\r\n    for (let i = 0; i < this.subKernels.length; i++) {\r\n      const texture = this.context.createTexture();\r\n      this.subKernelOutputTextures.push(texture);\r\n      this.drawBuffersMap.push(gl.COLOR_ATTACHMENT0 + i + 1);\r\n      gl.activeTexture(gl.TEXTURE0 + this.constantTextureCount + this.argumentTextureCount + i);\r\n      gl.bindTexture(gl.TEXTURE_2D, texture);\r\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\r\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\r\n      // TODO: upgrade this\r\n      if (this.precision === 'single') {\r\n        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA32F, texSize[0], texSize[1], 0, gl.RGBA, gl.FLOAT, null);\r\n      } else {\r\n        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, texSize[0], texSize[1], 0, gl.RGBA, gl.UNSIGNED_BYTE, null);\r\n      }\r\n      gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0 + i + 1, gl.TEXTURE_2D, texture, 0);\r\n    }\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @desc Get the header string for the program.\r\n   * This returns an empty string if no sub-kernels are defined.\r\n   *\r\n   * @returns {String} result\r\n   */\r\n  _getHeaderString() {\r\n    return '';\r\n  }\r\n\r\n  /**\r\n   * @desc Get texture coordinate string for the program\r\n   * @returns {String} result\r\n   */\r\n  _getTextureCoordinate() {\r\n    const subKernels = this.subKernels;\r\n    if (subKernels === null || subKernels.length < 1) {\r\n      switch (this.tactic) {\r\n        case 'speed':\r\n          return 'in lowp vec2 vTexCoord;\\n';\r\n        case 'performance':\r\n          return 'in highp vec2 vTexCoord;\\n';\r\n        case 'balanced':\r\n        default:\r\n          return 'in mediump vec2 vTexCoord;\\n';\r\n      }\r\n    } else {\r\n      switch (this.tactic) {\r\n        case 'speed':\r\n          return 'out lowp vec2 vTexCoord;\\n';\r\n        case 'performance':\r\n          return 'out highp vec2 vTexCoord;\\n';\r\n        case 'balanced':\r\n        default:\r\n          return 'out mediump vec2 vTexCoord;\\n';\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @desc Generate transpiled glsl Strings for user-defined parameters sent to a kernel\r\n   * @param {Array} args - The actual parameters sent to the Kernel\r\n   * @returns {String} result\r\n   */\r\n  _getMainArgumentsString(args) {\r\n    const result = [];\r\n    const argumentNames = this.argumentNames;\r\n    for (let i = 0; i < argumentNames.length; i++) {\r\n      result.push(this.kernelArguments[i].getSource(args[i]));\r\n    }\r\n    return result.join('');\r\n  }\r\n\r\n  /**\r\n   * @desc Get Kernel program string (in *glsl*) for a kernel.\r\n   * @returns {String} result\r\n   */\r\n  getKernelString() {\r\n    let kernelResultDeclaration;\r\n    switch (this.returnType) {\r\n      case 'Array(2)':\r\n        kernelResultDeclaration = 'vec2 kernelResult';\r\n        break;\r\n      case 'Array(3)':\r\n        kernelResultDeclaration = 'vec3 kernelResult';\r\n        break;\r\n      case 'Array(4)':\r\n        kernelResultDeclaration = 'vec4 kernelResult';\r\n        break;\r\n      case 'LiteralInteger':\r\n      case 'Float':\r\n      case 'Number':\r\n      case 'Integer':\r\n        kernelResultDeclaration = 'float kernelResult';\r\n        break;\r\n      default:\r\n        if (this.graphical) {\r\n          kernelResultDeclaration = 'float kernelResult';\r\n        } else {\r\n          throw new Error(`unrecognized output type \"${ this.returnType }\"`);\r\n        }\r\n    }\r\n\r\n    const result = [];\r\n    const subKernels = this.subKernels;\r\n    if (subKernels !== null) {\r\n      result.push(\r\n        kernelResultDeclaration,\r\n        'layout(location = 0) out vec4 data0'\r\n      );\r\n      for (let i = 0; i < subKernels.length; i++) {\r\n        const subKernel = subKernels[i];\r\n        result.push(\r\n          subKernel.returnType === 'Integer' ?\r\n          `int subKernelResult_${ subKernel.name } = 0` :\r\n          `float subKernelResult_${ subKernel.name } = 0.0`,\r\n          `layout(location = ${ i + 1 }) out vec4 data${ i + 1 }`\r\n        );\r\n      }\r\n    } else {\r\n      result.push(\r\n        'out vec4 data0',\r\n        kernelResultDeclaration\r\n      );\r\n    }\r\n\r\n    return utils.linesToString(result) + this.translatedSource;\r\n  }\r\n\r\n  getMainResultGraphical() {\r\n    return utils.linesToString([\r\n      '  threadId = indexTo3D(index, uOutputDim)',\r\n      '  kernel()',\r\n      '  data0 = actualColor',\r\n    ]);\r\n  }\r\n\r\n  getMainResultPackedPixels() {\r\n    switch (this.returnType) {\r\n      case 'LiteralInteger':\r\n      case 'Number':\r\n      case 'Integer':\r\n      case 'Float':\r\n        return this.getMainResultKernelPackedPixels() +\r\n          this.getMainResultSubKernelPackedPixels();\r\n      default:\r\n        throw new Error(`packed output only usable with Numbers, \"${this.returnType}\" specified`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @return {String}\r\n   */\r\n  getMainResultKernelPackedPixels() {\r\n    return utils.linesToString([\r\n      '  threadId = indexTo3D(index, uOutputDim)',\r\n      '  kernel()',\r\n      `  data0 = ${this.useLegacyEncoder ? 'legacyEncode32' : 'encode32'}(kernelResult)`\r\n    ]);\r\n  }\r\n\r\n  /**\r\n   * @return {String}\r\n   */\r\n  getMainResultSubKernelPackedPixels() {\r\n    const result = [];\r\n    if (!this.subKernels) return '';\r\n    for (let i = 0; i < this.subKernels.length; i++) {\r\n      const subKernel = this.subKernels[i];\r\n      if (subKernel.returnType === 'Integer') {\r\n        result.push(\r\n          `  data${i + 1} = ${this.useLegacyEncoder ? 'legacyEncode32' : 'encode32'}(float(subKernelResult_${this.subKernels[i].name}))`\r\n        );\r\n      } else {\r\n        result.push(\r\n          `  data${i + 1} = ${this.useLegacyEncoder ? 'legacyEncode32' : 'encode32'}(subKernelResult_${this.subKernels[i].name})`\r\n        );\r\n      }\r\n    }\r\n    return utils.linesToString(result);\r\n  }\r\n\r\n  getMainResultMemoryOptimizedFloats() {\r\n    const result = [\r\n      '  index *= 4',\r\n    ];\r\n\r\n    switch (this.returnType) {\r\n      case 'Number':\r\n      case 'Integer':\r\n      case 'Float':\r\n        const channels = ['r', 'g', 'b', 'a'];\r\n        for (let i = 0; i < channels.length; i++) {\r\n          const channel = channels[i];\r\n          this.getMainResultKernelMemoryOptimizedFloats(result, channel);\r\n          this.getMainResultSubKernelMemoryOptimizedFloats(result, channel);\r\n          if (i + 1 < channels.length) {\r\n            result.push('  index += 1');\r\n          }\r\n        }\r\n        break;\r\n      default:\r\n        throw new Error(`optimized output only usable with Numbers, ${this.returnType} specified`);\r\n    }\r\n\r\n    return utils.linesToString(result);\r\n  }\r\n\r\n  getMainResultKernelMemoryOptimizedFloats(result, channel) {\r\n    result.push(\r\n      '  threadId = indexTo3D(index, uOutputDim)',\r\n      '  kernel()',\r\n      `  data0.${channel} = kernelResult`,\r\n    );\r\n  }\r\n\r\n  getMainResultSubKernelMemoryOptimizedFloats(result, channel) {\r\n    if (!this.subKernels) return result;\r\n    for (let i = 0; i < this.subKernels.length; i++) {\r\n      const subKernel = this.subKernels[i];\r\n      if (subKernel.returnType === 'Integer') {\r\n        result.push(\r\n          `  data${i + 1}.${channel} = float(subKernelResult_${subKernel.name})`,\r\n        );\r\n      } else {\r\n        result.push(\r\n          `  data${i + 1}.${channel} = subKernelResult_${subKernel.name}`,\r\n        );\r\n      }\r\n    }\r\n  }\r\n\r\n  getMainResultKernelNumberTexture() {\r\n    return [\r\n      '  threadId = indexTo3D(index, uOutputDim)',\r\n      '  kernel()',\r\n      '  data0[0] = kernelResult',\r\n    ];\r\n  }\r\n\r\n  getMainResultSubKernelNumberTexture() {\r\n    const result = [];\r\n    if (!this.subKernels) return result;\r\n    for (let i = 0; i < this.subKernels.length; ++i) {\r\n      const subKernel = this.subKernels[i];\r\n      if (subKernel.returnType === 'Integer') {\r\n        result.push(\r\n          `  data${i + 1}[0] = float(subKernelResult_${subKernel.name})`,\r\n        );\r\n      } else {\r\n        result.push(\r\n          `  data${i + 1}[0] = subKernelResult_${subKernel.name}`,\r\n        );\r\n      }\r\n    }\r\n    return result;\r\n  }\r\n\r\n  getMainResultKernelArray2Texture() {\r\n    return [\r\n      '  threadId = indexTo3D(index, uOutputDim)',\r\n      '  kernel()',\r\n      '  data0[0] = kernelResult[0]',\r\n      '  data0[1] = kernelResult[1]',\r\n    ];\r\n  }\r\n\r\n  getMainResultSubKernelArray2Texture() {\r\n    const result = [];\r\n    if (!this.subKernels) return result;\r\n    for (let i = 0; i < this.subKernels.length; ++i) {\r\n      const subKernel = this.subKernels[i];\r\n      result.push(\r\n        `  data${i + 1}[0] = subKernelResult_${subKernel.name}[0]`,\r\n        `  data${i + 1}[1] = subKernelResult_${subKernel.name}[1]`,\r\n      );\r\n    }\r\n    return result;\r\n  }\r\n\r\n  getMainResultKernelArray3Texture() {\r\n    return [\r\n      '  threadId = indexTo3D(index, uOutputDim)',\r\n      '  kernel()',\r\n      '  data0[0] = kernelResult[0]',\r\n      '  data0[1] = kernelResult[1]',\r\n      '  data0[2] = kernelResult[2]',\r\n    ];\r\n  }\r\n\r\n  getMainResultSubKernelArray3Texture() {\r\n    const result = [];\r\n    if (!this.subKernels) return result;\r\n    for (let i = 0; i < this.subKernels.length; ++i) {\r\n      const subKernel = this.subKernels[i];\r\n      result.push(\r\n        `  data${i + 1}[0] = subKernelResult_${subKernel.name}[0]`,\r\n        `  data${i + 1}[1] = subKernelResult_${subKernel.name}[1]`,\r\n        `  data${i + 1}[2] = subKernelResult_${subKernel.name}[2]`,\r\n      );\r\n    }\r\n    return result;\r\n  }\r\n\r\n  getMainResultKernelArray4Texture() {\r\n    return [\r\n      '  threadId = indexTo3D(index, uOutputDim)',\r\n      '  kernel()',\r\n      '  data0 = kernelResult',\r\n    ];\r\n  }\r\n\r\n  getMainResultSubKernelArray4Texture() {\r\n    const result = [];\r\n    if (!this.subKernels) return result;\r\n    for (let i = 0; i < this.subKernels.length; ++i) {\r\n      result.push(\r\n        `  data${i + 1} = subKernelResult_${this.subKernels[i].name}`,\r\n      );\r\n    }\r\n    return result;\r\n  }\r\n\r\n  destroyExtensions() {\r\n    this.extensions.EXT_color_buffer_float = null;\r\n    this.extensions.OES_texture_float_linear = null;\r\n  }\r\n\r\n  toJSON() {\r\n    const json = super.toJSON();\r\n    json.functionNodes = FunctionBuilder.fromKernel(this, WebGL2FunctionNode).toJSON();\r\n    return json;\r\n  }\r\n}\r\n","import { utils } from './utils';\r\n\r\n/**\r\n * Makes kernels easier for mortals (including me)\r\n * @param kernel\r\n * @returns {function()}\r\n */\r\nexport function kernelRunShortcut(kernel) {\r\n  let run = function() {\r\n    kernel.build.apply(kernel, arguments);\r\n    if (kernel.renderKernels) {\r\n      run = function() {\r\n        kernel.run.apply(kernel, arguments);\r\n        if (kernel.switchingKernels) {\r\n          kernel.switchingKernels = false;\r\n          return kernel.onRequestSwitchKernel(arguments, kernel);\r\n        }\r\n        return kernel.renderKernels();\r\n      };\r\n    } else if (kernel.renderOutput) {\r\n      run = function() {\r\n        kernel.run.apply(kernel, arguments);\r\n        if (kernel.switchingKernels) {\r\n          kernel.switchingKernels = false;\r\n          return kernel.onRequestSwitchKernel(arguments, kernel);\r\n        }\r\n        return kernel.renderOutput();\r\n      };\r\n    } else {\r\n      run = function() {\r\n        return kernel.run.apply(kernel, arguments);\r\n      };\r\n    }\r\n    return run.apply(kernel, arguments);\r\n  };\r\n  const shortcut = function() {\r\n    return run.apply(kernel, arguments);\r\n  };\r\n  /**\r\n   * Run kernel in async mode\r\n   * @returns {Promise<KernelOutput>}\r\n   */\r\n  shortcut.exec = function() {\r\n    return new Promise((accept, reject) => {\r\n      try {\r\n        accept(run.apply(this, arguments));\r\n      } catch (e) {\r\n        reject(e);\r\n      }\r\n    });\r\n  };\r\n  shortcut.replaceKernel = function(replacementKernel) {\r\n    kernel = replacementKernel;\r\n    bindKernelToShortcut(kernel, shortcut);\r\n    shortcut.kernel = kernel;\r\n  };\r\n\r\n  bindKernelToShortcut(kernel, shortcut);\r\n  shortcut.kernel = kernel;\r\n  return shortcut;\r\n}\r\n\r\nfunction bindKernelToShortcut(kernel, shortcut) {\r\n  const properties = utils.allPropertiesOf(kernel);\r\n  for (let i = 0; i < properties.length; i++) {\r\n    const property = properties[i];\r\n    if (property[0] === '_' && property[1] === '_') continue;\r\n    if (typeof kernel[property] === 'function') {\r\n      if (property.substring(0, 3) === 'add' || property.substring(0, 3) === 'set') {\r\n        shortcut[property] = function() {\r\n          kernel[property].apply(kernel, arguments);\r\n          return shortcut;\r\n        };\r\n      } else {\r\n        if (property === 'toString') {\r\n          shortcut.toString = function() {\r\n            return kernel.toString.apply(kernel, arguments);\r\n          };\r\n        } else {\r\n          shortcut[property] = kernel[property].bind(kernel);\r\n        }\r\n      }\r\n    } else {\r\n      shortcut.__defineGetter__(property, () => {\r\n        return kernel[property];\r\n      });\r\n      shortcut.__defineSetter__(property, (value) => {\r\n        kernel[property] = value;\r\n      });\r\n    }\r\n  }\r\n}\r\n","import { gpuMock } from 'gpu-mock.js';\r\nimport { CPUKernel } from './backend/cpu/kernel';\r\nimport { WebGL2Kernel } from './backend/web-gl2/kernel';\r\nimport { WebGLKernel } from './backend/web-gl/kernel';\r\nimport { kernelRunShortcut } from './kernel-run-shortcut';\r\nimport {\r\n  functionToIFunction,\r\n  getFunctionNameFromString,\r\n  isFunction,\r\n  warnDeprecated\r\n} from './common';\r\nimport { getVariableType } from './utils';\r\n\r\n/**\r\n * @type {Kernel[]}\r\n */\r\nconst kernelOrder = [ WebGL2Kernel, WebGLKernel ];\r\n\r\n/**\r\n * @type {string[]}\r\n */\r\nconst kernelTypes = [ 'gpu', 'cpu' ];\r\n\r\nconst internalKernels = {\r\n  'webgl2': WebGL2Kernel,\r\n  'webgl': WebGLKernel,\r\n};\r\n\r\nlet validate = true;\r\n\r\n/**\r\n * The GPU.js library class which manages the GPU context for the creating kernels\r\n */\r\nexport class GPU {\r\n  static disableValidation() {\r\n    validate = false;\r\n  }\r\n\r\n  static enableValidation() {\r\n    validate = true;\r\n  }\r\n\r\n  static get isGPUSupported() {\r\n    return kernelOrder.some(Kernel => Kernel.isSupported);\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @returns {boolean}\r\n   */\r\n  static get isKernelMapSupported() {\r\n    return kernelOrder.some(Kernel => Kernel.isSupported && Kernel.features.kernelMap);\r\n  }\r\n\r\n  /**\r\n   * @desc TRUE is platform supports OffscreenCanvas\r\n   */\r\n  static get isOffscreenCanvasSupported() {\r\n    return (typeof Worker !== 'undefined' && typeof OffscreenCanvas !== 'undefined') || typeof importScripts !== 'undefined';\r\n  }\r\n\r\n  /**\r\n   * @desc TRUE if platform supports WebGL\r\n   */\r\n  static get isWebGLSupported() {\r\n    return WebGLKernel.isSupported;\r\n  }\r\n\r\n  /**\r\n   * @desc TRUE if platform supports WebGL2\r\n   */\r\n  static get isWebGL2Supported() {\r\n    return WebGL2Kernel.isSupported;\r\n  }\r\n\r\n  /**\r\n   * @desc TRUE if platform supports HeadlessGL\r\n   */\r\n  static get isHeadlessGLSupported() {\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @desc TRUE if platform supports Canvas\r\n   */\r\n  static get isCanvasSupported() {\r\n    return typeof HTMLCanvasElement !== 'undefined';\r\n  }\r\n\r\n  /**\r\n   * @desc TRUE if platform supports HTMLImageArray}\r\n   */\r\n  static get isGPUHTMLImageArraySupported() {\r\n    return WebGL2Kernel.isSupported;\r\n  }\r\n\r\n  /**\r\n   * @desc TRUE if platform supports single precision}\r\n   * @returns {boolean}\r\n   */\r\n  static get isSinglePrecisionSupported() {\r\n    return kernelOrder.some(Kernel => Kernel.isSupported && Kernel.features.isFloatRead && Kernel.features.isTextureFloat);\r\n  }\r\n\r\n  /**\r\n   * Creates an instance of GPU.\r\n   * @param {IGPUSettings} [settings] - Settings to set mode, and other properties\r\n   */\r\n  constructor(settings) {\r\n    settings = settings || {};\r\n    this.canvas = settings.canvas || null;\r\n    this.context = settings.context || null;\r\n    this.mode = settings.mode;\r\n    this.Kernel = null;\r\n    this.kernels = [];\r\n    this.functions = [];\r\n    this.nativeFunctions = [];\r\n    this.injectedNative = null;\r\n    if (this.mode === 'dev') return;\r\n    this.chooseKernel();\r\n    // add functions from settings\r\n    if (settings.functions) {\r\n      for (let i = 0; i < settings.functions.length; i++) {\r\n        this.addFunction(settings.functions[i]);\r\n      }\r\n    }\r\n\r\n    // add native functions from settings\r\n    if (settings.nativeFunctions) {\r\n      for (const p in settings.nativeFunctions) {\r\n        this.addNativeFunction(p, settings.nativeFunctions[p]);\r\n      }\r\n    }\r\n  }\r\n\r\n  getValidate() {\r\n    return validate;\r\n  }\r\n\r\n  /**\r\n   * Choose kernel type and save on .Kernel property of GPU\r\n   */\r\n  chooseKernel() {\r\n    if (this.Kernel) return;\r\n\r\n    let Kernel = null;\r\n\r\n    if (this.context) {\r\n      for (let i = 0; i < kernelOrder.length; i++) {\r\n        const ExternalKernel = kernelOrder[i];\r\n        if (ExternalKernel.isContextMatch(this.context)) {\r\n          if (!ExternalKernel.isSupported) {\r\n            throw new Error(`Kernel type ${ExternalKernel.name} not supported`);\r\n          }\r\n          Kernel = ExternalKernel;\r\n          break;\r\n        }\r\n      }\r\n      if (Kernel === null) {\r\n        throw new Error('unknown Context');\r\n      }\r\n    } else if (this.mode) {\r\n      if (this.mode in internalKernels) {\r\n        if (!validate || internalKernels[this.mode].isSupported) {\r\n          Kernel = internalKernels[this.mode];\r\n        }\r\n      } else if (this.mode === 'gpu') {\r\n        for (let i = 0; i < kernelOrder.length; i++) {\r\n          if (kernelOrder[i].isSupported) {\r\n            Kernel = kernelOrder[i];\r\n            break;\r\n          }\r\n        }\r\n      } else if (this.mode === 'cpu') {\r\n        Kernel = CPUKernel;\r\n      }\r\n      if (!Kernel) {\r\n        throw new Error(`A requested mode of \"${this.mode}\" and is not supported`);\r\n      }\r\n    } else {\r\n      for (let i = 0; i < kernelOrder.length; i++) {\r\n        if (kernelOrder[i].isSupported) {\r\n          Kernel = kernelOrder[i];\r\n          break;\r\n        }\r\n      }\r\n      if (!Kernel) {\r\n        Kernel = CPUKernel;\r\n      }\r\n    }\r\n\r\n    if (!this.mode) {\r\n      this.mode = Kernel.mode;\r\n    }\r\n    this.Kernel = Kernel;\r\n  }\r\n\r\n  /**\r\n   * @desc This creates a callable function object to call the kernel function with the argument parameter set\r\n   * @param {Function|String|object} source - The calling to perform the conversion\r\n   * @param {Object} [settings] - The parameter configuration object\r\n   * @return {Kernel} callable function to run\r\n   */\r\n  createKernel(source, settings) {\r\n    if (typeof source === 'undefined') {\r\n      throw new Error('Missing source parameter');\r\n    }\r\n    if (typeof source !== 'object' && !isFunction(source) && typeof source !== 'string') {\r\n      throw new Error('source parameter not a function');\r\n    }\r\n\r\n    if (this.mode === 'dev') {\r\n      const devKernel = gpuMock(source, upgradeDeprecatedCreateKernelSettings(settings));\r\n      this.kernels.push(devKernel);\r\n      return devKernel;\r\n    }\r\n\r\n    source = typeof source === 'function' ? source.toString() : source;\r\n    const switchableKernels = {};\r\n    const settingsCopy = upgradeDeprecatedCreateKernelSettings(settings) || {};\r\n    // handle conversion of argumentTypes\r\n    if (settings && typeof settings.argumentTypes === 'object') {\r\n      settingsCopy.argumentTypes = Object.keys(settings.argumentTypes).map(argumentName => settings.argumentTypes[argumentName]);\r\n    }\r\n\r\n    function onRequestFallback(args) {\r\n      const fallbackKernel = new CPUKernel(source, {\r\n        argumentTypes: kernelRun.argumentTypes,\r\n        constantTypes: kernelRun.constantTypes,\r\n        graphical: kernelRun.graphical,\r\n        loopMaxIterations: kernelRun.loopMaxIterations,\r\n        constants: kernelRun.constants,\r\n        dynamicOutput: kernelRun.dynamicOutput,\r\n        dynamicArgument: kernelRun.dynamicArguments,\r\n        output: kernelRun.output,\r\n        precision: kernelRun.precision,\r\n        pipeline: kernelRun.pipeline,\r\n        immutable: kernelRun.immutable,\r\n        optimizeFloatMemory: kernelRun.optimizeFloatMemory,\r\n        fixIntegerDivisionAccuracy: kernelRun.fixIntegerDivisionAccuracy,\r\n        functions: kernelRun.functions,\r\n        nativeFunctions: kernelRun.nativeFunctions,\r\n        injectedNative: kernelRun.injectedNative,\r\n        subKernels: kernelRun.subKernels,\r\n        strictIntegers: kernelRun.strictIntegers,\r\n        debug: kernelRun.debug,\r\n        warnVarUsage: kernelRun.warnVarUsage,\r\n      });\r\n      fallbackKernel.build.apply(fallbackKernel, args);\r\n      const result = fallbackKernel.run.apply(fallbackKernel, args);\r\n      kernelRun.replaceKernel(fallbackKernel);\r\n      return result;\r\n    }\r\n\r\n    function onRequestSwitchKernel(args, kernel) {\r\n      const argumentTypes = new Array(args.length);\r\n      for (let i = 0; i < args.length; i++) {\r\n        const arg = args[i];\r\n        const type = kernel.argumentTypes[i];\r\n        if (arg.type) {\r\n          argumentTypes[i] = arg.type;\r\n        } else {\r\n          switch (type) {\r\n            case 'Number':\r\n            case 'Integer':\r\n            case 'Float':\r\n            case 'ArrayTexture(1)':\r\n              argumentTypes[i] = getVariableType(arg);\r\n              break;\r\n            default:\r\n              argumentTypes[i] = type;\r\n          }\r\n        }\r\n      }\r\n      const signature = argumentTypes.join(',');\r\n      const existingKernel = switchableKernels[signature];\r\n      if (existingKernel) {\r\n        existingKernel.run.apply(existingKernel, args);\r\n        if (existingKernel.renderKernels) {\r\n          return existingKernel.renderKernels();\r\n        } else {\r\n          return existingKernel.renderOutput();\r\n        }\r\n      }\r\n\r\n      const newKernel = switchableKernels[signature] = new kernel.constructor(source, {\r\n        argumentTypes,\r\n        constantTypes: kernel.constantTypes,\r\n        graphical: kernel.graphical,\r\n        loopMaxIterations: kernel.loopMaxIterations,\r\n        constants: kernel.constants,\r\n        dynamicOutput: kernel.dynamicOutput,\r\n        dynamicArgument: kernel.dynamicArguments,\r\n        context: kernel.context,\r\n        canvas: kernel.canvas,\r\n        output: kernel.output,\r\n        precision: kernel.precision,\r\n        pipeline: kernel.pipeline,\r\n        immutable: kernel.immutable,\r\n        optimizeFloatMemory: kernel.optimizeFloatMemory,\r\n        fixIntegerDivisionAccuracy: kernel.fixIntegerDivisionAccuracy,\r\n        functions: kernel.functions,\r\n        nativeFunctions: kernel.nativeFunctions,\r\n        injectedNative: kernel.injectedNative,\r\n        subKernels: kernel.subKernels,\r\n        strictIntegers: kernel.strictIntegers,\r\n        debug: kernel.debug,\r\n        gpu: kernel.gpu,\r\n        validate,\r\n        warnVarUsage: kernel.warnVarUsage,\r\n        returnType: kernel.returnType,\r\n        onRequestFallback,\r\n        onRequestSwitchKernel,\r\n      });\r\n      newKernel.build.apply(newKernel, args);\r\n      newKernel.run.apply(newKernel, args);\r\n      kernelRun.replaceKernel(newKernel);\r\n      if (newKernel.renderKernels) {\r\n        return newKernel.renderKernels();\r\n      } else {\r\n        return newKernel.renderOutput();\r\n      }\r\n    }\r\n    const mergedSettings = Object.assign({\r\n      context: this.context,\r\n      canvas: this.canvas,\r\n      functions: this.functions,\r\n      nativeFunctions: this.nativeFunctions,\r\n      injectedNative: this.injectedNative,\r\n      gpu: this,\r\n      validate,\r\n      onRequestFallback,\r\n      onRequestSwitchKernel\r\n    }, settingsCopy);\r\n\r\n    const kernelRun = kernelRunShortcut(new this.Kernel(source, mergedSettings));\r\n\r\n    //if canvas didn't come from this, propagate from kernel\r\n    if (!this.canvas) {\r\n      this.canvas = kernelRun.canvas;\r\n    }\r\n\r\n    //if context didn't come from this, propagate from kernel\r\n    if (!this.context) {\r\n      this.context = kernelRun.context;\r\n    }\r\n\r\n    this.kernels.push(kernelRun);\r\n\r\n    return kernelRun;\r\n  }\r\n\r\n  /**\r\n   *\r\n   * Create a super kernel which executes sub kernels\r\n   * and saves their output to be used with the next sub kernel.\r\n   * This can be useful if we want to save the output on one kernel,\r\n   * and then use it as an input to another kernel. *Machine Learning*\r\n   *\r\n   * @param {Object|Array} subKernels - Sub kernels for this kernel\r\n   * @param {Function} rootKernel - Root kernel\r\n   *\r\n   * @returns {Function} callable kernel function\r\n   *\r\n   * @example\r\n   * const megaKernel = gpu.createKernelMap({\r\n   *   addResult: function add(a, b) {\r\n   *     return a[this.thread.x] + b[this.thread.x];\r\n   *   },\r\n   *   multiplyResult: function multiply(a, b) {\r\n   *     return a[this.thread.x] * b[this.thread.x];\r\n   *   },\r\n   *  }, function(a, b, c) {\r\n   *       return multiply(add(a, b), c);\r\n   * });\r\n   *\r\n   * megaKernel(a, b, c);\r\n   *\r\n   * Note: You can also define subKernels as an array of functions.\r\n   * > [add, multiply]\r\n   *\r\n   */\r\n  createKernelMap() {\r\n    let fn;\r\n    let settings;\r\n    if (typeof arguments[arguments.length - 2] === 'function') {\r\n      fn = arguments[arguments.length - 2];\r\n      settings = arguments[arguments.length - 1];\r\n    } else {\r\n      fn = arguments[arguments.length - 1];\r\n    }\r\n\r\n    if (this.mode !== 'dev') {\r\n      if (!this.Kernel.isSupported || !this.Kernel.features.kernelMap) {\r\n        if (this.mode && kernelTypes.indexOf(this.mode) < 0) {\r\n          throw new Error(`kernelMap not supported on ${this.Kernel.name}`);\r\n        }\r\n      }\r\n    }\r\n\r\n    const settingsCopy = upgradeDeprecatedCreateKernelSettings(settings);\r\n    // handle conversion of argumentTypes\r\n    if (settings && typeof settings.argumentTypes === 'object') {\r\n      settingsCopy.argumentTypes = Object.keys(settings.argumentTypes).map(argumentName => settings.argumentTypes[argumentName]);\r\n    }\r\n\r\n    if (Array.isArray(arguments[0])) {\r\n      settingsCopy.subKernels = [];\r\n      const functions = arguments[0];\r\n      for (let i = 0; i < functions.length; i++) {\r\n        const source = functions[i].toString();\r\n        const name = getFunctionNameFromString(source);\r\n        settingsCopy.subKernels.push({\r\n          name,\r\n          source,\r\n          property: i,\r\n        });\r\n      }\r\n    } else {\r\n      settingsCopy.subKernels = [];\r\n      const functions = arguments[0];\r\n      for (let p in functions) {\r\n        if (!functions.hasOwnProperty(p)) continue;\r\n        const source = functions[p].toString();\r\n        const name = getFunctionNameFromString(source);\r\n        settingsCopy.subKernels.push({\r\n          name: name || p,\r\n          source,\r\n          property: p,\r\n        });\r\n      }\r\n    }\r\n    const kernel = this.createKernel(fn, settingsCopy);\r\n\r\n    return kernel;\r\n  }\r\n\r\n  /**\r\n   *\r\n   * Combine different kernels into one super Kernel,\r\n   * useful to perform multiple operations inside one\r\n   * kernel without the penalty of data transfer between\r\n   * cpu and gpu.\r\n   *\r\n   * The number of kernel functions sent to this method can be variable.\r\n   * You can send in one, two, etc.\r\n   *\r\n   * @param {Function} subKernels - Kernel function(s) to combine.\r\n   * @param {Function} rootKernel - Root kernel to combine kernels into\r\n   *\r\n   * @example\r\n   *   combineKernels(add, multiply, function(a,b,c){\r\n   *     return add(multiply(a,b), c)\r\n   *  })\r\n   *\r\n   * @returns {Function} Callable kernel function\r\n   *\r\n   */\r\n  combineKernels() {\r\n    const firstKernel = arguments[0];\r\n    const combinedKernel = arguments[arguments.length - 1];\r\n    if (firstKernel.kernel.constructor.mode === 'cpu') return combinedKernel;\r\n    const canvas = arguments[0].canvas;\r\n    const context = arguments[0].context;\r\n    const max = arguments.length - 1;\r\n    for (let i = 0; i < max; i++) {\r\n      arguments[i]\r\n        .setCanvas(canvas)\r\n        .setContext(context)\r\n        .setPipeline(true);\r\n    }\r\n\r\n    return function() {\r\n      const texture = combinedKernel.apply(this, arguments);\r\n      if (texture.toArray) {\r\n        return texture.toArray();\r\n      }\r\n      return texture;\r\n    };\r\n  }\r\n\r\n  /**\r\n   * @desc Adds additional functions, that the kernel may call.\r\n   * @param {Function|String} source - Javascript function to convert\r\n   * @param {IFunctionSettings} [settings]\r\n   * @returns {GPU} returns itself\r\n   */\r\n  addFunction(source, settings) {\r\n    this.functions.push(functionToIFunction(source, settings));\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * @desc Adds additional native functions, that the kernel may call.\r\n   * @param {String} name - native function name, used for reverse lookup\r\n   * @param {String} source - the native function implementation, as it would be defined in it's entirety\r\n   * @param {object} [settings]\r\n   * @returns {GPU} returns itself\r\n   */\r\n  addNativeFunction(name, source, settings) {\r\n    if (this.kernels.length > 0) {\r\n      throw new Error('Cannot call \"addNativeFunction\" after \"createKernels\" has been called.');\r\n    }\r\n    settings = settings || {};\r\n    const { argumentTypes, argumentNames } = this.Kernel.nativeFunctionArguments(source) || {};\r\n    this.nativeFunctions.push({\r\n      name,\r\n      source,\r\n      settings,\r\n      argumentTypes,\r\n      argumentNames,\r\n      returnType: settings.returnType || this.Kernel.nativeFunctionReturnType(source),\r\n    });\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Inject a string just before translated kernel functions\r\n   * @param {String} source\r\n   * @return {GPU}\r\n   */\r\n  injectNative(source) {\r\n    this.injectedNative = source;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * @desc Destroys all memory associated with gpu.js & the webGl if we created it\r\n   */\r\n  destroy() {\r\n    if (!this.kernels) return;\r\n    // perform on next run loop - for some reason we dont get lose context events\r\n    // if webGl is created and destroyed in the same run loop.\r\n    setTimeout(() => {\r\n      for (let i = 0; i < this.kernels.length; i++) {\r\n        this.kernels[i].destroy(true); // remove canvas if exists\r\n      }\r\n      // all kernels are associated with one context, go ahead and take care of it here\r\n      let firstKernel = this.kernels[0];\r\n      if (firstKernel) {\r\n        // if it is shortcut\r\n        if (firstKernel.kernel) {\r\n          firstKernel = firstKernel.kernel;\r\n        }\r\n        if (firstKernel.constructor.destroyContext) {\r\n          firstKernel.constructor.destroyContext(this.context);\r\n        }\r\n      }\r\n    }, 0);\r\n  }\r\n}\r\n\r\nfunction upgradeDeprecatedCreateKernelSettings(settings) {\r\n  if (!settings) {\r\n    return {};\r\n  }\r\n  const upgradedSettings = Object.assign({}, settings);\r\n\r\n  if (settings.hasOwnProperty('floatOutput')) {\r\n    warnDeprecated('setting', 'floatOutput', 'precision');\r\n    upgradedSettings.precision = settings.floatOutput ? 'single' : 'unsigned';\r\n  }\r\n  if (settings.hasOwnProperty('outputToTexture')) {\r\n    warnDeprecated('setting', 'outputToTexture', 'pipeline');\r\n    upgradedSettings.pipeline = Boolean(settings.outputToTexture);\r\n  }\r\n  if (settings.hasOwnProperty('outputImmutable')) {\r\n    warnDeprecated('setting', 'outputImmutable', 'immutable');\r\n    upgradedSettings.immutable = Boolean(settings.outputImmutable);\r\n  }\r\n  if (settings.hasOwnProperty('floatTextures')) {\r\n    warnDeprecated('setting', 'floatTextures', 'optimizeFloatMemory');\r\n    upgradedSettings.optimizeFloatMemory = Boolean(settings.floatTextures);\r\n  }\r\n  return upgradedSettings;\r\n}\r\n","import { GPU } from './base-gpu';\r\nimport { alias } from './alias';\r\nimport { utils } from './utils';\r\nimport * as common from './common';\r\nimport { Input, input } from './input';\r\nimport { Texture } from './texture';\r\nimport { FunctionBuilder } from './backend/function-builder';\r\nimport { FunctionNode } from './backend/function-node';\r\nimport { CPUFunctionNode } from './backend/cpu/function-node';\r\nimport { CPUKernel } from './backend/cpu/kernel';\r\nimport { WebGLFunctionNode } from './backend/web-gl/function-node';\r\nimport { WebGLKernel } from './backend/web-gl/kernel';\r\nimport { WebGL2FunctionNode } from './backend/web-gl2/function-node';\r\nimport { WebGL2Kernel } from './backend/web-gl2/kernel';\r\nimport { GLKernel } from './backend/gl/kernel';\r\nimport { Kernel } from './backend/kernel';\r\n\r\n/**\r\n * Stub for HeadlessGL.\r\n */\r\nclass HeadlessGLKernel extends WebGLKernel {\r\n  static get isSupported() { return false }\r\n  static isContextMatch() { return false }\r\n  static getIsTextureFloat() { return false }\r\n  static getIsDrawBuffers() { return false }\r\n  static getChannelCount() { return 1 }\r\n  static get testCanvas() { return null }\r\n  static get testContext() { return null }\r\n  static get features() { return null }\r\n  static setupFeatureChecks() {}\r\n  static destroyContext() {}\r\n  initCanvas() { return {} }\r\n  initContext() { return null }\r\n  toString() { return '' }\r\n  initExtensions() {}\r\n  build() {}\r\n  destroyExtensions() {}\r\n  setOutput() {}\r\n\r\n  static getFeatures() {\r\n    return Object.freeze({\r\n      isFloatRead: false,\r\n      isIntegerDivisionAccurate: false,\r\n      isTextureFloat: false,\r\n      isDrawBuffers: false,\r\n      kernelMap: false,\r\n      channelCount: 1,\r\n    });\r\n  }\r\n};\r\n\r\nconst lib = GPU;\r\nlib.alias = alias;\r\nlib.CPUFunctionNode = CPUFunctionNode;\r\nlib.CPUKernel = CPUKernel;\r\nlib.FunctionBuilder = FunctionBuilder;\r\nlib.FunctionNode = FunctionNode;\r\nlib.HeadlessGLKernel = HeadlessGLKernel;\r\nlib.Input = Input;\r\nlib.input = input;\r\nlib.Texture = Texture;\r\nlib.utils = { ...common, ...utils };\r\nlib.WebGL2FunctionNode = WebGL2FunctionNode;\r\nlib.WebGL2Kernel = WebGL2Kernel;\r\nlib.WebGLFunctionNode = WebGLFunctionNode;\r\nlib.WebGLKernel = WebGLKernel;\r\nlib.GLKernel = GLKernel;\r\nlib.Kernel = Kernel;\r\n\r\nexport default lib;\r\n","import { utils } from './utils';\r\n\r\n/**\r\n * @param name\r\n * @param source\r\n * @returns {Function}\r\n */\r\nexport function alias(name, source) {\r\n  const fnString = source.toString();\r\n  return new Function(`return function ${ name } (${ utils.getArgumentNamesFromString(fnString).join(', ') }) {\r\n  ${ utils.getFunctionBodyFromString(fnString) }\r\n}`)();\r\n}\r\n"],"names":["setupArguments","args","newArguments","Array","length","i","arg","toArray","mock1D","arguments","row","Float32Array","this","output","x","thread","y","z","_fn","apply","mock2D","matrix","mock2DGraphical","mock3D","cube","apiDecorate","kernel","setOutput","setupOutput","graphical","setupGraphical","toJSON","Error","setConstants","flag","constants","setGraphical","setCanvas","canvas","setContext","context","exec","Promise","resolve","reject","e","getPixels","flip","pixels","width","height","halfHeight","bytesPerRow","temp","Uint8ClampedArray","result","slice","topOffset","bottomOffset","set","subarray","copyWithin","flipPixels","_imageData","data","color","r","g","b","a","Math","floor","index","_colorData","setWarnVarUsage","setOptimizeFloatMemory","setArgumentTypes","setDebug","setLoopMaxIterations","setPipeline","setPrecision","setImmutable","setFunctions","addSubKernel","destroy","validateSettings","createImageData","fn","settings","ARGUMENT_NAMES","FUNCTION_NAME","STRIP_COMMENTS","isFunction","funcObj","getFunctionNameFromString","funcStr","trim","functionToIFunction","source","sourceString","toString","argumentTypes","isArray","getArgumentNamesFromString","map","name","returnType","warnDeprecated","type","oldName","newName","msg","console","warn","isFunctionString","toLowerCase","fnStr","replace","indexOf","match","array","isNaN","erectMemoryOptimized2DFloat","yResults","offset","erectMemoryOptimized3DFloat","depth","zResults","getAstString","ast","lines","split","start","loc","end","line","push","substring","column","join","Input","[object Object]","value","size","Int32Array","w","h","d","Texture","texture","dimensions","constructor","deleteTexture","getSystemEndianness","ArrayBuffer","Uint32Array","c","Uint8Array","_systemEndianness","getVariableType","strictIntegers","nodeName","Boolean","Number","isInteger","hasOwnProperty","utils","systemEndianness","getFunctionBodyFromString","lastIndexOf","obj","key","Object","prototype","call","isActiveClone","clone","texelCount","optimizeFloatMemory","precision","ceil","closestSquareDimensions","sqrt","high","low","bitRatio","roundTo","n","pad","ret","dim","reverse","from","target","l","flatten4dArrayTo","flatten3dArrayTo","flatten2dArrayTo","part","buffer","byteOffset","props","getOwnPropertyNames","getPrototypeOf","linesToString","erectPackedFloat","erect2DPackedFloat","xStart","xEnd","erect3DPackedFloat","erectMemoryOptimizedFloat","erectFloat","xResults","erect2DFloat","erect3DFloat","erectArray2","xResultsMax","erect2DArray2","XResultsMax","erect3DArray2","erectArray3","erect2DArray3","erect3DArray3","erectArray4","erect2DArray4","erect3DArray4","flattenFunctionToString","findDependency","thisLookup","doNotDefine","flattened","parse","functionDependencies","flatten","results","body","id","params","declarations","init","properties","declaration","test","lookups","lookup","property","kind","callee","object","foundSource","argument","left","operator","right","prefix","expression","raw","computed","update","consequent","elements","alternate","flattenedFunctionDependencies","functionDependency","Kernel","isSupported","useLegacyEncoder","fallbackRequested","onRequestFallback","argumentNames","argumentSizes","argumentBitRatios","kernelArguments","kernelConstants","debug","loopMaxIterations","constantTypes","constantBitRatios","dynamicArguments","dynamicOutput","checkContext","gpu","functions","nativeFunctions","injectedNative","subKernels","validate","immutable","pipeline","tactic","plugins","leadingReturnStatement","followingReturnStatement","fixIntegerDivisionAccuracy","warnVarUsage","p","initCanvas","initContext","initPlugins","argType","getBitRatio","needsConstantTypes","max","setDynamicOutput","setDynamicArguments","argumentIndex","subKernel","removeCanvasReferences","Int8Array","Uint16Array","Int16Array","threadDim","argumentsTypes","pluginNames","plugin","FunctionBuilder","FunctionNode","extraNodeOptions","kernelConstant","needsArgumentType","functionName","functionBuilder","assignArgumentType","lookupReturnType","requestingNode","lookupFunctionArgumentTypes","lookupFunctionArgumentName","lookupFunctionArgumentBitRatio","argumentName","triggerImplyArgumentType","argumentType","triggerTrackArgumentSynonym","calleeFunctionName","trackArgumentSynonym","lookupArgumentSynonym","originFunctionName","onFunctionCall","trackFunctionCall","nodeOptions","assign","isRootKernel","onNestedFunction","nestedFunction","traceFunctionAST","addFunctionNode","rootNodeOptions","functionNodes","fromJSON","rootNode","subKernelNodes","isSubKernel","functionMap","nativeFunctionNames","lookupChain","argumentChain","functionNodeDependencies","functionCalls","nativeFunction","functionNode","retList","functionIndex","calledFunctions","traceFunctionCalls","dependantFunctionName","splice","getPrototypes","getPrototypesFromFunctionNames","keys","functionList","node","nativeIndex","jsonFunctionNodes","jsonFunctionNode","getStringFromFunctionNames","_isNativeFunction","_lookupNativeFunctionReturnType","_isFunction","_getFunction","j","getType","pop","getJsAST","_getNativeFunction","argumentSynonym","synonymIndex","fnNode","calleeArgumentName","synonymUseIndex","Set","add","subKernelNode","called","functionCallIndex","list","FunctionTracer","runningContexts","contexts","identifiers","returnStatements","inLoopInit","scan","currentContext","run","newContext","origin","forceInteger","assignable","discriminant","cases","states","strictTypingChecking","literalTypes","_string","_internalVariableNames","state","astMemberExpressionUnroll","firstExpression","expressions","astErrorOutput","inParser","parser","freeze","locations","functionAST","dependencies","getDependencies","valueType","realType","isSafe","isSafeDependencies","identifier","getDeclaration","typeLookupMap","constantName","astGeneric","literalKey","isAstMathFunction","inferArgumentTypesIfNeeded","isState","rightType","lastType","isAstVariable","getVariableSignature","findIdentifierOrigin","getLookupType","getConstantType","isAstMathVariable","lastReturn","findLastReturn","every","dependency","isNotSafe","Infinity","details","getMemberExpressionDetails","signature","xProperty","yProperty","zProperty","unshift","signatureString","retArr","astFunctionDeclaration","astFunctionExpression","astReturnStatement","astLiteral","astBinaryExpression","astIdentifierExpression","astAssignmentExpression","astExpressionStatement","astEmptyStatement","astBlockStatement","astIfStatement","astSwitchStatement","astBreakStatement","astContinueStatement","astForStatement","astWhileStatement","astDoWhileStatement","astVariableDeclaration","astVariableDeclarator","astThisExpression","astSequenceExpression","astUnaryExpression","astUpdateExpression","astLogicalExpression","astMemberExpression","astCallExpression","astArrayExpression","astDebuggerStatement","astConditionalExpression","error","debugString","splitLines","substr","lineBefore","arrNode","isChildFunction","astFunction","esNode","eNode","brNode","crNode","varDecNode","firstDeclaration","markupType","typeMap","iVarDecNode","sNode","uNode","checkAndUpconvertBitwiseUnary","logNode","variableSignature","astToFind","stack","atNode","shift","Float","Integer","Array(2)","Array(3)","Array(4)","Array2D","Array3D","HTMLImage","HTMLVideo","HTMLImageArray","NumberTexture","MemoryOptimizedNumberTexture","Array1D(2)","Array1D(3)","Array1D(4)","Array2D(2)","Array2D(3)","Array2D(4)","Array3D(2)","Array3D(3)","Array3D(4)","ArrayTexture(1)","ArrayTexture(2)","ArrayTexture(3)","ArrayTexture(4)","CPUFunctionNode","idtNode","getKernelArgumentName","forNode","initArr","testArr","updateArr","bodyArr","pushState","includes","popState","iVariableName","getInternalVariableName","whileNode","doWhileNode","assNode","bNode","varWarn","ifNode","tNode","mNode","synonymName","markupName","isInput","constant","targetTypes","arrLen","subNode","CPUKernel","features","kernelMap","isIntegerDivisionAccurate","mode","combinedKernel","super","mergeSettings","_kernelString","translatedSources","document","createElement","OffscreenCanvas","getContext","getDimensions","checkOutput","fromKernel","getKernelResultType","setupConstants","translateSource","kernelString","getKernelString","log","Function","bind","kernelThreadString","filter","_getLoopMaxString","_processConstants","_processArguments","_graphicalKernelBody","_resultKernelBody","cpuKernel","header","thisProperties","beforeReturn","useFunctionKeyword","JSON","stringify","constantsToString","colorFn","propertyName","getPixelsFn","constantKeys","flattenedImageTo3DArray","_imageTo3DArray","flattenedImageTo2DArray","_imageTo2DArray","cpuKernelString","parseInt","variableName","image","ctx","drawImage","pixelsData","getImageData","imageArray","pixel","images","imagesArray","_resultKernel1DLoop","_kernelOutput","_resultKernel2DLoop","_resultKernel3DLoop","_graphicalKernel2DLoop","_graphicalOutput","constructorString","_getKernelResultTypeConstructorString","_mapSubKernels","removeCanvasReference","json","GLTextureFloat","gl","framebuffer","createFramebuffer","bindFramebuffer","FRAMEBUFFER","framebufferTexture2D","COLOR_ATTACHMENT0","TEXTURE_2D","readPixels","RGBA","FLOAT","renderRawOutput","renderValues","GLTextureArray2Float","GLTextureArray2Float2D","GLTextureArray2Float3D","GLTextureArray3Float","GLTextureArray3Float2D","GLTextureArray3Float3D","GLTextureArray4Float","GLTextureArray4Float2D","GLTextureArray4Float3D","GLTextureFloat2D","GLTextureFloat3D","GLTextureMemoryOptimized","GLTextureMemoryOptimized2D","GLTextureMemoryOptimized3D","GLTextureUnsigned","UNSIGNED_BYTE","GLTextureUnsigned2D","GLTextureUnsigned3D","GLTextureGraphical","GLKernel","testContext","testCanvas","build","renderOutput","v1","v2","fix","floatTextures","isStartingVariableName","isVariableChar","char","nextChar","lastKernel","texSize","bytes","splitArray","transferValues","formatValues","TextureConstructor","translatedSource","renderStrategy","compiledFragmentShader","compiledVertexShader","readPackedPixelsToUint8Array","readPackedPixelsToFloat32Array","renderTexture","renderKernels","renderKernelsToTextures","PackedPixelTo3DFloat","PackedPixelTo2DFloat","PackedPixelToFloat","requestFallback","renderKernelsToArrays","readFloatPixelsToFloat32Array","FloatTexture","MemoryOptimizedFloatPixelToMemoryOptimized3DFloat","MemoryOptimizedFloatPixelToMemoryOptimized2DFloat","MemoryOptimizedFloatPixelToMemoryOptimizedFloat","FloatPixelTo3DArray2","FloatPixelTo2DArray2","FloatPixelToArray2","FloatPixelTo3DArray3","FloatPixelTo2DArray3","FloatPixelToArray3","FloatPixelTo3DArray4","FloatPixelTo2DArray4","FloatPixelToArray4","FloatPixelTo3DFloat","FloatPixelTo2DFloat","FloatPixelToFloat","getMainResultNumberTexture","getMainResultArray2Texture","getMainResultArray3Texture","getMainResultArray4Texture","getMainResultGraphical","getMainResultMemoryOptimizedFloats","getMainResultTexture","getMainResultPackedPixels","getMainResultKernelNumberTexture","getMainResultSubKernelNumberTexture","getMainResultKernelArray2Texture","getMainResultSubKernelArray2Texture","getMainResultKernelArray3Texture","getMainResultSubKernelArray3Texture","getMainResultKernelArray4Texture","getMainResultSubKernelArray4Texture","outputTexture","subKernelOutputTextures","program","getKernelTextureSize","updateMaxTexSize","viewport","maxTexSize","_setupOutputTexture","_setupSubOutputTextures","PackedPixelToUint8Array","Symbol","PackedTexture","FloatPixelToFloat32Array","int","float","vec2","vec3","vec4","WebGLFunctionNode","castLiteralToFloat","castValueToInteger","castLiteralToInteger","round","checkAndUpconvertOperator","castValueToFloat","leftType","operatorMap","literalResult","bitwiseResult","checkAndUpconvertBitwiseOperators","foundOperator","%","**","&","|","^","<<",">>",">>>","~","userArgumentName","inForLoopInit","info","actualType","declarationResult","varName","fallingThrough","defaultResult","movingDefaultToEnd","pastFirstIf","memberExpressionPropertyMarkup","memberExpressionXYZ","isMathFunction","functionMatch","functionReplace","targetType","LiteralInteger","===","!==","onBeforeRun","setUniform1f","random","functionReturnType","fragmentShader","vertexShader","glWiretap","options","contextName","throwGetError","useTrackablePrimitives","readPixelsFile","recording","variables","onReadPixels","onUnrecognizedArgumentLookup","proxy","Proxy","get","addComment","checkThrowError","readPixelsVariableName","insertVariable","reset","setIndent","getContextVariableName","indent","getError","contextVariables","extension","getExtension","tappedExtension","glExtensionWiretap","getEntity","targetVariableName","getVariableName","argumentAsStrings","writePPM","argumentsToString","addVariable","drawBuffers","methodCallToString","trackablePrimitive","entityNames","imageCount","spaces","repeat","sourceVariable","imageVariable","method","getExtensionEntity","drawBuffersWEBGL","extensionEntityNames","hasLines","hasSingleQuotes","hasDoubleQuotes","instantiationString","argumentToString","module","window","toStringWithoutUtils","glKernelString","originKernel","setupContextString","destroyContextString","postResult","targetName","subKernelsResultVariableSetup","subKernelsResultIndex","getRenderString","variable","uploadValue","upgradedArguments","forEach","kernelArgument","imageIndex","flattenTo","getStringValueHandler","textureName","getToArrayString","subKernelResult","subKernelTextureName","getGetPixelsString","constantsUpload","readBackValue","kernelResult","KernelValue","onRequestContextHandle","onUpdateValueMismatch","contextHandle","WebGLKernelValue","dimensionsId","sizeId","initialValueConstructor","onRequestTexture","onRequestIndex","textureSize","setupTexture","getTransferArrayType","Float64Array","Type","valuesFlat","WebGLKernelValueBoolean","setUniform1i","WebGLKernelValueFloat","WebGLKernelValueInteger","WebGLKernelValueHTMLImage","requestTexture","inputImage","activeTexture","bindTexture","texParameteri","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","TEXTURE_MIN_FILTER","NEAREST","TEXTURE_MAG_FILTER","pixelStorei","UNPACK_FLIP_Y_WEBGL","texImage2D","WebGLKernelValueDynamicHTMLImage","setUniform3iv","setUniform2iv","updateValue","WebGLKernelValueHTMLVideo","WebGLKernelValueDynamicHTMLVideo","WebGLKernelValueSingleInput","getMemoryOptimizedFloatTextureSize","uploadArrayLength","input","WebGLKernelValueUnsignedInput","getMemoryOptimizedPackedTextureSize","TranserArrayType","preUploadValue","WebGLKernelValueDynamicUnsignedInput","WebGLKernelValueMemoryOptimizedNumberTexture","inputTexture","WebGLKernelValueDynamicMemoryOptimizedNumberTexture","WebGLKernelValueNumberTexture","WebGLKernelValueDynamicNumberTexture","WebGLKernelValueSingleArray","WebGLKernelValueDynamicSingleArray","WebGLKernelValueSingleArray1DI","setShape","valueDimensions","WebGLKernelValueDynamicSingleArray1DI","WebGLKernelValueSingleArray2DI","WebGLKernelValueDynamicSingleArray2DI","WebGLKernelValueSingleArray3DI","WebGLKernelValueDynamicSingleArray3DI","WebGLKernelValueSingleArray2","setUniform2fv","WebGLKernelValueSingleArray3","setUniform3fv","WebGLKernelValueSingleArray4","setUniform4fv","WebGLKernelValueUnsignedArray","WebGLKernelValueDynamicUnsignedArray","kernelValueMaps","unsigned","dynamic","static","single","testExtensions","triangleNoise","canvases","maxTexSizes","WebGLKernel","setupFeatureChecks","isContextMatch","OES_texture_float","OES_texture_float_linear","OES_element_index_uint","WEBGL_draw_buffers","getFeatures","WebGLRenderingContext","isDrawBuffers","getIsDrawBuffers","isFloatRead","getIsFloatRead","getIsIntegerDivisionAccurate","isTextureFloat","getIsTextureFloat","channelCount","getChannelCount","getParameter","MAX_DRAW_BUFFERS_WEBGL","types","undefined","lookupKernelValueType","endianness","extensions","argumentTextureCount","constantTextureCount","fragShader","vertShader","drawBuffersMap","switchingKernels","onRequestSwitchKernel","textureCache","programUniformLocationCache","uniform1fCache","uniform1iCache","uniform2fCache","uniform2fvCache","uniform2ivCache","uniform3fvCache","uniform3ivCache","uniform4fvCache","uniform4ivCache","alpha","antialias","pluginsToUse","some","pluginName","WEBGL_color_buffer_float","canvasIndex","getPrototypeString","requiredChannels","returnTypes","getReturnTypes","needsArgumentTypes","textureIndexes","createTexture","TEXTURE0","kernelValue","initExtensions","failureResult","pickRenderStrategy","enable","SCISSOR_TEST","getVertexShader","createShader","VERTEX_SHADER","shaderSource","compileShader","getFragmentShader","FRAGMENT_SHADER","getShaderParameter","COMPILE_STATUS","getShaderInfoLog","createProgram","attachShader","linkProgram","vertices","texCoords","texCoordOffset","byteLength","bindBuffer","ARRAY_BUFFER","createBuffer","bufferData","STATIC_DRAW","bufferSubData","aPosLoc","getAttribLocation","enableVertexAttribArray","vertexAttribPointer","aTexCoordLoc","useProgram","getSubKernelResultType","scissor","setUniform2f","bindRenderbuffer","RENDERBUFFER","drawArrays","TRIANGLE_STRIP","getTextureCache","getUniformLocation","uniform1f","uniform1i","value1","value2","cache","uniform2f","uniform2fv","uniform2iv","uniform3fv","uniform3iv","uniform4iv","uniform4fv","HEADER","_getHeaderString","LOOP_MAX","PLUGINS","_getPluginsString","CONSTANTS","_getConstantsString","DECODE32_ENDIANNESS","_getDecode32EndiannessString","ENCODE32_ENDIANNESS","_getEncode32EndiannessString","DIVIDE_WITH_INTEGER_CHECK","_getDivideWithIntegerCheckString","INJECTED_NATIVE","_getInjectedNative","MAIN_CONSTANTS","_getMainConstantsString","MAIN_ARGUMENTS","_getMainArgumentsString","KERNEL","MAIN_RESULT","getMainResultString","FLOAT_TACTIC_DECLARATION","getFloatTacticDeclaration","INT_TACTIC_DECLARATION","getIntTacticDeclaration","SAMPLER_2D_TACTIC_DECLARATION","getSampler2DTacticDeclaration","SAMPLER_2D_ARRAY_TACTIC_DECLARATION","getSampler2DArrayTacticDeclaration","getSource","kernelResultDeclaration","getMainResultKernelPackedPixels","getMainResultSubKernelPackedPixels","channels","channel","getMainResultKernelMemoryOptimizedFloats","getMainResultSubKernelMemoryOptimizedFloats","src","artifact","replaceArtifacts","_getFragShaderArtifactMap","_getVertShaderArtifactMap","deleteBuffer","deleteFramebuffer","deleteShader","deleteProgram","idx","destroyExtensions","loseContext","WebGL2FunctionNode","WebGL2KernelValueBoolean","WebGL2KernelValueFloat","WebGL2KernelValueInteger","variablePrecision","getVariablePrecisionString","WebGL2KernelValueHTMLImage","WebGL2KernelValueDynamicHTMLImage","WebGL2KernelValueHtmlImageArray","TEXTURE_2D_ARRAY","texImage3D","xOffset","yOffset","imageDepth","texSubImage3D","WebGL2KernelValueDynamicHtmlImageArray","WebGL2KernelValueHTMLVideo","WebGL2KernelValueDynamicHTMLVideo","WebGL2KernelValueSingleInput","RGBA32F","WebGL2KernelValueDynamicMemoryOptimizedNumberTexture","WebGL2KernelValueNumberTexture","WebGL2KernelValueDynamicNumberTexture","WebGL2KernelValueSingleArray","WebGL2KernelValueSingleArray1DI","WebGL2KernelValueDynamicSingleArray1DI","WebGL2KernelValueSingleArray2DI","WebGL2KernelValueDynamicSingleArray2DI","WebGL2KernelValueSingleArray3DI","WebGL2KernelValueDynamicSingleArray3DI","WebGL2KernelValueSingleArray2","WebGL2KernelValueSingleArray3","WebGL2KernelValueSingleArray4","WebGL2Kernel","EXT_color_buffer_float","WebGL2RenderingContext","MAX_DRAW_BUFFERS","texStorage2D","R32F","RG32F","bindKernelToShortcut","shortcut","allPropertiesOf","__defineGetter__","__defineSetter__","kernelOrder","kernelTypes","internalKernels","webgl2","webgl","upgradeDeprecatedCreateKernelSettings","upgradedSettings","floatOutput","outputToTexture","outputImmutable","lib","isGPUSupported","isKernelMapSupported","isOffscreenCanvasSupported","Worker","importScripts","isWebGLSupported","isWebGL2Supported","isHeadlessGLSupported","isCanvasSupported","HTMLCanvasElement","isGPUHTMLImageArraySupported","isSinglePrecisionSupported","kernels","chooseKernel","addFunction","addNativeFunction","ExternalKernel","devKernel","gpuMock","switchableKernels","settingsCopy","fallbackKernel","kernelRun","dynamicArgument","replaceKernel","mergedSettings","existingKernel","newKernel","accept","replacementKernel","kernelRunShortcut","createKernel","firstKernel","nativeFunctionArguments","nativeFunctionReturnType","setTimeout","destroyContext","alias","fnString","HeadlessGLKernel","common"],"mappings":"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"}