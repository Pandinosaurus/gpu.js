{"version":3,"file":"gpu-browser-core.min.js","sources":["../node_modules/gpu-mock.js/index.js","../src/common.js","../src/input.js","../src/texture.js","../src/utils.js","../src/backend/kernel.js","../src/backend/function-builder.js","../src/backend/function-tracer.js","../src/backend/function-node.js","../src/backend/cpu/function-node.js","../src/backend/cpu/kernel.js","../src/backend/cpu/kernel-string.js","../src/backend/gl/texture/float.js","../src/backend/gl/texture/array-2-float.js","../src/backend/gl/texture/array-2-float-2d.js","../src/backend/gl/texture/array-2-float-3d.js","../src/backend/gl/texture/array-3-float.js","../src/backend/gl/texture/array-3-float-2d.js","../src/backend/gl/texture/array-3-float-3d.js","../src/backend/gl/texture/array-4-float.js","../src/backend/gl/texture/array-4-float-2d.js","../src/backend/gl/texture/array-4-float-3d.js","../src/backend/gl/texture/float-2d.js","../src/backend/gl/texture/float-3d.js","../src/backend/gl/texture/memory-optimized.js","../src/backend/gl/texture/memory-optimized-2d.js","../src/backend/gl/texture/memory-optimized-3d.js","../src/backend/gl/texture/unsigned.js","../src/backend/gl/texture/unsigned-2d.js","../src/backend/gl/texture/unsigned-3d.js","../src/backend/gl/texture/graphical.js","../src/backend/gl/kernel.js","../src/backend/web-gl/function-node.js","../src/plugins/triangle-noise.js","../src/backend/web-gl/fragment-shader.js","../src/backend/web-gl/vertex-shader.js","../node_modules/gl-wiretap/index.js","../src/backend/gl/kernel-string.js","../src/backend/kernel-value.js","../src/backend/web-gl/kernel-value/index.js","../src/backend/web-gl/kernel-value/boolean.js","../src/backend/web-gl/kernel-value/float.js","../src/backend/web-gl/kernel-value/integer.js","../src/backend/web-gl/kernel-value/html-image.js","../src/backend/web-gl/kernel-value/dynamic-html-image.js","../src/backend/web-gl/kernel-value/single-input.js","../src/backend/web-gl/kernel-value/unsigned-input.js","../src/backend/web-gl/kernel-value/dynamic-unsigned-input.js","../src/backend/web-gl/kernel-value/memory-optimized-number-texture.js","../src/backend/web-gl/kernel-value/dynamic-memory-optimized-number-texture.js","../src/backend/web-gl/kernel-value/number-texture.js","../src/backend/web-gl/kernel-value/dynamic-number-texture.js","../src/backend/web-gl/kernel-value/single-array.js","../src/backend/web-gl/kernel-value/dynamic-single-array.js","../src/backend/web-gl/kernel-value/single-array1d-i.js","../src/backend/web-gl/kernel-value/dynamic-single-array1d-i.js","../src/backend/web-gl/kernel-value/single-array2d-i.js","../src/backend/web-gl/kernel-value/dynamic-single-array2d-i.js","../src/backend/web-gl/kernel-value/single-array3d-i.js","../src/backend/web-gl/kernel-value/dynamic-single-array3d-i.js","../src/backend/web-gl/kernel-value/single-array2.js","../src/backend/web-gl/kernel-value/single-array3.js","../src/backend/web-gl/kernel-value/single-array4.js","../src/backend/web-gl/kernel-value/unsigned-array.js","../src/backend/web-gl/kernel-value/dynamic-unsigned-array.js","../src/backend/web-gl/kernel-value-maps.js","../src/backend/web-gl/kernel-value/dynamic-single-input.js","../src/backend/web-gl/kernel.js","../src/backend/web-gl2/function-node.js","../src/backend/web-gl2/fragment-shader.js","../src/backend/web-gl2/vertex-shader.js","../src/backend/web-gl2/kernel-value/boolean.js","../src/backend/web-gl2/kernel-value/float.js","../src/backend/web-gl2/kernel-value/integer.js","../src/backend/web-gl2/kernel-value/html-image.js","../src/backend/web-gl2/kernel-value/dynamic-html-image.js","../src/backend/web-gl2/kernel-value/html-image-array.js","../src/backend/web-gl2/kernel-value/dynamic-html-image-array.js","../src/backend/web-gl2/kernel-value/single-input.js","../src/backend/web-gl2/kernel-value/dynamic-memory-optimized-number-texture.js","../src/backend/web-gl2/kernel-value/number-texture.js","../src/backend/web-gl2/kernel-value/dynamic-number-texture.js","../src/backend/web-gl2/kernel-value/single-array.js","../src/backend/web-gl2/kernel-value/single-array1d-i.js","../src/backend/web-gl2/kernel-value/dynamic-single-array1d-i.js","../src/backend/web-gl2/kernel-value/single-array2d-i.js","../src/backend/web-gl2/kernel-value/dynamic-single-array2d-i.js","../src/backend/web-gl2/kernel-value/single-array3d-i.js","../src/backend/web-gl2/kernel-value/dynamic-single-array3d-i.js","../src/backend/web-gl2/kernel-value/single-array2.js","../src/backend/web-gl2/kernel-value/single-array3.js","../src/backend/web-gl2/kernel-value/single-array4.js","../src/backend/web-gl2/kernel-value-maps.js","../src/backend/web-gl2/kernel-value/dynamic-unsigned-array.js","../src/backend/web-gl2/kernel-value/dynamic-unsigned-input.js","../src/backend/web-gl2/kernel-value/unsigned-array.js","../src/backend/web-gl2/kernel-value/unsigned-input.js","../src/backend/web-gl2/kernel-value/dynamic-single-array.js","../src/backend/web-gl2/kernel-value/dynamic-single-input.js","../src/backend/web-gl2/kernel-value/memory-optimized-number-texture.js","../src/backend/web-gl2/kernel.js","../src/kernel-run-shortcut.js","../src/base-gpu.js","../src/browser.js","../src/alias.js"],"sourcesContent":["function setupArguments(args) {\n  const newArguments = new Array(args.length);\n  for (let i = 0; i < args.length; i++) {\n    const arg = args[i];\n    if (arg.toArray) {\n      newArguments[i] = arg.toArray();\n    } else {\n      newArguments[i] = arg;\n    }\n  }\n  return newArguments;\n}\n\nfunction mock1D() {\n  const args = setupArguments(arguments);\n  const row = new Float32Array(this.output.x);\n  for (let x = 0; x < this.output.x; x++) {\n    this.thread.x = x;\n    this.thread.y = 0;\n    this.thread.z = 0;\n    row[x] = this._fn.apply(this, args);\n  }\n  return row;\n}\n\nfunction mock2D() {\n  const args = setupArguments(arguments);\n  const matrix = new Array(this.output.y);\n  for (let y = 0; y < this.output.y; y++) {\n    const row = new Float32Array(this.output.x);\n    for (let x = 0; x < this.output.x; x++) {\n      this.thread.x = x;\n      this.thread.y = y;\n      this.thread.z = 0;\n      row[x] = this._fn.apply(this, args);\n    }\n    matrix[y] = row;\n  }\n  return matrix;\n}\n\nfunction mock2DGraphical() {\n  const args = setupArguments(arguments);\n  for (let y = 0; y < this.output.y; y++) {\n    for (let x = 0; x < this.output.x; x++) {\n      this.thread.x = x;\n      this.thread.y = y;\n      this.thread.z = 0;\n      this._fn.apply(this, args);\n    }\n  }\n}\n\nfunction mock3D() {\n  const args = setupArguments(arguments);\n  const cube = new Array(this.output.z);\n  for (let z = 0; z < this.output.z; z++) {\n    const matrix = new Array(this.output.y);\n    for (let y = 0; y < this.output.y; y++) {\n      const row = new Float32Array(this.output.x);\n      for (let x = 0; x < this.output.x; x++) {\n        this.thread.x = x;\n        this.thread.y = y;\n        this.thread.z = z;\n        row[x] = this._fn.apply(this, args);\n      }\n      matrix[y] = row;\n    }\n    cube[z] = matrix;\n  }\n  return cube;\n}\n\nfunction apiDecorate(kernel) {\n  kernel.setOutput = (output) => {\n    kernel.output = setupOutput(output);\n    if (kernel.graphical) {\n      setupGraphical(kernel);\n    }\n  };\n  kernel.toJSON = () => {\n    throw new Error('Not usable with gpuMock');\n  };\n  kernel.setConstants = (flag) => {\n    kernel.constants = flag;\n    return kernel;\n  };\n  kernel.setGraphical = (flag) => {\n    kernel.graphical = flag;\n    return kernel;\n  };\n  kernel.setCanvas = (flag) => {\n    kernel.canvas = flag;\n    return kernel;\n  };\n  kernel.setContext = (flag) => {\n    kernel.context = flag;\n    return kernel;\n  };\n  kernel.exec = function() {\n    return new Promise((resolve, reject) => {\n      try {\n        resolve(kernel.apply(kernel, arguments));\n      } catch(e) {\n        reject(e);\n      }\n    });\n  };\n  kernel.getPixels = (flip) => {\n    const {x, y} = kernel.output;\n    // cpu is not flipped by default\n    return flip ? flipPixels(kernel._imageData.data, x, y) : kernel._imageData.data.slice(0);\n  };\n  kernel.color = function(r, g, b, a) {\n    if (typeof a === 'undefined') {\n      a = 1;\n    }\n\n    r = Math.floor(r * 255);\n    g = Math.floor(g * 255);\n    b = Math.floor(b * 255);\n    a = Math.floor(a * 255);\n\n    const width = kernel.output.x;\n    const height = kernel.output.y;\n\n    const x = kernel.thread.x;\n    const y = height - kernel.thread.y - 1;\n\n    const index = x + y * width;\n\n    kernel._colorData[index * 4 + 0] = r;\n    kernel._colorData[index * 4 + 1] = g;\n    kernel._colorData[index * 4 + 2] = b;\n    kernel._colorData[index * 4 + 3] = a;\n  };\n\n  // these are added for api compatibility, but have no affect\n  kernel.setWarnVarUsage = () => {\n    return kernel;\n  };\n  kernel.setOptimizeFloatMemory = () => {\n    return kernel;\n  };\n  kernel.setArgumentTypes = () => {\n    return kernel;\n  };\n  kernel.setDebug = () => {\n    return kernel;\n  };\n  kernel.setLoopMaxIterations = () => {\n    return kernel;\n  };\n  kernel.setPipeline = () => {\n    return kernel;\n  };\n  kernel.setPrecision = () => {\n    return kernel;\n  };\n  kernel.setImmutable = () => {\n    return kernel;\n  };\n  kernel.setFunctions = () => {\n    return kernel;\n  };\n  kernel.addSubKernel = () => {\n    return kernel;\n  };\n  kernel.destroy = () => {};\n  kernel.validateSettings = () => {};\n  if (kernel.graphical && kernel.output) {\n    setupGraphical(kernel);\n  }\n  return kernel;\n}\n\nfunction setupGraphical(kernel) {\n  const {x, y} = kernel.output;\n  if (kernel.context && kernel.context.createImageData) {\n    const data = new Uint8ClampedArray(x * y * 4);\n    kernel._imageData = kernel.context.createImageData(x, y);\n    kernel._colorData = data;\n  } else {\n    const data = new Uint8ClampedArray(x * y * 4);\n    kernel._imageData = { data };\n    kernel._colorData = data;\n  }\n}\n\nfunction setupOutput(output) {\n  let result = null;\n  if (output.length) {\n    if (output.length === 3) {\n      const [x,y,z] = output;\n      result = { x, y, z };\n    } else if (output.length === 2) {\n      const [x,y] = output;\n      result = { x, y };\n    } else {\n      const [x] = output;\n      result = { x };\n    }\n  } else {\n    result = output;\n  }\n  return result;\n}\n\nfunction gpuMock(fn, settings = {}) {\n  const output = settings.output ? setupOutput(settings.output) : null;\n  function kernel() {\n    if (kernel.output.z) {\n      return mock3D.apply(kernel, arguments);\n    } else if (kernel.output.y) {\n      if (kernel.graphical) {\n        return mock2DGraphical.apply(kernel, arguments);\n      }\n      return mock2D.apply(kernel, arguments);\n    } else {\n      return mock1D.apply(kernel, arguments);\n    }\n  }\n  kernel._fn = fn;\n  kernel.constants = settings.constants || null;\n  kernel.context = settings.context || null;\n  kernel.canvas = settings.canvas || null;\n  kernel.graphical = settings.graphical || false;\n  kernel._imageData = null;\n  kernel._colorData = null;\n  kernel.output = output;\n  kernel.thread = {\n    x: 0,\n    y: 0,\n    z: 0\n  };\n  return apiDecorate(kernel);\n}\n\nfunction flipPixels(pixels, width, height) {\n  // https://stackoverflow.com/a/41973289/1324039\n  const halfHeight = height / 2 | 0; // the | 0 keeps the result an int\n  const bytesPerRow = width * 4;\n  // make a temp buffer to hold one row\n  const temp = new Uint8ClampedArray(width * 4);\n  const result = pixels.slice(0);\n  for (let y = 0; y < halfHeight; ++y) {\n    const topOffset = y * bytesPerRow;\n    const bottomOffset = (height - y - 1) * bytesPerRow;\n\n    // make copy of a row on the top half\n    temp.set(result.subarray(topOffset, topOffset + bytesPerRow));\n\n    // copy a row from the bottom half to the top\n    result.copyWithin(topOffset, bottomOffset, bottomOffset + bytesPerRow);\n\n    // copy the copy of the top half row to the bottom half\n    result.set(temp, bottomOffset);\n  }\n  return result;\n}\n\nmodule.exports = {\n  gpuMock\n};\n","/**\r\n * @fileoverview Branch of utils to prevent circular dependencies.\r\n */\r\n\r\nconst ARGUMENT_NAMES = /([^\\s,]+)/g;\r\nconst FUNCTION_NAME = /function ([^(]*)/;\r\nconst STRIP_COMMENTS = /((\\/\\/.*$)|(\\/\\*[\\s\\S]*?\\*\\/))/mg;\r\n\r\n/**\r\n * @descReturn TRUE, on a JS function\r\n * @param {Function} funcObj - Object to validate if its a function\r\n * @returns  {Boolean} TRUE if the object is a JS function\r\n */\r\nexport function isFunction(funcObj) {\r\n  return typeof(funcObj) === 'function';\r\n};\r\n\r\n/**\r\n * @desc Return the function name from a JS function string\r\n * @param {String} funcStr - String of JS function to validate\r\n * @returns {String} Function name string (if found)\r\n */\r\nexport function getFunctionNameFromString(funcStr) {\r\n  return FUNCTION_NAME.exec(funcStr)[1].trim();\r\n};\r\n\r\n/**\r\n *\r\n * @param {String|Function} source\r\n * @param {IFunctionSettings} [settings]\r\n * @returns {IFunction}\r\n */\r\nexport function functionToIFunction(source, settings) {\r\n  settings = settings || {};\r\n  if (typeof source !== 'string' && typeof source !== 'function') throw new Error('source not a string or function');\r\n  const sourceString = typeof source === 'string' ? source : source.toString();\r\n\r\n  let argumentTypes = [];\r\n\r\n  if (Array.isArray(settings.argumentTypes)) {\r\n    argumentTypes = settings.argumentTypes;\r\n  } else if (typeof settings.argumentTypes === 'object') {\r\n    argumentTypes = getArgumentNamesFromString(sourceString)\r\n      .map(name => settings.argumentTypes[name]) || [];\r\n  } else {\r\n    argumentTypes = settings.argumentTypes || [];\r\n  }\r\n\r\n  return {\r\n    source: sourceString,\r\n    argumentTypes,\r\n    returnType: settings.returnType || null,\r\n  };\r\n};\r\n\r\nexport function warnDeprecated(type, oldName, newName) {\r\n  const msg = newName\r\n    ? `It has been replaced with \"${ newName }\"`\r\n    : 'It has been removed';\r\n  console.warn(`You are using a deprecated ${ type } \"${ oldName }\". ${msg}. Fixing, but please upgrade as it will soon be removed.`)\r\n};\r\n\r\n/**\r\n * @desc Return TRUE, on a valid JS function string\r\n * Note: This does just a VERY simply sanity check. And may give false positives.\r\n *\r\n * @param {String} fn - String of JS function to validate\r\n * @returns {Boolean} TRUE if the string passes basic validation\r\n */\r\nexport function isFunctionString(fn) {\r\n  if (typeof fn === 'string') {\r\n    return (fn\r\n      .slice(0, 'function'.length)\r\n      .toLowerCase() === 'function');\r\n  }\r\n  return false;\r\n};\r\n\r\n/**\r\n * @desc Return list of argument names extracted from a javascript function\r\n * @param {String} fn - String of JS function to validate\r\n * @returns {String[]}  Array representing all the parameter names\r\n */\r\nexport function getArgumentNamesFromString(fn) {\r\n  const fnStr = fn.replace(STRIP_COMMENTS, '');\r\n  let result = fnStr.slice(fnStr.indexOf('(') + 1, fnStr.indexOf(')')).match(ARGUMENT_NAMES);\r\n  if (result === null) {\r\n    result = [];\r\n  }\r\n  return result;\r\n};\r\n\r\n/**\r\n * @desc Checks if is an array or Array-like object\r\n * @param {Object} array - The argument object to check if is array\r\n * @returns {Boolean}  true if is array or Array-like object\r\n */\r\nexport function isArray(array) {\r\n  return !isNaN(array.length);\r\n};\r\n\r\nexport function erectMemoryOptimized2DFloat(array, width, height) {\r\n  const yResults = new Array(height);\r\n  for (let y = 0; y < height; y++) {\r\n    const offset = y * width;\r\n    yResults[y] = array.subarray(offset, offset + width);\r\n  }\r\n  return yResults;\r\n};\r\n\r\nexport function erectMemoryOptimized3DFloat(array, width, height, depth) {\r\n  const zResults = new Array(depth);\r\n  for (let z = 0; z < depth; z++) {\r\n    const yResults = new Array(height);\r\n    for (let y = 0; y < height; y++) {\r\n      const offset = (z * height * width) + (y * width);\r\n      yResults[y] = array.subarray(offset, offset + width);\r\n    }\r\n    zResults[z] = yResults;\r\n  }\r\n  return zResults;\r\n};\r\n\r\nexport function getAstString(source, ast) {\r\n  const lines = Array.isArray(source) ? source : source.split(/\\r?\\n/g);\r\n  const start = ast.loc.start;\r\n  const end = ast.loc.end;\r\n  const result = [];\r\n  if (start.line === end.line) {\r\n    result.push(lines[start.line - 1].substring(start.column, end.column));\r\n  } else {\r\n    result.push(lines[start.line - 1].slice(start.column));\r\n    for (let i = start.line; i < end.line; i++) {\r\n      result.push(lines[i]);\r\n    }\r\n    result.push(lines[end.line - 1].slice(0, end.column));\r\n  }\r\n  return result.join('\\n');\r\n};\r\n","import { erectMemoryOptimized2DFloat, erectMemoryOptimized3DFloat } from './common';\r\n\r\nexport class Input {\r\n  constructor(value, size) {\r\n    this.value = value;\r\n    if (Array.isArray(size)) {\r\n      this.size = size;\r\n    } else {\r\n      this.size = new Int32Array(3);\r\n      if (size.z) {\r\n        this.size = new Int32Array([size.x, size.y, size.z]);\r\n      } else if (size.y) {\r\n        this.size = new Int32Array([size.x, size.y]);\r\n      } else {\r\n        this.size = new Int32Array([size.x]);\r\n      }\r\n    }\r\n\r\n    const [w, h, d] = this.size;\r\n    if (d) {\r\n      if (this.value.length !== (w * h * d)) {\r\n        throw new Error(`Input size ${this.value.length} does not match ${w} * ${h} * ${d} = ${(h * w * d)}`);\r\n      }\r\n    } else if (h) {\r\n      if (this.value.length !== (w * h)) {\r\n        throw new Error(`Input size ${this.value.length} does not match ${w} * ${h} = ${(h * w)}`);\r\n      }\r\n    } else {\r\n      if (this.value.length !== w) {\r\n        throw new Error(`Input size ${this.value.length} does not match ${w}`);\r\n      }\r\n    }\r\n\r\n  }\r\n\r\n  toArray() {\r\n    const [ w, h, d ] = this.size;\r\n    if (d) {\r\n      return erectMemoryOptimized3DFloat(this.value.subarray ? this.value : new Float32Array(this.value), w, h, d);\r\n    } else if (h) {\r\n      return erectMemoryOptimized2DFloat(this.value.subarray ? this.value : new Float32Array(this.value), w, h);\r\n    } else {\r\n      return this.value;\r\n    }\r\n  }\r\n};\r\n\r\nexport function input(value, size) {\r\n  return new Input(value, size);\r\n};\r\n","/**\r\n * @desc WebGl Texture implementation in JS\r\n * @param {ITextureSettings} settings\r\n */\r\nexport class Texture {\r\n  constructor(settings) {\r\n    const {\r\n      texture,\r\n      size,\r\n      dimensions,\r\n      output,\r\n      context,\r\n      type = 'NumberTexture',\r\n    } = settings;\r\n    if (!output) throw new Error('settings property \"output\" required.');\r\n    if (!context) throw new Error('settings property \"context\" required.');\r\n    this.texture = texture;\r\n    this.size = size;\r\n    this.dimensions = dimensions;\r\n    this.output = output;\r\n    this.context = context;\r\n    this.kernel = null;\r\n    this.type = type;\r\n  }\r\n\r\n  /**\r\n   * @desc Converts the Texture into a JavaScript Array\r\n   * @returns {Number[]|Number[][]|Number[][][]}\r\n   */\r\n  toArray() {\r\n    throw new Error(`Not implemented on ${this.constructor.name}`);\r\n  }\r\n\r\n  /**\r\n   * @desc Deletes the Texture\r\n   */\r\n  delete() {\r\n    return this.context.deleteTexture(this.texture);\r\n  }\r\n};\r\n","import { parse } from 'acorn';\r\nimport { Texture } from './texture';\r\nimport { Input } from './input';\r\nimport {\r\n  getAstString,\r\n  erectMemoryOptimized2DFloat,\r\n  erectMemoryOptimized3DFloat,\r\n  functionToIFunction,\r\n  getArgumentNamesFromString,\r\n  getFunctionNameFromString,\r\n  isArray,\r\n  isFunction,\r\n  isFunctionString,\r\n  warnDeprecated\r\n} from './common';\r\n\r\nexport function getSystemEndianness() {\r\n  const b = new ArrayBuffer(4);\r\n  const a = new Uint32Array(b);\r\n  const c = new Uint8Array(b);\r\n  a[0] = 0xdeadbeef;\r\n  if (c[0] === 0xef) return 'LE';\r\n  if (c[0] === 0xde) return 'BE';\r\n  throw new Error('unknown endianness');\r\n};\r\n\r\nconst _systemEndianness = getSystemEndianness();\r\n\r\n/**\r\n *\r\n * @desc Gets the system endianness, and cache it\r\n * @returns {String} 'LE' or 'BE' depending on system architecture\r\n * Credit: https://gist.github.com/TooTallNate/4750953\r\n */\r\nexport function systemEndianness() {\r\n  return _systemEndianness;\r\n};\r\n\r\n/**\r\n * @desc Evaluate the argument type, to apply respective logic for it\r\n * @param {Object} value - The argument object to evaluate type\r\n * @returns {String}  Argument type Array/Number/Float/Texture/Unknown\r\n */\r\nexport function getVariableType(value, strictIntegers) {\r\n  if (isArray(value)) {\r\n    if (value[0].nodeName === 'IMG') {\r\n      return 'HTMLImageArray';\r\n    }\r\n    return 'Array';\r\n  }\r\n\r\n  switch (value.constructor) {\r\n    case Boolean:\r\n      return 'Boolean';\r\n    case Number:\r\n      return strictIntegers && Number.isInteger(value) ? 'Integer' : 'Float';\r\n    case Texture:\r\n      return value.type;\r\n    case Input:\r\n      return 'Input';\r\n  }\r\n\r\n  if (value.nodeName === 'IMG') {\r\n    return 'HTMLImage';\r\n  } else {\r\n    return value.hasOwnProperty('type') ? value.type : 'Unknown';\r\n  }\r\n};\r\n\r\n/**\r\n * @desc Various utility functions / snippets of code that GPU.JS uses internally.\r\n * This covers various snippets of code that is not entirely gpu.js specific (ie. may find uses elsewhere)\r\n */\r\nconst utils = {\r\n  systemEndianness,\r\n  getSystemEndianness,\r\n  isFunction,\r\n  isFunctionString,\r\n  getFunctionNameFromString,\r\n\r\n  getFunctionBodyFromString(funcStr) {\r\n    return funcStr.substring(funcStr.indexOf('{') + 1, funcStr.lastIndexOf('}'));\r\n  },\r\n\r\n  getArgumentNamesFromString,\r\n\r\n  /**\r\n   * @desc Returns a clone\r\n   * @param {Object} obj - Object to clone\r\n   * @returns {Object|Array} Cloned object\r\n   */\r\n  clone(obj) {\r\n    if (obj === null || typeof obj !== 'object' || obj.hasOwnProperty('isActiveClone')) return obj;\r\n\r\n    const temp = obj.constructor(); // changed\r\n\r\n    for (let key in obj) {\r\n      if (Object.prototype.hasOwnProperty.call(obj, key)) {\r\n        obj.isActiveClone = null;\r\n        temp[key] = utils.clone(obj[key]);\r\n        delete obj.isActiveClone;\r\n      }\r\n    }\r\n\r\n    return temp;\r\n  },\r\n\r\n  isArray,\r\n  getVariableType,\r\n\r\n  getKernelTextureSize(settings, dimensions) {\r\n    let [w, h, d] = dimensions;\r\n    let texelCount = (w || 1) * (h || 1) * (d || 1);\r\n\r\n    if (settings.optimizeFloatMemory && settings.precision === 'single') {\r\n      w = texelCount = Math.ceil(texelCount / 4);\r\n    }\r\n    // if given dimensions == a 2d image\r\n    if (h > 1 && w * h === texelCount) {\r\n      return new Int32Array([w, h]);\r\n    }\r\n    return utils.closestSquareDimensions(texelCount);\r\n  },\r\n\r\n  /**\r\n   *\r\n   * @param {Number} length\r\n   * @returns {TextureDimensions}\r\n   */\r\n  closestSquareDimensions(length) {\r\n    const sqrt = Math.sqrt(length);\r\n    let high = Math.ceil(sqrt);\r\n    let low = Math.floor(sqrt);\r\n    while (high * low < length) {\r\n      high--;\r\n      low = Math.ceil(length / high);\r\n    }\r\n    return new Int32Array([low, Math.ceil(length / low)]);\r\n  },\r\n\r\n  /**\r\n   * A texture takes up four\r\n   * @param {OutputDimensions} dimensions\r\n   * @param {Number} bitRatio\r\n   * @returns {TextureDimensions}\r\n   */\r\n  getMemoryOptimizedFloatTextureSize(dimensions, bitRatio) {\r\n    const totalArea = utils.roundTo((dimensions[0] || 1) * (dimensions[1] || 1) * (dimensions[2] || 1) * (dimensions[3] || 1), 4);\r\n    const texelCount = totalArea / bitRatio;\r\n    return utils.closestSquareDimensions(texelCount);\r\n  },\r\n\r\n  /**\r\n   *\r\n   * @param dimensions\r\n   * @param bitRatio\r\n   * @returns {*|TextureDimensions}\r\n   */\r\n  getMemoryOptimizedPackedTextureSize(dimensions, bitRatio) {\r\n    const [w, h, d] = dimensions;\r\n    const totalArea = utils.roundTo((w || 1) * (h || 1) * (d || 1), 4);\r\n    const texelCount = totalArea / (4 / bitRatio);\r\n    return utils.closestSquareDimensions(texelCount);\r\n  },\r\n\r\n  roundTo(n, d) {\r\n    return Math.floor((n + d - 1) / d) * d;\r\n  },\r\n  /**\r\n   * @desc Return the dimension of an array.\r\n   * @param {Array|String|Texture|Input} x - The array\r\n   * @param {Boolean} [pad] - To include padding in the dimension calculation\r\n   * @returns {OutputDimensions}\r\n   */\r\n  getDimensions(x, pad) {\r\n    let ret;\r\n    if (isArray(x)) {\r\n      const dim = [];\r\n      let temp = x;\r\n      while (isArray(temp)) {\r\n        dim.push(temp.length);\r\n        temp = temp[0];\r\n      }\r\n      ret = dim.reverse();\r\n    } else if (x instanceof Texture) {\r\n      ret = x.output;\r\n    } else if (x instanceof Input) {\r\n      ret = x.size;\r\n    } else {\r\n      throw new Error(`Unknown dimensions of ${x}`);\r\n    }\r\n\r\n    if (pad) {\r\n      ret = Array.from(ret);\r\n      while (ret.length < 3) {\r\n        ret.push(1);\r\n      }\r\n    }\r\n\r\n    return new Int32Array(ret);\r\n  },\r\n\r\n  /**\r\n   * Puts a nested 2d array into a one-dimensional target array\r\n   * @param {Array|*} array\r\n   * @param {Float32Array|Float64Array} target\r\n   */\r\n  flatten2dArrayTo(array, target) {\r\n    let offset = 0;\r\n    for (let y = 0; y < array.length; y++) {\r\n      target.set(array[y], offset);\r\n      offset += array[y].length;\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Puts a nested 3d array into a one-dimensional target array\r\n   * @param {Array|*} array\r\n   * @param {Float32Array|Float64Array} target\r\n   */\r\n  flatten3dArrayTo(array, target) {\r\n    let offset = 0;\r\n    for (let z = 0; z < array.length; z++) {\r\n      for (let y = 0; y < array[z].length; y++) {\r\n        target.set(array[z][y], offset);\r\n        offset += array[z][y].length;\r\n      }\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Puts a nested 4d array into a one-dimensional target array\r\n   * @param {Array|*} array\r\n   * @param {Float32Array|Float64Array} target\r\n   */\r\n  flatten4dArrayTo(array, target) {\r\n    let offset = 0;\r\n    for (let l = 0; l < array.length; l++) {\r\n      for (let z = 0; z < array[l].length; z++) {\r\n        for (let y = 0; y < array[l][z].length; y++) {\r\n          target.set(array[l][z][y], offset);\r\n          offset += array[l][z][y].length;\r\n        }\r\n      }\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Puts a nested 1d, 2d, or 3d array into a one-dimensional target array\r\n   * @param {Float32Array|Uint16Array|Uint8Array} array\r\n   * @param {Float32Array} target\r\n   */\r\n  flattenTo(array, target) {\r\n    if (isArray(array[0])) {\r\n      if (isArray(array[0][0])) {\r\n        if (isArray(array[0][0][0])) {\r\n          utils.flatten4dArrayTo(array, target);\r\n        } else {\r\n          utils.flatten3dArrayTo(array, target);\r\n        }\r\n      } else {\r\n        utils.flatten2dArrayTo(array, target);\r\n      }\r\n    } else {\r\n      target.set(array);\r\n    }\r\n  },\r\n\r\n  /**\r\n   *\r\n   * @desc Splits an array into smaller arrays.\r\n   * Number of elements in one small chunk is given by `part`\r\n   *\r\n   * @param {Number[]} array - The array to split into chunks\r\n   * @param {Number} part - elements in one chunk\r\n   *\r\n   * @returns {Number[]} An array of smaller chunks\r\n   */\r\n  splitArray(array, part) {\r\n    const result = [];\r\n    for (let i = 0; i < array.length; i += part) {\r\n      result.push(new array.constructor(array.buffer, i * 4 + array.byteOffset, part));\r\n    }\r\n    return result;\r\n  },\r\n\r\n  getAstString,\r\n\r\n  allPropertiesOf(obj) {\r\n    const props = [];\r\n\r\n    do {\r\n      props.push.apply(props, Object.getOwnPropertyNames(obj));\r\n    } while (obj = Object.getPrototypeOf(obj));\r\n\r\n    return props;\r\n  },\r\n\r\n  /**\r\n   * @param {Array} lines - An Array of strings\r\n   * @returns {String} Single combined String, separated by *\\n*\r\n   */\r\n  linesToString(lines) {\r\n    if (lines.length > 0) {\r\n      return lines.join(';\\n') + ';\\n';\r\n    } else {\r\n      return '\\n';\r\n    }\r\n  },\r\n\r\n  warnDeprecated,\r\n  functionToIFunction,\r\n\r\n  flipPixels(pixels, width, height) {\r\n    // https://stackoverflow.com/a/41973289/1324039\r\n    const halfHeight = height / 2 | 0; // the | 0 keeps the result an int\r\n    const bytesPerRow = width * 4;\r\n    // make a temp buffer to hold one row\r\n    const temp = new Uint8ClampedArray(width * 4);\r\n    const result = pixels.slice(0);\r\n    for (let y = 0; y < halfHeight; ++y) {\r\n      const topOffset = y * bytesPerRow;\r\n      const bottomOffset = (height - y - 1) * bytesPerRow;\r\n\r\n      // make copy of a row on the top half\r\n      temp.set(result.subarray(topOffset, topOffset + bytesPerRow));\r\n\r\n      // copy a row from the bottom half to the top\r\n      result.copyWithin(topOffset, bottomOffset, bottomOffset + bytesPerRow);\r\n\r\n      // copy the copy of the top half row to the bottom half\r\n      result.set(temp, bottomOffset);\r\n    }\r\n    return result;\r\n  },\r\n\r\n  erectPackedFloat: (array, width) => {\r\n    return array.subarray(0, width);\r\n  },\r\n  erect2DPackedFloat: (array, width, height) => {\r\n    const yResults = new Array(height);\r\n    for (let y = 0; y < height; y++) {\r\n      const xStart = y * width;\r\n      const xEnd = xStart + width;\r\n      yResults[y] = array.subarray(xStart, xEnd);\r\n    }\r\n    return yResults;\r\n  },\r\n  erect3DPackedFloat: (array, width, height, depth) => {\r\n    const zResults = new Array(depth);\r\n    for (let z = 0; z < depth; z++) {\r\n      const yResults = new Array(height);\r\n      for (let y = 0; y < height; y++) {\r\n        const xStart = (z * height * width) + y * width;\r\n        const xEnd = xStart + width;\r\n        yResults[y] = array.subarray(xStart, xEnd);\r\n      }\r\n      zResults[z] = yResults;\r\n    }\r\n    return zResults;\r\n  },\r\n  erectMemoryOptimizedFloat: (array, width) => {\r\n    return array.subarray(0, width);\r\n  },\r\n  erectMemoryOptimized2DFloat,\r\n  erectMemoryOptimized3DFloat,\r\n  erectFloat: (array, width) => {\r\n    const xResults = new Float32Array(width);\r\n    let i = 0;\r\n    for (let x = 0; x < width; x++) {\r\n      xResults[x] = array[i];\r\n      i += 4;\r\n    }\r\n    return xResults;\r\n  },\r\n  erect2DFloat: (array, width, height) => {\r\n    const yResults = new Array(height);\r\n    let i = 0;\r\n    for (let y = 0; y < height; y++) {\r\n      const xResults = new Float32Array(width);\r\n      for (let x = 0; x < width; x++) {\r\n        xResults[x] = array[i];\r\n        i += 4;\r\n      }\r\n      yResults[y] = xResults;\r\n    }\r\n    return yResults;\r\n  },\r\n  erect3DFloat: (array, width, height, depth) => {\r\n    const zResults = new Array(depth);\r\n    let i = 0;\r\n    for (let z = 0; z < depth; z++) {\r\n      const yResults = new Array(height);\r\n      for (let y = 0; y < height; y++) {\r\n        const xResults = new Float32Array(width);\r\n        for (let x = 0; x < width; x++) {\r\n          xResults[x] = array[i];\r\n          i += 4;\r\n        }\r\n        yResults[y] = xResults;\r\n      }\r\n      zResults[z] = yResults;\r\n    }\r\n    return zResults;\r\n  },\r\n  erectArray2: (array, width) => {\r\n    const xResults = new Array(width);\r\n    const xResultsMax = width * 4;\r\n    let i = 0;\r\n    for (let x = 0; x < xResultsMax; x += 4) {\r\n      xResults[i++] = array.subarray(x, x + 2);\r\n    }\r\n    return xResults;\r\n  },\r\n  erect2DArray2: (array, width, height) => {\r\n    const yResults = new Array(height);\r\n    const XResultsMax = width * 4;\r\n    for (let y = 0; y < height; y++) {\r\n      const xResults = new Array(width);\r\n      const offset = y * XResultsMax;\r\n      let i = 0;\r\n      for (let x = 0; x < XResultsMax; x += 4) {\r\n        xResults[i++] = array.subarray(x + offset, x + offset + 2);\r\n      }\r\n      yResults[y] = xResults;\r\n    }\r\n    return yResults;\r\n  },\r\n  erect3DArray2: (array, width, height, depth) => {\r\n    const xResultsMax = width * 4;\r\n    const zResults = new Array(depth);\r\n    for (let z = 0; z < depth; z++) {\r\n      const yResults = new Array(height);\r\n      for (let y = 0; y < height; y++) {\r\n        const xResults = new Array(width);\r\n        const offset = (z * xResultsMax * height) + (y * xResultsMax);\r\n        let i = 0;\r\n        for (let x = 0; x < xResultsMax; x += 4) {\r\n          xResults[i++] = array.subarray(x + offset, x + offset + 2);\r\n        }\r\n        yResults[y] = xResults;\r\n      }\r\n      zResults[z] = yResults;\r\n    }\r\n    return zResults;\r\n  },\r\n  erectArray3: (array, width) => {\r\n    const xResults = new Array(width);\r\n    const xResultsMax = width * 4;\r\n    let i = 0;\r\n    for (let x = 0; x < xResultsMax; x += 4) {\r\n      xResults[i++] = array.subarray(x, x + 3);\r\n    }\r\n    return xResults;\r\n  },\r\n  erect2DArray3: (array, width, height) => {\r\n    const xResultsMax = width * 4;\r\n    const yResults = new Array(height);\r\n    for (let y = 0; y < height; y++) {\r\n      const xResults = new Array(width);\r\n      const offset = y * xResultsMax;\r\n      let i = 0;\r\n      for (let x = 0; x < xResultsMax; x += 4) {\r\n        xResults[i++] = array.subarray(x + offset, x + offset + 3);\r\n      }\r\n      yResults[y] = xResults;\r\n    }\r\n    return yResults;\r\n  },\r\n  erect3DArray3: (array, width, height, depth) => {\r\n    const xResultsMax = width * 4;\r\n    const zResults = new Array(depth);\r\n    for (let z = 0; z < depth; z++) {\r\n      const yResults = new Array(height);\r\n      for (let y = 0; y < height; y++) {\r\n        const xResults = new Array(width);\r\n        const offset = (z * xResultsMax * height) + (y * xResultsMax);\r\n        let i = 0;\r\n        for (let x = 0; x < xResultsMax; x += 4) {\r\n          xResults[i++] = array.subarray(x + offset, x + offset + 3);\r\n        }\r\n        yResults[y] = xResults;\r\n      }\r\n      zResults[z] = yResults;\r\n    }\r\n    return zResults;\r\n  },\r\n  erectArray4: (array, width) => {\r\n    const xResults = new Array(array);\r\n    const xResultsMax = width * 4;\r\n    let i = 0;\r\n    for (let x = 0; x < xResultsMax; x += 4) {\r\n      xResults[i++] = array.subarray(x, x + 4);\r\n    }\r\n    return xResults;\r\n  },\r\n  erect2DArray4: (array, width, height) => {\r\n    const xResultsMax = width * 4;\r\n    const yResults = new Array(height);\r\n    for (let y = 0; y < height; y++) {\r\n      const xResults = new Array(width);\r\n      const offset = y * xResultsMax;\r\n      let i = 0;\r\n      for (let x = 0; x < xResultsMax; x += 4) {\r\n        xResults[i++] = array.subarray(x + offset, x + offset + 4);\r\n      }\r\n      yResults[y] = xResults;\r\n    }\r\n    return yResults;\r\n  },\r\n  erect3DArray4: (array, width, height, depth) => {\r\n    const xResultsMax = width * 4;\r\n    const zResults = new Array(depth);\r\n    for (let z = 0; z < depth; z++) {\r\n      const yResults = new Array(height);\r\n      for (let y = 0; y < height; y++) {\r\n        const xResults = new Array(width);\r\n        const offset = (z * xResultsMax * height) + (y * xResultsMax);\r\n        let i = 0;\r\n        for (let x = 0; x < xResultsMax; x += 4) {\r\n          xResults[i++] = array.subarray(x + offset, x + offset + 4);\r\n        }\r\n        yResults[y] = xResults;\r\n      }\r\n      zResults[z] = yResults;\r\n    }\r\n    return zResults;\r\n  },\r\n\r\n  /**\r\n   * @param {String} source\r\n   * @param {Object} settings\r\n   * @return {String}\r\n   */\r\n  flattenFunctionToString: (source, settings) => {\r\n    const { findDependency, thisLookup, doNotDefine } = settings;\r\n    let flattened = settings.flattened;\r\n    if (!flattened) {\r\n      flattened = settings.flattened = {};\r\n    }\r\n\r\n    if (parse === null) {\r\n      throw new Error('Missing JS to AST parser');\r\n    }\r\n\r\n    const ast = parse(source);\r\n    const functionDependencies = [];\r\n\r\n    function flatten(ast) {\r\n      if (Array.isArray(ast)) {\r\n        const results = [];\r\n        for (let i = 0; i < ast.length; i++) {\r\n          results.push(flatten(ast[i]));\r\n        }\r\n        return results.join('');\r\n      }\r\n      switch (ast.type) {\r\n        case 'Program':\r\n          return flatten(ast.body);\r\n        case 'FunctionDeclaration':\r\n          return `function ${ast.id.name}(${ast.params.map(flatten).join(', ')}) ${ flatten(ast.body) }`;\r\n        case 'BlockStatement': {\r\n          const result = [];\r\n          for (let i = 0; i < ast.body.length; i++) {\r\n            result.push(flatten(ast.body[i]), ';\\n');\r\n          }\r\n          return `{\\n${result.join('')}}`;\r\n        }\r\n        case 'VariableDeclaration':\r\n          switch (ast.declarations[0].id.type) {\r\n            case 'ObjectPattern': {\r\n              const source = flatten(ast.declarations[0].init);\r\n              const properties = ast.declarations.map(declaration => declaration.id.properties.map(flatten))[0];\r\n              if (/this/.test(source)) {\r\n                const result = [];\r\n                const lookups = properties.map(thisLookup);\r\n                for (let i = 0; i < lookups.length; i++) {\r\n                  const lookup = lookups[i];\r\n                  if (lookup === null) continue;\r\n                  const property = properties[i];\r\n                  result.push(`${ast.kind} ${ property } = ${ lookup };\\n`);\r\n                }\r\n\r\n                return result.join('');\r\n              }\r\n              return `${ast.kind} { ${properties} } = ${source}`;\r\n            }\r\n            case 'ArrayPattern':\r\n              return `${ast.kind} [ ${ ast.declarations.map(declaration => flatten(declaration.id)).join(', ') } ] = ${flatten(ast.declarations[0].init)}`;\r\n          }\r\n          if (doNotDefine && doNotDefine.indexOf(ast.declarations[0].id.name) !== -1) {\r\n            return '';\r\n          }\r\n          return `${ast.kind} ${ast.declarations[0].id.name} = ${flatten(ast.declarations[0].init)}`;\r\n        case 'CallExpression': {\r\n          if (ast.callee.property.name === 'subarray') {\r\n            return `${flatten(ast.callee.object)}.${flatten(ast.callee.property)}(${ast.arguments.map(value => flatten(value)).join(', ')})`;\r\n          }\r\n          if (ast.callee.object.name === 'gl' || ast.callee.object.name === 'context') {\r\n            return `${flatten(ast.callee.object)}.${flatten(ast.callee.property)}(${ast.arguments.map(value => flatten(value)).join(', ')})`;\r\n          }\r\n          if (ast.callee.object.type === 'ThisExpression') {\r\n            functionDependencies.push(findDependency('this', ast.callee.property.name));\r\n            return `${ast.callee.property.name}(${ast.arguments.map(value => flatten(value)).join(', ')})`;\r\n          } else if (ast.callee.object.name) {\r\n            const foundSource = findDependency(ast.callee.object.name, ast.callee.property.name);\r\n            if (foundSource === null) {\r\n              // we're not flattening it\r\n              return `${ast.callee.object.name}.${ast.callee.property.name}(${ast.arguments.map(value => flatten(value)).join(', ')})`;\r\n            } else {\r\n              functionDependencies.push(foundSource);\r\n              // we're flattening it\r\n              return `${ast.callee.property.name}(${ast.arguments.map(value => flatten(value)).join(', ')})`;\r\n            }\r\n          } else if (ast.callee.object.type === 'MemberExpression') {\r\n            return `${flatten(ast.callee.object)}.${ast.callee.property.name}(${ast.arguments.map(value => flatten(value)).join(', ')})`;\r\n          } else {\r\n            throw new Error('unknown ast.callee');\r\n          }\r\n        }\r\n        case 'ReturnStatement':\r\n          return `return ${flatten(ast.argument)}`;\r\n        case 'BinaryExpression':\r\n          return `(${flatten(ast.left)}${ast.operator}${flatten(ast.right)})`;\r\n        case 'UnaryExpression':\r\n          if (ast.prefix) {\r\n            return `${ast.operator} ${flatten(ast.argument)}`;\r\n          } else {\r\n            return `${flatten(ast.argument)} ${ast.operator}`;\r\n          }\r\n          case 'ExpressionStatement':\r\n            return `(${flatten(ast.expression)})`;\r\n          case 'ArrowFunctionExpression':\r\n            return `(${ast.params.map(flatten).join(', ')}) => ${flatten(ast.body)}`;\r\n          case 'Literal':\r\n            return ast.raw;\r\n          case 'Identifier':\r\n            return ast.name;\r\n          case 'MemberExpression':\r\n            if (ast.object.type === 'ThisExpression') {\r\n              return thisLookup(ast.property.name);\r\n            }\r\n            if (ast.computed) {\r\n              return `${flatten(ast.object)}[${flatten(ast.property)}]`;\r\n            }\r\n            return flatten(ast.object) + '.' + flatten(ast.property);\r\n          case 'ThisExpression':\r\n            return 'this';\r\n          case 'NewExpression':\r\n            return `new ${flatten(ast.callee)}(${ast.arguments.map(value => flatten(value)).join(', ')})`;\r\n          case 'ForStatement':\r\n            return `for (${flatten(ast.init)};${flatten(ast.test)};${flatten(ast.update)}) ${flatten(ast.body)}`;\r\n          case 'AssignmentExpression':\r\n            return `${flatten(ast.left)}${ast.operator}${flatten(ast.right)}`;\r\n          case 'UpdateExpression':\r\n            return `${flatten(ast.argument)}${ast.operator}`;\r\n          case 'IfStatement':\r\n            return `if (${flatten(ast.test)}) ${flatten(ast.consequent)}`;\r\n          case 'ThrowStatement':\r\n            return `throw ${flatten(ast.argument)}`;\r\n          case 'ObjectPattern':\r\n            return ast.properties.map(flatten).join(', ');\r\n          case 'ArrayPattern':\r\n            return ast.elements.map(flatten).join(', ');\r\n          case 'DebuggerStatement':\r\n            return 'debugger;';\r\n          case 'ConditionalExpression':\r\n            return `${flatten(ast.test)}?${flatten(ast.consequent)}:${flatten(ast.alternate)}`;\r\n          case 'Property':\r\n            if (ast.kind === 'init') {\r\n              return flatten(ast.key);\r\n            }\r\n      }\r\n      throw new Error(`unhandled ast.type of ${ ast.type }`);\r\n    }\r\n    const result = flatten(ast);\r\n    if (functionDependencies.length > 0) {\r\n      const flattenedFunctionDependencies = [];\r\n      for (let i = 0; i < functionDependencies.length; i++) {\r\n        const functionDependency = functionDependencies[i];\r\n        if (!flattened[functionDependency]) {\r\n          flattened[functionDependency] = true;\r\n        }\r\n        flattenedFunctionDependencies.push(utils.flattenFunctionToString(functionDependency, settings) + ';\\n');\r\n      }\r\n      return flattenedFunctionDependencies.join('') + result;\r\n    }\r\n    return result;\r\n  },\r\n};\r\n\r\nexport { utils };\r\n","import { Input } from '../input';\r\nimport {\r\n  functionToIFunction,\r\n  getArgumentNamesFromString,\r\n  isArray,\r\n  isFunctionString,\r\n  warnDeprecated\r\n} from '../common';\r\nimport { getVariableType } from '../utils';\r\n\r\nexport class Kernel {\r\n  /**\r\n   * @type {Boolean}\r\n   */\r\n  static get isSupported() {\r\n    throw new Error(`\"isSupported\" not implemented on ${ this.name }`);\r\n  }\r\n\r\n  /**\r\n   * @type {Boolean}\r\n   */\r\n  static isContextMatch(context) {\r\n    throw new Error(`\"isContextMatch\" not implemented on ${ this.name }`);\r\n  }\r\n\r\n  /**\r\n   * @type {IKernelFeatures}\r\n   * Used internally to populate the kernel.feature, which is a getter for the output of this value\r\n   */\r\n  static getFeatures() {\r\n    throw new Error(`\"getFeatures\" not implemented on ${ this.name }`);\r\n  }\r\n\r\n  static destroyContext(context) {\r\n    throw new Error(`\"destroyContext\" called on ${ this.name }`);\r\n  }\r\n\r\n  static nativeFunctionArguments() {\r\n    throw new Error(`\"nativeFunctionArguments\" called on ${ this.name }`);\r\n  }\r\n\r\n  static nativeFunctionReturnType() {\r\n    throw new Error(`\"nativeFunctionReturnType\" called on ${ this.name }`);\r\n  }\r\n\r\n  static combineKernels() {\r\n    throw new Error(`\"combineKernels\" called on ${ this.name }`);\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @param {string|object} source\r\n   * @param [settings]\r\n   */\r\n  constructor(source, settings) {\r\n    if (typeof source !== 'object') {\r\n      if (typeof source !== 'string') {\r\n        throw new Error('source not a string');\r\n      }\r\n      if (!isFunctionString(source)) {\r\n        throw new Error('source not a function string');\r\n      }\r\n    }\r\n    this.useLegacyEncoder = false;\r\n    this.fallbackRequested = false;\r\n    this.onRequestFallback = null;\r\n\r\n    /**\r\n     * Name of the arguments found from parsing source argument\r\n     * @type {String[]}\r\n     */\r\n    this.argumentNames = typeof source === 'string' ? getArgumentNamesFromString(source) : null;\r\n    this.argumentTypes = null;\r\n    this.argumentSizes = null;\r\n    this.argumentBitRatios = null;\r\n    this.kernelArguments = null;\r\n    this.kernelConstants = null;\r\n\r\n\r\n    /**\r\n     * The function source\r\n     * @type {String}\r\n     */\r\n    this.source = source;\r\n\r\n    /**\r\n     * The size of the kernel's output\r\n     * @type {Number[]}\r\n     */\r\n    this.output = null;\r\n\r\n    /**\r\n     * Debug mode\r\n     * @type {Boolean}\r\n     */\r\n    this.debug = false;\r\n\r\n    /**\r\n     * Graphical mode\r\n     * @type {Boolean}\r\n     */\r\n    this.graphical = false;\r\n\r\n    /**\r\n     * Maximum loops when using argument values to prevent infinity\r\n     * @type {Number}\r\n     */\r\n    this.loopMaxIterations = 0;\r\n\r\n    /**\r\n     * Constants used in kernel via `this.constants`\r\n     * @type {Object}\r\n     */\r\n    this.constants = null;\r\n    this.constantTypes = null;\r\n    this.constantBitRatios = null;\r\n    this.dynamicArguments = false;\r\n    this.dynamicOutput = true;\r\n\r\n    /**\r\n     *\r\n     * @type {Object}\r\n     */\r\n    this.canvas = null;\r\n\r\n    /**\r\n     *\r\n     * @type {WebGLRenderingContext}\r\n     */\r\n    this.context = null;\r\n\r\n    /**\r\n     *\r\n     * @type {Boolean}\r\n     */\r\n    this.checkContext = null;\r\n\r\n    /**\r\n     *\r\n     * @type {GPU}\r\n     */\r\n    this.gpu = null;\r\n\r\n    /**\r\n     *\r\n     * @type {IGPUFunction[]}\r\n     */\r\n    this.functions = null;\r\n\r\n    /**\r\n     *\r\n     * @type {IGPUNativeFunction[]}\r\n     */\r\n    this.nativeFunctions = null;\r\n\r\n    /**\r\n     *\r\n     * @type {ISubKernel[]}\r\n     */\r\n    this.subKernels = null;\r\n\r\n    /**\r\n     *\r\n     * @type {Boolean}\r\n     */\r\n    this.validate = true;\r\n\r\n    /**\r\n     * Enforces kernel to write to a new array or texture on run\r\n     * @type {Boolean}\r\n     */\r\n    this.immutable = false;\r\n\r\n    /**\r\n     * Enforces kernel to write to a texture on run\r\n     * @type {Boolean}\r\n     */\r\n    this.pipeline = false;\r\n\r\n    /**\r\n     * Make GPU use single precison or unsigned.  Acceptable values: 'single' or 'unsigned'\r\n     * @type {String|null}\r\n     * @enum 'single' | 'unsigned'\r\n     */\r\n    this.precision = null;\r\n\r\n    /**\r\n     *\r\n     * @type {String|null}\r\n     * @enum 'speed' | 'balanced' | 'precision'\r\n     */\r\n    this.tactic = 'balanced';\r\n\r\n    this.plugins = null;\r\n\r\n    this.returnType = null;\r\n    this.leadingReturnStatement = null;\r\n    this.followingReturnStatement = null;\r\n    this.optimizeFloatMemory = null;\r\n    this.strictIntegers = false;\r\n    this.fixIntegerDivisionAccuracy = null;\r\n    this.warnVarUsage = true;\r\n  }\r\n\r\n  mergeSettings(settings) {\r\n    for (let p in settings) {\r\n      if (!settings.hasOwnProperty(p) || !this.hasOwnProperty(p)) continue;\r\n      switch (p) {\r\n        case 'output':\r\n          if (!Array.isArray(settings.output)) {\r\n            this.setOutput(settings.output); // Flatten output object\r\n            continue;\r\n          }\r\n          break;\r\n        case 'functions':\r\n          if (typeof settings.functions[0] === 'function') {\r\n            this.functions = settings.functions.map(source => functionToIFunction(source));\r\n            continue;\r\n          }\r\n          break;\r\n        case 'graphical':\r\n          if (settings[p] && !settings.hasOwnProperty('precision')) {\r\n            this.precision = 'unsigned';\r\n          }\r\n          this[p] = settings[p];\r\n          continue;\r\n      }\r\n      this[p] = settings[p];\r\n    }\r\n\r\n    if (!this.canvas) this.canvas = this.initCanvas();\r\n    if (!this.context) this.context = this.initContext();\r\n    if (!this.plugins) this.plugins = this.initPlugins(settings);\r\n  }\r\n  /**\r\n   * @desc Builds the Kernel, by compiling Fragment and Vertical Shaders,\r\n   * and instantiates the program.\r\n   * @abstract\r\n   */\r\n  build() {\r\n    throw new Error(`\"build\" not defined on ${ this.constructor.name }`);\r\n  }\r\n\r\n  /**\r\n   * @desc Run the kernel program, and send the output to renderOutput\r\n   * <p> This method calls a helper method *renderOutput* to return the result. </p>\r\n   * @returns {Float32Array|Float32Array[]|Float32Array[][]|void} Result The final output of the program, as float, and as Textures for reuse.\r\n   * @abstract\r\n   */\r\n  run() {\r\n    throw new Error(`\"run\" not defined on ${ this.constructor.name }`)\r\n  }\r\n\r\n  /**\r\n   * @abstract\r\n   * @return {Object}\r\n   */\r\n  initCanvas() {\r\n    throw new Error(`\"initCanvas\" not defined on ${ this.constructor.name }`);\r\n  }\r\n\r\n  /**\r\n   * @abstract\r\n   * @return {Object}\r\n   */\r\n  initContext() {\r\n    throw new Error(`\"initContext\" not defined on ${ this.constructor.name }`);\r\n  }\r\n\r\n  /**\r\n   * @param {IFunctionSettings} settings\r\n   * @return {Object};\r\n   * @abstract\r\n   */\r\n  initPlugins(settings) {\r\n    throw new Error(`\"initPlugins\" not defined on ${ this.constructor.name }`);\r\n  }\r\n\r\n  /**\r\n   * @desc Setup the parameter types for the parameters\r\n   * supplied to the Kernel function\r\n   *\r\n   * @param {IArguments} args - The actual parameters sent to the Kernel\r\n   */\r\n  setupArguments(args) {\r\n    this.kernelArguments = [];\r\n    if (!this.argumentTypes) {\r\n      if (!this.argumentTypes) {\r\n        this.argumentTypes = [];\r\n        for (let i = 0; i < args.length; i++) {\r\n          const argType = getVariableType(args[i], this.strictIntegers);\r\n          const type = argType === 'Integer' ? 'Number' : argType;\r\n          this.argumentTypes.push(type);\r\n          this.kernelArguments.push({\r\n            type\r\n          });\r\n        }\r\n      }\r\n    } else {\r\n      for (let i = 0; i < this.argumentTypes.length; i++) {\r\n        this.kernelArguments.push({\r\n          type: this.argumentTypes[i]\r\n        });\r\n      }\r\n    }\r\n\r\n    // setup sizes\r\n    this.argumentSizes = new Array(args.length);\r\n    this.argumentBitRatios = new Int32Array(args.length);\r\n\r\n    for (let i = 0; i < args.length; i++) {\r\n      const arg = args[i];\r\n      this.argumentSizes[i] = arg.constructor === Input ? arg.size : null;\r\n      this.argumentBitRatios[i] = this.getBitRatio(arg);\r\n    }\r\n\r\n    if (this.argumentNames.length !== args.length) {\r\n      throw new Error(`arguments are miss-aligned`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Setup constants\r\n   */\r\n  setupConstants() {\r\n    this.kernelConstants = [];\r\n    let needsConstantTypes = this.constantTypes === null;\r\n    if (needsConstantTypes) {\r\n      this.constantTypes = {};\r\n    }\r\n    this.constantBitRatios = {};\r\n    if (this.constants) {\r\n      for (let name in this.constants) {\r\n        if (needsConstantTypes) {\r\n          const type = getVariableType(this.constants[name], this.strictIntegers);\r\n          this.constantTypes[name] = type;\r\n          this.kernelConstants.push({\r\n            name,\r\n            type\r\n          });\r\n        } else {\r\n          this.kernelConstants.push({\r\n            name,\r\n            type: this.constantTypes[name]\r\n          });\r\n        }\r\n        this.constantBitRatios[name] = this.getBitRatio(this.constants[name]);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @param flag\r\n   * @return {Kernel}\r\n   */\r\n  setOptimizeFloatMemory(flag) {\r\n    this.optimizeFloatMemory = flag;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * @desc Set output dimensions of the kernel function\r\n   * @param {Array|Object} output - The output array to set the kernel output size to\r\n   */\r\n  setOutput(output) {\r\n    if (output.hasOwnProperty('x')) {\r\n      if (output.hasOwnProperty('y')) {\r\n        if (output.hasOwnProperty('z')) {\r\n          this.output = [output.x, output.y, output.z];\r\n        } else {\r\n          this.output = [output.x, output.y];\r\n        }\r\n      } else {\r\n        this.output = [output.x];\r\n      }\r\n    } else {\r\n      this.output = output;\r\n    }\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * @desc Toggle debug mode\r\n   * @param {Boolean} flag - true to enable debug\r\n   */\r\n  setDebug(flag) {\r\n    this.debug = flag;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * @desc Toggle graphical output mode\r\n   * @param {Boolean} flag - true to enable graphical output\r\n   */\r\n  setGraphical(flag) {\r\n    this.graphical = flag;\r\n    this.precision = 'unsigned';\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * @desc Set the maximum number of loop iterations\r\n   * @param {number} max - iterations count\r\n   *\r\n   */\r\n  setLoopMaxIterations(max) {\r\n    this.loopMaxIterations = max;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * @desc Set Constants\r\n   */\r\n  setConstants(constants) {\r\n    this.constants = constants;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @param [IKernelValueTypes] constantTypes\r\n   * @return {Kernel}\r\n   */\r\n  setConstantTypes(constantTypes) {\r\n    this.constantTypes = constantTypes;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @param {IFunction[]|KernelFunction[]} functions\r\n   * @return {Kernel}\r\n   */\r\n  setFunctions(functions) {\r\n    if (typeof functions[0] === 'function') {\r\n      this.functions = functions.map(source => functionToIFunction(source));\r\n    } else {\r\n      this.functions = functions;\r\n    }\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Set writing to texture on/off\r\n   * @param flag\r\n   * @return {Kernel}\r\n   */\r\n  setPipeline(flag) {\r\n    this.pipeline = flag;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Set precision to 'unsigned' or 'single'\r\n   * @param {String} flag 'unsigned' or 'single'\r\n   * @return {Kernel}\r\n   */\r\n  setPrecision(flag) {\r\n    this.precision = flag;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * @param flag\r\n   * @return {Kernel}\r\n   * @deprecated\r\n   */\r\n  setOutputToTexture(flag) {\r\n    warnDeprecated('method', 'setOutputToTexture', 'setPipeline');\r\n    this.pipeline = flag;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Set to immutable\r\n   * @param flag\r\n   * @return {Kernel}\r\n   */\r\n  setImmutable(flag) {\r\n    this.immutable = flag;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * @desc Bind the canvas to kernel\r\n   * @param {Object} canvas\r\n   */\r\n  setCanvas(canvas) {\r\n    this.canvas = canvas;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * @param {Boolean} flag\r\n   * @return {Kernel}\r\n   */\r\n  setStrictIntegers(flag) {\r\n    this.strictIntegers = flag;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @param flag\r\n   * @return {Kernel}\r\n   */\r\n  setDynamicOutput(flag) {\r\n    this.dynamicOutput = flag;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * @deprecated\r\n   * @param flag\r\n   * @return {Kernel}\r\n   */\r\n  setHardcodeConstants(flag) {\r\n    warnDeprecated('method', 'setHardcodeConstants');\r\n    this.setDynamicOutput(flag);\r\n    this.setDynamicArguments(flag);\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @param flag\r\n   * @return {Kernel}\r\n   */\r\n  setDynamicArguments(flag) {\r\n    this.dynamicArguments = flag;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * @param {Boolean} flag\r\n   * @return {Kernel}\r\n   */\r\n  setUseLegacyEncoder(flag) {\r\n    this.useLegacyEncoder = flag;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @param {Boolean} flag\r\n   * @return {Kernel}\r\n   */\r\n  setWarnVarUsage(flag) {\r\n    this.warnVarUsage = flag;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * @deprecated\r\n   * @returns {Object}\r\n   */\r\n  getCanvas() {\r\n    warnDeprecated('method', 'getCanvas');\r\n    return this.canvas;\r\n  }\r\n\r\n  /**\r\n   * @deprecated\r\n   * @returns {Object}\r\n   */\r\n  getWebGl() {\r\n    warnDeprecated('method', 'getWebGl');\r\n    return this.context;\r\n  }\r\n\r\n  /**\r\n   * @desc Bind the webGL instance to kernel\r\n   * @param {WebGLRenderingContext} context - webGl instance to bind\r\n   */\r\n  setContext(context) {\r\n    this.context = context;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @param [IKernelValueTypes|GPUVariableType[]] argumentTypes\r\n   * @return {Kernel}\r\n   */\r\n  setArgumentTypes(argumentTypes) {\r\n    if (Array.isArray(argumentTypes)) {\r\n      this.argumentTypes = argumentTypes;\r\n    } else {\r\n      this.argumentTypes = [];\r\n      for (const p in argumentTypes) {\r\n        const argumentIndex = this.argumentNames.indexOf(p);\r\n        if (argumentIndex === -1) throw new Error(`unable to find argument ${ p }`);\r\n        this.argumentTypes[argumentIndex] = argumentTypes[p];\r\n      }\r\n    }\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @param [Tactic] tactic\r\n   * @return {Kernel}\r\n   */\r\n  setTactic(tactic) {\r\n    this.tactic = tactic;\r\n    return this;\r\n  }\r\n\r\n  requestFallback(args) {\r\n    if (!this.onRequestFallback) {\r\n      throw new Error(`\"onRequestFallback\" not defined on ${ this.constructor.name }`);\r\n    }\r\n    this.fallbackRequested = true;\r\n    return this.onRequestFallback(args);\r\n  }\r\n\r\n  /**\r\n   * @desc Validate settings\r\n   * @abstract\r\n   */\r\n  validateSettings() {\r\n    throw new Error(`\"validateSettings\" not defined on ${ this.constructor.name }`);\r\n  }\r\n\r\n  /**\r\n   * @desc Add a sub kernel to the root kernel instance.\r\n   * This is what `createKernelMap` uses.\r\n   *\r\n   * @param {ISubKernel} subKernel - function (as a String) of the subKernel to add\r\n   */\r\n  addSubKernel(subKernel) {\r\n    if (this.subKernels === null) {\r\n      this.subKernels = [];\r\n    }\r\n    if (!subKernel.source) throw new Error('subKernel missing \"source\" property');\r\n    if (!subKernel.property && isNaN(subKernel.property)) throw new Error('subKernel missing \"property\" property');\r\n    if (!subKernel.name) throw new Error('subKernel missing \"name\" property');\r\n    this.subKernels.push(subKernel);\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * @desc Destroys all memory associated with this kernel\r\n   * @param {Boolean} [removeCanvasReferences] remove any associated canvas references\r\n   */\r\n  destroy(removeCanvasReferences) {\r\n    throw new Error(`\"destroy\" called on ${ this.constructor.name }`);\r\n  }\r\n\r\n  /**\r\n   * bit storage ratio of source to target 'buffer', i.e. if 8bit array -> 32bit tex = 4\r\n   * @param value\r\n   * @returns {number}\r\n   */\r\n  getBitRatio(value) {\r\n    if (this.precision === 'single') {\r\n      // 8 and 16 are upconverted to float32\r\n      return 4;\r\n    } else if (Array.isArray(value[0])) {\r\n      return this.getBitRatio(value[0]);\r\n    } else if (value.constructor === Input) {\r\n      return this.getBitRatio(value.value);\r\n    }\r\n    switch (value.constructor) {\r\n      case Uint8ClampedArray:\r\n      case Uint8Array:\r\n      case Int8Array:\r\n        return 1;\r\n      case Uint16Array:\r\n      case Int16Array:\r\n        return 2;\r\n      case Float32Array:\r\n      case Int32Array:\r\n      default:\r\n        return 4;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @returns {number[]}\r\n   */\r\n  getPixels() {\r\n    throw new Error(`\"getPixels\" called on ${ this.constructor.name }`);\r\n  }\r\n\r\n  checkOutput() {\r\n    if (!this.output || !isArray(this.output)) throw new Error('kernel.output not an array');\r\n    if (this.output.length < 1) throw new Error('kernel.output is empty, needs at least 1 value');\r\n    for (let i = 0; i < this.output.length; i++) {\r\n      if (isNaN(this.output[i]) || this.output[i] < 1) {\r\n        throw new Error(`${ this.constructor.name }.output[${ i }] incorrectly defined as \\`${ this.output[i] }\\`, needs to be numeric, and greater than 0`);\r\n      }\r\n    }\r\n  }\r\n\r\n  toJSON() {\r\n    const settings = {\r\n      output: this.output,\r\n      threadDim: this.threadDim,\r\n      pipeline: this.pipeline,\r\n      argumentNames: this.argumentNames,\r\n      argumentsTypes: this.argumentTypes,\r\n      constants: this.constants,\r\n      pluginNames: this.plugins ? this.plugins.map(plugin => plugin.name) : null,\r\n      returnType: this.returnType,\r\n    };\r\n    return {\r\n      settings\r\n    };\r\n  }\r\n}\r\n","/**\r\n * @desc This handles all the raw state, converted state, etc. of a single function.\r\n * [INTERNAL] A collection of functionNodes.\r\n * @class\r\n */\r\nexport class FunctionBuilder {\r\n  /**\r\n   *\r\n   * @param {Kernel} kernel\r\n   * @param {FunctionNode} FunctionNode\r\n   * @param {object} [extraNodeOptions]\r\n   * @returns {FunctionBuilder}\r\n   * @static\r\n   */\r\n  static fromKernel(kernel, FunctionNode, extraNodeOptions) {\r\n    const {\r\n      kernelArguments,\r\n      kernelConstants,\r\n      argumentNames,\r\n      argumentSizes,\r\n      argumentBitRatios,\r\n      constants,\r\n      constantBitRatios,\r\n      debug,\r\n      loopMaxIterations,\r\n      nativeFunctions,\r\n      output,\r\n      optimizeFloatMemory,\r\n      precision,\r\n      plugins,\r\n      source,\r\n      subKernels,\r\n      functions,\r\n      leadingReturnStatement,\r\n      followingReturnStatement,\r\n      dynamicArguments,\r\n      dynamicOutput,\r\n      warnVarUsage,\r\n    } = kernel;\r\n\r\n    const argumentTypes = new Array(kernelArguments.length);\r\n    const constantTypes = {};\r\n\r\n    for (let i = 0; i < kernelArguments.length; i++) {\r\n      argumentTypes[i] = kernelArguments[i].type;\r\n    }\r\n\r\n    for (let i = 0; i < kernelConstants.length; i++) {\r\n      const kernelConstant = kernelConstants[i]\r\n      constantTypes[kernelConstant.name] = kernelConstant.type;\r\n    }\r\n\r\n    const needsArgumentType = (functionName, index) => {\r\n      return functionBuilder.needsArgumentType(functionName, index);\r\n    };\r\n\r\n    const assignArgumentType = (functionName, index, type) => {\r\n      functionBuilder.assignArgumentType(functionName, index, type);\r\n    };\r\n\r\n    const lookupReturnType = (functionName, ast, requestingNode) => {\r\n      return functionBuilder.lookupReturnType(functionName, ast, requestingNode);\r\n    };\r\n\r\n    const lookupFunctionArgumentTypes = (functionName) => {\r\n      return functionBuilder.lookupFunctionArgumentTypes(functionName);\r\n    };\r\n\r\n    const lookupFunctionArgumentName = (functionName, argumentIndex) => {\r\n      return functionBuilder.lookupFunctionArgumentName(functionName, argumentIndex);\r\n    };\r\n\r\n    const lookupFunctionArgumentBitRatio = (functionName, argumentName) => {\r\n      return functionBuilder.lookupFunctionArgumentBitRatio(functionName, argumentName);\r\n    };\r\n\r\n    const triggerImplyArgumentType = (functionName, i, argumentType, requestingNode) => {\r\n      functionBuilder.assignArgumentType(functionName, i, argumentType, requestingNode);\r\n    };\r\n\r\n    const triggerTrackArgumentSynonym = (functionName, argumentName, calleeFunctionName, argumentIndex) => {\r\n      functionBuilder.trackArgumentSynonym(functionName, argumentName, calleeFunctionName, argumentIndex);\r\n    };\r\n\r\n    const lookupArgumentSynonym = (originFunctionName, functionName, argumentName) => {\r\n      return functionBuilder.lookupArgumentSynonym(originFunctionName, functionName, argumentName);\r\n    };\r\n\r\n    const onFunctionCall = (functionName, calleeFunctionName, args) => {\r\n      functionBuilder.trackFunctionCall(functionName, calleeFunctionName, args);\r\n    };\r\n\r\n    const onNestedFunction = (ast, returnType) => {\r\n      const argumentNames = [];\r\n      for (let i = 0; i < ast.params.length; i++) {\r\n        argumentNames.push(ast.params[i].name);\r\n      }\r\n      const nestedFunction = new FunctionNode(null, Object.assign({}, nodeOptions, {\r\n        returnType: null,\r\n        ast,\r\n        name: ast.id.name,\r\n        argumentNames,\r\n        lookupReturnType,\r\n        lookupFunctionArgumentTypes,\r\n        lookupFunctionArgumentName,\r\n        lookupFunctionArgumentBitRatio,\r\n        needsArgumentType,\r\n        assignArgumentType,\r\n        triggerImplyArgumentType,\r\n        triggerTrackArgumentSynonym,\r\n        lookupArgumentSynonym,\r\n        onFunctionCall,\r\n        warnVarUsage,\r\n      }));\r\n      nestedFunction.traceFunctionAST(ast);\r\n      functionBuilder.addFunctionNode(nestedFunction);\r\n    };\r\n\r\n    const nodeOptions = Object.assign({\r\n      isRootKernel: false,\r\n      onNestedFunction,\r\n      lookupReturnType,\r\n      lookupFunctionArgumentTypes,\r\n      lookupFunctionArgumentName,\r\n      lookupFunctionArgumentBitRatio,\r\n      needsArgumentType,\r\n      assignArgumentType,\r\n      triggerImplyArgumentType,\r\n      triggerTrackArgumentSynonym,\r\n      lookupArgumentSynonym,\r\n      onFunctionCall,\r\n      optimizeFloatMemory,\r\n      precision,\r\n      constants,\r\n      constantTypes,\r\n      constantBitRatios,\r\n      debug,\r\n      loopMaxIterations,\r\n      output,\r\n      plugins,\r\n      dynamicArguments,\r\n      dynamicOutput,\r\n    }, extraNodeOptions || {});\r\n\r\n    const rootNodeOptions = Object.assign({}, nodeOptions, {\r\n      isRootKernel: true,\r\n      name: 'kernel',\r\n      argumentNames,\r\n      argumentTypes,\r\n      argumentSizes,\r\n      argumentBitRatios,\r\n      leadingReturnStatement,\r\n      followingReturnStatement,\r\n    });\r\n\r\n    if (typeof source === 'object' && source.functionNodes) {\r\n      return new FunctionBuilder().fromJSON(source.functionNodes, FunctionNode);\r\n    }\r\n\r\n    const rootNode = new FunctionNode(source, rootNodeOptions);\r\n\r\n    let functionNodes = null;\r\n    if (functions) {\r\n      functionNodes = functions.map((fn) => new FunctionNode(fn.source, {\r\n        returnType: fn.returnType,\r\n        argumentTypes: fn.argumentTypes,\r\n        output,\r\n        plugins,\r\n        constants,\r\n        constantTypes,\r\n        constantBitRatios,\r\n        optimizeFloatMemory,\r\n        precision,\r\n        lookupReturnType,\r\n        lookupFunctionArgumentTypes,\r\n        lookupFunctionArgumentName,\r\n        lookupFunctionArgumentBitRatio,\r\n        needsArgumentType,\r\n        assignArgumentType,\r\n        triggerImplyArgumentType,\r\n        triggerTrackArgumentSynonym,\r\n        lookupArgumentSynonym,\r\n        onFunctionCall,\r\n      }));\r\n    }\r\n\r\n    let subKernelNodes = null;\r\n    if (subKernels) {\r\n      subKernelNodes = subKernels.map((subKernel) => {\r\n        const { name, source } = subKernel;\r\n        return new FunctionNode(source, Object.assign({}, nodeOptions, {\r\n          name,\r\n          isSubKernel: true,\r\n          isRootKernel: false,\r\n        }));\r\n      });\r\n    }\r\n\r\n    const functionBuilder = new FunctionBuilder({\r\n      kernel,\r\n      rootNode,\r\n      functionNodes,\r\n      nativeFunctions,\r\n      subKernelNodes\r\n    });\r\n\r\n    return functionBuilder;\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @param {IFunctionBuilderSettings} [settings]\r\n   */\r\n  constructor(settings) {\r\n    settings = settings || {};\r\n    this.kernel = settings.kernel;\r\n    this.rootNode = settings.rootNode;\r\n    this.functionNodes = settings.functionNodes || [];\r\n    this.subKernelNodes = settings.subKernelNodes || [];\r\n    this.nativeFunctions = settings.nativeFunctions || [];\r\n    this.functionMap = {};\r\n    this.nativeFunctionNames = [];\r\n    this.lookupChain = [];\r\n    this.argumentChain = [];\r\n    this.functionNodeDependencies = {};\r\n    this.functionCalls = {};\r\n\r\n    if (this.rootNode) {\r\n      this.functionMap['kernel'] = this.rootNode;\r\n    }\r\n\r\n    if (this.functionNodes) {\r\n      for (let i = 0; i < this.functionNodes.length; i++) {\r\n        this.functionMap[this.functionNodes[i].name] = this.functionNodes[i];\r\n      }\r\n    }\r\n\r\n    if (this.subKernelNodes) {\r\n      for (let i = 0; i < this.subKernelNodes.length; i++) {\r\n        this.functionMap[this.subKernelNodes[i].name] = this.subKernelNodes[i];\r\n      }\r\n    }\r\n\r\n    if (this.nativeFunctions) {\r\n      for (let i = 0; i < this.nativeFunctions.length; i++) {\r\n        const nativeFunction = this.nativeFunctions[i];\r\n        this.nativeFunctionNames.push(nativeFunction.name);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @desc Add the function node directly\r\n   *\r\n   * @param {FunctionNode} functionNode - functionNode to add\r\n   *\r\n   */\r\n  addFunctionNode(functionNode) {\r\n    if (!functionNode.name) throw new Error('functionNode.name needs set');\r\n    this.functionMap[functionNode.name] = functionNode;\r\n    if (functionNode.isRootKernel) {\r\n      this.rootNode = functionNode;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @desc Trace all the depending functions being called, from a single function\r\n   *\r\n   * This allow for 'unneeded' functions to be automatically optimized out.\r\n   * Note that the 0-index, is the starting function trace.\r\n   *\r\n   * @param {String} functionName - Function name to trace from, default to 'kernel'\r\n   * @param {String[]} [retList] - Returning list of function names that is traced. Including itself.\r\n   *\r\n   * @returns {String[]}  Returning list of function names that is traced. Including itself.\r\n   */\r\n  traceFunctionCalls(functionName, retList) {\r\n    functionName = functionName || 'kernel';\r\n    retList = retList || [];\r\n\r\n    if (this.nativeFunctionNames.indexOf(functionName) > -1) {\r\n      if (retList.indexOf(functionName) === -1) {\r\n        retList.push(functionName);\r\n      }\r\n      return retList;\r\n    }\r\n\r\n    const functionNode = this.functionMap[functionName];\r\n    if (functionNode) {\r\n      // Check if function already exists\r\n      const functionIndex = retList.indexOf(functionName);\r\n      if (functionIndex === -1) {\r\n        retList.push(functionName);\r\n        functionNode.toString(); //ensure JS trace is done\r\n        for (let i = 0; i < functionNode.calledFunctions.length; ++i) {\r\n          this.traceFunctionCalls(functionNode.calledFunctions[i], retList);\r\n        }\r\n      } else {\r\n        /**\r\n         * https://github.com/gpujs/gpu.js/issues/207\r\n         * if dependent function is already in the list, because a function depends on it, and because it has\r\n         * already been traced, we know that we must move the dependent function to the end of the the retList.\r\n         * */\r\n        const dependantFunctionName = retList.splice(functionIndex, 1)[0];\r\n        retList.push(dependantFunctionName);\r\n      }\r\n    }\r\n\r\n    return retList;\r\n  }\r\n\r\n  /**\r\n   * @desc Return the string for a function\r\n   * @param {String} functionName - Function name to trace from. If null, it returns the WHOLE builder stack\r\n   * @returns {String} The full string, of all the various functions. Trace optimized if functionName given\r\n   */\r\n  getPrototypeString(functionName) {\r\n    return this.getPrototypes(functionName).join('\\n');\r\n  }\r\n\r\n  /**\r\n   * @desc Return the string for a function\r\n   * @param {String} [functionName] - Function name to trace from. If null, it returns the WHOLE builder stack\r\n   * @returns {Array} The full string, of all the various functions. Trace optimized if functionName given\r\n   */\r\n  getPrototypes(functionName) {\r\n    if (this.rootNode) {\r\n      this.rootNode.toString();\r\n    }\r\n    if (functionName) {\r\n      return this.getPrototypesFromFunctionNames(this.traceFunctionCalls(functionName, []).reverse());\r\n    }\r\n    return this.getPrototypesFromFunctionNames(Object.keys(this.functionMap));\r\n  }\r\n\r\n  /**\r\n   * @desc Get string from function names\r\n   * @param {String[]} functionList - List of function to build string\r\n   * @returns {String} The string, of all the various functions. Trace optimized if functionName given\r\n   */\r\n  getStringFromFunctionNames(functionList) {\r\n    const ret = [];\r\n    for (let i = 0; i < functionList.length; ++i) {\r\n      const node = this.functionMap[functionList[i]];\r\n      if (node) {\r\n        ret.push(this.functionMap[functionList[i]].toString());\r\n      }\r\n    }\r\n    return ret.join('\\n');\r\n  }\r\n\r\n  /**\r\n   * @desc Return string of all functions converted\r\n   * @param {String[]} functionList - List of function names to build the string.\r\n   * @returns {Array} Prototypes of all functions converted\r\n   */\r\n  getPrototypesFromFunctionNames(functionList) {\r\n    const ret = [];\r\n    for (let i = 0; i < functionList.length; ++i) {\r\n      const functionName = functionList[i];\r\n      const functionIndex = this.nativeFunctionNames.indexOf(functionName);\r\n      if (functionIndex > -1) {\r\n        ret.push(this.nativeFunctions[functionIndex].source);\r\n        continue;\r\n      }\r\n      const node = this.functionMap[functionName];\r\n      if (node) {\r\n        ret.push(node.toString());\r\n      }\r\n    }\r\n    return ret;\r\n  }\r\n\r\n  toJSON() {\r\n    return this.traceFunctionCalls(this.rootNode.name).reverse().map(name => {\r\n      const nativeIndex = this.nativeFunctions.indexOf(name);\r\n      if (nativeIndex > -1) {\r\n        return {\r\n          name,\r\n          source: this.nativeFunctions[nativeIndex].source\r\n        };\r\n      } else if (this.functionMap[name]) {\r\n        return this.functionMap[name].toJSON();\r\n      } else {\r\n        throw new Error(`function ${ name } not found`);\r\n      }\r\n    });\r\n  }\r\n\r\n  fromJSON(jsonFunctionNodes, FunctionNode) {\r\n    this.functionMap = {};\r\n    for (let i = 0; i < jsonFunctionNodes.length; i++) {\r\n      const jsonFunctionNode = jsonFunctionNodes[i];\r\n      this.functionMap[jsonFunctionNode.settings.name] = new FunctionNode(jsonFunctionNode.ast, jsonFunctionNode.settings);\r\n    }\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * @desc Get string for a particular function name\r\n   * @param {String} functionName - Function name to trace from. If null, it returns the WHOLE builder stack\r\n   * @returns {String} settings - The string, of all the various functions. Trace optimized if functionName given\r\n   */\r\n  getString(functionName) {\r\n    if (functionName) {\r\n      return this.getStringFromFunctionNames(this.traceFunctionCalls(functionName).reverse());\r\n    }\r\n    return this.getStringFromFunctionNames(Object.keys(this.functionMap));\r\n  }\r\n\r\n  lookupReturnType(functionName, ast, requestingNode) {\r\n    if (ast.type !== 'CallExpression') {\r\n      throw new Error(`expected ast type of \"CallExpression\", but is ${ ast.type }`);\r\n    }\r\n    if (this._isNativeFunction(functionName)) {\r\n      return this._lookupNativeFunctionReturnType(functionName);\r\n    } else if (this._isFunction(functionName)) {\r\n      const node = this._getFunction(functionName);\r\n      if (node.returnType) {\r\n        return node.returnType;\r\n      } else {\r\n        for (let i = 0; i < this.lookupChain.length; i++) {\r\n          // detect circlical logic\r\n          if (this.lookupChain[i].ast === ast) {\r\n            // detect if arguments have not resolved, preventing a return type\r\n            // if so, go ahead and resolve them, so we can resolve the return type\r\n            if (node.argumentTypes.length === 0 && ast.arguments.length > 0) {\r\n              const args = ast.arguments;\r\n              for (let j = 0; j < args.length; j++) {\r\n                this.lookupChain.push({\r\n                  name: requestingNode.name,\r\n                  ast: args[i],\r\n                  requestingNode\r\n                });\r\n                node.argumentTypes[j] = requestingNode.getType(args[j]);\r\n                this.lookupChain.pop();\r\n              }\r\n              return node.returnType = node.getType(node.getJsAST());\r\n            }\r\n\r\n            throw new Error('circlical logic detected!');\r\n          }\r\n        }\r\n        // get ready for a ride!\r\n        this.lookupChain.push({\r\n          name: requestingNode.name,\r\n          ast,\r\n          requestingNode\r\n        });\r\n        const type = node.getType(node.getJsAST());\r\n        this.lookupChain.pop();\r\n        return node.returnType = type;\r\n      }\r\n    }\r\n\r\n    // function not found, maybe native?\r\n    return null;\r\n\r\n    /**\r\n     * first iteration\r\n     * kernel.outputs = Array\r\n     * kernel.targets = Array\r\n     * kernel.returns = null\r\n     * kernel.calls.calcErrorOutput = [kernel.output, kernel.targets]\r\n     * kernel.calls.calcDeltas = [calcErrorOutput.returns, kernel.output]\r\n     * calcErrorOutput.output = null\r\n     * calcErrorOutput.targets = null\r\n     * calcErrorOutput.returns = null\r\n     * calcDeltasSigmoid.error = null\r\n     * calcDeltasSigmoid.output = Number\r\n     * calcDeltasSigmoid.returns = null\r\n     *\r\n     * resolvable are:\r\n     * calcErrorOutput.output\r\n     * calcErrorOutput.targets\r\n     * calcErrorOutput.returns\r\n     *\r\n     * second iteration\r\n     * kernel.outputs = Array\r\n     * kernel.targets = Array\r\n     * kernel.returns = null\r\n     * kernel.calls.calcErrorOutput = [kernel.output, kernel.targets]\r\n     * kernel.calls.calcDeltas = [calcErrorOutput.returns, kernel.output]\r\n     * calcErrorOutput.output = Number\r\n     * calcErrorOutput.targets = Array\r\n     * calcErrorOutput.returns = Number\r\n     * calcDeltasSigmoid.error = null\r\n     * calcDeltasSigmoid.output = Number\r\n     * calcDeltasSigmoid.returns = null\r\n     *\r\n     * resolvable are:\r\n     * calcDeltasSigmoid.error\r\n     * calcDeltasSigmoid.returns\r\n     * kernel.returns\r\n     *\r\n     * third iteration\r\n     * kernel.outputs = Array\r\n     * kernel.targets = Array\r\n     * kernel.returns = Number\r\n     * kernel.calls.calcErrorOutput = [kernel.output, kernel.targets]\r\n     * kernel.calls.calcDeltas = [calcErrorOutput.returns, kernel.output]\r\n     * calcErrorOutput.output = Number\r\n     * calcErrorOutput.targets = Array\r\n     * calcErrorOutput.returns = Number\r\n     * calcDeltasSigmoid.error = Number\r\n     * calcDeltasSigmoid.output = Number\r\n     * calcDeltasSigmoid.returns = Number\r\n     *\r\n     *\r\n     */\r\n  }\r\n\r\n  _getFunction(functionName) {\r\n    if (!this._isFunction(functionName)) {\r\n      new Error(`Function ${functionName} not found`);\r\n    }\r\n    return this.functionMap[functionName];\r\n  }\r\n\r\n  _isFunction(functionName) {\r\n    return Boolean(this.functionMap[functionName]);\r\n  }\r\n\r\n  _getNativeFunction(functionName) {\r\n    for (let i = 0; i < this.nativeFunctions.length; i++) {\r\n      if (this.nativeFunctions[i].name === functionName) return this.nativeFunctions[i];\r\n    }\r\n    return null;\r\n  }\r\n\r\n  _isNativeFunction(functionName) {\r\n    return Boolean(this._getNativeFunction(functionName));\r\n  }\r\n\r\n  _lookupNativeFunctionReturnType(functionName) {\r\n    let nativeFunction = this._getNativeFunction(functionName);\r\n    if (nativeFunction) {\r\n      return nativeFunction.returnType;\r\n    }\r\n    throw new Error(`Native function ${ functionName } not found`);\r\n  }\r\n\r\n  lookupFunctionArgumentTypes(functionName) {\r\n    if (this._isNativeFunction(functionName)) {\r\n      return this._getNativeFunction(functionName).argumentTypes;\r\n    } else if (this._isFunction(functionName)) {\r\n      return this._getFunction(functionName).argumentTypes;\r\n    }\r\n    return null;\r\n  }\r\n\r\n  lookupFunctionArgumentName(functionName, argumentIndex) {\r\n    return this._getFunction(functionName).argumentNames[argumentIndex];\r\n  }\r\n\r\n  lookupFunctionArgumentBitRatio(functionName, argumentName) {\r\n    if (!this._isFunction(functionName)) {\r\n      throw new Error('function not found');\r\n    }\r\n    if (this.rootNode.name === functionName) {\r\n      const i = this.rootNode.argumentNames.indexOf(argumentName);\r\n      if (i !== -1) {\r\n        return this.rootNode.argumentBitRatios[i];\r\n      } else {\r\n        throw new Error('argument bit ratio not found');\r\n      }\r\n    } else {\r\n      const node = this._getFunction(functionName);\r\n      const argumentSynonym = node.argumentSynonym[node.synonymIndex];\r\n      if (!argumentSynonym) {\r\n        throw new Error('argument synonym not found');\r\n      }\r\n      return this.lookupFunctionArgumentBitRatio(argumentSynonym.functionName, argumentSynonym.argumentName);\r\n    }\r\n  }\r\n\r\n  needsArgumentType(functionName, i) {\r\n    if (!this._isFunction(functionName)) return false;\r\n    const fnNode = this._getFunction(functionName);\r\n    return !fnNode.argumentTypes[i];\r\n  }\r\n\r\n  assignArgumentType(functionName, i, argumentType, requestingNode) {\r\n    if (!this._isFunction(functionName)) return;\r\n    const fnNode = this._getFunction(functionName);\r\n    if (!fnNode.argumentTypes[i]) {\r\n      fnNode.argumentTypes[i] = argumentType;\r\n    }\r\n  }\r\n\r\n  trackArgumentSynonym(functionName, argumentName, calleeFunctionName, argumentIndex) {\r\n    if (!this._isFunction(calleeFunctionName)) return;\r\n    const node = this._getFunction(calleeFunctionName);\r\n    if (!node.argumentSynonym) {\r\n      node.argumentSynonym = {};\r\n    }\r\n    const calleeArgumentName = node.argumentNames[argumentIndex];\r\n    if (!node.argumentSynonym[calleeArgumentName]) {\r\n      node.argumentSynonym[calleeArgumentName] = {};\r\n    }\r\n    node.synonymIndex++;\r\n    node.argumentSynonym[node.synonymIndex] = {\r\n      functionName,\r\n      argumentName,\r\n      calleeArgumentName,\r\n      calleeFunctionName,\r\n    };\r\n  }\r\n\r\n  lookupArgumentSynonym(originFunctionName, functionName, argumentName) {\r\n    if (originFunctionName === functionName) return argumentName;\r\n    if (!this._isFunction(functionName)) return null;\r\n    const node = this._getFunction(functionName);\r\n    const argumentSynonym = node.argumentSynonym[node.synonymUseIndex];\r\n    if (!argumentSynonym) return null;\r\n    if (argumentSynonym.calleeArgumentName !== argumentName) return null;\r\n    node.synonymUseIndex++;\r\n    if (originFunctionName !== functionName) {\r\n      return this.lookupArgumentSynonym(originFunctionName, argumentSynonym.functionName, argumentSynonym.argumentName);\r\n    }\r\n    return argumentSynonym.argumentName;\r\n  }\r\n\r\n  trackFunctionCall(functionName, calleeFunctionName, args) {\r\n    if (!this.functionNodeDependencies[functionName]) {\r\n      this.functionNodeDependencies[functionName] = new Set();\r\n      this.functionCalls[functionName] = [];\r\n    }\r\n    this.functionNodeDependencies[functionName].add(calleeFunctionName);\r\n    this.functionCalls[functionName].push(args);\r\n  }\r\n\r\n  getKernelResultType() {\r\n    return this.rootNode.returnType || this.rootNode.getType(this.rootNode.ast);\r\n  }\r\n\r\n  getSubKernelResultType(index) {\r\n    const subKernelNode = this.subKernelNodes[index];\r\n    let called = false;\r\n    for (let functionCallIndex = 0; functionCallIndex < this.rootNode.functionCalls.length; functionCallIndex++) {\r\n      const functionCall = this.rootNode.functionCalls[functionCallIndex];\r\n      if (functionCall.ast.callee.name === subKernelNode.name) {\r\n        called = true;\r\n      }\r\n    }\r\n    if (!called) {\r\n      throw new Error(`SubKernel ${ subKernelNode.name } never called by kernel`);\r\n    }\r\n    return subKernelNode.returnType || subKernelNode.getType(subKernelNode.getJsAST());\r\n  }\r\n\r\n  getReturnTypes() {\r\n    const result = {\r\n      [this.rootNode.name]: this.rootNode.getType(this.rootNode.ast),\r\n    };\r\n    const list = this.traceFunctionCalls(this.rootNode.name);\r\n    for (let i = 0; i < list.length; i++) {\r\n      const functionName = list[i];\r\n      const functionNode = this.functionMap[functionName];\r\n      result[functionName] = functionNode.getType(functionNode.ast);\r\n    }\r\n    return result;\r\n  }\r\n}\r\n","export class FunctionTracer {\r\n  constructor(ast) {\r\n    this.runningContexts = [];\r\n    this.contexts = [];\r\n    this.functionCalls = [];\r\n    this.declarations = [];\r\n    this.identifiers = [];\r\n    this.functions = [];\r\n    this.returnStatements = [];\r\n    this.inLoopInit = false;\r\n    this.scan(ast);\r\n  }\r\n\r\n  get currentContext() {\r\n    return this.runningContexts.length > 0 ? this.runningContexts[this.runningContexts.length - 1] : null;\r\n  }\r\n\r\n  newContext(run) {\r\n    const newContext = Object.assign({}, this.currentContext);\r\n    this.contexts.push(newContext);\r\n    this.runningContexts.push(newContext);\r\n    run();\r\n    this.runningContexts.pop();\r\n  }\r\n\r\n  /**\r\n   * Recursively scans AST for declarations and functions, and add them to their respective context\r\n   * @param ast\r\n   */\r\n  scan(ast) {\r\n    if (Array.isArray(ast)) {\r\n      for (let i = 0; i < ast.length; i++) {\r\n        this.scan(ast[i]);\r\n      }\r\n      return;\r\n    }\r\n    switch (ast.type) {\r\n      case 'Program':\r\n        this.scan(ast.body);\r\n        break;\r\n      case 'BlockStatement':\r\n        this.newContext(() => {\r\n          this.scan(ast.body);\r\n        });\r\n        break;\r\n      case 'AssignmentExpression':\r\n        this.scan(ast.left);\r\n        this.scan(ast.right);\r\n        break;\r\n      case 'BinaryExpression':\r\n        this.scan(ast.left);\r\n        if (ast.right) this.scan(ast.right);\r\n        break;\r\n      case 'UpdateExpression':\r\n        this.scan(ast.argument);\r\n        break;\r\n      case 'UnaryExpression':\r\n        this.scan(ast.argument);\r\n        break;\r\n      case 'VariableDeclaration':\r\n        this.scan(ast.declarations);\r\n        break;\r\n      case 'VariableDeclarator':\r\n        const { currentContext } = this;\r\n        const declaration = {\r\n          ast: ast,\r\n          context: currentContext,\r\n          name: ast.id.name,\r\n          origin: 'declaration',\r\n          forceInteger: this.inLoopInit,\r\n          assignable: !this.inLoopInit && !currentContext.hasOwnProperty(ast.id.name),\r\n        };\r\n        currentContext[ast.id.name] = declaration;\r\n        this.declarations.push(declaration);\r\n        this.scan(ast.id);\r\n        this.scan(ast.init);\r\n        break;\r\n      case 'FunctionExpression':\r\n      case 'FunctionDeclaration':\r\n        if (this.runningContexts.length === 0) {\r\n          this.scan(ast.body);\r\n        } else {\r\n          this.functions.push(ast);\r\n        }\r\n        break;\r\n      case 'IfStatement':\r\n        this.scan(ast.test);\r\n        this.scan(ast.consequent);\r\n        if (ast.alternate) this.scan(ast.alternate);\r\n        break;\r\n      case 'ForStatement':\r\n        this.newContext(() => {\r\n          if (ast.init) {\r\n            this.inLoopInit = true;\r\n            this.scan(ast.init);\r\n            this.inLoopInit = false;\r\n          }\r\n          if (ast.test) {\r\n            this.scan(ast.test);\r\n          }\r\n          this.scan(ast.update);\r\n          this.newContext(() => {\r\n            this.scan(ast.body);\r\n          });\r\n        });\r\n        break;\r\n      case 'DoWhileStatement':\r\n      case 'WhileStatement':\r\n        this.newContext(() => {\r\n          this.scan(ast.body);\r\n          this.scan(ast.test);\r\n        });\r\n        break;\r\n      case 'Identifier':\r\n        this.identifiers.push({\r\n          context: this.currentContext,\r\n          ast,\r\n        });\r\n        break;\r\n      case 'ReturnStatement':\r\n        this.returnStatements.push(ast);\r\n        this.scan(ast.argument);\r\n        break;\r\n      case 'MemberExpression':\r\n        this.scan(ast.object);\r\n        this.scan(ast.property);\r\n        break;\r\n      case 'ExpressionStatement':\r\n        this.scan(ast.expression);\r\n        break;\r\n      case 'ThisExpression':\r\n        break;\r\n      case 'CallExpression':\r\n        this.functionCalls.push({\r\n          context: this.currentContext,\r\n          ast,\r\n        });\r\n        this.scan(ast.arguments);\r\n        break;\r\n      case 'ArrayExpression':\r\n        this.scan(ast.elements);\r\n        break;\r\n      case 'ConditionalExpression':\r\n        this.scan(ast.test);\r\n        this.scan(ast.alternate);\r\n        this.scan(ast.consequent);\r\n        break;\r\n      case 'SwitchStatement':\r\n        this.scan(ast.discriminant);\r\n        this.scan(ast.cases);\r\n        break;\r\n      case 'SwitchCase':\r\n        if (ast.test) this.scan(ast.test);\r\n        this.scan(ast.consequent);\r\n        break;\r\n      case 'LogicalExpression':\r\n        this.scan(ast.left);\r\n        this.scan(ast.right);\r\n        break;\r\n      case 'Literal':\r\n        break;\r\n      case 'DebuggerStatement':\r\n        break;\r\n      case 'EmptyStatement':\r\n        break;\r\n      case 'BreakStatement':\r\n        break;\r\n      default:\r\n        throw new Error(`unhandled type \"${ast.type}\"`);\r\n    }\r\n  }\r\n}\r\n","import { parse } from 'acorn';\r\nimport { FunctionTracer } from './function-tracer';\r\nimport {\r\n  getArgumentNamesFromString,\r\n  getAstString,\r\n  getFunctionNameFromString,\r\n  isFunctionString,\r\n} from '../common';\r\n\r\n/**\r\n *\r\n * @desc Represents a single function, inside JS, webGL, or openGL.\r\n * <p>This handles all the raw state, converted state, etc. Of a single function.</p>\r\n */\r\nexport class FunctionNode {\r\n  /**\r\n   *\r\n   * @param {string|object} source\r\n   * @param {IFunctionSettings} [settings]\r\n   */\r\n  constructor(source, settings) {\r\n    if (!source && !settings.ast) {\r\n      throw new Error('source parameter is missing');\r\n    }\r\n    settings = settings || {};\r\n    this.source = source;\r\n    this.ast = null;\r\n    this.name = typeof source === 'string' ? settings.isRootKernel ?\r\n      'kernel' :\r\n      (settings.name || getFunctionNameFromString(source)) : null;\r\n    this.calledFunctions = [];\r\n    this.constants = {};\r\n    this.constantTypes = {};\r\n    this.constantBitRatios = {};\r\n    this.isRootKernel = false;\r\n    this.isSubKernel = false;\r\n    this.debug = null;\r\n    this.declarations = null;\r\n    this.functions = null;\r\n    this.identifiers = null;\r\n    this.contexts = null;\r\n    this.functionCalls = null;\r\n    this.states = [];\r\n    this.needsArgumentType = null;\r\n    this.assignArgumentType = null;\r\n    this.lookupReturnType = null;\r\n    this.lookupFunctionArgumentTypes = null;\r\n    this.lookupFunctionArgumentBitRatio = null;\r\n    this.triggerImplyArgumentType = null;\r\n    this.triggerTrackArgumentSynonym = null;\r\n    this.lookupArgumentSynonym = null;\r\n    this.onNestedFunction = null;\r\n    this.onFunctionCall = null;\r\n    this.optimizeFloatMemory = null;\r\n    this.precision = null;\r\n    this.loopMaxIterations = null;\r\n    this.argumentNames = (typeof this.source === 'string' ? getArgumentNamesFromString(this.source) : null);\r\n    this.argumentTypes = [];\r\n    this.argumentSizes = [];\r\n    this.argumentBitRatios = null;\r\n    this.returnType = null;\r\n    this.output = [];\r\n    this.plugins = null;\r\n    this.leadingReturnStatement = null;\r\n    this.followingReturnStatement = null;\r\n    this.dynamicOutput = null;\r\n    this.dynamicArguments = null;\r\n    this.strictTypingChecking = false;\r\n    this.fixIntegerDivisionAccuracy = null;\r\n    this.warnVarUsage = true;\r\n\r\n    if (settings) {\r\n      for (const p in settings) {\r\n        if (!settings.hasOwnProperty(p)) continue;\r\n        if (!this.hasOwnProperty(p)) continue;\r\n        this[p] = settings[p];\r\n      }\r\n    }\r\n\r\n    this.synonymIndex = -1;\r\n    this.synonymUseIndex = 0;\r\n    this.argumentSynonym = {};\r\n    this.literalTypes = {};\r\n\r\n    this.validate();\r\n    this._string = null;\r\n    this._internalVariableNames = {};\r\n  }\r\n\r\n  validate() {\r\n    if (typeof this.source !== 'string' && !this.ast) {\r\n      throw new Error('this.source not a string');\r\n    }\r\n\r\n    if (!this.ast && !isFunctionString(this.source)) {\r\n      throw new Error('this.source not a function string');\r\n    }\r\n\r\n    if (!this.name) {\r\n      throw new Error('this.name could not be set');\r\n    }\r\n\r\n    if (this.argumentTypes.length > 0 && this.argumentTypes.length !== this.argumentNames.length) {\r\n      throw new Error(`argumentTypes count of ${ this.argumentTypes.length } exceeds ${ this.argumentNames.length }`);\r\n    }\r\n\r\n    if (this.output.length < 1) {\r\n      throw new Error('this.output is not big enough');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @param {String} name\r\n   * @returns {boolean}\r\n   */\r\n  isIdentifierConstant(name) {\r\n    if (!this.constants) return false;\r\n    return this.constants.hasOwnProperty(name);\r\n  }\r\n\r\n  isInput(argumentName) {\r\n    return this.argumentTypes[this.argumentNames.indexOf(argumentName)] === 'Input';\r\n  }\r\n\r\n  pushState(state) {\r\n    this.states.push(state);\r\n  }\r\n\r\n  popState(state) {\r\n    if (this.state !== state) {\r\n      throw new Error(`Cannot popState ${ state } when in ${ this.state }`);\r\n    }\r\n    this.states.pop();\r\n  }\r\n\r\n  isState(state) {\r\n    return this.state === state;\r\n  }\r\n\r\n  get state() {\r\n    return this.states[this.states.length - 1];\r\n  }\r\n\r\n  /**\r\n   * @function\r\n   * @name astMemberExpressionUnroll\r\n   * @desc Parses the abstract syntax tree for binary expression.\r\n   *\r\n   * <p>Utility function for astCallExpression.</p>\r\n   *\r\n   * @param {Object} ast - the AST object to parse\r\n   *\r\n   * @returns {String} the function namespace call, unrolled\r\n   */\r\n  astMemberExpressionUnroll(ast) {\r\n    if (ast.type === 'Identifier') {\r\n      return ast.name;\r\n    } else if (ast.type === 'ThisExpression') {\r\n      return 'this';\r\n    }\r\n\r\n    if (ast.type === 'MemberExpression') {\r\n      if (ast.object && ast.property) {\r\n        //babel sniffing\r\n        if (ast.object.hasOwnProperty('name') && ast.object.name[0] === '_') {\r\n          return this.astMemberExpressionUnroll(ast.property);\r\n        }\r\n\r\n        return (\r\n          this.astMemberExpressionUnroll(ast.object) +\r\n          '.' +\r\n          this.astMemberExpressionUnroll(ast.property)\r\n        );\r\n      }\r\n    }\r\n\r\n    //babel sniffing\r\n    if (ast.hasOwnProperty('expressions')) {\r\n      const firstExpression = ast.expressions[0];\r\n      if (firstExpression.type === 'Literal' && firstExpression.value === 0 && ast.expressions.length === 2) {\r\n        return this.astMemberExpressionUnroll(ast.expressions[1]);\r\n      }\r\n    }\r\n\r\n    // Failure, unknown expression\r\n    throw this.astErrorOutput('Unknown astMemberExpressionUnroll', ast);\r\n  }\r\n\r\n  /**\r\n   * @desc Parses the class function JS, and returns its Abstract Syntax Tree object.\r\n   * This is used internally to convert to shader code\r\n   *\r\n   * @param {Object} [import { $1 } from $2] - Parser to use, assumes in scope 'parser' if null or undefined\r\n   *\r\n   * @returns {Object} The function AST Object, note that result is cached under this.ast;\r\n   */\r\n  getJsAST(inParser) {\r\n    if (this.ast) {\r\n      return this.ast;\r\n    }\r\n    if (typeof this.source === 'object') {\r\n      this.traceFunctionAST(this.source);\r\n      return this.ast = this.source;\r\n    }\r\n\r\n    const parser = inParser && inParser.hasOwnProperty('parse') ? inParser.parse : parse\r\n    if (inParser === null) {\r\n      throw new Error('Missing JS to AST parser');\r\n    }\r\n\r\n    const ast = Object.freeze(parser(`const parser_${ this.name } = ${ this.source };`, {\r\n      locations: true\r\n    }));\r\n    // take out the function object, outside the var declarations\r\n    const functionAST = ast.body[0].declarations[0].init;\r\n    this.traceFunctionAST(functionAST);\r\n\r\n    if (!ast) {\r\n      throw new Error('Failed to parse JS code');\r\n    }\r\n\r\n    return this.ast = functionAST;\r\n  }\r\n\r\n  traceFunctionAST(ast) {\r\n    const { contexts, declarations, functions, identifiers, functionCalls } = new FunctionTracer(ast);\r\n    this.contexts = contexts;\r\n    this.identifiers = identifiers;\r\n    this.functionCalls = functionCalls;\r\n    this.declarations = [];\r\n    this.functions = functions;\r\n    for (let i = 0; i < declarations.length; i++) {\r\n      const declaration = declarations[i];\r\n      const { ast, context, name, origin, forceInteger, assignable } = declaration;\r\n      const { init } = ast;\r\n      const dependencies = this.getDependencies(init);\r\n      let valueType = null;\r\n\r\n      if (forceInteger) {\r\n        valueType = 'Integer';\r\n      } else {\r\n        if (init) {\r\n          const realType = this.getType(init);\r\n          switch (realType) {\r\n            case 'Integer':\r\n            case 'Float':\r\n            case 'Number':\r\n              if (init.type === 'MemberExpression') {\r\n                valueType = realType;\r\n              } else {\r\n                valueType = 'Number';\r\n              }\r\n              break;\r\n            case 'LiteralInteger':\r\n              valueType = 'Number';\r\n              break;\r\n            default:\r\n              valueType = realType;\r\n          }\r\n        }\r\n      }\r\n      this.declarations.push({\r\n        valueType,\r\n        dependencies,\r\n        isSafe: this.isSafeDependencies(dependencies),\r\n        ast,\r\n        name,\r\n        context,\r\n        origin,\r\n        assignable,\r\n      });\r\n    }\r\n\r\n    for (let i = 0; i < functions.length; i++) {\r\n      this.onNestedFunction(functions[i]);\r\n    }\r\n  }\r\n\r\n  getDeclaration(ast) {\r\n    for (let i = 0; i < this.identifiers.length; i++) {\r\n      const identifier = this.identifiers[i];\r\n      if (ast === identifier.ast && identifier.context.hasOwnProperty(ast.name)) {\r\n        for (let j = 0; j < this.declarations.length; j++) {\r\n          const declaration = this.declarations[j];\r\n          if (declaration.name === ast.name && declaration.context[ast.name] === identifier.context[ast.name]) {\r\n            return declaration;\r\n          }\r\n        }\r\n      }\r\n    }\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * @desc Return the type of parameter sent to subKernel/Kernel.\r\n   * @param {Object} ast - Identifier\r\n   * @returns {String} Type of the parameter\r\n   */\r\n  getVariableType(ast) {\r\n    if (ast.type !== 'Identifier') {\r\n      throw new Error(`ast of ${ast.type} not \"Identifier\"`);\r\n    }\r\n    let type = null;\r\n    const argumentIndex = this.argumentNames.indexOf(ast.name);\r\n    if (argumentIndex === -1) {\r\n      const declaration = this.getDeclaration(ast);\r\n      if (declaration) {\r\n        return declaration.valueType;\r\n      }\r\n    } else {\r\n      const argumentType = this.argumentTypes[argumentIndex];\r\n      if (argumentType) {\r\n        type = argumentType;\r\n      }\r\n    }\r\n    if (!type && this.strictTypingChecking) {\r\n      throw new Error(`Declaration of ${name} not found`);\r\n    }\r\n    return type;\r\n  }\r\n\r\n  /**\r\n   * Generally used to lookup the value type returned from a member expressions\r\n   * @param {String} type\r\n   * @return {String}\r\n   */\r\n  getLookupType(type) {\r\n    if (!typeLookupMap.hasOwnProperty(type)) {\r\n      throw new Error(`unknown typeLookupMap ${ type }`);\r\n    }\r\n    return typeLookupMap[type];\r\n  }\r\n\r\n  getConstantType(constantName) {\r\n    if (this.constantTypes[constantName]) {\r\n      const type = this.constantTypes[constantName];\r\n      if (type === 'Float') {\r\n        return 'Number';\r\n      } else {\r\n        return type;\r\n      }\r\n    }\r\n    throw new Error(`Type for constant \"${ constantName }\" not declared`);\r\n  }\r\n\r\n  /**\r\n   * @desc Return the name of the *user argument*(subKernel argument) corresponding\r\n   * to the argument supplied to the kernel\r\n   *\r\n   * @param {String} name - Name of the argument\r\n   * @returns {String} Name of the parameter\r\n   */\r\n  getKernelArgumentName(name) {\r\n    if (!this.lookupArgumentSynonym) return null;\r\n    const argumentIndex = this.argumentNames.indexOf(name);\r\n    if (argumentIndex === -1) return null;\r\n    return this.lookupArgumentSynonym('kernel', this.name, name);\r\n  }\r\n\r\n  toString() {\r\n    if (this._string) return this._string;\r\n    return this._string = this.astGeneric(this.getJsAST(), []).join('').trim();\r\n  }\r\n\r\n  toJSON() {\r\n    const settings = {\r\n      source: this.source,\r\n      name: this.name,\r\n      constants: this.constants,\r\n      constantTypes: this.constantTypes,\r\n      isRootKernel: this.isRootKernel,\r\n      isSubKernel: this.isSubKernel,\r\n      debug: this.debug,\r\n      output: this.output,\r\n      loopMaxIterations: this.loopMaxIterations,\r\n      argumentNames: this.argumentNames,\r\n      argumentTypes: this.argumentTypes,\r\n      argumentSizes: this.argumentSizes,\r\n      returnType: this.returnType,\r\n      leadingReturnStatement: this.leadingReturnStatement,\r\n      followingReturnStatement: this.followingReturnStatement,\r\n    };\r\n\r\n    return {\r\n      ast: this.ast,\r\n      settings\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Recursively looks up type for ast expression until it's found\r\n   * @param ast\r\n   * @returns {String|null}\r\n   */\r\n  getType(ast) {\r\n    if (Array.isArray(ast)) {\r\n      return this.getType(ast[ast.length - 1]);\r\n    }\r\n    switch (ast.type) {\r\n      case 'BlockStatement':\r\n        return this.getType(ast.body);\r\n      case 'ArrayExpression':\r\n        return `Array(${ ast.elements.length })`;\r\n      case 'Literal':\r\n        const literalKey = `${ast.start},${ast.end}`;\r\n        if (this.literalTypes[literalKey]) {\r\n          return this.literalTypes[literalKey];\r\n        }\r\n        if (Number.isInteger(ast.value)) {\r\n          return 'LiteralInteger';\r\n        } else if (ast.value === true || ast.value === false) {\r\n          return 'Boolean';\r\n        } else {\r\n          return 'Number';\r\n        }\r\n        case 'AssignmentExpression':\r\n          return this.getType(ast.left);\r\n        case 'CallExpression':\r\n          if (this.isAstMathFunction(ast)) {\r\n            return 'Number';\r\n          }\r\n          if (!ast.callee || !ast.callee.name) {\r\n            if (ast.callee.type === 'SequenceExpression' && ast.callee.expressions[ast.callee.expressions.length - 1].property.name) {\r\n              const functionName = ast.callee.expressions[ast.callee.expressions.length - 1].property.name;\r\n              this.inferArgumentTypesIfNeeded(functionName, ast.arguments);\r\n              return this.lookupReturnType(functionName, ast, this);\r\n            }\r\n            throw this.astErrorOutput('Unknown call expression', ast);\r\n          }\r\n          if (ast.callee && ast.callee.name) {\r\n            const functionName = ast.callee.name;\r\n            this.inferArgumentTypesIfNeeded(functionName, ast.arguments);\r\n            return this.lookupReturnType(functionName, ast, this);\r\n          }\r\n          throw this.astErrorOutput(`Unhandled getType Type \"${ ast.type }\"`, ast);\r\n        case 'BinaryExpression':\r\n          // modulos is Number\r\n          switch (ast.operator) {\r\n            case '%':\r\n            case '/':\r\n              if (this.fixIntegerDivisionAccuracy) {\r\n                return 'Number';\r\n              } else {\r\n                break;\r\n              }\r\n              case '>':\r\n              case '<':\r\n                return 'Boolean';\r\n              case '&':\r\n              case '|':\r\n              case '^':\r\n              case '<<':\r\n              case '>>':\r\n              case '>>>':\r\n                return 'Integer';\r\n          }\r\n          const type = this.getType(ast.left);\r\n          if (this.isState('skip-literal-correction')) return type;\r\n          if (type === 'LiteralInteger') {\r\n            const rightType = this.getType(ast.right);\r\n            if (rightType === 'LiteralInteger') {\r\n              if (ast.left.value % 1 === 0) {\r\n                return 'Integer';\r\n              } else {\r\n                return 'Float';\r\n              }\r\n            }\r\n            return rightType;\r\n          }\r\n          return typeLookupMap[type] || type;\r\n        case 'UpdateExpression':\r\n          return this.getType(ast.argument);\r\n        case 'UnaryExpression':\r\n          if (ast.operator === '~') {\r\n            return 'Integer';\r\n          }\r\n          return this.getType(ast.argument);\r\n        case 'VariableDeclaration': {\r\n          const declarations = ast.declarations;\r\n          let lastType;\r\n          for (let i = 0; i < declarations.length; i++) {\r\n            const declaration = declarations[i];\r\n            lastType = this.getType(declaration);\r\n          }\r\n          if (!lastType) {\r\n            throw this.astErrorOutput(`Unable to find type for declaration`, ast);\r\n          }\r\n          return lastType;\r\n        }\r\n        case 'VariableDeclarator':\r\n          const declaration = this.getDeclaration(ast.id);\r\n          if (!declaration) {\r\n            throw this.astErrorOutput(`Unable to find declarator`, ast);\r\n          }\r\n\r\n          if (!declaration.valueType) {\r\n            throw this.astErrorOutput(`Unable to find declarator valueType`, ast);\r\n          }\r\n\r\n          return declaration.valueType;\r\n        case 'Identifier':\r\n          if (ast.name === 'Infinity') {\r\n            return 'Number';\r\n          }\r\n          if (this.isAstVariable(ast)) {\r\n            const signature = this.getVariableSignature(ast);\r\n            if (signature === 'value') {\r\n              const type = this.getVariableType(ast);\r\n              if (!type) {\r\n                throw this.astErrorOutput(`Unable to find identifier valueType`, ast);\r\n              }\r\n              return type;\r\n            }\r\n          }\r\n          const origin = this.findIdentifierOrigin(ast);\r\n          if (origin && origin.init) {\r\n            return this.getType(origin.init);\r\n          }\r\n          return null;\r\n        case 'ReturnStatement':\r\n          return this.getType(ast.argument);\r\n        case 'MemberExpression':\r\n          if (this.isAstMathFunction(ast)) {\r\n            switch (ast.property.name) {\r\n              case 'ceil':\r\n                return 'Integer';\r\n              case 'floor':\r\n                return 'Integer';\r\n              case 'round':\r\n                return 'Integer';\r\n            }\r\n            return 'Number';\r\n          }\r\n          if (this.isAstVariable(ast)) {\r\n            const variableSignature = this.getVariableSignature(ast);\r\n            switch (variableSignature) {\r\n              case 'value[]':\r\n                return this.getLookupType(this.getVariableType(ast.object));\r\n              case 'value[][]':\r\n                return this.getLookupType(this.getVariableType(ast.object.object));\r\n              case 'value[][][]':\r\n                return this.getLookupType(this.getVariableType(ast.object.object.object));\r\n              case 'value[][][][]':\r\n                return this.getLookupType(this.getVariableType(ast.object.object.object.object));\r\n              case 'value.thread.value':\r\n              case 'this.thread.value':\r\n                return 'Integer';\r\n              case 'this.output.value':\r\n                return this.dynamicOutput ? 'Integer' : 'LiteralInteger';\r\n              case 'this.constants.value':\r\n                return this.getConstantType(ast.property.name);\r\n              case 'this.constants.value[]':\r\n                return this.getLookupType(this.getConstantType(ast.object.property.name));\r\n              case 'this.constants.value[][]':\r\n                return this.getLookupType(this.getConstantType(ast.object.object.property.name));\r\n              case 'this.constants.value[][][]':\r\n                return this.getLookupType(this.getConstantType(ast.object.object.object.property.name));\r\n              case 'this.constants.value[][][][]':\r\n                return this.getLookupType(this.getConstantType(ast.object.object.object.object.property.name));\r\n              case 'fn()[]':\r\n                return this.getLookupType(this.getType(ast.object));\r\n              case 'fn()[][]':\r\n                return this.getLookupType(this.getType(ast.object));\r\n              case 'fn()[][][]':\r\n                return this.getLookupType(this.getType(ast.object));\r\n              case 'value.value':\r\n                if (this.isAstMathVariable(ast)) {\r\n                  return 'Number';\r\n                }\r\n                switch (ast.property.name) {\r\n                  case 'r':\r\n                    return this.getLookupType(this.getVariableType(ast.object));\r\n                  case 'g':\r\n                    return this.getLookupType(this.getVariableType(ast.object));\r\n                  case 'b':\r\n                    return this.getLookupType(this.getVariableType(ast.object));\r\n                  case 'a':\r\n                    return this.getLookupType(this.getVariableType(ast.object));\r\n                }\r\n                case '[][]':\r\n                  return 'Number';\r\n            }\r\n            throw this.astErrorOutput('Unhandled getType MemberExpression', ast);\r\n          }\r\n          throw this.astErrorOutput('Unhandled getType MemberExpression', ast);\r\n        case 'ConditionalExpression':\r\n          return this.getType(ast.consequent);\r\n        case 'FunctionDeclaration':\r\n        case 'FunctionExpression':\r\n          const lastReturn = this.findLastReturn(ast.body);\r\n          if (lastReturn) {\r\n            return this.getType(lastReturn);\r\n          }\r\n          return null;\r\n        case 'IfStatement':\r\n          return this.getType(ast.consequent);\r\n        default:\r\n          throw this.astErrorOutput(`Unhandled getType Type \"${ ast.type }\"`, ast);\r\n    }\r\n  }\r\n\r\n  inferArgumentTypesIfNeeded(functionName, args) {\r\n    // ensure arguments are filled in, so when we lookup return type, we already can infer it\r\n    for (let i = 0; i < args.length; i++) {\r\n      if (!this.needsArgumentType(functionName, i)) continue;\r\n      const type = this.getType(args[i]);\r\n      if (!type) {\r\n        throw this.astErrorOutput(`Unable to infer argument ${i}`, args[i]);\r\n      }\r\n      this.assignArgumentType(functionName, i, type);\r\n    }\r\n  }\r\n\r\n  isAstMathVariable(ast) {\r\n    const mathProperties = [\r\n      'E',\r\n      'PI',\r\n      'SQRT2',\r\n      'SQRT1_2',\r\n      'LN2',\r\n      'LN10',\r\n      'LOG2E',\r\n      'LOG10E',\r\n    ];\r\n    return ast.type === 'MemberExpression' &&\r\n      ast.object && ast.object.type === 'Identifier' &&\r\n      ast.object.name === 'Math' &&\r\n      ast.property &&\r\n      ast.property.type === 'Identifier' &&\r\n      mathProperties.indexOf(ast.property.name) > -1;\r\n  }\r\n\r\n  isAstMathFunction(ast) {\r\n    const mathFunctions = [\r\n      'abs',\r\n      'acos',\r\n      'asin',\r\n      'atan',\r\n      'atan2',\r\n      'ceil',\r\n      'cos',\r\n      'exp',\r\n      'floor',\r\n      'log',\r\n      'log2',\r\n      'max',\r\n      'min',\r\n      'pow',\r\n      'random',\r\n      'round',\r\n      'sign',\r\n      'sin',\r\n      'sqrt',\r\n      'tan',\r\n    ];\r\n    return ast.type === 'CallExpression' &&\r\n      ast.callee &&\r\n      ast.callee.type === 'MemberExpression' &&\r\n      ast.callee.object &&\r\n      ast.callee.object.type === 'Identifier' &&\r\n      ast.callee.object.name === 'Math' &&\r\n      ast.callee.property &&\r\n      ast.callee.property.type === 'Identifier' &&\r\n      mathFunctions.indexOf(ast.callee.property.name) > -1;\r\n  }\r\n\r\n  isAstVariable(ast) {\r\n    return ast.type === 'Identifier' || ast.type === 'MemberExpression';\r\n  }\r\n\r\n  isSafe(ast) {\r\n    return this.isSafeDependencies(this.getDependencies(ast));\r\n  }\r\n\r\n  isSafeDependencies(dependencies) {\r\n    return dependencies && dependencies.every ? dependencies.every(dependency => dependency.isSafe) : true;\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @param ast\r\n   * @param dependencies\r\n   * @param isNotSafe\r\n   * @return {Array}\r\n   */\r\n  getDependencies(ast, dependencies, isNotSafe) {\r\n    if (!dependencies) {\r\n      dependencies = [];\r\n    }\r\n    if (!ast) return null;\r\n    if (Array.isArray(ast)) {\r\n      for (let i = 0; i < ast.length; i++) {\r\n        this.getDependencies(ast[i], dependencies, isNotSafe);\r\n      }\r\n      return dependencies;\r\n    }\r\n    switch (ast.type) {\r\n      case 'AssignmentExpression':\r\n        this.getDependencies(ast.left, dependencies, isNotSafe);\r\n        this.getDependencies(ast.right, dependencies, isNotSafe);\r\n        return dependencies;\r\n      case 'Literal':\r\n        dependencies.push({\r\n          origin: 'literal',\r\n          value: ast.value,\r\n          isSafe: isNotSafe === true ? false : ast.value > -Infinity && ast.value < Infinity && !isNaN(ast.value)\r\n        });\r\n        break;\r\n      case 'VariableDeclarator':\r\n        return this.getDependencies(ast.init, dependencies, isNotSafe);\r\n      case 'Identifier':\r\n        const declaration = this.getDeclaration(ast);\r\n        if (declaration) {\r\n          dependencies.push({\r\n            name: ast.name,\r\n            origin: 'declaration',\r\n            isSafe: isNotSafe ? false : this.isSafeDependencies(declaration.dependencies),\r\n          });\r\n        } else if (this.argumentNames.indexOf(ast.name) > -1) {\r\n          dependencies.push({\r\n            name: ast.name,\r\n            origin: 'argument',\r\n            isSafe: false,\r\n          });\r\n        } else if (this.strictTypingChecking) {\r\n          throw new Error(`Cannot find identifier origin \"${ast.name}\"`);\r\n        }\r\n        break;\r\n      case 'FunctionDeclaration':\r\n        return this.getDependencies(ast.body.body[ast.body.body.length - 1], dependencies, isNotSafe);\r\n      case 'ReturnStatement':\r\n        return this.getDependencies(ast.argument, dependencies);\r\n      case 'BinaryExpression':\r\n        isNotSafe = (ast.operator === '/' || ast.operator === '*');\r\n        this.getDependencies(ast.left, dependencies, isNotSafe);\r\n        this.getDependencies(ast.right, dependencies, isNotSafe);\r\n        return dependencies;\r\n      case 'UnaryExpression':\r\n      case 'UpdateExpression':\r\n        return this.getDependencies(ast.argument, dependencies, isNotSafe);\r\n      case 'VariableDeclaration':\r\n        return this.getDependencies(ast.declarations, dependencies, isNotSafe);\r\n      case 'ArrayExpression':\r\n        dependencies.push({\r\n          origin: 'declaration',\r\n          isSafe: true,\r\n        });\r\n        return dependencies;\r\n      case 'CallExpression':\r\n        dependencies.push({\r\n          origin: 'function',\r\n          isSafe: true,\r\n        });\r\n        return dependencies;\r\n      case 'MemberExpression':\r\n        const details = this.getMemberExpressionDetails(ast);\r\n        switch (details.signature) {\r\n          case 'value[]':\r\n            this.getDependencies(ast.object, dependencies, isNotSafe);\r\n            break;\r\n          case 'value[][]':\r\n            this.getDependencies(ast.object.object, dependencies, isNotSafe);\r\n            break;\r\n          case 'value[][][]':\r\n            this.getDependencies(ast.object.object.object, dependencies, isNotSafe);\r\n            break;\r\n          case 'this.output.value':\r\n            if (this.dynamicOutput) {\r\n              dependencies.push({\r\n                name: details.name,\r\n                origin: 'output',\r\n                isSafe: false,\r\n              });\r\n            }\r\n            break;\r\n        }\r\n        if (details) {\r\n          if (details.property) {\r\n            this.getDependencies(details.property, dependencies, isNotSafe);\r\n          }\r\n          if (details.xProperty) {\r\n            this.getDependencies(details.xProperty, dependencies, isNotSafe);\r\n          }\r\n          if (details.yProperty) {\r\n            this.getDependencies(details.yProperty, dependencies, isNotSafe);\r\n          }\r\n          if (details.zProperty) {\r\n            this.getDependencies(details.zProperty, dependencies, isNotSafe);\r\n          }\r\n          return dependencies;\r\n        }\r\n        default:\r\n          throw this.astErrorOutput(`Unhandled type ${ ast.type } in getDependencies`, ast);\r\n    }\r\n    return dependencies;\r\n  }\r\n\r\n  getVariableSignature(ast) {\r\n    if (!this.isAstVariable(ast)) {\r\n      throw new Error(`ast of type \"${ ast.type }\" is not a variable signature`);\r\n    }\r\n    if (ast.type === 'Identifier') {\r\n      return 'value';\r\n    }\r\n    const signature = [];\r\n    while (true) {\r\n      if (!ast) break;\r\n      if (ast.computed) {\r\n        signature.push('[]');\r\n      } else if (ast.type === 'ThisExpression') {\r\n        signature.unshift('this');\r\n      } else if (ast.property && ast.property.name) {\r\n        if (\r\n          ast.property.name === 'x' ||\r\n          ast.property.name === 'y' ||\r\n          ast.property.name === 'z'\r\n        ) {\r\n          signature.unshift('.value');\r\n        } else if (\r\n          ast.property.name === 'constants' ||\r\n          ast.property.name === 'thread' ||\r\n          ast.property.name === 'output'\r\n        ) {\r\n          signature.unshift('.' + ast.property.name);\r\n        } else {\r\n          signature.unshift('.value');\r\n        }\r\n      } else if (ast.name) {\r\n        signature.unshift('value');\r\n      } else if (ast.callee && ast.callee.name) {\r\n        signature.unshift('fn()');\r\n      } else if (ast.elements) {\r\n        signature.unshift('[]');\r\n      } else {\r\n        signature.unshift('unknown');\r\n      }\r\n      ast = ast.object;\r\n    }\r\n\r\n    const signatureString = signature.join('');\r\n    const allowedExpressions = [\r\n      'value',\r\n      'value[]',\r\n      'value[][]',\r\n      'value[][][]',\r\n      'value[][][][]',\r\n      'value.value',\r\n      'value.thread.value',\r\n      'this.thread.value',\r\n      'this.output.value',\r\n      'this.constants.value',\r\n      'this.constants.value[]',\r\n      'this.constants.value[][]',\r\n      'this.constants.value[][][]',\r\n      'this.constants.value[][][][]',\r\n      'fn()[]',\r\n      'fn()[][]',\r\n      'fn()[][][]',\r\n      '[][]',\r\n    ];\r\n    if (allowedExpressions.indexOf(signatureString) > -1) {\r\n      return signatureString;\r\n    }\r\n    return null;\r\n  }\r\n\r\n  build() {\r\n    return this.toString().length > 0;\r\n  }\r\n\r\n  /**\r\n   * @desc Parses the abstract syntax tree for generically to its respective function\r\n   * @param {Object} ast - the AST object to parse\r\n   * @param {Array} retArr - return array string\r\n   * @returns {Array} the parsed string array\r\n   */\r\n  astGeneric(ast, retArr) {\r\n    if (ast === null) {\r\n      throw this.astErrorOutput('NULL ast', ast);\r\n    } else {\r\n      if (Array.isArray(ast)) {\r\n        for (let i = 0; i < ast.length; i++) {\r\n          this.astGeneric(ast[i], retArr);\r\n        }\r\n        return retArr;\r\n      }\r\n\r\n      switch (ast.type) {\r\n        case 'FunctionDeclaration':\r\n          return this.astFunctionDeclaration(ast, retArr);\r\n        case 'FunctionExpression':\r\n          return this.astFunctionExpression(ast, retArr);\r\n        case 'ReturnStatement':\r\n          return this.astReturnStatement(ast, retArr);\r\n        case 'Literal':\r\n          return this.astLiteral(ast, retArr);\r\n        case 'BinaryExpression':\r\n          return this.astBinaryExpression(ast, retArr);\r\n        case 'Identifier':\r\n          return this.astIdentifierExpression(ast, retArr);\r\n        case 'AssignmentExpression':\r\n          return this.astAssignmentExpression(ast, retArr);\r\n        case 'ExpressionStatement':\r\n          return this.astExpressionStatement(ast, retArr);\r\n        case 'EmptyStatement':\r\n          return this.astEmptyStatement(ast, retArr);\r\n        case 'BlockStatement':\r\n          return this.astBlockStatement(ast, retArr);\r\n        case 'IfStatement':\r\n          return this.astIfStatement(ast, retArr);\r\n        case 'SwitchStatement':\r\n          return this.astSwitchStatement(ast, retArr);\r\n        case 'BreakStatement':\r\n          return this.astBreakStatement(ast, retArr);\r\n        case 'ContinueStatement':\r\n          return this.astContinueStatement(ast, retArr);\r\n        case 'ForStatement':\r\n          return this.astForStatement(ast, retArr);\r\n        case 'WhileStatement':\r\n          return this.astWhileStatement(ast, retArr);\r\n        case 'DoWhileStatement':\r\n          return this.astDoWhileStatement(ast, retArr);\r\n        case 'VariableDeclaration':\r\n          return this.astVariableDeclaration(ast, retArr);\r\n        case 'VariableDeclarator':\r\n          return this.astVariableDeclarator(ast, retArr);\r\n        case 'ThisExpression':\r\n          return this.astThisExpression(ast, retArr);\r\n        case 'SequenceExpression':\r\n          return this.astSequenceExpression(ast, retArr);\r\n        case 'UnaryExpression':\r\n          return this.astUnaryExpression(ast, retArr);\r\n        case 'UpdateExpression':\r\n          return this.astUpdateExpression(ast, retArr);\r\n        case 'LogicalExpression':\r\n          return this.astLogicalExpression(ast, retArr);\r\n        case 'MemberExpression':\r\n          return this.astMemberExpression(ast, retArr);\r\n        case 'CallExpression':\r\n          return this.astCallExpression(ast, retArr);\r\n        case 'ArrayExpression':\r\n          return this.astArrayExpression(ast, retArr);\r\n        case 'DebuggerStatement':\r\n          return this.astDebuggerStatement(ast, retArr);\r\n        case 'ConditionalExpression':\r\n          return this.astConditionalExpression(ast, retArr);\r\n      }\r\n\r\n      throw this.astErrorOutput('Unknown ast type : ' + ast.type, ast);\r\n    }\r\n  }\r\n  /**\r\n   * @desc To throw the AST error, with its location.\r\n   * @param {string} error - the error message output\r\n   * @param {Object} ast - the AST object where the error is\r\n   */\r\n  astErrorOutput(error, ast) {\r\n    if (typeof this.source !== 'string') {\r\n      return new Error(error);\r\n    }\r\n\r\n    const debugString = getAstString(this.source, ast);\r\n    const leadingSource = this.source.substr(ast.start);\r\n    const splitLines = leadingSource.split(/\\n/);\r\n    const lineBefore = splitLines.length > 0 ? splitLines[splitLines.length - 1] : 0;\r\n    return new Error(`${error} on line ${ splitLines.length }, position ${ lineBefore.length }:\\n ${ debugString }`);\r\n  }\r\n\r\n  astDebuggerStatement(arrNode, retArr) {\r\n    return retArr;\r\n  }\r\n\r\n  astConditionalExpression(ast, retArr) {\r\n    if (ast.type !== 'ConditionalExpression') {\r\n      throw this.astErrorOutput('Not a conditional expression', ast);\r\n    }\r\n    retArr.push('(');\r\n    this.astGeneric(ast.test, retArr);\r\n    retArr.push('?');\r\n    this.astGeneric(ast.consequent, retArr);\r\n    retArr.push(':');\r\n    this.astGeneric(ast.alternate, retArr);\r\n    retArr.push(')');\r\n    return retArr;\r\n  }\r\n\r\n  /**\r\n   * @abstract\r\n   * @param {Object} ast\r\n   * @param {String[]} retArr\r\n   * @returns {String[]}\r\n   */\r\n  astFunction(ast, retArr) {\r\n    throw new Error(`\"astFunction\" not defined on ${ this.constructor.name }`);\r\n  }\r\n\r\n  /**\r\n   * @desc Parses the abstract syntax tree for to its *named function declaration*\r\n   * @param {Object} ast - the AST object to parse\r\n   * @param {Array} retArr - return array string\r\n   * @returns {Array} the append retArr\r\n   */\r\n  astFunctionDeclaration(ast, retArr) {\r\n    if (this.isChildFunction(ast)) {\r\n      return retArr;\r\n    }\r\n    return this.astFunction(ast, retArr);\r\n  }\r\n  astFunctionExpression(ast, retArr) {\r\n    if (this.isChildFunction(ast)) {\r\n      return retArr;\r\n    }\r\n    return this.astFunction(ast, retArr);\r\n  }\r\n  isChildFunction(ast) {\r\n    for (let i = 0; i < this.functions.length; i++) {\r\n      if (this.functions[i] === ast) {\r\n        return true;\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n  astReturnStatement(ast, retArr) {\r\n    return retArr;\r\n  }\r\n  astLiteral(ast, retArr) {\r\n    this.literalTypes[`${ast.start},${ast.end}`] = 'Number';\r\n    return retArr;\r\n  }\r\n  astBinaryExpression(ast, retArr) {\r\n    return retArr;\r\n  }\r\n  astIdentifierExpression(ast, retArr) {\r\n    return retArr;\r\n  }\r\n  astAssignmentExpression(ast, retArr) {\r\n    return retArr;\r\n  }\r\n  /**\r\n   * @desc Parses the abstract syntax tree for *generic expression* statement\r\n   * @param {Object} esNode - An ast Node\r\n   * @param {Array} retArr - return array string\r\n   * @returns {Array} the append retArr\r\n   */\r\n  astExpressionStatement(esNode, retArr) {\r\n    this.astGeneric(esNode.expression, retArr);\r\n    retArr.push(';');\r\n    return retArr;\r\n  }\r\n  /**\r\n   * @desc Parses the abstract syntax tree for an *Empty* Statement\r\n   * @param {Object} eNode - An ast Node\r\n   * @param {Array} retArr - return array string\r\n   * @returns {Array} the append retArr\r\n   */\r\n  astEmptyStatement(eNode, retArr) {\r\n    return retArr;\r\n  }\r\n  astBlockStatement(ast, retArr) {\r\n    return retArr;\r\n  }\r\n  astIfStatement(ast, retArr) {\r\n    return retArr;\r\n  }\r\n  astSwitchStatement(ast, retArr) {\r\n    return retArr;\r\n  }\r\n  /**\r\n   * @desc Parses the abstract syntax tree for *Break* Statement\r\n   * @param {Object} brNode - An ast Node\r\n   * @param {Array} retArr - return array string\r\n   * @returns {Array} the append retArr\r\n   */\r\n  astBreakStatement(brNode, retArr) {\r\n    retArr.push('break;');\r\n    return retArr;\r\n  }\r\n  /**\r\n   * @desc Parses the abstract syntax tree for *Continue* Statement\r\n   * @param {Object} crNode - An ast Node\r\n   * @param {Array} retArr - return array string\r\n   * @returns {Array} the append retArr\r\n   */\r\n  astContinueStatement(crNode, retArr) {\r\n    retArr.push('continue;\\n');\r\n    return retArr;\r\n  }\r\n  astForStatement(ast, retArr) {\r\n    return retArr;\r\n  }\r\n  astWhileStatement(ast, retArr) {\r\n    return retArr;\r\n  }\r\n  astDoWhileStatement(ast, retArr) {\r\n    return retArr;\r\n  }\r\n  /**\r\n   * @desc Parses the abstract syntax tree for *Variable Declaration*\r\n   * @param {Object} varDecNode - An ast Node\r\n   * @param {Array} retArr - return array string\r\n   * @returns {Array} the append retArr\r\n   */\r\n  astVariableDeclaration(varDecNode, retArr) {\r\n    const declarations = varDecNode.declarations;\r\n    if (!declarations || !declarations[0] || !declarations[0].init) {\r\n      throw this.astErrorOutput('Unexpected expression', varDecNode);\r\n    }\r\n    const result = [];\r\n    const firstDeclaration = declarations[0];\r\n    const init = firstDeclaration.init;\r\n    let type = this.isState('in-for-loop-init') ? 'Integer' : this.getType(init);\r\n    if (type === 'LiteralInteger') {\r\n      // We had the choice to go either float or int, choosing float\r\n      type = 'Number';\r\n    }\r\n    const markupType = typeMap[type];\r\n    if (!markupType) {\r\n      throw this.astErrorOutput(`Markup type ${ markupType } not handled`, varDecNode);\r\n    }\r\n    let dependencies = this.getDependencies(firstDeclaration.init);\r\n    throw new Error('remove me');\r\n    this.declarations[firstDeclaration.id.name] = Object.freeze({\r\n      type,\r\n      dependencies,\r\n      isSafe: dependencies.every(dependency => dependency.isSafe)\r\n    });\r\n    const initResult = [`${type} user_${firstDeclaration.id.name}=`];\r\n    this.astGeneric(init, initResult);\r\n    result.push(initResult.join(''));\r\n\r\n    // first declaration is done, now any added ones setup\r\n    for (let i = 1; i < declarations.length; i++) {\r\n      const declaration = declarations[i];\r\n      dependencies = this.getDependencies(declaration);\r\n      throw new Error('Remove me');\r\n      this.declarations[declaration.id.name] = Object.freeze({\r\n        type,\r\n        dependencies,\r\n        isSafe: false\r\n      });\r\n      this.astGeneric(declaration, result);\r\n    }\r\n\r\n    retArr.push(retArr, result.join(','));\r\n    retArr.push(';');\r\n    return retArr;\r\n  }\r\n  /**\r\n   * @desc Parses the abstract syntax tree for *Variable Declarator*\r\n   * @param {Object} iVarDecNode - An ast Node\r\n   * @param {Array} retArr - return array string\r\n   * @returns {Array} the append retArr\r\n   */\r\n  astVariableDeclarator(iVarDecNode, retArr) {\r\n    this.astGeneric(iVarDecNode.id, retArr);\r\n    if (iVarDecNode.init !== null) {\r\n      retArr.push('=');\r\n      this.astGeneric(iVarDecNode.init, retArr);\r\n    }\r\n    return retArr;\r\n  }\r\n  astThisExpression(ast, retArr) {\r\n    return retArr;\r\n  }\r\n  astSequenceExpression(sNode, retArr) {\r\n    for (let i = 0; i < sNode.expressions.length; i++) {\r\n      if (i > 0) {\r\n        retArr.push(',');\r\n      }\r\n      this.astGeneric(sNode.expressions, retArr);\r\n    }\r\n    return retArr;\r\n  }\r\n  /**\r\n   * @desc Parses the abstract syntax tree for *Unary* Expression\r\n   * @param {Object} uNode - An ast Node\r\n   * @param {Array} retArr - return array string\r\n   * @returns {Array} the append retArr\r\n   */\r\n  astUnaryExpression(uNode, retArr) {\r\n    const unaryResult = this.checkAndUpconvertBitwiseUnary(uNode, retArr);\r\n    if (unaryResult) {\r\n      return retArr;\r\n    }\r\n\r\n    if (uNode.prefix) {\r\n      retArr.push(uNode.operator);\r\n      this.astGeneric(uNode.argument, retArr);\r\n    } else {\r\n      this.astGeneric(uNode.argument, retArr);\r\n      retArr.push(uNode.operator);\r\n    }\r\n\r\n    return retArr;\r\n  }\r\n\r\n  checkAndUpconvertBitwiseUnary(uNode, retArr) {}\r\n\r\n  /**\r\n   * @desc Parses the abstract syntax tree for *Update* Expression\r\n   * @param {Object} uNode - An ast Node\r\n   * @param {Array} retArr - return array string\r\n   * @returns {Array} the append retArr\r\n   */\r\n  astUpdateExpression(uNode, retArr) {\r\n    if (uNode.prefix) {\r\n      retArr.push(uNode.operator);\r\n      this.astGeneric(uNode.argument, retArr);\r\n    } else {\r\n      this.astGeneric(uNode.argument, retArr);\r\n      retArr.push(uNode.operator);\r\n    }\r\n\r\n    return retArr;\r\n  }\r\n  /**\r\n   * @desc Parses the abstract syntax tree for *Logical* Expression\r\n   * @param {Object} logNode - An ast Node\r\n   * @param {Array} retArr - return array string\r\n   * @returns {Array} the append retArr\r\n   */\r\n  astLogicalExpression(logNode, retArr) {\r\n    retArr.push('(');\r\n    this.astGeneric(logNode.left, retArr);\r\n    retArr.push(logNode.operator);\r\n    this.astGeneric(logNode.right, retArr);\r\n    retArr.push(')');\r\n    return retArr;\r\n  }\r\n  astMemberExpression(ast, retArr) {\r\n    return retArr;\r\n  }\r\n  astCallExpression(ast, retArr) {\r\n    return retArr;\r\n  }\r\n  astArrayExpression(ast, retArr) {\r\n    return retArr;\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @param ast\r\n   * @return {IFunctionNodeMemberExpressionDetails}\r\n   */\r\n  getMemberExpressionDetails(ast) {\r\n    if (ast.type !== 'MemberExpression') {\r\n      throw this.astErrorOutput(`Expression ${ ast.type } not a MemberExpression`, ast);\r\n    }\r\n    let name = null;\r\n    let type = null;\r\n    const variableSignature = this.getVariableSignature(ast);\r\n    switch (variableSignature) {\r\n      case 'value':\r\n        return null;\r\n      case 'value.thread.value':\r\n      case 'this.thread.value':\r\n      case 'this.output.value':\r\n        return {\r\n          signature: variableSignature,\r\n            type: 'Integer',\r\n            name: ast.property.name\r\n        };\r\n      case 'value[]':\r\n        if (typeof ast.object.name !== 'string') {\r\n          throw this.astErrorOutput('Unexpected expression', ast);\r\n        }\r\n        name = ast.object.name;\r\n        return {\r\n          name,\r\n          origin: 'user',\r\n            signature: variableSignature,\r\n            type: this.getVariableType(ast.object),\r\n            xProperty: ast.property\r\n        };\r\n      case 'value[][]':\r\n        if (typeof ast.object.object.name !== 'string') {\r\n          throw this.astErrorOutput('Unexpected expression', ast);\r\n        }\r\n        name = ast.object.object.name;\r\n        return {\r\n          name,\r\n          origin: 'user',\r\n            signature: variableSignature,\r\n            type: this.getVariableType(ast.object.object),\r\n            yProperty: ast.object.property,\r\n            xProperty: ast.property,\r\n        };\r\n      case 'value[][][]':\r\n        if (typeof ast.object.object.object.name !== 'string') {\r\n          throw this.astErrorOutput('Unexpected expression', ast);\r\n        }\r\n        name = ast.object.object.object.name;\r\n        return {\r\n          name,\r\n          origin: 'user',\r\n            signature: variableSignature,\r\n            type: this.getVariableType(ast.object.object.object),\r\n            zProperty: ast.object.object.property,\r\n            yProperty: ast.object.property,\r\n            xProperty: ast.property,\r\n        };\r\n      case 'value[][][][]':\r\n        if (typeof ast.object.object.object.object.name !== 'string') {\r\n          throw this.astErrorOutput('Unexpected expression', ast);\r\n        }\r\n        name = ast.object.object.object.object.name;\r\n        return {\r\n          name,\r\n          origin: 'user',\r\n            signature: variableSignature,\r\n            type: this.getVariableType(ast.object.object.object.object),\r\n            zProperty: ast.object.object.property,\r\n            yProperty: ast.object.property,\r\n            xProperty: ast.property,\r\n        };\r\n      case 'value.value':\r\n        if (typeof ast.property.name !== 'string') {\r\n          throw this.astErrorOutput('Unexpected expression', ast);\r\n        }\r\n        if (this.isAstMathVariable(ast)) {\r\n          name = ast.property.name;\r\n          return {\r\n            name,\r\n            origin: 'Math',\r\n            type: 'Number',\r\n            signature: variableSignature,\r\n          };\r\n        }\r\n        switch (ast.property.name) {\r\n          case 'r':\r\n          case 'g':\r\n          case 'b':\r\n          case 'a':\r\n            name = ast.object.name;\r\n            return {\r\n              name,\r\n              property: ast.property.name,\r\n                origin: 'user',\r\n                signature: variableSignature,\r\n                type: 'Number'\r\n            };\r\n          default:\r\n            throw this.astErrorOutput('Unexpected expression', ast);\r\n        }\r\n        case 'this.constants.value':\r\n          if (typeof ast.property.name !== 'string') {\r\n            throw this.astErrorOutput('Unexpected expression', ast);\r\n          }\r\n          name = ast.property.name;\r\n          type = this.getConstantType(name);\r\n          if (!type) {\r\n            throw this.astErrorOutput('Constant has no type', ast);\r\n          }\r\n          return {\r\n            name,\r\n            type,\r\n            origin: 'constants',\r\n              signature: variableSignature,\r\n          };\r\n        case 'this.constants.value[]':\r\n          if (typeof ast.object.property.name !== 'string') {\r\n            throw this.astErrorOutput('Unexpected expression', ast);\r\n          }\r\n          name = ast.object.property.name;\r\n          type = this.getConstantType(name);\r\n          if (!type) {\r\n            throw this.astErrorOutput('Constant has no type', ast);\r\n          }\r\n          return {\r\n            name,\r\n            type,\r\n            origin: 'constants',\r\n              signature: variableSignature,\r\n              xProperty: ast.property,\r\n          };\r\n        case 'this.constants.value[][]': {\r\n          if (typeof ast.object.object.property.name !== 'string') {\r\n            throw this.astErrorOutput('Unexpected expression', ast);\r\n          }\r\n          name = ast.object.object.property.name;\r\n          type = this.getConstantType(name);\r\n          if (!type) {\r\n            throw this.astErrorOutput('Constant has no type', ast);\r\n          }\r\n          return {\r\n            name,\r\n            type,\r\n            origin: 'constants',\r\n            signature: variableSignature,\r\n            yProperty: ast.object.property,\r\n            xProperty: ast.property,\r\n          };\r\n        }\r\n        case 'this.constants.value[][][]': {\r\n          if (typeof ast.object.object.object.property.name !== 'string') {\r\n            throw this.astErrorOutput('Unexpected expression', ast);\r\n          }\r\n          name = ast.object.object.object.property.name;\r\n          type = this.getConstantType(name);\r\n          if (!type) {\r\n            throw this.astErrorOutput('Constant has no type', ast);\r\n          }\r\n          return {\r\n            name,\r\n            type,\r\n            origin: 'constants',\r\n            signature: variableSignature,\r\n            zProperty: ast.object.object.property,\r\n            yProperty: ast.object.property,\r\n            xProperty: ast.property,\r\n          };\r\n        }\r\n        case 'fn()[]':\r\n        case '[][]':\r\n          return {\r\n            signature: variableSignature,\r\n              property: ast.property,\r\n          };\r\n        default:\r\n          throw this.astErrorOutput('Unexpected expression', ast);\r\n    }\r\n  }\r\n\r\n  findIdentifierOrigin(astToFind) {\r\n    const stack = [this.ast];\r\n\r\n    while (stack.length > 0) {\r\n      const atNode = stack[0];\r\n      if (atNode.type === 'VariableDeclarator' && atNode.id && atNode.id.name && atNode.id.name === astToFind.name) {\r\n        return atNode;\r\n      }\r\n      stack.shift();\r\n      if (atNode.argument) {\r\n        stack.push(atNode.argument);\r\n      } else if (atNode.body) {\r\n        stack.push(atNode.body);\r\n      } else if (atNode.declarations) {\r\n        stack.push(atNode.declarations);\r\n      } else if (Array.isArray(atNode)) {\r\n        for (let i = 0; i < atNode.length; i++) {\r\n          stack.push(atNode[i]);\r\n        }\r\n      }\r\n    }\r\n    return null;\r\n  }\r\n\r\n  findLastReturn(ast) {\r\n    const stack = [ast || this.ast];\r\n\r\n    while (stack.length > 0) {\r\n      const atNode = stack.pop();\r\n      if (atNode.type === 'ReturnStatement') {\r\n        return atNode;\r\n      }\r\n      if (atNode.type === 'FunctionDeclaration') {\r\n        continue;\r\n      }\r\n      if (atNode.argument) {\r\n        stack.push(atNode.argument);\r\n      } else if (atNode.body) {\r\n        stack.push(atNode.body);\r\n      } else if (atNode.declarations) {\r\n        stack.push(atNode.declarations);\r\n      } else if (Array.isArray(atNode)) {\r\n        for (let i = 0; i < atNode.length; i++) {\r\n          stack.push(atNode[i]);\r\n        }\r\n      } else if (atNode.consequent) {\r\n        stack.push(atNode.consequent);\r\n      } else if (atNode.cases) {\r\n        stack.push(atNode.cases);\r\n      }\r\n    }\r\n    return null;\r\n  }\r\n\r\n  getInternalVariableName(name) {\r\n    if (!this._internalVariableNames.hasOwnProperty(name)) {\r\n      this._internalVariableNames[name] = 0;\r\n    }\r\n    this._internalVariableNames[name]++;\r\n    if (this._internalVariableNames[name] === 1) {\r\n      return name;\r\n    }\r\n    return name + this._internalVariableNames[name];\r\n  }\r\n\r\n  varWarn() {\r\n    console.warn('var declarations are deprecated, weird things happen when falling back to CPU because var scope differs in javascript than in most languages.  Use const or let');\r\n  }\r\n}\r\n\r\nconst typeLookupMap = {\r\n  'Number': 'Number',\r\n  'Float': 'Float',\r\n  'Integer': 'Integer',\r\n  'Array': 'Number',\r\n  'Array(2)': 'Number',\r\n  'Array(3)': 'Number',\r\n  'Array(4)': 'Number',\r\n  'Array2D': 'Number',\r\n  'Array3D': 'Number',\r\n  'Input': 'Number',\r\n  'HTMLImage': 'Array(4)',\r\n  'HTMLImageArray': 'Array(4)',\r\n  'NumberTexture': 'Number',\r\n  'MemoryOptimizedNumberTexture': 'Number',\r\n  'Array1D(2)': 'Array(2)',\r\n  'Array1D(3)': 'Array(3)',\r\n  'Array1D(4)': 'Array(4)',\r\n  'Array2D(2)': 'Array(2)',\r\n  'Array2D(3)': 'Array(3)',\r\n  'Array2D(4)': 'Array(4)',\r\n  'Array3D(2)': 'Array(2)',\r\n  'Array3D(3)': 'Array(3)',\r\n  'Array3D(4)': 'Array(4)',\r\n  'ArrayTexture(1)': 'Number',\r\n  'ArrayTexture(2)': 'Array(2)',\r\n  'ArrayTexture(3)': 'Array(3)',\r\n  'ArrayTexture(4)': 'Array(4)',\r\n};\r\n","import { FunctionNode } from '../function-node';\r\n\r\n/**\r\n * @desc [INTERNAL] Represents a single function, inside JS\r\n *\r\n * <p>This handles all the raw state, converted state, etc. Of a single function.</p>\r\n */\r\nexport class CPUFunctionNode extends FunctionNode {\r\n  /**\r\n   * @desc Parses the abstract syntax tree for to its *named function*\r\n   * @param {Object} ast - the AST object to parse\r\n   * @param {Array} retArr - return array string\r\n   * @returns {Array} the append retArr\r\n   */\r\n  astFunction(ast, retArr) {\r\n\r\n    // Setup function return type and name\r\n    if (!this.isRootKernel) {\r\n      retArr.push('function');\r\n      retArr.push(' ');\r\n      retArr.push(this.name);\r\n      retArr.push('(');\r\n\r\n      // Arguments handling\r\n      for (let i = 0; i < this.argumentNames.length; ++i) {\r\n        const argumentName = this.argumentNames[i];\r\n\r\n        if (i > 0) {\r\n          retArr.push(', ');\r\n        }\r\n        retArr.push('user_');\r\n        retArr.push(argumentName);\r\n      }\r\n\r\n      // Function opening\r\n      retArr.push(') {\\n');\r\n    }\r\n\r\n    // Body statement iteration\r\n    for (let i = 0; i < ast.body.body.length; ++i) {\r\n      this.astGeneric(ast.body.body[i], retArr);\r\n      retArr.push('\\n');\r\n    }\r\n\r\n    if (!this.isRootKernel) {\r\n      // Function closing\r\n      retArr.push('}\\n');\r\n    }\r\n    return retArr;\r\n  }\r\n\r\n  /**\r\n   * @desc Parses the abstract syntax tree for to *return* statement\r\n   * @param {Object} ast - the AST object to parse\r\n   * @param {Array} retArr - return array string\r\n   * @returns {Array} the append retArr\r\n   */\r\n  astReturnStatement(ast, retArr) {\r\n    const type = this.returnType || this.getType(ast.argument);\r\n\r\n    if (!this.returnType) {\r\n      this.returnType = type;\r\n    }\r\n\r\n    if (this.isRootKernel) {\r\n      retArr.push(this.leadingReturnStatement);\r\n      this.astGeneric(ast.argument, retArr);\r\n      retArr.push(';\\n');\r\n      retArr.push(this.followingReturnStatement);\r\n      retArr.push('continue;\\n');\r\n    } else if (this.isSubKernel) {\r\n      retArr.push(`subKernelResult_${ this.name } = `);\r\n      this.astGeneric(ast.argument, retArr);\r\n      retArr.push(';');\r\n      retArr.push(`return subKernelResult_${ this.name };`);\r\n    } else {\r\n      retArr.push('return ');\r\n      this.astGeneric(ast.argument, retArr);\r\n      retArr.push(';');\r\n    }\r\n    return retArr;\r\n  }\r\n\r\n  /**\r\n   * @desc Parses the abstract syntax tree for *literal value*\r\n   * @param {Object} ast - the AST object to parse\r\n   * @param {Array} retArr - return array string\r\n   * @returns {Array} the append retArr\r\n   */\r\n  astLiteral(ast, retArr) {\r\n\r\n    // Reject non numeric literals\r\n    if (isNaN(ast.value)) {\r\n      throw this.astErrorOutput(\r\n        'Non-numeric literal not supported : ' + ast.value,\r\n        ast\r\n      );\r\n    }\r\n\r\n    retArr.push(ast.value);\r\n\r\n    return retArr;\r\n  }\r\n\r\n  /**\r\n   * @desc Parses the abstract syntax tree for *binary* expression\r\n   * @param {Object} ast - the AST object to parse\r\n   * @param {Array} retArr - return array string\r\n   * @returns {Array} the append retArr\r\n   */\r\n  astBinaryExpression(ast, retArr) {\r\n    retArr.push('(');\r\n    this.astGeneric(ast.left, retArr);\r\n    retArr.push(ast.operator);\r\n    this.astGeneric(ast.right, retArr);\r\n    retArr.push(')');\r\n    return retArr;\r\n  }\r\n\r\n  /**\r\n   * @desc Parses the abstract syntax tree for *identifier* expression\r\n   * @param {Object} idtNode - An ast Node\r\n   * @param {Array} retArr - return array string\r\n   * @returns {Array} the append retArr\r\n   */\r\n  astIdentifierExpression(idtNode, retArr) {\r\n    if (idtNode.type !== 'Identifier') {\r\n      throw this.astErrorOutput(\r\n        'IdentifierExpression - not an Identifier',\r\n        idtNode\r\n      );\r\n    }\r\n\r\n    switch (idtNode.name) {\r\n      case 'Infinity':\r\n        retArr.push('Infinity');\r\n        break;\r\n      default:\r\n        if (this.constants && this.constants.hasOwnProperty(idtNode.name)) {\r\n          retArr.push('constants_' + idtNode.name);\r\n        } else {\r\n          const name = this.getKernelArgumentName(idtNode.name);\r\n          if (name) {\r\n            retArr.push('user_' + name);\r\n          } else {\r\n            retArr.push('user_' + idtNode.name);\r\n          }\r\n        }\r\n    }\r\n\r\n    return retArr;\r\n  }\r\n\r\n  /**\r\n   * @desc Parses the abstract syntax tree for *for-loop* expression\r\n   * @param {Object} forNode - An ast Node\r\n   * @param {Array} retArr - return array string\r\n   * @returns {Array} the parsed webgl string\r\n   */\r\n  astForStatement(forNode, retArr) {\r\n    if (forNode.type !== 'ForStatement') {\r\n      throw this.astErrorOutput('Invalid for statement', forNode);\r\n    }\r\n\r\n    const initArr = [];\r\n    const testArr = [];\r\n    const updateArr = [];\r\n    const bodyArr = [];\r\n    let isSafe = null;\r\n\r\n    if (forNode.init) {\r\n      this.pushState('in-for-loop-init');\r\n      this.astGeneric(forNode.init, initArr);\r\n      for (let i = 0; i < initArr.length; i++) {\r\n        if (initArr[i].includes && initArr[i].includes(',')) {\r\n          isSafe = false;\r\n        }\r\n      }\r\n      this.popState('in-for-loop-init');\r\n    } else {\r\n      isSafe = false;\r\n    }\r\n\r\n    if (forNode.test) {\r\n      this.astGeneric(forNode.test, testArr);\r\n    } else {\r\n      isSafe = false;\r\n    }\r\n\r\n    if (forNode.update) {\r\n      this.astGeneric(forNode.update, updateArr);\r\n    } else {\r\n      isSafe = false;\r\n    }\r\n\r\n    if (forNode.body) {\r\n      this.pushState('loop-body');\r\n      this.astGeneric(forNode.body, bodyArr);\r\n      this.popState('loop-body');\r\n    }\r\n\r\n    // have all parts, now make them safe\r\n    if (isSafe === null) {\r\n      isSafe = this.isSafe(forNode.init) && this.isSafe(forNode.test);\r\n    }\r\n\r\n    if (isSafe) {\r\n      retArr.push(`for (${initArr.join('')};${testArr.join('')};${updateArr.join('')}){\\n`);\r\n      retArr.push(bodyArr.join(''));\r\n      retArr.push('}\\n');\r\n    } else {\r\n      const iVariableName = this.getInternalVariableName('safeI');\r\n      if (initArr.length > 0) {\r\n        retArr.push(initArr.join(''), ';\\n');\r\n      }\r\n      retArr.push(`for (let ${iVariableName}=0;${iVariableName}<LOOP_MAX;${iVariableName}++){\\n`);\r\n      if (testArr.length > 0) {\r\n        retArr.push(`if (!${testArr.join('')}) break;\\n`);\r\n      }\r\n      retArr.push(bodyArr.join(''));\r\n      retArr.push(`\\n${updateArr.join('')};`);\r\n      retArr.push('}\\n');\r\n    }\r\n    return retArr;\r\n  }\r\n\r\n  /**\r\n   * @desc Parses the abstract syntax tree for *while* loop\r\n   * @param {Object} whileNode - An ast Node\r\n   * @param {Array} retArr - return array string\r\n   * @returns {Array} the parsed javascript string\r\n   */\r\n  astWhileStatement(whileNode, retArr) {\r\n    if (whileNode.type !== 'WhileStatement') {\r\n      throw this.astErrorOutput(\r\n        'Invalid while statement',\r\n        whileNode\r\n      );\r\n    }\r\n\r\n    retArr.push('for (let i = 0; i < LOOP_MAX; i++) {');\r\n    retArr.push('if (');\r\n    this.astGeneric(whileNode.test, retArr);\r\n    retArr.push(') {\\n');\r\n    this.astGeneric(whileNode.body, retArr);\r\n    retArr.push('} else {\\n');\r\n    retArr.push('break;\\n');\r\n    retArr.push('}\\n');\r\n    retArr.push('}\\n');\r\n\r\n    return retArr;\r\n  }\r\n\r\n  /**\r\n   * @desc Parses the abstract syntax tree for *do while* loop\r\n   * @param {Object} doWhileNode - An ast Node\r\n   * @param {Array} retArr - return array string\r\n   * @returns {Array} the parsed webgl string\r\n   */\r\n  astDoWhileStatement(doWhileNode, retArr) {\r\n    if (doWhileNode.type !== 'DoWhileStatement') {\r\n      throw this.astErrorOutput(\r\n        'Invalid while statement',\r\n        doWhileNode\r\n      );\r\n    }\r\n\r\n    retArr.push('for (let i = 0; i < LOOP_MAX; i++) {');\r\n    this.astGeneric(doWhileNode.body, retArr);\r\n    retArr.push('if (!');\r\n    this.astGeneric(doWhileNode.test, retArr);\r\n    retArr.push(') {\\n');\r\n    retArr.push('break;\\n');\r\n    retArr.push('}\\n');\r\n    retArr.push('}\\n');\r\n\r\n    return retArr;\r\n\r\n  }\r\n\r\n  /**\r\n   * @desc Parses the abstract syntax tree for *Assignment* Expression\r\n   * @param {Object} assNode - An ast Node\r\n   * @param {Array} retArr - return array string\r\n   * @returns {Array} the append retArr\r\n   */\r\n  astAssignmentExpression(assNode, retArr) {\r\n    const declaration = this.getDeclaration(assNode.left);\r\n    if (declaration && !declaration.assignable) {\r\n      throw new this.astErrorOutput(`Variable ${assNode.left.name} is not assignable here`, assNode);\r\n    }\r\n    this.astGeneric(assNode.left, retArr);\r\n    retArr.push(assNode.operator);\r\n    this.astGeneric(assNode.right, retArr);\r\n    return retArr;\r\n  }\r\n\r\n  /**\r\n   * @desc Parses the abstract syntax tree for *Block* statement\r\n   * @param {Object} bNode - the AST object to parse\r\n   * @param {Array} retArr - return array string\r\n   * @returns {Array} the append retArr\r\n   */\r\n  astBlockStatement(bNode, retArr) {\r\n    if (this.isState('loop-body')) {\r\n      this.pushState('block-body'); // this prevents recursive removal of braces\r\n      for (let i = 0; i < bNode.body.length; i++) {\r\n        this.astGeneric(bNode.body[i], retArr);\r\n      }\r\n      this.popState('block-body');\r\n    } else {\r\n      retArr.push('{\\n');\r\n      for (let i = 0; i < bNode.body.length; i++) {\r\n        this.astGeneric(bNode.body[i], retArr);\r\n      }\r\n      retArr.push('}\\n');\r\n    }\r\n    return retArr;\r\n  }\r\n\r\n  /**\r\n   * @desc Parses the abstract syntax tree for *Variable Declaration*\r\n   * @param {Object} varDecNode - An ast Node\r\n   * @param {Array} retArr - return array string\r\n   * @returns {Array} the append retArr\r\n   */\r\n  astVariableDeclaration(varDecNode, retArr) {\r\n    if (varDecNode.kind === 'var' && this.warnVarUsage) {\r\n      this.varWarn();\r\n    }\r\n    retArr.push(`${varDecNode.kind} `);\r\n    const { declarations } = varDecNode;\r\n    for (let i = 0; i < declarations.length; i++) {\r\n      if (i > 0) {\r\n        retArr.push(',');\r\n      }\r\n      this.astGeneric(declarations[i], retArr);\r\n    }\r\n    if (!this.isState('in-for-loop-init')) {\r\n      retArr.push(';');\r\n    }\r\n    return retArr;\r\n  }\r\n\r\n  /**\r\n   * @desc Parses the abstract syntax tree for *If* Statement\r\n   * @param {Object} ifNode - An ast Node\r\n   * @param {Array} retArr - return array string\r\n   * @returns {Array} the append retArr\r\n   */\r\n  astIfStatement(ifNode, retArr) {\r\n    retArr.push('if (');\r\n    this.astGeneric(ifNode.test, retArr);\r\n    retArr.push(')');\r\n    if (ifNode.consequent.type === 'BlockStatement') {\r\n      this.astGeneric(ifNode.consequent, retArr);\r\n    } else {\r\n      retArr.push(' {\\n');\r\n      this.astGeneric(ifNode.consequent, retArr);\r\n      retArr.push('\\n}\\n');\r\n    }\r\n\r\n    if (ifNode.alternate) {\r\n      retArr.push('else ');\r\n      if (ifNode.alternate.type === 'BlockStatement') {\r\n        this.astGeneric(ifNode.alternate, retArr);\r\n      } else {\r\n        retArr.push(' {\\n');\r\n        this.astGeneric(ifNode.alternate, retArr);\r\n        retArr.push('\\n}\\n');\r\n      }\r\n    }\r\n    return retArr;\r\n\r\n  }\r\n\r\n  astSwitchStatement(ast, retArr) {\r\n    const { discriminant, cases } = ast;\r\n    retArr.push('switch (');\r\n    this.astGeneric(discriminant, retArr);\r\n    retArr.push(') {\\n');\r\n    for (let i = 0; i < cases.length; i++) {\r\n      if (cases[i].test === null) {\r\n        retArr.push('default:\\n');\r\n        this.astGeneric(cases[i].consequent, retArr);\r\n        if (cases[i].consequent && cases[i].consequent.length > 0) {\r\n          retArr.push('break;\\n');\r\n        }\r\n        continue;\r\n      }\r\n      retArr.push('case ');\r\n      this.astGeneric(cases[i].test, retArr);\r\n      retArr.push(':\\n');\r\n      if (cases[i].consequent && cases[i].consequent.length > 0) {\r\n        this.astGeneric(cases[i].consequent, retArr);\r\n        retArr.push('break;\\n');\r\n      }\r\n    }\r\n    retArr.push('\\n}');\r\n  }\r\n\r\n  /**\r\n   * @desc Parses the abstract syntax tree for *This* expression\r\n   * @param {Object} tNode - An ast Node\r\n   * @param {Array} retArr - return array string\r\n   * @returns {Array} the append retArr\r\n   */\r\n  astThisExpression(tNode, retArr) {\r\n    retArr.push('_this');\r\n    return retArr;\r\n  }\r\n\r\n  /**\r\n   * @desc Parses the abstract syntax tree for *Member* Expression\r\n   * @param {Object} mNode - An ast Node\r\n   * @param {Array} retArr - return array string\r\n   * @returns {Array} the append retArr\r\n   */\r\n  astMemberExpression(mNode, retArr) {\r\n    const {\r\n      signature,\r\n      type,\r\n      property,\r\n      xProperty,\r\n      yProperty,\r\n      zProperty,\r\n      name,\r\n      origin\r\n    } = this.getMemberExpressionDetails(mNode);\r\n    switch (signature) {\r\n      case 'this.thread.value':\r\n        retArr.push(`_this.thread.${ name }`);\r\n        return retArr;\r\n      case 'this.output.value':\r\n        switch (name) {\r\n          case 'x':\r\n            retArr.push('outputX');\r\n            break;\r\n          case 'y':\r\n            retArr.push('outputY');\r\n            break;\r\n          case 'z':\r\n            retArr.push('outputZ');\r\n            break;\r\n          default:\r\n            throw this.astErrorOutput('Unexpected expression', mNode);\r\n        }\r\n        return retArr;\r\n      case 'value':\r\n        throw this.astErrorOutput('Unexpected expression', mNode);\r\n      case 'value[]':\r\n      case 'value[][]':\r\n      case 'value[][][]':\r\n      case 'value.value':\r\n        if (origin === 'Math') {\r\n          retArr.push(Math[name]);\r\n          return retArr;\r\n        }\r\n        switch (property) {\r\n          case 'r':\r\n            retArr.push(`user_${ name }[0]`);\r\n            return retArr;\r\n          case 'g':\r\n            retArr.push(`user_${ name }[1]`);\r\n            return retArr;\r\n          case 'b':\r\n            retArr.push(`user_${ name }[2]`);\r\n            return retArr;\r\n          case 'a':\r\n            retArr.push(`user_${ name }[3]`);\r\n            return retArr;\r\n        }\r\n        break;\r\n      case 'this.constants.value':\r\n      case 'this.constants.value[]':\r\n      case 'this.constants.value[][]':\r\n      case 'this.constants.value[][][]':\r\n        break;\r\n      case 'fn()[]':\r\n        this.astGeneric(mNode.object, retArr);\r\n        retArr.push('[');\r\n        this.astGeneric(mNode.property, retArr);\r\n        retArr.push(']');\r\n        return retArr;\r\n      default:\r\n        throw this.astErrorOutput('Unexpected expression', mNode);\r\n    }\r\n\r\n    if (!mNode.computed) {\r\n      // handle simple types\r\n      switch (type) {\r\n        case 'Number':\r\n        case 'Integer':\r\n        case 'Float':\r\n        case 'Boolean':\r\n          retArr.push(`${origin}_${name}`);\r\n          return retArr;\r\n      }\r\n    }\r\n\r\n    // handle more complex types\r\n    // argument may have come from a parent\r\n    const synonymName = this.getKernelArgumentName(name);\r\n    const markupName = `${origin}_${synonymName || name}`;\r\n\r\n    switch (type) {\r\n      case 'Array(2)':\r\n      case 'Array(3)':\r\n      case 'Array(4)':\r\n      case 'HTMLImageArray':\r\n      case 'ArrayTexture(1)':\r\n      case 'ArrayTexture(2)':\r\n      case 'ArrayTexture(3)':\r\n      case 'ArrayTexture(4)':\r\n      case 'HTMLImage':\r\n      default:\r\n        let size;\r\n        let isInput;\r\n        if (origin === 'constants') {\r\n          const constant = this.constants[name];\r\n          isInput = this.constantTypes[name] === 'Input';\r\n          size = isInput ? constant.size : null;\r\n        } else {\r\n          isInput = this.isInput(synonymName || name);\r\n          size = isInput ? this.argumentSizes[this.argumentNames.indexOf(name)] : null;\r\n        }\r\n        retArr.push(`${ markupName }`);\r\n        if (zProperty && yProperty) {\r\n          if (isInput) {\r\n            retArr.push('[(');\r\n            this.astGeneric(zProperty, retArr);\r\n            retArr.push(`*${ this.dynamicArguments ? '(outputY * outputX)' : size[1] * size[0] })+(`);\r\n            this.astGeneric(yProperty, retArr);\r\n            retArr.push(`*${ this.dynamicArguments ? 'outputX' : size[0] })+`);\r\n            this.astGeneric(xProperty, retArr);\r\n            retArr.push(']');\r\n          } else {\r\n            retArr.push('[');\r\n            this.astGeneric(zProperty, retArr);\r\n            retArr.push(']');\r\n            retArr.push('[');\r\n            this.astGeneric(yProperty, retArr);\r\n            retArr.push(']');\r\n            retArr.push('[');\r\n            this.astGeneric(xProperty, retArr);\r\n            retArr.push(']');\r\n          }\r\n        } else if (yProperty) {\r\n          if (isInput) {\r\n            retArr.push('[(');\r\n            this.astGeneric(yProperty, retArr);\r\n            retArr.push(`*${ this.dynamicArguments ? 'outputX' : size[0] })+`);\r\n            this.astGeneric(xProperty, retArr);\r\n            retArr.push(']');\r\n          } else {\r\n            retArr.push('[');\r\n            this.astGeneric(yProperty, retArr);\r\n            retArr.push(']');\r\n            retArr.push('[');\r\n            this.astGeneric(xProperty, retArr);\r\n            retArr.push(']');\r\n          }\r\n        } else if (typeof xProperty !== 'undefined') {\r\n          retArr.push('[');\r\n          this.astGeneric(xProperty, retArr);\r\n          retArr.push(']');\r\n        }\r\n    }\r\n    return retArr;\r\n  }\r\n\r\n  /**\r\n   * @desc Parses the abstract syntax tree for *call* expression\r\n   * @param {Object} ast - the AST object to parse\r\n   * @param {Array} retArr - return array string\r\n   * @returns  {Array} the append retArr\r\n   */\r\n  astCallExpression(ast, retArr) {\r\n    if (ast.type !== 'CallExpression') {\r\n      // Failure, unknown expression\r\n      throw this.astErrorOutput('Unknown CallExpression', ast);\r\n    }\r\n    // Get the full function call, unrolled\r\n    let functionName = this.astMemberExpressionUnroll(ast.callee);\r\n\r\n    // Register the function into the called registry\r\n    if (this.calledFunctions.indexOf(functionName) < 0) {\r\n      this.calledFunctions.push(functionName);\r\n    }\r\n\r\n    const isMathFunction = this.isAstMathFunction(ast);\r\n\r\n    // track the function was called\r\n    if (this.onFunctionCall) {\r\n      this.onFunctionCall(this.name, functionName, ast.arguments);\r\n    }\r\n\r\n    // Call the function\r\n    retArr.push(functionName);\r\n\r\n    // Open arguments space\r\n    retArr.push('(');\r\n    const targetTypes = this.lookupFunctionArgumentTypes(functionName) || [];\r\n    // Add the arguments\r\n    for (let i = 0; i < ast.arguments.length; ++i) {\r\n      const argument = ast.arguments[i];\r\n\r\n      // in order to track return type, even though this is CPU\r\n      let argumentType = this.getType(argument);\r\n      if (!targetTypes[i]) {\r\n        this.triggerImplyArgumentType(functionName, i, argumentType, this);\r\n      }\r\n\r\n      if (i > 0) {\r\n        retArr.push(', ');\r\n      }\r\n      this.astGeneric(argument, retArr);\r\n    }\r\n    // Close arguments space\r\n    retArr.push(')');\r\n\r\n    return retArr;\r\n  }\r\n\r\n  /**\r\n   * @desc Parses the abstract syntax tree for *Array* Expression\r\n   * @param {Object} arrNode - the AST object to parse\r\n   * @param {Array} retArr - return array string\r\n   * @returns {Array} the append retArr\r\n   */\r\n  astArrayExpression(arrNode, retArr) {\r\n    const arrLen = arrNode.elements.length;\r\n\r\n    retArr.push('new Float32Array([');\r\n    for (let i = 0; i < arrLen; ++i) {\r\n      if (i > 0) {\r\n        retArr.push(', ');\r\n      }\r\n      const subNode = arrNode.elements[i];\r\n      this.astGeneric(subNode, retArr)\r\n    }\r\n    retArr.push('])');\r\n\r\n    return retArr;\r\n  }\r\n\r\n  astDebuggerStatement(arrNode, retArr) {\r\n    retArr.push('debugger;');\r\n    return retArr;\r\n  }\r\n}\r\n","import { Kernel } from '../kernel';\r\nimport { FunctionBuilder } from '../function-builder';\r\nimport { CPUFunctionNode } from './function-node';\r\nimport { getVariableType, utils } from '../../utils';\r\nimport { cpuKernelString } from './kernel-string';\r\n\r\n/**\r\n * @desc Kernel Implementation for CPU.\r\n * <p>Instantiates properties to the CPU Kernel.</p>\r\n */\r\nexport class CPUKernel extends Kernel {\r\n  static getFeatures() {\r\n    return this.features;\r\n  }\r\n  static get features() {\r\n    return Object.freeze({\r\n      kernelMap: true,\r\n      isIntegerDivisionAccurate: true\r\n    });\r\n  }\r\n  static get isSupported() {\r\n    return true;\r\n  }\r\n  static isContextMatch(context) {\r\n    return false;\r\n  }\r\n  /**\r\n   * @desc The current mode in which gpu.js is executing.\r\n   */\r\n  static get mode() {\r\n    return 'cpu';\r\n  }\r\n\r\n  static nativeFunctionArguments() {\r\n    return null;\r\n  }\r\n\r\n  static nativeFunctionReturnType() {\r\n    return null;\r\n  }\r\n\r\n  static combineKernels(combinedKernel) {\r\n    return combinedKernel;\r\n  }\r\n\r\n  constructor(source, settings) {\r\n    super(source, settings);\r\n    this.mergeSettings(source.settings || settings);\r\n\r\n    this._imageData = null;\r\n    this._colorData = null;\r\n    this._kernelString = null;\r\n    this.thread = {\r\n      x: 0,\r\n      y: 0,\r\n      z: 0\r\n    };\r\n    this.translatedSources = null;\r\n  }\r\n\r\n  initCanvas() {\r\n    if (typeof document !== 'undefined') {\r\n      return document.createElement('canvas');\r\n    } else if (typeof OffscreenCanvas !== 'undefined') {\r\n      return new OffscreenCanvas(0, 0);\r\n    }\r\n  }\r\n\r\n  initContext() {\r\n    if (!this.canvas) return null;\r\n    return this.canvas.getContext('2d');\r\n  }\r\n\r\n  initPlugins(settings) {\r\n    return [];\r\n  }\r\n\r\n  /**\r\n   * @desc Validate settings related to Kernel, such as dimensions size, and auto output support.\r\n   * @param {IArguments} args\r\n   */\r\n  validateSettings(args) {\r\n    if (!this.output || this.output.length === 0) {\r\n      if (args.length !== 1) {\r\n        throw new Error('Auto output only supported for kernels with only one input');\r\n      }\r\n\r\n      const argType = getVariableType(args[0], this.strictIntegers);\r\n      if (argType === 'Array') {\r\n        this.output = utils.getDimensions(argType);\r\n      } else if (argType === 'NumberTexture' || argType === 'ArrayTexture(4)') {\r\n        this.output = args[0].output;\r\n      } else {\r\n        throw new Error('Auto output not supported for input type: ' + argType);\r\n      }\r\n    }\r\n\r\n    if (this.graphical) {\r\n      if (this.output.length !== 2) {\r\n        throw new Error('Output must have 2 dimensions on graphical mode');\r\n      }\r\n    }\r\n\r\n    this.checkOutput();\r\n  }\r\n\r\n  translateSource() {\r\n    this.leadingReturnStatement = this.output.length > 1 ? 'resultX[x] = ' : 'result[x] = ';\r\n    if (this.subKernels) {\r\n      const followingReturnStatement = []\r\n      for (let i = 0; i < this.subKernels.length; i++) {\r\n        const {\r\n          name\r\n        } = this.subKernels[i];\r\n        followingReturnStatement.push(this.output.length > 1 ? `resultX_${ name }[x] = subKernelResult_${ name };\\n` : `result_${ name }[x] = subKernelResult_${ name };\\n`);\r\n      }\r\n      this.followingReturnStatement = followingReturnStatement.join('');\r\n    }\r\n    const functionBuilder = FunctionBuilder.fromKernel(this, CPUFunctionNode);\r\n    this.translatedSources = functionBuilder.getPrototypes('kernel');\r\n    if (!this.graphical && !this.returnType) {\r\n      this.returnType = functionBuilder.getKernelResultType();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @desc Builds the Kernel, by generating the kernel\r\n   * string using thread dimensions, and arguments\r\n   * supplied to the kernel.\r\n   *\r\n   * <p>If the graphical flag is enabled, canvas is used.</p>\r\n   */\r\n  build() {\r\n    this.setupConstants();\r\n    this.setupArguments(arguments);\r\n    this.validateSettings(arguments);\r\n    this.translateSource();\r\n\r\n    if (this.graphical) {\r\n      const {\r\n        canvas,\r\n        output\r\n      } = this;\r\n      if (!canvas) {\r\n        throw new Error('no canvas available for using graphical output');\r\n      }\r\n      const width = output[0];\r\n      const height = output[1] || 1;\r\n      canvas.width = width;\r\n      canvas.height = height;\r\n      this._imageData = this.context.createImageData(width, height);\r\n      this._colorData = new Uint8ClampedArray(width * height * 4);\r\n    }\r\n\r\n    const kernelString = this.getKernelString();\r\n    this.kernelString = kernelString;\r\n\r\n    if (this.debug) {\r\n      console.log('Function output:');\r\n      console.log(kernelString);\r\n    }\r\n\r\n    try {\r\n      this.run = new Function([], kernelString).bind(this)();\r\n    } catch (e) {\r\n      console.error('An error occurred compiling the javascript: ', e);\r\n    }\r\n  }\r\n\r\n  color(r, g, b, a) {\r\n    if (typeof a === 'undefined') {\r\n      a = 1;\r\n    }\r\n\r\n    r = Math.floor(r * 255);\r\n    g = Math.floor(g * 255);\r\n    b = Math.floor(b * 255);\r\n    a = Math.floor(a * 255);\r\n\r\n    const width = this.output[0];\r\n    const height = this.output[1];\r\n\r\n    const x = this.thread.x;\r\n    const y = height - this.thread.y - 1;\r\n\r\n    const index = x + y * width;\r\n\r\n    this._colorData[index * 4 + 0] = r;\r\n    this._colorData[index * 4 + 1] = g;\r\n    this._colorData[index * 4 + 2] = b;\r\n    this._colorData[index * 4 + 3] = a;\r\n  }\r\n\r\n  /**\r\n   * @desc Generates kernel string for this kernel program.\r\n   *\r\n   * <p>If sub-kernels are supplied, they are also factored in.\r\n   * This string can be saved by calling the `toString` method\r\n   * and then can be reused later.</p>\r\n   *\r\n   * @returns {String} result\r\n   *\r\n   */\r\n  getKernelString() {\r\n    if (this._kernelString !== null) return this._kernelString;\r\n\r\n    let kernelThreadString = null;\r\n    let {\r\n      translatedSources\r\n    } = this;\r\n    if (translatedSources.length > 1) {\r\n      translatedSources = translatedSources.filter(fn => {\r\n        if (/^function/.test(fn)) return fn;\r\n        kernelThreadString = fn;\r\n        return false;\r\n      })\r\n    } else {\r\n      kernelThreadString = translatedSources.shift();\r\n    }\r\n    const kernelString = this._kernelString = `  const LOOP_MAX = ${ this._getLoopMaxString() }\r\n  const constants = this.constants;\r\n  const _this = this;\r\n  return (${ this.argumentNames.map(argumentName => 'user_' + argumentName).join(', ') }) => {\r\n    ${ this._processConstants() }\r\n    ${ this._processArguments() }\r\n    ${ this.graphical ? this._graphicalKernelBody(kernelThreadString) : this._resultKernelBody(kernelThreadString) }\r\n    ${ translatedSources.length > 0 ? translatedSources.join('\\n') : '' }\r\n  };`;\r\n    return kernelString;\r\n  }\r\n\r\n  /**\r\n   * @desc Returns the *pre-compiled* Kernel as a JS Object String, that can be reused.\r\n   */\r\n  toString() {\r\n    return cpuKernelString(this);\r\n  }\r\n\r\n  /**\r\n   * @desc Get the maximum loop size String.\r\n   * @returns {String} result\r\n   */\r\n  _getLoopMaxString() {\r\n    return (\r\n      this.loopMaxIterations ?\r\n      ` ${ parseInt(this.loopMaxIterations) };` :\r\n      ' 1000;'\r\n    );\r\n  }\r\n\r\n  _processConstants() {\r\n    if (!this.constants) return '';\r\n\r\n    const result = [];\r\n    for (let p in this.constants) {\r\n      const type = this.constantTypes[p];\r\n      switch (type) {\r\n        case 'HTMLImage':\r\n          result.push(`    const constants_${p} = this._imageTo2DArray(this.constants.${p});\\n`);\r\n          break;\r\n        case 'HTMLImageArray':\r\n          result.push(`    const constants_${p} = this._imageTo3DArray(this.constants.${p});\\n`);\r\n          break;\r\n        case 'Input':\r\n          result.push(`    const constants_${p} = this.constants.${p}.value;\\n`);\r\n          break;\r\n        default:\r\n          result.push(`    const constants_${p} = this.constants.${p};\\n`);\r\n      }\r\n    }\r\n    return result.join('');\r\n  }\r\n\r\n  _processArguments() {\r\n    const result = [];\r\n    for (let i = 0; i < this.argumentTypes.length; i++) {\r\n      const variableName = `user_${this.argumentNames[i]}`;\r\n      switch (this.argumentTypes[i]) {\r\n        case 'HTMLImage':\r\n          result.push(`    ${variableName} = this._imageTo2DArray(${variableName});\\n`);\r\n          break;\r\n        case 'HTMLImageArray':\r\n          result.push(`    ${variableName} = this._imageTo3DArray(${variableName});\\n`);\r\n          break;\r\n        case 'Input':\r\n          result.push(`    ${variableName} = ${variableName}.value;\\n`);\r\n          break;\r\n        case 'ArrayTexture(1)':\r\n        case 'ArrayTexture(2)':\r\n        case 'ArrayTexture(3)':\r\n        case 'ArrayTexture(4)':\r\n        case 'NumberTexture':\r\n        case 'MemoryOptimizedNumberTexture':\r\n          result.push(`\r\n    if (${variableName}.toArray) {\r\n      if (!_this.textureCache) {\r\n        _this.textureCache = [];\r\n        _this.arrayCache = [];\r\n      }\r\n      const textureIndex = _this.textureCache.indexOf(${variableName});\r\n      if (textureIndex !== -1) {\r\n        ${variableName} = _this.arrayCache[textureIndex];\r\n      } else {\r\n        _this.textureCache.push(${variableName});\r\n        ${variableName} = ${variableName}.toArray();\r\n        _this.arrayCache.push(${variableName});\r\n      }\r\n    }`);\r\n          break;\r\n      }\r\n    }\r\n    return result.join('');\r\n  }\r\n\r\n  _imageTo2DArray(image) {\r\n    const canvas = this.canvas;\r\n    if (canvas.width < image.width) {\r\n      canvas.width = image.width;\r\n    }\r\n    if (canvas.height < image.height) {\r\n      canvas.height = image.height;\r\n    }\r\n    const ctx = this.context;\r\n    ctx.drawImage(image, 0, 0, image.width, image.height);\r\n    const pixelsData = ctx.getImageData(0, 0, image.width, image.height).data;\r\n    const imageArray = new Array(image.height);\r\n    let index = 0;\r\n    for (let y = image.height - 1; y >= 0; y--) {\r\n      const row = imageArray[y] = new Array(image.width);\r\n      for (let x = 0; x < image.width; x++) {\r\n        const pixel = new Float32Array(4);\r\n        pixel[0] = pixelsData[index++] / 255; // r\r\n        pixel[1] = pixelsData[index++] / 255; // g\r\n        pixel[2] = pixelsData[index++] / 255; // b\r\n        pixel[3] = pixelsData[index++] / 255; // a\r\n        row[x] = pixel;\r\n      }\r\n    }\r\n    return imageArray;\r\n  }\r\n\r\n  getPixels(flip) {\r\n    const [width, height] = this.output;\r\n    // cpu is not flipped by default\r\n    return flip ? utils.flipPixels(this._imageData.data, width, height) : this._imageData.data.slice(0);\r\n  }\r\n\r\n  _imageTo3DArray(images) {\r\n    const imagesArray = new Array(images.length);\r\n    for (let i = 0; i < images.length; i++) {\r\n      imagesArray[i] = this._imageTo2DArray(images[i]);\r\n    }\r\n    return imagesArray;\r\n  }\r\n\r\n  _resultKernelBody(kernelString) {\r\n    switch (this.output.length) {\r\n      case 1:\r\n        return this._resultKernel1DLoop(kernelString) + this._kernelOutput();\r\n      case 2:\r\n        return this._resultKernel2DLoop(kernelString) + this._kernelOutput();\r\n      case 3:\r\n        return this._resultKernel3DLoop(kernelString) + this._kernelOutput();\r\n      default:\r\n        throw new Error('unsupported size kernel');\r\n    }\r\n  }\r\n\r\n  _graphicalKernelBody(kernelThreadString) {\r\n    switch (this.output.length) {\r\n      case 2:\r\n        return this._graphicalKernel2DLoop(kernelThreadString) + this._graphicalOutput();\r\n      default:\r\n        throw new Error('unsupported size kernel');\r\n    }\r\n  }\r\n\r\n  _graphicalOutput() {\r\n    return `\r\n    this._imageData.data.set(this._colorData);\r\n    this.context.putImageData(this._imageData, 0, 0);\r\n    return;`\r\n  }\r\n\r\n  _getKernelResultTypeConstructorString() {\r\n    switch (this.returnType) {\r\n      case 'LiteralInteger':\r\n      case 'Number':\r\n      case 'Integer':\r\n      case 'Float':\r\n        return 'Float32Array';\r\n      case 'Array(2)':\r\n      case 'Array(3)':\r\n      case 'Array(4)':\r\n        return 'Array';\r\n      default:\r\n        if (this.graphical) {\r\n          return 'Float32Array';\r\n        }\r\n        throw new Error(`unhandled returnType ${ this.returnType }`);\r\n    }\r\n  }\r\n\r\n  _resultKernel1DLoop(kernelString) {\r\n    const {\r\n      output\r\n    } = this;\r\n    const constructorString = this._getKernelResultTypeConstructorString();\r\n    return `  const outputX = _this.output[0];\r\n    const result = new ${constructorString}(outputX);\r\n    ${ this._mapSubKernels(subKernel => `const result_${ subKernel.name } = new ${constructorString}(outputX);\\n`).join('    ') }\r\n    ${ this._mapSubKernels(subKernel => `let subKernelResult_${ subKernel.name };\\n`).join('    ') }\r\n    for (let x = 0; x < outputX; x++) {\r\n      this.thread.x = x;\r\n      this.thread.y = 0;\r\n      this.thread.z = 0;\r\n      ${ kernelString }\r\n    }`;\r\n  }\r\n\r\n  _resultKernel2DLoop(kernelString) {\r\n    const {\r\n      output\r\n    } = this;\r\n    const constructorString = this._getKernelResultTypeConstructorString();\r\n    return `  const outputX = _this.output[0];\r\n    const outputY = _this.output[1];\r\n    const result = new Array(outputY);\r\n    ${ this._mapSubKernels(subKernel => `const result_${ subKernel.name } = new Array(outputY);\\n`).join('    ') }\r\n    ${ this._mapSubKernels(subKernel => `let subKernelResult_${ subKernel.name };\\n`).join('    ') }\r\n    for (let y = 0; y < outputY; y++) {\r\n      this.thread.z = 0;\r\n      this.thread.y = y;\r\n      const resultX = result[y] = new ${constructorString}(outputX);\r\n      ${ this._mapSubKernels(subKernel => `const resultX_${ subKernel.name } = result_${subKernel.name}[y] = new ${constructorString}(outputX);\\n`).join('') }\r\n      for (let x = 0; x < outputX; x++) {\r\n        this.thread.x = x;\r\n        ${ kernelString }\r\n      }\r\n    }`;\r\n  }\r\n\r\n  _graphicalKernel2DLoop(kernelString) {\r\n    const {\r\n      output\r\n    } = this;\r\n    const constructorString = this._getKernelResultTypeConstructorString();\r\n    return `  const outputX = _this.output[0];\r\n    const outputY = _this.output[1];\r\n    ${ this._mapSubKernels(subKernel => `const result_${ subKernel.name } = new Array(outputY);\\n`).join('    ') }\r\n    ${ this._mapSubKernels(subKernel => `let subKernelResult_${ subKernel.name };\\n`).join('    ') }\r\n    for (let y = 0; y < outputY; y++) {\r\n      this.thread.z = 0;\r\n      this.thread.y = y;\r\n      ${ this._mapSubKernels(subKernel => `const resultX_${ subKernel.name } = result_${subKernel.name}[y] = new ${constructorString}(outputX);\\n`).join('') }\r\n      for (let x = 0; x < outputX; x++) {\r\n        this.thread.x = x;\r\n        ${ kernelString }\r\n      }\r\n    }`;\r\n  }\r\n\r\n  _resultKernel3DLoop(kernelString) {\r\n    const {\r\n      output\r\n    } = this;\r\n    const constructorString = this._getKernelResultTypeConstructorString();\r\n    return `  const outputX = _this.output[0];\r\n    const outputY = _this.output[1];\r\n    const outputZ = _this.output[2];\r\n    const result = new Array(outputZ);\r\n    ${ this._mapSubKernels(subKernel => `const result_${ subKernel.name } = new Array(outputZ);\\n`).join('    ') }\r\n    ${ this._mapSubKernels(subKernel => `let subKernelResult_${ subKernel.name };\\n`).join('    ') }\r\n    for (let z = 0; z < outputZ; z++) {\r\n      this.thread.z = z;\r\n      const resultY = result[z] = new Array(outputY);\r\n      ${ this._mapSubKernels(subKernel => `const resultY_${ subKernel.name } = result_${subKernel.name}[z] = new Array(outputY);\\n`).join('      ') }\r\n      for (let y = 0; y < outputY; y++) {\r\n        this.thread.y = y;\r\n        const resultX = resultY[y] = new ${constructorString}(outputX);\r\n        ${ this._mapSubKernels(subKernel => `const resultX_${ subKernel.name } = resultY_${subKernel.name}[y] = new ${constructorString}(outputX);\\n`).join('        ') }\r\n        for (let x = 0; x < outputX; x++) {\r\n          this.thread.x = x;\r\n          ${ kernelString }\r\n        }\r\n      }\r\n    }`;\r\n  }\r\n\r\n  _kernelOutput() {\r\n    if (!this.subKernels) {\r\n      return '\\n    return result;';\r\n    }\r\n    return `\\n    return {\r\n      result: result,\r\n      ${ this.subKernels.map(subKernel => `${ subKernel.property }: result_${ subKernel.name }`).join(',\\n      ') }\r\n    };`;\r\n  }\r\n\r\n  _mapSubKernels(fn) {\r\n    return this.subKernels === null ? [''] :\r\n      this.subKernels.map(fn);\r\n  }\r\n\r\n\r\n\r\n  destroy(removeCanvasReference) {\r\n    if (removeCanvasReference) {\r\n      delete this.canvas;\r\n    }\r\n  }\r\n\r\n  static destroyContext(context) {}\r\n\r\n  toJSON() {\r\n    const json = super.toJSON();\r\n    json.functionNodes = FunctionBuilder.fromKernel(this, CPUFunctionNode).toJSON();\r\n    return json;\r\n  }\r\n\r\n  setOutput(output) {\r\n    super.setOutput(output);\r\n    const [width, height] = this.output;\r\n    if (this.graphical) {\r\n      this._imageData = this.context.createImageData(width, height);\r\n      this._colorData = new Uint8ClampedArray(width * height * 4);\r\n    }\r\n  }\r\n}\r\n","import { utils } from '../../utils';\r\n\r\nfunction constantsToString(constants) {\r\n  const results = [];\r\n  for (const p in constants) {\r\n    const constant = constants[p];\r\n    switch (typeof constant) {\r\n      case 'number':\r\n      case 'boolean':\r\n        results.push(`${p}:${constant}`);\r\n    }\r\n  }\r\n  return `{ ${ results.join() } }`;\r\n}\r\n\r\nexport function cpuKernelString(cpuKernel, name) {\r\n  const header = [];\r\n  const thisProperties = [];\r\n  const beforeReturn = [];\r\n\r\n  const useFunctionKeyword = !/^function/.test(cpuKernel.color.toString());\r\n\r\n  header.push(\r\n    '  const { context, canvas, constants } = settings;',\r\n    `  const output = new Int32Array(${JSON.stringify(Array.from(cpuKernel.output))});`,\r\n    `  const _constants = ${constantsToString(cpuKernel.constants)};`,\r\n  );\r\n\r\n  thisProperties.push(\r\n    '    constants: _constants,',\r\n    '    context,',\r\n    '    output,',\r\n    '    thread: {x: 0, y: 0, z: 0},',\r\n  );\r\n\r\n  if (cpuKernel.graphical) {\r\n    header.push(`  const _imageData = context.createImageData(${cpuKernel.output[0]}, ${cpuKernel.output[1]});`);\r\n    header.push(`  const _colorData = new Uint8ClampedArray(${cpuKernel.output[0]} * ${cpuKernel.output[1]} * 4);`);\r\n\r\n    const colorFn = utils.flattenFunctionToString((useFunctionKeyword ? 'function ' : '') + cpuKernel.color.toString(), {\r\n      thisLookup: (propertyName) => {\r\n        switch (propertyName) {\r\n          case '_colorData':\r\n            return '_colorData';\r\n          case '_imageData':\r\n            return '_imageData';\r\n          case 'output':\r\n            return 'output';\r\n          case 'thread':\r\n            return 'this.thread';\r\n        }\r\n        return JSON.stringify(cpuKernel[propertyName]);\r\n      },\r\n      findDependency: (object, name) => {\r\n        return null;\r\n      }\r\n    });\r\n\r\n    const getPixelsFn = utils.flattenFunctionToString((useFunctionKeyword ? 'function ' : '') + cpuKernel.getPixels.toString(), {\r\n      thisLookup: (propertyName) => {\r\n        switch (propertyName) {\r\n          case '_colorData':\r\n            return '_colorData';\r\n          case '_imageData':\r\n            return '_imageData';\r\n          case 'output':\r\n            return 'output';\r\n          case 'thread':\r\n            return 'this.thread';\r\n        }\r\n        return JSON.stringify(cpuKernel[propertyName]);\r\n      },\r\n      findDependency: () => {\r\n        return null;\r\n      }\r\n    });\r\n\r\n    thisProperties.push(\r\n      '    _imageData,',\r\n      '    _colorData,',\r\n      `    color: ${colorFn},`,\r\n    );\r\n\r\n    beforeReturn.push(\r\n      `  kernel.getPixels = ${getPixelsFn};`\r\n    );\r\n  }\r\n\r\n  const constantTypes = [];\r\n  const constantKeys = Object.keys(cpuKernel.constantTypes);\r\n  for (let i = 0; i < constantKeys.length; i++) {\r\n    constantTypes.push(cpuKernel.constantTypes[constantKeys]);\r\n  }\r\n  if (cpuKernel.argumentTypes.indexOf('HTMLImageArray') !== -1 || constantTypes.indexOf('HTMLImageArray') !== -1) {\r\n    const flattenedImageTo3DArray = utils.flattenFunctionToString((useFunctionKeyword ? 'function ' : '') + cpuKernel._imageTo3DArray.toString(), {\r\n      doNotDefine: ['canvas'],\r\n      findDependency: (object, name) => {\r\n        if (object === 'this') {\r\n          return (useFunctionKeyword ? 'function ' : '') + cpuKernel[name].toString();\r\n        }\r\n        return null;\r\n      },\r\n      thisLookup: (propertyName) => {\r\n        switch (propertyName) {\r\n          case 'canvas':\r\n            return;\r\n          case 'context':\r\n            return 'context';\r\n        }\r\n      }\r\n    })\r\n    beforeReturn.push(flattenedImageTo3DArray);\r\n    thisProperties.push(`    _imageTo2DArray,`);\r\n    thisProperties.push(`    _imageTo3DArray,`);\r\n  } else if (cpuKernel.argumentTypes.indexOf('HTMLImage') !== -1 || constantTypes.indexOf('HTMLImage') !== -1) {\r\n    const flattenedImageTo2DArray = utils.flattenFunctionToString((useFunctionKeyword ? 'function ' : '') + cpuKernel._imageTo2DArray.toString(), {\r\n      findDependency: (object, name) => {\r\n        return null;\r\n      },\r\n      thisLookup: (propertyName) => {\r\n        switch (propertyName) {\r\n          case 'canvas':\r\n            return 'settings.canvas';\r\n          case 'context':\r\n            return 'settings.context';\r\n        }\r\n        throw new Error('unhandled thisLookup');\r\n      }\r\n    });\r\n    beforeReturn.push(flattenedImageTo2DArray);\r\n    thisProperties.push(`    _imageTo2DArray,`);\r\n  }\r\n\r\n  return `function(settings) {\r\n${ header.join('\\n') }\r\n  for (const p in constants) {\r\n    const constant = constants[p];\r\n    switch (typeof constant) {\r\n      case 'number':\r\n      case 'boolean':\r\n        continue;\r\n    }\r\n    _constants[p] = constant;\r\n  }\r\n  const kernel = (function() {\r\n${cpuKernel._kernelString}\r\n  })\r\n    .apply({ ${thisProperties.join('\\n')} });\r\n  ${ beforeReturn.join('\\n') }\r\n  return kernel;\r\n}`;\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { Texture } from '../../../texture';\r\n\r\nexport class GLTextureFloat extends Texture {\r\n  constructor(settings) {\r\n    super(settings);\r\n    this.type = 'ArrayTexture(1)';\r\n  }\r\n  renderRawOutput() {\r\n    const { context: gl } = this;\r\n    const framebuffer = gl.createFramebuffer();\r\n    gl.bindFramebuffer(gl.FRAMEBUFFER, framebuffer);\r\n    gl.framebufferTexture2D(\r\n      gl.FRAMEBUFFER,\r\n      gl.COLOR_ATTACHMENT0,\r\n      gl.TEXTURE_2D,\r\n      this.texture,\r\n      0\r\n    );\r\n    const result = new Float32Array(this.size[0] * this.size[1] * 4);\r\n    gl.readPixels(0, 0, this.size[0], this.size[1], gl.RGBA, gl.FLOAT, result);\r\n    return result;\r\n  }\r\n  renderValues() {\r\n    return this.renderRawOutput();\r\n  }\r\n  toArray() {\r\n    return utils.erectFloat(this.renderValues(), this.output[0]);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { GLTextureFloat } from './float';\r\n\r\nexport class GLTextureArray2Float extends GLTextureFloat {\r\n  constructor(settings) {\r\n    super(settings);\r\n    this.type = 'ArrayTexture(2)';\r\n  }\r\n  toArray() {\r\n    return utils.erectArray2(this.renderValues(), this.output[0], this.output[1]);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { GLTextureFloat } from './float';\r\n\r\nexport class GLTextureArray2Float2D extends GLTextureFloat {\r\n  constructor(settings) {\r\n    super(settings);\r\n    this.type = 'ArrayTexture(2)';\r\n  }\r\n  toArray() {\r\n    return utils.erect2DArray2(this.renderValues(), this.output[0], this.output[1]);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { GLTextureFloat } from './float';\r\n\r\nexport class GLTextureArray2Float3D extends GLTextureFloat {\r\n  constructor(settings) {\r\n    super(settings);\r\n    this.type = 'ArrayTexture(2)';\r\n  }\r\n  toArray() {\r\n    return utils.erect3DArray2(this.renderValues(), this.output[0], this.output[1], this.output[2]);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { GLTextureFloat } from './float';\r\n\r\nexport class GLTextureArray3Float extends GLTextureFloat {\r\n  constructor(settings) {\r\n    super(settings);\r\n    this.type = 'ArrayTexture(3)';\r\n  }\r\n  toArray() {\r\n    return utils.erectArray3(this.renderValues(), this.output[0]);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { GLTextureFloat } from './float';\r\n\r\nexport class GLTextureArray3Float2D extends GLTextureFloat {\r\n  constructor(settings) {\r\n    super(settings);\r\n    this.type = 'ArrayTexture(3)';\r\n  }\r\n  toArray() {\r\n    return utils.erect2DArray3(this.renderValues(), this.output[0], this.output[1]);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { GLTextureFloat } from './float';\r\n\r\nexport class GLTextureArray3Float3D extends GLTextureFloat {\r\n  constructor(settings) {\r\n    super(settings);\r\n    this.type = 'ArrayTexture(3)';\r\n  }\r\n  toArray() {\r\n    return utils.erect3DArray3(this.renderValues(), this.output[0], this.output[1], this.output[2]);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { GLTextureFloat } from './float';\r\n\r\nexport class GLTextureArray4Float extends GLTextureFloat {\r\n  constructor(settings) {\r\n    super(settings);\r\n    this.type = 'ArrayTexture(4)';\r\n  }\r\n  toArray() {\r\n    return utils.erectArray4(this.renderValues(), this.output[0]);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { GLTextureFloat } from './float';\r\n\r\nexport class GLTextureArray4Float2D extends GLTextureFloat {\r\n  constructor(settings) {\r\n    super(settings);\r\n    this.type = 'ArrayTexture(4)';\r\n  }\r\n  toArray() {\r\n    return utils.erect2DArray4(this.renderValues(), this.output[0], this.output[1]);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { GLTextureFloat } from './float';\r\n\r\nexport class GLTextureArray4Float3D extends GLTextureFloat {\r\n  constructor(settings) {\r\n    super(settings);\r\n    this.type = 'ArrayTexture(4)';\r\n  }\r\n  toArray() {\r\n    return utils.erect3DArray4(this.renderValues(), this.output[0], this.output[1], this.output[2]);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { GLTextureFloat } from './float';\r\n\r\nexport class GLTextureFloat2D extends GLTextureFloat {\r\n  constructor(settings) {\r\n    super(settings);\r\n    this.type = 'ArrayTexture(1)';\r\n  }\r\n  toArray() {\r\n    return utils.erect2DFloat(this.renderValues(), this.output[0], this.output[1]);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { GLTextureFloat } from './float';\r\n\r\nexport class GLTextureFloat3D extends GLTextureFloat {\r\n  constructor(settings) {\r\n    super(settings);\r\n    this.type = 'ArrayTexture(1)';\r\n  }\r\n  toArray() {\r\n    return utils.erect3DFloat(this.renderValues(), this.output[0], this.output[1], this.output[2]);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { GLTextureFloat } from './float';\r\n\r\nexport class GLTextureMemoryOptimized extends GLTextureFloat {\r\n  constructor(settings) {\r\n    super(settings);\r\n    this.type = 'MemoryOptimizedNumberTexture';\r\n  }\r\n  toArray() {\r\n    return utils.erectMemoryOptimizedFloat(this.renderValues(), this.output[0]);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { GLTextureFloat } from './float';\r\n\r\nexport class GLTextureMemoryOptimized2D extends GLTextureFloat {\r\n  constructor(settings) {\r\n    super(settings);\r\n    this.type = 'MemoryOptimizedNumberTexture';\r\n  }\r\n  toArray() {\r\n    return utils.erectMemoryOptimized2DFloat(this.renderValues(), this.output[0], this.output[1]);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { GLTextureFloat } from './float';\r\n\r\nexport class GLTextureMemoryOptimized3D extends GLTextureFloat {\r\n  constructor(settings) {\r\n    super(settings);\r\n    this.type = 'MemoryOptimizedNumberTexture';\r\n  }\r\n  toArray() {\r\n    return utils.erectMemoryOptimized3DFloat(this.renderValues(), this.output[0], this.output[1], this.output[2]);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { Texture } from '../../../texture';\r\n\r\nexport class GLTextureUnsigned extends Texture {\r\n  constructor(settings) {\r\n    super(settings);\r\n    this.type = 'NumberTexture';\r\n  }\r\n  renderRawOutput() {\r\n    const { context: gl } = this;\r\n    const framebuffer = gl.createFramebuffer();\r\n    gl.bindFramebuffer(gl.FRAMEBUFFER, framebuffer);\r\n    gl.framebufferTexture2D(\r\n      gl.FRAMEBUFFER,\r\n      gl.COLOR_ATTACHMENT0,\r\n      gl.TEXTURE_2D,\r\n      this.texture,\r\n      0\r\n    );\r\n    const result = new Uint8Array(this.size[0] * this.size[1] * 4);\r\n    gl.readPixels(0, 0, this.size[0], this.size[1], gl.RGBA, gl.UNSIGNED_BYTE, result);\r\n    return result;\r\n  }\r\n  renderValues() {\r\n    return new Float32Array(this.renderRawOutput().buffer);\r\n  }\r\n  toArray() {\r\n    return utils.erectPackedFloat(this.renderValues(), this.output[0]);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { GLTextureUnsigned } from './unsigned';\r\n\r\nexport class GLTextureUnsigned2D extends GLTextureUnsigned {\r\n  constructor(settings) {\r\n    super(settings);\r\n    this.type = 'NumberTexture';\r\n  }\r\n  toArray() {\r\n    return utils.erect2DPackedFloat(this.renderValues(), this.output[0], this.output[1]);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { GLTextureUnsigned } from './unsigned';\r\n\r\nexport class GLTextureUnsigned3D extends GLTextureUnsigned {\r\n  constructor(settings) {\r\n    super(settings);\r\n    this.type = 'NumberTexture';\r\n  }\r\n  toArray() {\r\n    return utils.erect3DPackedFloat(this.renderValues(), this.output[0], this.output[1], this.output[2]);\r\n  }\r\n}\r\n","import { GLTextureUnsigned } from './unsigned';\r\n\r\nexport class GLTextureGraphical extends GLTextureUnsigned {\r\n  constructor(settings) {\r\n    super(settings);\r\n    this.type = 'ArrayTexture(4)';\r\n  }\r\n  toArray() {\r\n    return this.renderValues();\r\n  }\r\n}\r\n","import { Kernel } from '../kernel';\r\nimport { utils } from '../../utils';\r\nimport { GLTextureArray2Float } from './texture/array-2-float';\r\nimport { GLTextureArray2Float2D } from './texture/array-2-float-2d';\r\nimport { GLTextureArray2Float3D } from './texture/array-2-float-3d';\r\nimport { GLTextureArray3Float } from './texture/array-3-float';\r\nimport { GLTextureArray3Float2D } from './texture/array-3-float-2d';\r\nimport { GLTextureArray3Float3D } from './texture/array-3-float-3d';\r\nimport { GLTextureArray4Float } from './texture/array-4-float';\r\nimport { GLTextureArray4Float2D } from './texture/array-4-float-2d';\r\nimport { GLTextureArray4Float3D } from './texture/array-4-float-3d';\r\nimport { GLTextureFloat } from './texture/float';\r\nimport { GLTextureFloat2D } from './texture/float-2d';\r\nimport { GLTextureFloat3D } from './texture/float-3d';\r\nimport { GLTextureMemoryOptimized } from './texture/memory-optimized';\r\nimport { GLTextureMemoryOptimized2D } from './texture/memory-optimized-2d';\r\nimport { GLTextureMemoryOptimized3D } from './texture/memory-optimized-3d';\r\nimport { GLTextureUnsigned } from './texture/unsigned';\r\nimport { GLTextureUnsigned2D } from './texture/unsigned-2d';\r\nimport { GLTextureUnsigned3D } from './texture/unsigned-3d';\r\nimport { GLTextureGraphical } from './texture/graphical';\r\n\r\n/**\r\n * @abstract\r\n * @extends Kernel\r\n */\r\nexport class GLKernel extends Kernel {\r\n  static get mode() {\r\n    return 'gpu';\r\n  }\r\n\r\n  static getIsFloatRead() {\r\n    const kernelString = `function kernelFunction() {\r\n      return 1;\r\n    }`;\r\n    const kernel = new this(kernelString, {\r\n      context: this.testContext,\r\n      canvas: this.testCanvas,\r\n      validate: false,\r\n      output: [1],\r\n      precision: 'single',\r\n      returnType: 'Number',\r\n      tactic: 'speed',\r\n    });\r\n    kernel.build();\r\n    kernel.run();\r\n    const result = kernel.renderOutput();\r\n    kernel.destroy(true);\r\n    return result[0] === 1;\r\n  }\r\n\r\n  static getIsIntegerDivisionAccurate() {\r\n    function kernelFunction(v1, v2) {\r\n      return v1[this.thread.x] / v2[this.thread.x];\r\n    }\r\n    const kernel = new this(kernelFunction.toString(), {\r\n      context: this.testContext,\r\n      canvas: this.testCanvas,\r\n      validate: false,\r\n      output: [2],\r\n      returnType: 'Number',\r\n      precision: 'unsigned',\r\n      tactic: 'speed',\r\n    });\r\n    const args = [\r\n      [6, 6030401],\r\n      [3, 3991]\r\n    ];\r\n    kernel.build.apply(kernel, args);\r\n    kernel.run.apply(kernel, args);\r\n    const result = kernel.renderOutput();\r\n    kernel.destroy(true);\r\n    // have we not got whole numbers for 6/3 or 6030401/3991\r\n    // add more here if others see this problem\r\n    return result[0] === 2 && result[1] === 1511;\r\n  }\r\n\r\n  /**\r\n   * @abstract\r\n   */\r\n  static get testCanvas() {\r\n    throw new Error(`\"testCanvas\" not defined on ${ this.name }`);\r\n  }\r\n\r\n  /**\r\n   * @abstract\r\n   */\r\n  static get testContext() {\r\n    throw new Error(`\"testContext\" not defined on ${ this.name }`);\r\n  }\r\n\r\n  /**\r\n   * @type {IKernelFeatures}\r\n   */\r\n  static get features() {\r\n    throw new Error(`\"features\" not defined on ${ this.name }`);\r\n  }\r\n\r\n  /**\r\n   * @abstract\r\n   */\r\n  static setupFeatureChecks() {\r\n    throw new Error(`\"setupFeatureChecks\" not defined on ${ this.name }`);\r\n  }\r\n\r\n  /**\r\n   * @desc Fix division by factor of 3 FP accuracy bug\r\n   * @param {Boolean} fix - should fix\r\n   */\r\n  setFixIntegerDivisionAccuracy(fix) {\r\n    this.fixIntegerDivisionAccuracy = fix;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * @desc Toggle output mode\r\n   * @param {String} flag - 'single' or 'unsigned'\r\n   */\r\n  setPrecision(flag) {\r\n    this.precision = flag;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * @desc Toggle texture output mode\r\n   * @param {Boolean} flag - true to enable floatTextures\r\n   * @deprecated\r\n   */\r\n  setFloatTextures(flag) {\r\n    utils.warnDeprecated('method', 'setFloatTextures', 'setOptimizeFloatMemory');\r\n    this.floatTextures = flag;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * A highly readable very forgiving micro-parser for a glsl function that gets argument types\r\n   * @param {String} source\r\n   * @returns {{argumentTypes: String[], argumentNames: String[]}}\r\n   */\r\n  static nativeFunctionArguments(source) {\r\n    const argumentTypes = [];\r\n    const argumentNames = [];\r\n    const states = [];\r\n    const isStartingVariableName = /^[a-zA-Z_]/;\r\n    const isVariableChar = /[a-zA-Z_0-9]/;\r\n    let i = 0;\r\n    let argumentName = null;\r\n    let argumentType = null;\r\n    while (i < source.length) {\r\n      const char = source[i];\r\n      const nextChar = source[i + 1];\r\n      const state = states.length > 0 ? states[states.length - 1] : null;\r\n\r\n      // begin MULTI_LINE_COMMENT handling\r\n      if (state === 'FUNCTION_ARGUMENTS' && char === '/' && nextChar === '*') {\r\n        states.push('MULTI_LINE_COMMENT');\r\n        i += 2;\r\n        continue;\r\n      } else if (state === 'MULTI_LINE_COMMENT' && char === '*' && nextChar === '/') {\r\n        states.pop();\r\n        i += 2;\r\n        continue;\r\n      }\r\n      // end MULTI_LINE_COMMENT handling\r\n\r\n      // begin COMMENT handling\r\n      else if (state === 'FUNCTION_ARGUMENTS' && char === '/' && nextChar === '/') {\r\n        states.push('COMMENT');\r\n        i += 2;\r\n        continue;\r\n      } else if (state === 'COMMENT' && char === '\\n') {\r\n        states.pop();\r\n        i++;\r\n        continue;\r\n      }\r\n      // end COMMENT handling\r\n\r\n      // being FUNCTION_ARGUMENTS handling\r\n      else if (state === null && char === '(') {\r\n        states.push('FUNCTION_ARGUMENTS');\r\n        i++;\r\n        continue;\r\n      } else if (state === 'FUNCTION_ARGUMENTS') {\r\n        if (char === ')') {\r\n          states.pop();\r\n          break;\r\n        }\r\n        if (char === 'f' && nextChar === 'l' && source[i + 2] === 'o' && source[i + 3] === 'a' && source[i + 4] === 't' && source[i + 5] === ' ') {\r\n          states.push('DECLARE_VARIABLE');\r\n          argumentType = 'float';\r\n          argumentName = '';\r\n          i += 6;\r\n          continue;\r\n        } else if (char === 'i' && nextChar === 'n' && source[i + 2] === 't' && source[i + 3] === ' ') {\r\n          states.push('DECLARE_VARIABLE');\r\n          argumentType = 'int';\r\n          argumentName = '';\r\n          i += 4;\r\n          continue;\r\n        } else if (char === 'v' && nextChar === 'e' && source[i + 2] === 'c' && source[i + 3] === '2' && source[i + 4] === ' ') {\r\n          states.push('DECLARE_VARIABLE');\r\n          argumentType = 'vec2';\r\n          argumentName = '';\r\n          i += 5;\r\n          continue;\r\n        } else if (char === 'v' && nextChar === 'e' && source[i + 2] === 'c' && source[i + 3] === '3' && source[i + 4] === ' ') {\r\n          states.push('DECLARE_VARIABLE');\r\n          argumentType = 'vec3';\r\n          argumentName = '';\r\n          i += 5;\r\n          continue;\r\n        } else if (char === 'v' && nextChar === 'e' && source[i + 2] === 'c' && source[i + 3] === '4' && source[i + 4] === ' ') {\r\n          states.push('DECLARE_VARIABLE');\r\n          argumentType = 'vec4';\r\n          argumentName = '';\r\n          i += 5;\r\n          continue;\r\n        }\r\n      }\r\n      // end FUNCTION_ARGUMENTS handling\r\n\r\n      // begin DECLARE_VARIABLE handling\r\n      else if (state === 'DECLARE_VARIABLE') {\r\n        if (argumentName === '') {\r\n          if (char === ' ') {\r\n            i++;\r\n            continue;\r\n          }\r\n          if (!isStartingVariableName.test(char)) {\r\n            throw new Error('variable name is not expected string');\r\n          }\r\n        }\r\n        argumentName += char;\r\n        if (!isVariableChar.test(nextChar)) {\r\n          states.pop();\r\n          argumentNames.push(argumentName);\r\n          argumentTypes.push(typeMap[argumentType]);\r\n        }\r\n      }\r\n      // end DECLARE_VARIABLE handling\r\n\r\n      // Progress to next character\r\n      i++;\r\n    }\r\n    if (states.length > 0) {\r\n      throw new Error('GLSL function was not parsable');\r\n    }\r\n    return {\r\n      argumentNames,\r\n      argumentTypes,\r\n    };\r\n  }\r\n\r\n  static nativeFunctionReturnType(source) {\r\n    return typeMap[source.match(/int|float|vec[2-4]/)[0]];\r\n  }\r\n\r\n  static combineKernels(combinedKernel, lastKernel) {\r\n    combinedKernel.apply(null, arguments);\r\n    const {\r\n      texSize,\r\n      context,\r\n      threadDim\r\n    } = lastKernel.texSize;\r\n    let result;\r\n    if (lastKernel.precision === 'single') {\r\n      const w = texSize[0];\r\n      const h = Math.ceil(texSize[1] / 4);\r\n      result = new Float32Array(w * h * 4 * 4);\r\n      context.readPixels(0, 0, w, h * 4, context.RGBA, context.FLOAT, result);\r\n    } else {\r\n      const bytes = new Uint8Array(texSize[0] * texSize[1] * 4);\r\n      context.readPixels(0, 0, texSize[0], texSize[1], context.RGBA, context.UNSIGNED_BYTE, bytes);\r\n      result = new Float32Array(bytes.buffer);\r\n    }\r\n\r\n    result = result.subarray(0, threadDim[0] * threadDim[1] * threadDim[2]);\r\n\r\n    if (lastKernel.output.length === 1) {\r\n      return result;\r\n    } else if (lastKernel.output.length === 2) {\r\n      return utils.splitArray(result, lastKernel.output[0]);\r\n    } else if (lastKernel.output.length === 3) {\r\n      const cube = utils.splitArray(result, lastKernel.output[0] * lastKernel.output[1]);\r\n      return cube.map(function(x) {\r\n        return utils.splitArray(x, lastKernel.output[0]);\r\n      });\r\n    }\r\n  }\r\n\r\n  constructor(source, settings) {\r\n    super(source, settings);\r\n    this.transferValues = null;\r\n    this.formatValues = null;\r\n    this.TextureConstructor = null;\r\n    this.renderOutput = null;\r\n    this.renderRawOutput = null;\r\n    this.texSize = null;\r\n    this.translatedSource = null;\r\n    this.renderStrategy = null;\r\n    this.compiledFragmentShader = null;\r\n    this.compiledVertexShader = null;\r\n  }\r\n\r\n  translateSource() {\r\n    throw new Error(`\"translateSource\" not defined on ${this.constructor.name}`);\r\n  }\r\n\r\n  /**\r\n   * Picks a render strategy for the now finally parsed kernel\r\n   * @param args\r\n   * @return {null|KernelOutput}\r\n   */\r\n  pickRenderStrategy(args) {\r\n    if (this.graphical) {\r\n      this.renderRawOutput = this.readPackedPixelsToUint8Array;\r\n      this.transferValues = (pixels) => pixels;\r\n      this.TextureConstructor = GLTextureGraphical;\r\n      return null;\r\n    }\r\n    if (this.precision === 'unsigned') {\r\n      this.renderRawOutput = this.readPackedPixelsToUint8Array;\r\n      this.transferValues = this.readPackedPixelsToFloat32Array;\r\n      if (this.pipeline) {\r\n        this.renderOutput = this.renderTexture;\r\n        if (this.subKernels !== null) {\r\n          this.renderKernels = this.renderKernelsToTextures;\r\n        }\r\n        switch (this.returnType) {\r\n          case 'LiteralInteger':\r\n          case 'Float':\r\n          case 'Number':\r\n          case 'Integer':\r\n            if (this.output[2] > 0) {\r\n              this.TextureConstructor = GLTextureUnsigned3D;\r\n              this.renderStrategy = renderStrategy.PackedPixelTo3DFloat;\r\n              return null;\r\n            } else if (this.output[1] > 0) {\r\n              this.TextureConstructor = GLTextureUnsigned2D;\r\n              this.renderStrategy = renderStrategy.PackedPixelTo2DFloat;\r\n              return null;\r\n            } else {\r\n              this.TextureConstructor = GLTextureUnsigned;\r\n              this.renderStrategy = renderStrategy.PackedPixelToFloat;\r\n              return null;\r\n            }\r\n            break;\r\n          case 'Array(2)':\r\n          case 'Array(3)':\r\n          case 'Array(4)':\r\n            return this.requestFallback(args);\r\n        }\r\n      } else {\r\n        if (this.subKernels !== null) {\r\n          this.renderKernels = this.renderKernelsToArrays;\r\n        }\r\n        switch (this.returnType) {\r\n          case 'LiteralInteger':\r\n          case 'Float':\r\n          case 'Number':\r\n          case 'Integer':\r\n            this.renderOutput = this.renderValues;\r\n            if (this.output[2] > 0) {\r\n              this.TextureConstructor = GLTextureUnsigned3D;\r\n              this.renderStrategy = renderStrategy.PackedPixelTo3DFloat;\r\n              this.formatValues = utils.erect3DPackedFloat;\r\n              return null;\r\n            } else if (this.output[1] > 0) {\r\n              this.TextureConstructor = GLTextureUnsigned2D;\r\n              this.renderStrategy = renderStrategy.PackedPixelTo2DFloat;\r\n              this.formatValues = utils.erect2DPackedFloat;\r\n              return null;\r\n            } else {\r\n              this.TextureConstructor = GLTextureUnsigned;\r\n              this.renderStrategy = renderStrategy.PackedPixelToFloat;\r\n              this.formatValues = utils.erectPackedFloat;\r\n              return null;\r\n            }\r\n\r\n            break;\r\n          case 'Array(2)':\r\n          case 'Array(3)':\r\n          case 'Array(4)':\r\n            return this.requestFallback(args);\r\n        }\r\n      }\r\n    } else if (this.precision === 'single') {\r\n      this.renderRawOutput = this.readFloatPixelsToFloat32Array;\r\n      this.transferValues = this.readFloatPixelsToFloat32Array;\r\n      if (this.pipeline) {\r\n        this.renderStrategy = renderStrategy.FloatTexture;\r\n        this.renderOutput = this.renderTexture;\r\n        if (this.subKernels !== null) {\r\n          this.renderKernels = this.renderKernelsToTextures;\r\n        }\r\n        switch (this.returnType) {\r\n          case 'LiteralInteger':\r\n          case 'Float':\r\n          case 'Number':\r\n          case 'Integer':\r\n            if (this.optimizeFloatMemory) {\r\n              if (this.output[2] > 0) {\r\n                this.TextureConstructor = GLTextureMemoryOptimized3D;\r\n                return null;\r\n              } else if (this.output[1] > 0) {\r\n                this.TextureConstructor = GLTextureMemoryOptimized2D;\r\n                return null;\r\n              } else {\r\n                this.TextureConstructor = GLTextureMemoryOptimized;\r\n                return null;\r\n              }\r\n            } else {\r\n              if (this.output[2] > 0) {\r\n                this.TextureConstructor = GLTextureFloat3D;\r\n                return null;\r\n              } else if (this.output[1] > 0) {\r\n                this.TextureConstructor = GLTextureFloat2D;\r\n                return null;\r\n              } else {\r\n                this.TextureConstructor = GLTextureFloat;\r\n                return null;\r\n              }\r\n            }\r\n            break;\r\n          case 'Array(2)':\r\n            if (this.output[2] > 0) {\r\n              this.TextureConstructor = GLTextureArray2Float3D;\r\n              return null;\r\n            } else if (this.output[1] > 0) {\r\n              this.TextureConstructor = GLTextureArray2Float2D;\r\n              return null;\r\n            } else {\r\n              this.TextureConstructor = GLTextureArray2Float;\r\n              return null;\r\n            }\r\n            break;\r\n          case 'Array(3)':\r\n            if (this.output[2] > 0) {\r\n              this.TextureConstructor = GLTextureArray3Float3D;\r\n              return null;\r\n            } else if (this.output[1] > 0) {\r\n              this.TextureConstructor = GLTextureArray3Float2D;\r\n              return null;\r\n            } else {\r\n              this.TextureConstructor = GLTextureArray3Float;\r\n              return null;\r\n            }\r\n            break;\r\n          case 'Array(4)':\r\n            if (this.output[2] > 0) {\r\n              this.TextureConstructor = GLTextureArray4Float3D;\r\n              return null;\r\n            } else if (this.output[1] > 0) {\r\n              this.TextureConstructor = GLTextureArray4Float2D;\r\n              return null;\r\n            } else {\r\n              this.TextureConstructor = GLTextureArray4Float;\r\n              return null;\r\n            }\r\n        }\r\n      }\r\n      this.renderOutput = this.renderValues;\r\n      if (this.subKernels !== null) {\r\n        this.renderKernels = this.renderKernelsToArrays;\r\n      }\r\n      if (this.optimizeFloatMemory) {\r\n        switch (this.returnType) {\r\n          case 'LiteralInteger':\r\n          case 'Float':\r\n          case 'Number':\r\n          case 'Integer':\r\n            if (this.output[2] > 0) {\r\n              this.TextureConstructor = GLTextureMemoryOptimized3D;\r\n              this.renderStrategy = renderStrategy.MemoryOptimizedFloatPixelToMemoryOptimized3DFloat;\r\n              this.formatValues = utils.erectMemoryOptimized3DFloat;\r\n              return null;\r\n            } else if (this.output[1] > 0) {\r\n              this.TextureConstructor = GLTextureMemoryOptimized2D;\r\n              this.renderStrategy = renderStrategy.MemoryOptimizedFloatPixelToMemoryOptimized2DFloat;\r\n              this.formatValues = utils.erectMemoryOptimized2DFloat;\r\n              return null;\r\n            } else {\r\n              this.TextureConstructor = GLTextureMemoryOptimized;\r\n              this.renderStrategy = renderStrategy.MemoryOptimizedFloatPixelToMemoryOptimizedFloat;\r\n              this.formatValues = utils.erectMemoryOptimizedFloat;\r\n              return null;\r\n            }\r\n            break;\r\n          case 'Array(2)':\r\n            if (this.output[2] > 0) {\r\n              this.TextureConstructor = GLTextureArray2Float3D;\r\n              this.renderStrategy = renderStrategy.FloatPixelTo3DArray2;\r\n              this.formatValues = utils.erect3DArray2;\r\n              return null;\r\n            } else if (this.output[1] > 0) {\r\n              this.TextureConstructor = GLTextureArray2Float2D;\r\n              this.renderStrategy = renderStrategy.FloatPixelTo2DArray2;\r\n              this.formatValues = utils.erect2DArray2;\r\n              return null;\r\n            } else {\r\n              this.TextureConstructor = GLTextureArray2Float;\r\n              this.renderStrategy = renderStrategy.FloatPixelToArray2;\r\n              this.formatValues = utils.erectArray2;\r\n              return null;\r\n            }\r\n            break;\r\n          case 'Array(3)':\r\n            if (this.output[2] > 0) {\r\n              this.TextureConstructor = GLTextureArray3Float3D;\r\n              this.renderStrategy = renderStrategy.FloatPixelTo3DArray3;\r\n              this.formatValues = utils.erect3DArray3;\r\n              return null;\r\n            } else if (this.output[1] > 0) {\r\n              this.TextureConstructor = GLTextureArray3Float2D;\r\n              this.renderStrategy = renderStrategy.FloatPixelTo2DArray3;\r\n              this.formatValues = utils.erect2DArray3;\r\n              return null;\r\n            } else {\r\n              this.TextureConstructor = GLTextureArray3Float;\r\n              this.renderStrategy = renderStrategy.FloatPixelToArray3;\r\n              this.formatValues = utils.erectArray3;\r\n              return null;\r\n            }\r\n            break;\r\n          case 'Array(4)':\r\n            if (this.output[2] > 0) {\r\n              this.TextureConstructor = GLTextureArray4Float3D;\r\n              this.renderStrategy = renderStrategy.FloatPixelTo3DArray4;\r\n              this.formatValues = utils.erect3DArray4;\r\n              return null;\r\n            } else if (this.output[1] > 0) {\r\n              this.TextureConstructor = GLTextureArray4Float2D;\r\n              this.renderStrategy = renderStrategy.FloatPixelTo2DArray4;\r\n              this.formatValues = utils.erect2DArray4;\r\n              return null;\r\n            } else {\r\n              this.TextureConstructor = GLTextureArray4Float;\r\n              this.renderStrategy = renderStrategy.FloatPixelToArray4;\r\n              this.formatValues = utils.erectArray4;\r\n              return null;\r\n            }\r\n        }\r\n      } else {\r\n        switch (this.returnType) {\r\n          case 'LiteralInteger':\r\n          case 'Float':\r\n          case 'Number':\r\n          case 'Integer':\r\n            if (this.output[2] > 0) {\r\n              this.TextureConstructor = GLTextureFloat3D;\r\n              this.renderStrategy = renderStrategy.FloatPixelTo3DFloat;\r\n              this.formatValues = utils.erect3DFloat;\r\n              return null;\r\n            } else if (this.output[1] > 0) {\r\n              this.TextureConstructor = GLTextureFloat2D;\r\n              this.renderStrategy = renderStrategy.FloatPixelTo2DFloat;\r\n              this.formatValues = utils.erect2DFloat;\r\n              return null;\r\n            } else {\r\n              this.TextureConstructor = GLTextureFloat;\r\n              this.renderStrategy = renderStrategy.FloatPixelToFloat;\r\n              this.formatValues = utils.erectFloat;\r\n              return null;\r\n            }\r\n            break;\r\n          case 'Array(2)':\r\n            if (this.output[2] > 0) {\r\n              this.TextureConstructor = GLTextureArray2Float3D;\r\n              this.renderStrategy = renderStrategy.FloatPixelTo3DArray2;\r\n              this.formatValues = utils.erect3DArray2;\r\n              return null;\r\n            } else if (this.output[1] > 0) {\r\n              this.TextureConstructor = GLTextureArray2Float2D;\r\n              this.renderStrategy = renderStrategy.FloatPixelTo2DArray2;\r\n              this.formatValues = utils.erect2DArray2;\r\n              return null;\r\n            } else {\r\n              this.TextureConstructor = GLTextureArray2Float;\r\n              this.renderStrategy = renderStrategy.FloatPixelToArray2;\r\n              this.formatValues = utils.erectArray2;\r\n              return null;\r\n            }\r\n            break;\r\n          case 'Array(3)':\r\n            if (this.output[2] > 0) {\r\n              this.TextureConstructor = GLTextureArray3Float3D;\r\n              this.renderStrategy = renderStrategy.FloatPixelTo3DArray3;\r\n              this.formatValues = utils.erect3DArray3;\r\n              return null;\r\n            } else if (this.output[1] > 0) {\r\n              this.TextureConstructor = GLTextureArray3Float2D;\r\n              this.renderStrategy = renderStrategy.FloatPixelTo2DArray3;\r\n              this.formatValues = utils.erect2DArray3;\r\n              return null;\r\n            } else {\r\n              this.TextureConstructor = GLTextureArray3Float;\r\n              this.renderStrategy = renderStrategy.FloatPixelToArray3;\r\n              this.formatValues = utils.erectArray3;\r\n              return null;\r\n            }\r\n            break;\r\n          case 'Array(4)':\r\n            if (this.output[2] > 0) {\r\n              this.TextureConstructor = GLTextureArray4Float3D;\r\n              this.renderStrategy = renderStrategy.FloatPixelTo3DArray4;\r\n              this.formatValues = utils.erect3DArray4;\r\n              return null;\r\n            } else if (this.output[1] > 0) {\r\n              this.TextureConstructor = GLTextureArray4Float2D;\r\n              this.renderStrategy = renderStrategy.FloatPixelTo2DArray4;\r\n              this.formatValues = utils.erect2DArray4;\r\n              return null;\r\n            } else {\r\n              this.TextureConstructor = GLTextureArray4Float;\r\n              this.renderStrategy = renderStrategy.FloatPixelToArray4;\r\n              this.formatValues = utils.erectArray4;\r\n              return null;\r\n            }\r\n        }\r\n      }\r\n    } else {\r\n      throw new Error(`unhandled precision of \"${this.precision}\"`);\r\n    }\r\n\r\n    throw new Error(`unhandled return type \"${this.returnType}\"`);\r\n  }\r\n\r\n  /**\r\n   * @abstract\r\n   * @returns String\r\n   */\r\n  getKernelString() {\r\n    throw new Error(`abstract method call`);\r\n  }\r\n\r\n  getMainResultTexture() {\r\n    switch (this.returnType) {\r\n      case 'LiteralInteger':\r\n      case 'Float':\r\n      case 'Integer':\r\n      case 'Number':\r\n        return this.getMainResultNumberTexture();\r\n      case 'Array(2)':\r\n        return this.getMainResultArray2Texture();\r\n      case 'Array(3)':\r\n        return this.getMainResultArray3Texture();\r\n      case 'Array(4)':\r\n        return this.getMainResultArray4Texture();\r\n      default:\r\n        throw new Error(`unhandled returnType type ${ this.returnType }`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @abstract\r\n   * @returns String[]\r\n   */\r\n  getMainResultKernelNumberTexture() {\r\n    throw new Error(`abstract method call`);\r\n  }\r\n  /**\r\n   * @abstract\r\n   * @returns String[]\r\n   */\r\n  getMainResultSubKernelNumberTexture() {\r\n    throw new Error(`abstract method call`);\r\n  }\r\n  /**\r\n   * @abstract\r\n   * @returns String[]\r\n   */\r\n  getMainResultKernelArray2Texture() {\r\n    throw new Error(`abstract method call`);\r\n  }\r\n  /**\r\n   * @abstract\r\n   * @returns String[]\r\n   */\r\n  getMainResultSubKernelArray2Texture() {\r\n    throw new Error(`abstract method call`);\r\n  }\r\n  /**\r\n   * @abstract\r\n   * @returns String[]\r\n   */\r\n  getMainResultKernelArray3Texture() {\r\n    throw new Error(`abstract method call`);\r\n  }\r\n  /**\r\n   * @abstract\r\n   * @returns String[]\r\n   */\r\n  getMainResultSubKernelArray3Texture() {\r\n    throw new Error(`abstract method call`);\r\n  }\r\n  /**\r\n   * @abstract\r\n   * @returns String[]\r\n   */\r\n  getMainResultKernelArray4Texture() {\r\n    throw new Error(`abstract method call`);\r\n  }\r\n  /**\r\n   * @abstract\r\n   * @returns String[]\r\n   */\r\n  getMainResultSubKernelArray4Texture() {\r\n    throw new Error(`abstract method call`);\r\n  }\r\n  /**\r\n   * @abstract\r\n   * @returns String[]\r\n   */\r\n  getMainResultGraphical() {\r\n    throw new Error(`abstract method call`);\r\n  }\r\n  /**\r\n   * @abstract\r\n   * @returns String[]\r\n   */\r\n  getMainResultMemoryOptimizedFloats() {\r\n    throw new Error(`abstract method call`);\r\n  }\r\n  /**\r\n   * @abstract\r\n   * @returns String[]\r\n   */\r\n  getMainResultPackedPixels() {\r\n    throw new Error(`abstract method call`);\r\n  }\r\n\r\n  getMainResultString() {\r\n    if (this.graphical) {\r\n      return this.getMainResultGraphical();\r\n    } else if (this.precision === 'single') {\r\n      if (this.optimizeFloatMemory) {\r\n        return this.getMainResultMemoryOptimizedFloats();\r\n      }\r\n      return this.getMainResultTexture();\r\n    } else {\r\n      return this.getMainResultPackedPixels();\r\n    }\r\n  }\r\n\r\n  getMainResultNumberTexture() {\r\n    return utils.linesToString(this.getMainResultKernelNumberTexture()) +\r\n      utils.linesToString(this.getMainResultSubKernelNumberTexture());\r\n  }\r\n\r\n  getMainResultArray2Texture() {\r\n    return utils.linesToString(this.getMainResultKernelArray2Texture()) +\r\n      utils.linesToString(this.getMainResultSubKernelArray2Texture());\r\n  }\r\n\r\n  getMainResultArray3Texture() {\r\n    return utils.linesToString(this.getMainResultKernelArray3Texture()) +\r\n      utils.linesToString(this.getMainResultSubKernelArray3Texture());\r\n  }\r\n\r\n  getMainResultArray4Texture() {\r\n    return utils.linesToString(this.getMainResultKernelArray4Texture()) +\r\n      utils.linesToString(this.getMainResultSubKernelArray4Texture());\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @return {string}\r\n   */\r\n  getFloatTacticDeclaration() {\r\n    switch (this.tactic) {\r\n      case 'speed':\r\n        return 'precision lowp float;\\n';\r\n      case 'performance':\r\n        return 'precision highp float;\\n';\r\n      case 'balanced':\r\n      default:\r\n        return 'precision mediump float;\\n';\r\n    }\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @return {string}\r\n   */\r\n  getIntTacticDeclaration() {\r\n    switch (this.tactic) {\r\n      case 'speed':\r\n        return 'precision lowp int;\\n';\r\n      case 'performance':\r\n        return 'precision highp int;\\n';\r\n      case 'balanced':\r\n      default:\r\n        return 'precision mediump int;\\n';\r\n    }\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @return {string}\r\n   */\r\n  getSampler2DTacticDeclaration() {\r\n    switch (this.tactic) {\r\n      case 'speed':\r\n        return 'precision lowp sampler2D;\\n';\r\n      case 'performance':\r\n        return 'precision highp sampler2D;\\n';\r\n      case 'balanced':\r\n      default:\r\n        return 'precision mediump sampler2D;\\n';\r\n    }\r\n  }\r\n\r\n  getSampler2DArrayTacticDeclaration() {\r\n    switch (this.tactic) {\r\n      case 'speed':\r\n        return 'precision lowp sampler2DArray;\\n';\r\n      case 'performance':\r\n        return 'precision highp sampler2DArray;\\n';\r\n      case 'balanced':\r\n      default:\r\n        return 'precision mediump sampler2DArray;\\n';\r\n    }\r\n  }\r\n\r\n  renderTexture() {\r\n    return new this.TextureConstructor({\r\n      texture: this.outputTexture,\r\n      size: this.texSize,\r\n      dimensions: this.threadDim,\r\n      output: this.output,\r\n      context: this.context,\r\n    });\r\n  }\r\n  readPackedPixelsToUint8Array() {\r\n    if (this.precision !== 'unsigned') throw new Error('Requires this.precision to be \"unsigned\"');\r\n    const {\r\n      texSize,\r\n      context: gl\r\n    } = this;\r\n    const result = new Uint8Array(texSize[0] * texSize[1] * 4);\r\n    gl.readPixels(0, 0, texSize[0], texSize[1], gl.RGBA, gl.UNSIGNED_BYTE, result);\r\n    return result;\r\n  }\r\n\r\n  readPackedPixelsToFloat32Array() {\r\n    return new Float32Array(this.readPackedPixelsToUint8Array().buffer);\r\n  }\r\n\r\n  readFloatPixelsToFloat32Array() {\r\n    if (this.precision !== 'single') throw new Error('Requires this.precision to be \"single\"');\r\n    const {\r\n      texSize,\r\n      context: gl\r\n    } = this;\r\n    const w = texSize[0];\r\n    const h = texSize[1];\r\n    const result = new Float32Array(w * h * 4);\r\n    gl.readPixels(0, 0, w, h, gl.RGBA, gl.FLOAT, result);\r\n    return result;\r\n  }\r\n\r\n  readMemoryOptimizedFloatPixelsToFloat32Array() {\r\n    if (this.precision !== 'single') throw new Error('Requires this.precision to be \"single\"');\r\n    const {\r\n      texSize,\r\n      context: gl\r\n    } = this;\r\n    const w = texSize[0];\r\n    const h = texSize[1];\r\n    const result = new Float32Array(w * h * 4);\r\n    gl.readPixels(0, 0, w, h, gl.RGBA, gl.FLOAT, result);\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @param {Boolean} [flip]\r\n   * @return {Uint8Array}\r\n   */\r\n  getPixels(flip) {\r\n    const {\r\n      context: gl,\r\n      output\r\n    } = this;\r\n    const [width, height] = output;\r\n    const pixels = new Uint8Array(width * height * 4);\r\n    gl.readPixels(0, 0, width, height, gl.RGBA, gl.UNSIGNED_BYTE, pixels);\r\n    // flipped by default, so invert\r\n    return new Uint8ClampedArray((flip ? pixels : utils.flipPixels(pixels, width, height)).buffer);\r\n  }\r\n\r\n  renderKernelsToArrays() {\r\n    const result = {\r\n      result: this.renderOutput(),\r\n    };\r\n    for (let i = 0; i < this.subKernels.length; i++) {\r\n      result[this.subKernels[i].property] = new this.TextureConstructor({\r\n        texture: this.subKernelOutputTextures[i],\r\n        size: this.texSize,\r\n        dimensions: this.threadDim,\r\n        output: this.output,\r\n        context: this.context,\r\n      }).toArray();\r\n    }\r\n    return result;\r\n  }\r\n\r\n  renderKernelsToTextures() {\r\n    const result = {\r\n      result: this.renderOutput(),\r\n    };\r\n    for (let i = 0; i < this.subKernels.length; i++) {\r\n      result[this.subKernels[i].property] = new this.TextureConstructor({\r\n        texture: this.subKernelOutputTextures[i],\r\n        size: this.texSize,\r\n        dimensions: this.threadDim,\r\n        output: this.output,\r\n        context: this.context,\r\n      });\r\n    }\r\n    return result;\r\n  }\r\n\r\n  setOutput(output) {\r\n    super.setOutput(output);\r\n    if (this.program) {\r\n      this.threadDim = [this.output[0], this.output[1] || 1, this.output[2] || 1];\r\n      this.texSize = utils.getKernelTextureSize({\r\n        optimizeFloatMemory: this.optimizeFloatMemory,\r\n        precision: this.precision,\r\n      }, this.output);\r\n      const { context: gl } = this;\r\n      gl.bindFramebuffer(gl.FRAMEBUFFER, this.framebuffer);\r\n      this.updateMaxTexSize();\r\n      this.framebuffer.width = this.texSize[0];\r\n      this.framebuffer.height = this.texSize[1];\r\n      this.context.viewport(0, 0, this.maxTexSize[0], this.maxTexSize[1]);\r\n      this.canvas.width = this.maxTexSize[0];\r\n      this.canvas.height = this.maxTexSize[1];\r\n      this._setupOutputTexture();\r\n      if (this.subKernels && this.subKernels.length > 0) {\r\n        this._setupSubOutputTextures();\r\n      }\r\n    }\r\n    return this;\r\n  }\r\n  renderValues() {\r\n    return this.formatValues(\r\n      this.transferValues(),\r\n      this.output[0],\r\n      this.output[1],\r\n      this.output[2]\r\n    );\r\n  }\r\n}\r\n\r\nexport const renderStrategy = Object.freeze({\r\n  PackedPixelToUint8Array: Symbol('PackedPixelToUint8Array'),\r\n  PackedPixelToFloat: Symbol('PackedPixelToFloat'),\r\n  PackedPixelTo2DFloat: Symbol('PackedPixelTo2DFloat'),\r\n  PackedPixelTo3DFloat: Symbol('PackedPixelTo3DFloat'),\r\n  PackedTexture: Symbol('PackedTexture'),\r\n  FloatPixelToFloat32Array: Symbol('FloatPixelToFloat32Array'),\r\n  FloatPixelToFloat: Symbol('FloatPixelToFloat'),\r\n  FloatPixelTo2DFloat: Symbol('FloatPixelTo2DFloat'),\r\n  FloatPixelTo3DFloat: Symbol('FloatPixelTo3DFloat'),\r\n  FloatPixelToArray2: Symbol('FloatPixelToArray2'),\r\n  FloatPixelTo2DArray2: Symbol('FloatPixelTo2DArray2'),\r\n  FloatPixelTo3DArray2: Symbol('FloatPixelTo3DArray2'),\r\n  FloatPixelToArray3: Symbol('FloatPixelToArray3'),\r\n  FloatPixelTo2DArray3: Symbol('FloatPixelTo2DArray3'),\r\n  FloatPixelTo3DArray3: Symbol('FloatPixelTo3DArray3'),\r\n  FloatPixelToArray4: Symbol('FloatPixelToArray4'),\r\n  FloatPixelTo2DArray4: Symbol('FloatPixelTo2DArray4'),\r\n  FloatPixelTo3DArray4: Symbol('FloatPixelTo3DArray4'),\r\n  FloatTexture: Symbol('FloatTexture'),\r\n  MemoryOptimizedFloatPixelToMemoryOptimizedFloat: Symbol('MemoryOptimizedFloatPixelToFloat'),\r\n  MemoryOptimizedFloatPixelToMemoryOptimized2DFloat: Symbol('MemoryOptimizedFloatPixelTo2DFloat'),\r\n  MemoryOptimizedFloatPixelToMemoryOptimized3DFloat: Symbol('MemoryOptimizedFloatPixelTo3DFloat'),\r\n});\r\n\r\nconst typeMap = {\r\n  int: 'Integer',\r\n  float: 'Number',\r\n  vec2: 'Array(2)',\r\n  vec3: 'Array(3)',\r\n  vec4: 'Array(4)',\r\n};\r\n","import { utils } from '../../utils';\r\nimport { FunctionNode } from '../function-node';\r\n// Closure capture for the ast function, prevent collision with existing AST functions\r\n// The prefixes to use\r\nconst jsMathPrefix = 'Math.';\r\nconst localPrefix = 'this.';\r\n\r\n/**\r\n * @desc [INTERNAL] Takes in a function node, and does all the AST voodoo required to toString its respective WebGL code\r\n * @extends FunctionNode\r\n * @returns the converted WebGL function string\r\n */\r\nexport class WebGLFunctionNode extends FunctionNode {\r\n  constructor(source, settings) {\r\n    super(source, settings);\r\n    if (settings && settings.hasOwnProperty('fixIntegerDivisionAccuracy')) {\r\n      this.fixIntegerDivisionAccuracy = settings.fixIntegerDivisionAccuracy;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @desc Parses the abstract syntax tree for to its *named function*\r\n   * @param {Object} ast - the AST object to parse\r\n   * @param {Array} retArr - return array string\r\n   * @returns {Array} the append retArr\r\n   */\r\n  astFunction(ast, retArr) {\r\n    // Setup function return type and name\r\n    if (this.isRootKernel) {\r\n      retArr.push('void');\r\n    } else {\r\n      // looking up return type, this is a little expensive, and can be avoided if returnType is set\r\n      let lastReturn = null;\r\n      if (!this.returnType) {\r\n        const lastReturn = this.findLastReturn();\r\n        if (lastReturn) {\r\n          this.returnType = this.getType(ast.body);\r\n          if (this.returnType === 'LiteralInteger') {\r\n            this.returnType = 'Number';\r\n          }\r\n        }\r\n      }\r\n\r\n      const { returnType } = this;\r\n      if (!returnType) {\r\n        retArr.push('void');\r\n      } else {\r\n        const type = typeMap[returnType];\r\n        if (!type) {\r\n          throw new Error(`unknown type ${returnType}`);\r\n        }\r\n        retArr.push(type);\r\n      }\r\n    }\r\n    retArr.push(' ');\r\n    retArr.push(this.name);\r\n    retArr.push('(');\r\n\r\n    if (!this.isRootKernel) {\r\n      // Arguments handling\r\n      for (let i = 0; i < this.argumentNames.length; ++i) {\r\n        const argumentName = this.argumentNames[i];\r\n\r\n        if (i > 0) {\r\n          retArr.push(', ');\r\n        }\r\n        let argumentType = this.argumentTypes[this.argumentNames.indexOf(argumentName)];\r\n        // The type is too loose ended, here we descide to solidify a type, lets go with float\r\n        if (!argumentType) {\r\n          throw this.astErrorOutput(`Unknown argument ${argumentName} type`, ast);\r\n        }\r\n        if (argumentType === 'LiteralInteger') {\r\n          this.argumentTypes[i] = argumentType = 'Number';\r\n        }\r\n        const type = typeMap[argumentType];\r\n        if (!type) {\r\n          throw this.astErrorOutput('Unexpected expression', ast);\r\n        }\r\n        retArr.push(type);\r\n        retArr.push(' ');\r\n        retArr.push('user_');\r\n        retArr.push(argumentName);\r\n      }\r\n    }\r\n\r\n    // Function opening\r\n    retArr.push(') {\\n');\r\n\r\n    // Body statement iteration\r\n    for (let i = 0; i < ast.body.body.length; ++i) {\r\n      this.astGeneric(ast.body.body[i], retArr);\r\n      retArr.push('\\n');\r\n    }\r\n\r\n    // Function closing\r\n    retArr.push('}\\n');\r\n    return retArr;\r\n  }\r\n\r\n  /**\r\n   * @desc Parses the abstract syntax tree for to *return* statement\r\n   * @param {Object} ast - the AST object to parse\r\n   * @param {Array} retArr - return array string\r\n   * @returns {Array} the append retArr\r\n   */\r\n  astReturnStatement(ast, retArr) {\r\n    if (!ast.argument) throw this.astErrorOutput('Unexpected return statement', ast);\r\n    this.pushState('skip-literal-correction');\r\n    const type = this.getType(ast.argument);\r\n    this.popState('skip-literal-correction');\r\n\r\n    const result = [];\r\n\r\n    if (!this.returnType) {\r\n      if (type === 'LiteralInteger' || type === 'Integer') {\r\n        this.returnType = 'Number';\r\n      } else {\r\n        this.returnType = type;\r\n      }\r\n    }\r\n\r\n    switch (this.returnType) {\r\n      case 'LiteralInteger':\r\n      case 'Number':\r\n      case 'Float':\r\n        switch (type) {\r\n          case 'Integer':\r\n            result.push('float(');\r\n            this.astGeneric(ast.argument, result);\r\n            result.push(')');\r\n            break;\r\n          case 'LiteralInteger':\r\n            this.castLiteralToFloat(ast.argument, result);\r\n\r\n            // Running astGeneric forces the LiteralInteger to pick a type, and here, if we are returning a float, yet\r\n            // the LiteralInteger has picked to be an integer because of constraints on it we cast it to float.\r\n            if (this.getType(ast) === 'Integer') {\r\n              result.unshift('float(');\r\n              result.push(')');\r\n            }\r\n            break;\r\n          default:\r\n            this.astGeneric(ast.argument, result);\r\n        }\r\n        break;\r\n      case 'Integer':\r\n        switch (type) {\r\n          case 'Float':\r\n          case 'Number':\r\n            this.castValueToInteger(ast.argument, result);\r\n            break;\r\n          case 'LiteralInteger':\r\n            this.castLiteralToInteger(ast.argument, result);\r\n            break;\r\n          default:\r\n            this.astGeneric(ast.argument, result);\r\n        }\r\n        break;\r\n      case 'Array(4)':\r\n      case 'Array(3)':\r\n      case 'Array(2)':\r\n      case 'Input':\r\n        this.astGeneric(ast.argument, result);\r\n        break;\r\n      default:\r\n        throw this.astErrorOutput(`unhandled return type ${this.returnType}`, ast);\r\n    }\r\n\r\n    if (this.isRootKernel) {\r\n      retArr.push(`kernelResult = ${ result.join('') };`);\r\n      retArr.push('return;');\r\n    } else if (this.isSubKernel) {\r\n      retArr.push(`subKernelResult_${ this.name } = ${ result.join('') };`);\r\n      retArr.push(`return subKernelResult_${ this.name };`);\r\n    } else {\r\n      retArr.push(`return ${ result.join('') };`);\r\n    }\r\n    return retArr;\r\n  }\r\n\r\n  /**\r\n   * @desc Parses the abstract syntax tree for *literal value*\r\n   *\r\n   * @param {Object} ast - the AST object to parse\r\n   * @param {Array} retArr - return array string\r\n   *\r\n   * @returns {Array} the append retArr\r\n   */\r\n  astLiteral(ast, retArr) {\r\n    // Reject non numeric literals\r\n    if (isNaN(ast.value)) {\r\n      throw this.astErrorOutput(\r\n        'Non-numeric literal not supported : ' + ast.value,\r\n        ast\r\n      );\r\n    }\r\n\r\n    const key = `${ast.start},${ast.end}`;\r\n    if (Number.isInteger(ast.value)) {\r\n      if (this.isState('in-for-loop-init') || this.isState('casting-to-integer') || this.isState('building-integer')) {\r\n        this.literalTypes[key] = 'Integer';\r\n        retArr.push(`${ast.value}`);\r\n      } else if (this.isState('casting-to-float') || this.isState('building-float')) {\r\n        this.literalTypes[key] = 'Number';\r\n        retArr.push(`${ast.value}.0`);\r\n      } else {\r\n        this.literalTypes[key] = 'Number';\r\n        retArr.push(`${ast.value}.0`);\r\n      }\r\n    } else if (this.isState('casting-to-integer') || this.isState('building-integer')) {\r\n      this.literalTypes[key] = 'Integer';\r\n      retArr.push(Math.round(ast.value));\r\n    } else {\r\n      this.literalTypes[key] = 'Number';\r\n      retArr.push(`${ast.value}`);\r\n    }\r\n    return retArr;\r\n  }\r\n\r\n  /**\r\n   * @desc Parses the abstract syntax tree for *binary* expression\r\n   * @param {Object} ast - the AST object to parse\r\n   * @param {Array} retArr - return array string\r\n   * @returns {Array} the append retArr\r\n   */\r\n  astBinaryExpression(ast, retArr) {\r\n    if (this.checkAndUpconvertOperator(ast, retArr)) {\r\n      return retArr;\r\n    }\r\n\r\n    if (this.fixIntegerDivisionAccuracy && ast.operator === '/') {\r\n      retArr.push('div_with_int_check(');\r\n      this.pushState('building-float');\r\n      switch (this.getType(ast.left)) {\r\n        case 'Integer':\r\n          this.castValueToFloat(ast.left, retArr);\r\n          break;\r\n        case 'LiteralInteger':\r\n          this.castLiteralToFloat(ast.left, retArr);\r\n          break;\r\n        default:\r\n          this.astGeneric(ast.left, retArr);\r\n      }\r\n      retArr.push(', ');\r\n      switch (this.getType(ast.right)) {\r\n        case 'Integer':\r\n          this.castValueToFloat(ast.right, retArr);\r\n          break;\r\n        case 'LiteralInteger':\r\n          this.castLiteralToFloat(ast.right, retArr);\r\n          break;\r\n        default:\r\n          this.astGeneric(ast.right, retArr);\r\n      }\r\n      this.popState('building-float');\r\n      retArr.push(')');\r\n      return retArr;\r\n    }\r\n\r\n    retArr.push('(');\r\n    const leftType = this.getType(ast.left) || 'Number';\r\n    const rightType = this.getType(ast.right) || 'Number';\r\n    if (!leftType || !rightType) {\r\n      throw this.astErrorOutput(`Unhandled binary expression`, ast);\r\n    }\r\n    const key = leftType + ' & ' + rightType;\r\n    switch (key) {\r\n      case 'Integer & Integer':\r\n        this.pushState('building-integer');\r\n        this.astGeneric(ast.left, retArr);\r\n        retArr.push(operatorMap[ast.operator] || ast.operator);\r\n        this.astGeneric(ast.right, retArr);\r\n        this.popState('building-integer');\r\n        break;\r\n      case 'Number & Float':\r\n      case 'Float & Number':\r\n      case 'Float & Float':\r\n      case 'Number & Number':\r\n        this.pushState('building-float');\r\n        this.astGeneric(ast.left, retArr);\r\n        retArr.push(operatorMap[ast.operator] || ast.operator);\r\n        this.astGeneric(ast.right, retArr);\r\n        this.popState('building-float');\r\n        break;\r\n      case 'LiteralInteger & LiteralInteger':\r\n        if (this.isState('casting-to-integer') || this.isState('building-integer')) {\r\n          this.pushState('building-integer');\r\n          this.astGeneric(ast.left, retArr);\r\n          retArr.push(operatorMap[ast.operator] || ast.operator);\r\n          this.astGeneric(ast.right, retArr);\r\n          this.popState('building-integer');\r\n        } else {\r\n          this.pushState('building-float');\r\n          this.castLiteralToFloat(ast.left, retArr);\r\n          retArr.push(operatorMap[ast.operator] || ast.operator);\r\n          this.castLiteralToFloat(ast.right, retArr);\r\n          this.popState('building-float');\r\n        }\r\n        break;\r\n\r\n      case 'Integer & Float':\r\n      case 'Integer & Number':\r\n        if (ast.operator === '>' || ast.operator === '<' && ast.right.type === 'Literal') {\r\n          // if right value is actually a float, don't loose that information, cast left to right rather than the usual right to left\r\n          if (!Number.isInteger(ast.right.value)) {\r\n            this.pushState('building-float');\r\n            this.castValueToFloat(ast.left, retArr);\r\n            retArr.push(operatorMap[ast.operator] || ast.operator);\r\n            this.astGeneric(ast.right, retArr);\r\n            this.popState('building-float');\r\n            break;\r\n          }\r\n        }\r\n        this.pushState('building-integer');\r\n        this.astGeneric(ast.left, retArr);\r\n        retArr.push(operatorMap[ast.operator] || ast.operator);\r\n        this.pushState('casting-to-integer');\r\n        if (ast.right.type === 'Literal') {\r\n          const literalResult = [];\r\n          this.astGeneric(ast.right, literalResult);\r\n          const literalType = this.getType(ast.right);\r\n          if (literalType === 'Integer') {\r\n            retArr.push(literalResult.join(''));\r\n          } else {\r\n            throw this.astErrorOutput(`Unhandled binary expression with literal`, ast);\r\n          }\r\n        } else {\r\n          retArr.push('int(');\r\n          this.astGeneric(ast.right, retArr);\r\n          retArr.push(')');\r\n        }\r\n        this.popState('casting-to-integer');\r\n        this.popState('building-integer');\r\n        break;\r\n      case 'Integer & LiteralInteger':\r\n        this.pushState('building-integer');\r\n        this.astGeneric(ast.left, retArr);\r\n        retArr.push(operatorMap[ast.operator] || ast.operator);\r\n        this.castLiteralToInteger(ast.right, retArr);\r\n        this.popState('building-integer');\r\n        break;\r\n\r\n      case 'Number & Integer':\r\n        this.pushState('building-float');\r\n        this.astGeneric(ast.left, retArr);\r\n        retArr.push(operatorMap[ast.operator] || ast.operator);\r\n        this.castValueToFloat(ast.right, retArr);\r\n        this.popState('building-float');\r\n        break;\r\n      case 'Float & LiteralInteger':\r\n      case 'Number & LiteralInteger':\r\n        if (this.isState('in-for-loop-test')) {\r\n          this.pushState('building-integer');\r\n          retArr.push('int(');\r\n          this.astGeneric(ast.left, retArr);\r\n          retArr.push(')');\r\n          retArr.push(operatorMap[ast.operator] || ast.operator);\r\n          this.castLiteralToInteger(ast.right, retArr);\r\n          this.popState('building-integer');\r\n        } else {\r\n          this.pushState('building-float');\r\n          this.astGeneric(ast.left, retArr);\r\n          retArr.push(operatorMap[ast.operator] || ast.operator);\r\n          this.castLiteralToFloat(ast.right, retArr);\r\n          this.popState('building-float');\r\n        }\r\n        break;\r\n      case 'LiteralInteger & Float':\r\n      case 'LiteralInteger & Number':\r\n        if (this.isState('in-for-loop-test') || this.isState('in-for-loop-init') || this.isState('casting-to-integer')) {\r\n          this.pushState('building-integer');\r\n          this.castLiteralToInteger(ast.left, retArr);\r\n          retArr.push(operatorMap[ast.operator] || ast.operator);\r\n          this.castValueToInteger(ast.right, retArr);\r\n          this.popState('building-integer');\r\n        } else {\r\n          this.pushState('building-float');\r\n          this.astGeneric(ast.left, retArr);\r\n          retArr.push(operatorMap[ast.operator] || ast.operator);\r\n          this.pushState('casting-to-float');\r\n          this.astGeneric(ast.right, retArr);\r\n          this.popState('casting-to-float');\r\n          this.popState('building-float');\r\n        }\r\n        break;\r\n      case 'LiteralInteger & Integer':\r\n        this.pushState('building-integer');\r\n        this.castLiteralToInteger(ast.left, retArr);\r\n        retArr.push(operatorMap[ast.operator] || ast.operator);\r\n        this.astGeneric(ast.right, retArr);\r\n        this.popState('building-integer');\r\n        break;\r\n\r\n      case 'Boolean & Boolean':\r\n        this.pushState('building-boolean');\r\n        this.astGeneric(ast.left, retArr);\r\n        retArr.push(operatorMap[ast.operator] || ast.operator);\r\n        this.astGeneric(ast.right, retArr);\r\n        this.popState('building-boolean');\r\n        break;\r\n\r\n      case 'Float & Integer':\r\n        this.pushState('building-float');\r\n        this.astGeneric(ast.left, retArr);\r\n        retArr.push(operatorMap[ast.operator] || ast.operator);\r\n        this.castValueToFloat(ast.right, retArr);\r\n        this.popState('building-float');\r\n        break;\r\n\r\n      default:\r\n        throw this.astErrorOutput(`Unhandled binary expression between ${key}`, ast);\r\n    }\r\n    retArr.push(')');\r\n\r\n    return retArr;\r\n  }\r\n\r\n  checkAndUpconvertOperator(ast, retArr) {\r\n    const bitwiseResult = this.checkAndUpconvertBitwiseOperators(ast, retArr);\r\n    if (bitwiseResult) {\r\n      return bitwiseResult;\r\n    }\r\n    const upconvertableOperators = {\r\n      '%': 'mod',\r\n      '**': 'pow',\r\n    };\r\n    const foundOperator = upconvertableOperators[ast.operator];\r\n    if (!foundOperator) return null;\r\n    retArr.push(foundOperator);\r\n    retArr.push('(');\r\n    switch (this.getType(ast.left)) {\r\n      case 'Integer':\r\n        this.castValueToFloat(ast.left, retArr);\r\n        break;\r\n      case 'LiteralInteger':\r\n        this.castLiteralToFloat(ast.left, retArr);\r\n        break;\r\n      default:\r\n        this.astGeneric(ast.left, retArr);\r\n    }\r\n    retArr.push(',');\r\n    switch (this.getType(ast.right)) {\r\n      case 'Integer':\r\n        this.castValueToFloat(ast.right, retArr);\r\n        break;\r\n      case 'LiteralInteger':\r\n        this.castLiteralToFloat(ast.right, retArr);\r\n        break;\r\n      default:\r\n        this.astGeneric(ast.right, retArr);\r\n    }\r\n    retArr.push(')');\r\n    return retArr;\r\n  }\r\n\r\n  checkAndUpconvertBitwiseOperators(ast, retArr) {\r\n    const upconvertableOperators = {\r\n      '&': 'bitwiseAnd',\r\n      '|': 'bitwiseOr',\r\n      '^': 'bitwiseXOR',\r\n      '<<': 'bitwiseZeroFillLeftShift',\r\n      '>>': 'bitwiseSignedRightShift',\r\n      '>>>': 'bitwiseZeroFillRightShift',\r\n    };\r\n    const foundOperator = upconvertableOperators[ast.operator];\r\n    if (!foundOperator) return null;\r\n    retArr.push(foundOperator);\r\n    retArr.push('(');\r\n    const leftType = this.getType(ast.left);\r\n    switch (leftType) {\r\n      case 'Number':\r\n      case 'Float':\r\n        this.castValueToInteger(ast.left, retArr);\r\n        break;\r\n      case 'LiteralInteger':\r\n        this.castLiteralToInteger(ast.left, retArr);\r\n        break;\r\n      default:\r\n        this.astGeneric(ast.left, retArr);\r\n    }\r\n    retArr.push(',');\r\n    const rightType = this.getType(ast.right);\r\n    switch (rightType) {\r\n      case 'Number':\r\n      case 'Float':\r\n        this.castValueToInteger(ast.right, retArr);\r\n        break;\r\n      case 'LiteralInteger':\r\n        this.castLiteralToInteger(ast.right, retArr);\r\n        break;\r\n      default:\r\n        this.astGeneric(ast.right, retArr);\r\n    }\r\n    retArr.push(')');\r\n    return retArr;\r\n  }\r\n\r\n  checkAndUpconvertBitwiseUnary(ast, retArr) {\r\n    const upconvertableOperators = {\r\n      '~': 'bitwiseNot',\r\n    };\r\n    const foundOperator = upconvertableOperators[ast.operator];\r\n    if (!foundOperator) return null;\r\n    retArr.push(foundOperator);\r\n    retArr.push('(');\r\n    switch (this.getType(ast.argument)) {\r\n      case 'Number':\r\n      case 'Float':\r\n        this.castValueToInteger(ast.argument, retArr);\r\n        break;\r\n      case 'LiteralInteger':\r\n        this.castLiteralToInteger(ast.argument, retArr);\r\n        break;\r\n      default:\r\n        this.astGeneric(ast.argument, retArr);\r\n    }\r\n    retArr.push(')');\r\n    return retArr;\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @param {Object} ast\r\n   * @param {Array} retArr\r\n   * @return {String[]}\r\n   */\r\n  castLiteralToInteger(ast, retArr) {\r\n    this.pushState('casting-to-integer');\r\n    this.astGeneric(ast, retArr);\r\n    this.popState('casting-to-integer');\r\n    return retArr;\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @param {Object} ast\r\n   * @param {Array} retArr\r\n   * @return {String[]}\r\n   */\r\n  castLiteralToFloat(ast, retArr) {\r\n    this.pushState('casting-to-float');\r\n    this.astGeneric(ast, retArr);\r\n    this.popState('casting-to-float');\r\n    return retArr;\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @param {Object} ast\r\n   * @param {Array} retArr\r\n   * @return {String[]}\r\n   */\r\n  castValueToInteger(ast, retArr) {\r\n    this.pushState('casting-to-integer');\r\n    retArr.push('int(');\r\n    this.astGeneric(ast, retArr);\r\n    retArr.push(')');\r\n    this.popState('casting-to-integer');\r\n    return retArr;\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @param {Object} ast\r\n   * @param {Array} retArr\r\n   * @return {String[]}\r\n   */\r\n  castValueToFloat(ast, retArr) {\r\n    this.pushState('casting-to-float');\r\n    retArr.push('float(');\r\n    this.astGeneric(ast, retArr);\r\n    retArr.push(')');\r\n    this.popState('casting-to-float');\r\n    return retArr;\r\n  }\r\n\r\n  /**\r\n   * @desc Parses the abstract syntax tree for *identifier* expression\r\n   * @param {Object} idtNode - An ast Node\r\n   * @param {Array} retArr - return array string\r\n   * @returns {Array} the append retArr\r\n   */\r\n  astIdentifierExpression(idtNode, retArr) {\r\n    if (idtNode.type !== 'Identifier') {\r\n      throw this.astErrorOutput('IdentifierExpression - not an Identifier', idtNode);\r\n    }\r\n\r\n    const type = this.getType(idtNode);\r\n\r\n    if (idtNode.name === 'Infinity') {\r\n      // https://stackoverflow.com/a/47543127/1324039\r\n      retArr.push('3.402823466e+38');\r\n    } else if (type === 'Boolean') {\r\n      if (this.argumentNames.indexOf(idtNode.name) > -1) {\r\n        retArr.push(`bool(user_${idtNode.name})`);\r\n      } else {\r\n        retArr.push(`user_${idtNode.name}`);\r\n      }\r\n    } else {\r\n      const userArgumentName = this.getKernelArgumentName(idtNode.name);\r\n      if (userArgumentName) {\r\n        retArr.push(`user_${userArgumentName}`);\r\n      } else {\r\n        retArr.push(`user_${idtNode.name}`);\r\n      }\r\n    }\r\n\r\n    return retArr;\r\n  }\r\n\r\n  /**\r\n   * @desc Parses the abstract syntax tree for *for-loop* expression\r\n   * @param {Object} forNode - An ast Node\r\n   * @param {Array} retArr - return array string\r\n   * @returns {Array} the parsed webgl string\r\n   */\r\n  astForStatement(forNode, retArr) {\r\n    if (forNode.type !== 'ForStatement') {\r\n      throw this.astErrorOutput('Invalid for statement', forNode);\r\n    }\r\n\r\n    const initArr = [];\r\n    const testArr = [];\r\n    const updateArr = [];\r\n    const bodyArr = [];\r\n    let isSafe = null;\r\n\r\n    if (forNode.init) {\r\n      this.pushState('in-for-loop-init');\r\n      this.astGeneric(forNode.init, initArr);\r\n      const { declarations } = forNode.init;\r\n      for (let i = 0; i < declarations.length; i++) {\r\n        if (declarations[i].init && declarations[i].init.type !== 'Literal') {\r\n          isSafe = false;\r\n        }\r\n      }\r\n      if (isSafe) {\r\n        for (let i = 0; i < initArr.length; i++) {\r\n          if (initArr[i].includes && initArr[i].includes(',')) {\r\n            isSafe = false;\r\n          }\r\n        }\r\n      }\r\n      this.popState('in-for-loop-init');\r\n    } else {\r\n      isSafe = false;\r\n    }\r\n\r\n    if (forNode.test) {\r\n      this.pushState('in-for-loop-test');\r\n      this.astGeneric(forNode.test, testArr);\r\n      this.popState('in-for-loop-test');\r\n    } else {\r\n      isSafe = false;\r\n    }\r\n\r\n    if (forNode.update) {\r\n      this.astGeneric(forNode.update, updateArr);\r\n    } else {\r\n      isSafe = false;\r\n    }\r\n\r\n    if (forNode.body) {\r\n      this.pushState('loop-body');\r\n      this.astGeneric(forNode.body, bodyArr);\r\n      this.popState('loop-body');\r\n    }\r\n\r\n    // have all parts, now make them safe\r\n    if (isSafe === null) {\r\n      isSafe = this.isSafe(forNode.init) && this.isSafe(forNode.test);\r\n    }\r\n\r\n    if (isSafe) {\r\n      retArr.push(`for (${initArr.join('')};${testArr.join('')};${updateArr.join('')}){\\n`);\r\n      retArr.push(bodyArr.join(''));\r\n      retArr.push('}\\n');\r\n    } else {\r\n      const iVariableName = this.getInternalVariableName('safeI');\r\n      if (initArr.length > 0) {\r\n        retArr.push(initArr.join(''), ';\\n');\r\n      }\r\n      retArr.push(`for (int ${iVariableName}=0;${iVariableName}<LOOP_MAX;${iVariableName}++){\\n`);\r\n      if (testArr.length > 0) {\r\n        retArr.push(`if (!${testArr.join('')}) break;\\n`);\r\n      }\r\n      retArr.push(bodyArr.join(''));\r\n      retArr.push(`\\n${updateArr.join('')};`);\r\n      retArr.push('}\\n');\r\n    }\r\n    return retArr;\r\n  }\r\n\r\n  /**\r\n   * @desc Parses the abstract syntax tree for *while* loop\r\n   * @param {Object} whileNode - An ast Node\r\n   * @param {Array} retArr - return array string\r\n   * @returns {Array} the parsed webgl string\r\n   */\r\n  astWhileStatement(whileNode, retArr) {\r\n    if (whileNode.type !== 'WhileStatement') {\r\n      throw this.astErrorOutput('Invalid while statement', whileNode);\r\n    }\r\n\r\n    const iVariableName = this.getInternalVariableName('safeI');\r\n    retArr.push(`for (int ${iVariableName}=0;${iVariableName}<LOOP_MAX;${iVariableName}++){\\n`);\r\n    retArr.push('if (!');\r\n    this.astGeneric(whileNode.test, retArr);\r\n    retArr.push(') break;\\n');\r\n    this.astGeneric(whileNode.body, retArr);\r\n    retArr.push('}\\n');\r\n\r\n    return retArr;\r\n  }\r\n\r\n  /**\r\n   * @desc Parses the abstract syntax tree for *do while* loop\r\n   * @param {Object} doWhileNode - An ast Node\r\n   * @param {Array} retArr - return array string\r\n   * @returns {Array} the parsed webgl string\r\n   */\r\n  astDoWhileStatement(doWhileNode, retArr) {\r\n    if (doWhileNode.type !== 'DoWhileStatement') {\r\n      throw this.astErrorOutput('Invalid while statement', doWhileNode);\r\n    }\r\n\r\n    const iVariableName = this.getInternalVariableName('safeI');\r\n    retArr.push(`for (int ${iVariableName}=0;${iVariableName}<LOOP_MAX;${iVariableName}++){\\n`);\r\n    this.astGeneric(doWhileNode.body, retArr);\r\n    retArr.push('if (!');\r\n    this.astGeneric(doWhileNode.test, retArr);\r\n    retArr.push(') break;\\n');\r\n    retArr.push('}\\n');\r\n\r\n    return retArr;\r\n  }\r\n\r\n\r\n  /**\r\n   * @desc Parses the abstract syntax tree for *Assignment* Expression\r\n   * @param {Object} assNode - An ast Node\r\n   * @param {Array} retArr - return array string\r\n   * @returns {Array} the append retArr\r\n   */\r\n  astAssignmentExpression(assNode, retArr) {\r\n    const declaration = this.getDeclaration(assNode.left);\r\n    if (declaration && !declaration.assignable) {\r\n      throw new this.astErrorOutput(`Variable ${assNode.left.name} is not assignable here`, assNode);\r\n    }\r\n    // TODO: casting needs implemented here\r\n    if (assNode.operator === '%=') {\r\n      this.astGeneric(assNode.left, retArr);\r\n      retArr.push('=');\r\n      retArr.push('mod(');\r\n      this.astGeneric(assNode.left, retArr);\r\n      retArr.push(',');\r\n      this.astGeneric(assNode.right, retArr);\r\n      retArr.push(')');\r\n    } else if (assNode.operator === '**=') {\r\n      this.astGeneric(assNode.left, retArr);\r\n      retArr.push('=');\r\n      retArr.push('pow(');\r\n      this.astGeneric(assNode.left, retArr);\r\n      retArr.push(',');\r\n      this.astGeneric(assNode.right, retArr);\r\n      retArr.push(')');\r\n    } else {\r\n      const leftType = this.getType(assNode.left);\r\n      const rightType = this.getType(assNode.right);\r\n      this.astGeneric(assNode.left, retArr);\r\n      retArr.push(assNode.operator);\r\n      if (leftType !== 'Integer' && rightType === 'Integer') {\r\n        retArr.push('float(');\r\n        this.astGeneric(assNode.right, retArr);\r\n        retArr.push(')');\r\n      } else {\r\n        this.astGeneric(assNode.right, retArr);\r\n      }\r\n      return retArr;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @desc Parses the abstract syntax tree for *Block* statement\r\n   * @param {Object} bNode - the AST object to parse\r\n   * @param {Array} retArr - return array string\r\n   * @returns {Array} the append retArr\r\n   */\r\n  astBlockStatement(bNode, retArr) {\r\n    if (this.isState('loop-body')) {\r\n      this.pushState('block-body'); // this prevents recursive removal of braces\r\n      for (let i = 0; i < bNode.body.length; i++) {\r\n        this.astGeneric(bNode.body[i], retArr);\r\n      }\r\n      this.popState('block-body');\r\n    } else {\r\n      retArr.push('{\\n');\r\n      for (let i = 0; i < bNode.body.length; i++) {\r\n        this.astGeneric(bNode.body[i], retArr);\r\n      }\r\n      retArr.push('}\\n');\r\n    }\r\n    return retArr;\r\n  }\r\n\r\n  /**\r\n   * @desc Parses the abstract syntax tree for *Variable Declaration*\r\n   * @param {Object} varDecNode - An ast Node\r\n   * @param {Array} retArr - return array string\r\n   * @returns {Array} the append retArr\r\n   */\r\n  astVariableDeclaration(varDecNode, retArr) {\r\n    if (varDecNode.kind === 'var' && this.warnVarUsage) {\r\n      this.varWarn();\r\n    }\r\n    const declarations = varDecNode.declarations;\r\n    if (!declarations || !declarations[0] || !declarations[0].init) {\r\n      throw this.astErrorOutput('Unexpected expression', varDecNode);\r\n    }\r\n    const result = [];\r\n    let lastType = null;\r\n    const inForLoopInit = this.isState('in-for-loop-init');\r\n    for (let i = 0; i < declarations.length; i++) {\r\n      const declaration = declarations[i];\r\n      const init = declaration.init;\r\n      const info = this.getDeclaration(declaration.id);\r\n      const valueType = info.valueType;\r\n      const actualType = this.getType(declaration.init);\r\n      let dependencies = info.dependencies;\r\n      let type = inForLoopInit ? 'Integer' : actualType;\r\n      if (type === 'LiteralInteger') {\r\n        // We had the choice to go either float or int, choosing float\r\n        type = 'Number';\r\n      }\r\n      const markupType = typeMap[type];\r\n      if (!markupType) {\r\n        throw this.astErrorOutput(`Markup type ${ markupType } not handled`, varDecNode);\r\n      }\r\n      const declarationResult = [];\r\n      if (actualType === 'Integer' && type === 'Integer' && !inForLoopInit) {\r\n        // Since we are assigning to a float, ensure valueType is reset to that\r\n        info.valueType = 'Number';\r\n        if (i === 0 || lastType === null) {\r\n          declarationResult.push('float ');\r\n        } else if (type !== lastType) {\r\n          throw new Error('Unhandled declaration');\r\n        } else {\r\n          declarationResult.push(',');\r\n        }\r\n        lastType = type;\r\n        declarationResult.push(`user_${declaration.id.name}=`);\r\n        declarationResult.push('float(');\r\n        this.astGeneric(init, declarationResult);\r\n        declarationResult.push(')');\r\n      } else {\r\n        // Since we are assigning to a float, ensure valueType is reset to that\r\n        info.valueType = type;\r\n        if (i === 0 || lastType === null) {\r\n          declarationResult.push(`${markupType} `);\r\n        } else if (type !== lastType) {\r\n          result.push(';');\r\n          declarationResult.push(`${markupType} `);\r\n        } else {\r\n          declarationResult.push(',');\r\n        }\r\n        lastType = type;\r\n        declarationResult.push(`user_${declaration.id.name}=`);\r\n        if (actualType === 'Number' && type === 'Integer') {\r\n          if (init.left && init.left.type === 'Literal') {\r\n            this.astGeneric(init, declarationResult);\r\n          } else {\r\n            declarationResult.push('int(');\r\n            this.astGeneric(init, declarationResult);\r\n            declarationResult.push(')');\r\n          }\r\n        } else {\r\n          this.astGeneric(init, declarationResult);\r\n        }\r\n      }\r\n      result.push(declarationResult.join(''));\r\n    }\r\n\r\n    retArr.push(result.join(''));\r\n    if (!inForLoopInit) {\r\n      retArr.push(';');\r\n    }\r\n    return retArr;\r\n  }\r\n\r\n  /**\r\n   * @desc Parses the abstract syntax tree for *If* Statement\r\n   * @param {Object} ifNode - An ast Node\r\n   * @param {Array} retArr - return array string\r\n   * @returns {Array} the append retArr\r\n   */\r\n  astIfStatement(ifNode, retArr) {\r\n    retArr.push('if (');\r\n    this.astGeneric(ifNode.test, retArr);\r\n    retArr.push(')');\r\n    if (ifNode.consequent.type === 'BlockStatement') {\r\n      this.astGeneric(ifNode.consequent, retArr);\r\n    } else {\r\n      retArr.push(' {\\n');\r\n      this.astGeneric(ifNode.consequent, retArr);\r\n      retArr.push('\\n}\\n');\r\n    }\r\n\r\n    if (ifNode.alternate) {\r\n      retArr.push('else ');\r\n      if (ifNode.alternate.type === 'BlockStatement') {\r\n        this.astGeneric(ifNode.alternate, retArr);\r\n      } else {\r\n        retArr.push(' {\\n');\r\n        this.astGeneric(ifNode.alternate, retArr);\r\n        retArr.push('\\n}\\n');\r\n      }\r\n    }\r\n    return retArr;\r\n  }\r\n\r\n  astSwitchStatement(ast, retArr) {\r\n    if (ast.type !== 'SwitchStatement') {\r\n      throw this.astErrorOutput('Invalid switch statement', ast);\r\n    }\r\n    const { discriminant, cases } = ast;\r\n    const type = this.getType(discriminant);\r\n    const varName = `switchDiscriminant${ast.start}_${ast.end}`;\r\n    switch (type) {\r\n      case 'Float':\r\n      case 'Number':\r\n        retArr.push(`float ${varName} = `);\r\n        this.astGeneric(discriminant, retArr);\r\n        retArr.push(';\\n');\r\n        break;\r\n      case 'Integer':\r\n        retArr.push(`int ${varName} = `);\r\n        this.astGeneric(discriminant, retArr);\r\n        retArr.push(';\\n');\r\n        break;\r\n    }\r\n    // switch with just a default:\r\n    if (cases.length === 1 && !cases[0].test) {\r\n      this.astGeneric(cases[0].consequent, retArr);\r\n      return retArr;\r\n    }\r\n\r\n    // regular switches:\r\n    let fallingThrough = false;\r\n    let defaultResult = [];\r\n    let movingDefaultToEnd = false;\r\n    let pastFirstIf = false;\r\n    for (let i = 0; i < cases.length; i++) {\r\n      // default\r\n      if (!cases[i].test) {\r\n        if (cases.length > i + 1) {\r\n          movingDefaultToEnd = true;\r\n          this.astGeneric(cases[i].consequent, defaultResult);\r\n          continue;\r\n        } else {\r\n          retArr.push(' else {\\n');\r\n        }\r\n      } else {\r\n        // all others\r\n        if (i === 0 || !pastFirstIf) {\r\n          pastFirstIf = true;\r\n          retArr.push(`if (${varName} == `);\r\n        } else {\r\n          if (fallingThrough) {\r\n            retArr.push(`${varName} == `);\r\n            fallingThrough = false;\r\n          } else {\r\n            retArr.push(` else if (${varName} == `);\r\n          }\r\n        }\r\n        if (type === 'Integer') {\r\n          const testType = this.getType(cases[i].test);\r\n          switch (testType) {\r\n            case 'Number':\r\n            case 'Float':\r\n              this.castValueToInteger(cases[i].test, retArr);\r\n              break;\r\n            case 'LiteralInteger':\r\n              this.castLiteralToInteger(cases[i].test, retArr);\r\n              break;\r\n          }\r\n        } else if (type === 'Float') {\r\n          const testType = this.getType(cases[i].test);\r\n          switch (testType) {\r\n            case 'LiteralInteger':\r\n              this.castLiteralToFloat(cases[i].test, retArr);\r\n              break;\r\n            case 'Integer':\r\n              this.castValueToFloat(cases[i].test, retArr);\r\n              break;\r\n          }\r\n        } else {\r\n          throw new Error('unhanlded');\r\n        }\r\n        if (!cases[i].consequent || cases[i].consequent.length === 0) {\r\n          fallingThrough = true;\r\n          retArr.push(' || ');\r\n          continue;\r\n        }\r\n        retArr.push(`) {\\n`);\r\n      }\r\n      this.astGeneric(cases[i].consequent, retArr);\r\n      retArr.push('\\n}');\r\n    }\r\n    if (movingDefaultToEnd) {\r\n      retArr.push(' else {');\r\n      retArr.push(defaultResult.join(''));\r\n      retArr.push('}');\r\n    }\r\n    return retArr;\r\n  }\r\n\r\n  /**\r\n   * @desc Parses the abstract syntax tree for *This* expression\r\n   * @param {Object} tNode - An ast Node\r\n   * @param {Array} retArr - return array string\r\n   * @returns {Array} the append retArr\r\n   */\r\n  astThisExpression(tNode, retArr) {\r\n    retArr.push('this');\r\n    return retArr;\r\n  }\r\n\r\n  /**\r\n   * @desc Parses the abstract syntax tree for *Member* Expression\r\n   * @param {Object} mNode - An ast Node\r\n   * @param {Array} retArr - return array string\r\n   * @returns {Array} the append retArr\r\n   */\r\n  astMemberExpression(mNode, retArr) {\r\n    const {\r\n      property,\r\n      name,\r\n      signature,\r\n      origin,\r\n      type,\r\n      xProperty,\r\n      yProperty,\r\n      zProperty\r\n    } = this.getMemberExpressionDetails(mNode);\r\n    switch (signature) {\r\n      case 'value.thread.value':\r\n      case 'this.thread.value':\r\n        if (name !== 'x' && name !== 'y' && name !== 'z') {\r\n          throw this.astErrorOutput('Unexpected expression, expected `this.thread.x`, `this.thread.y`, or `this.thread.z`', mNode);\r\n        }\r\n        retArr.push(`threadId.${name}`);\r\n        return retArr;\r\n      case 'this.output.value':\r\n        if (this.dynamicOutput) {\r\n          switch (name) {\r\n            case 'x':\r\n              if (this.isState('casting-to-float')) {\r\n                retArr.push('float(uOutputDim.x)');\r\n              } else {\r\n                retArr.push('uOutputDim.x');\r\n              }\r\n              break;\r\n            case 'y':\r\n              if (this.isState('casting-to-float')) {\r\n                retArr.push('float(uOutputDim.y)');\r\n              } else {\r\n                retArr.push('uOutputDim.y');\r\n              }\r\n              break;\r\n            case 'z':\r\n              if (this.isState('casting-to-float')) {\r\n                retArr.push('float(uOutputDim.z)');\r\n              } else {\r\n                retArr.push('uOutputDim.z');\r\n              }\r\n              break;\r\n            default:\r\n              throw this.astErrorOutput('Unexpected expression', mNode);\r\n          }\r\n        } else {\r\n          switch (name) {\r\n            case 'x':\r\n              if (this.isState('casting-to-integer')) {\r\n                retArr.push(this.output[0]);\r\n              } else {\r\n                retArr.push(this.output[0], '.0');\r\n              }\r\n              break;\r\n            case 'y':\r\n              if (this.isState('casting-to-integer')) {\r\n                retArr.push(this.output[1]);\r\n              } else {\r\n                retArr.push(this.output[1], '.0');\r\n              }\r\n              break;\r\n            case 'z':\r\n              if (this.isState('casting-to-integer')) {\r\n                retArr.push(this.output[2]);\r\n              } else {\r\n                retArr.push(this.output[2], '.0');\r\n              }\r\n              break;\r\n            default:\r\n              throw this.astErrorOutput('Unexpected expression', mNode);\r\n          }\r\n        }\r\n        return retArr;\r\n      case 'value':\r\n        throw this.astErrorOutput('Unexpected expression', mNode);\r\n      case 'value[]':\r\n      case 'value[][]':\r\n      case 'value[][][]':\r\n      case 'value[][][][]':\r\n      case 'value.value':\r\n        if (origin === 'Math') {\r\n          retArr.push(Math[name]);\r\n          return retArr;\r\n        }\r\n        switch (property) {\r\n          case 'r':\r\n            retArr.push(`user_${ name }.r`);\r\n            return retArr;\r\n          case 'g':\r\n            retArr.push(`user_${ name }.g`);\r\n            return retArr;\r\n          case 'b':\r\n            retArr.push(`user_${ name }.b`);\r\n            return retArr;\r\n          case 'a':\r\n            retArr.push(`user_${ name }.a`);\r\n            return retArr;\r\n        }\r\n        break;\r\n      case 'this.constants.value':\r\n        if (typeof xProperty === 'undefined') {\r\n          switch (type) {\r\n            case 'Array(2)':\r\n            case 'Array(3)':\r\n            case 'Array(4)':\r\n              retArr.push(`constants_${ name }`);\r\n              return retArr;\r\n          }\r\n        }\r\n        case 'this.constants.value[]':\r\n        case 'this.constants.value[][]':\r\n        case 'this.constants.value[][][]':\r\n        case 'this.constants.value[][][][]':\r\n          break;\r\n        case 'fn()[]':\r\n          this.astCallExpression(mNode.object, retArr);\r\n          retArr.push('[');\r\n          retArr.push(this.memberExpressionPropertyMarkup(property));\r\n          retArr.push(']');\r\n          return retArr;\r\n        case '[][]':\r\n          this.astArrayExpression(mNode.object, retArr);\r\n          retArr.push('[');\r\n          retArr.push(this.memberExpressionPropertyMarkup(property));\r\n          retArr.push(']');\r\n          return retArr;\r\n        default:\r\n          throw this.astErrorOutput('Unexpected expression', mNode);\r\n    }\r\n\r\n    if (mNode.computed === false) {\r\n      // handle simple types\r\n      switch (type) {\r\n        case 'Number':\r\n        case 'Integer':\r\n        case 'Float':\r\n        case 'Boolean':\r\n          retArr.push(`${origin}_${name}`);\r\n          return retArr;\r\n      }\r\n    }\r\n\r\n    // handle more complex types\r\n    // argument may have come from a parent\r\n    let synonymName = this.getKernelArgumentName(name);\r\n\r\n    const markupName = `${origin}_${synonymName || name}`;\r\n\r\n    switch (type) {\r\n      case 'Array(2)':\r\n      case 'Array(3)':\r\n      case 'Array(4)':\r\n        // Get from local vec4\r\n        this.astGeneric(mNode.object, retArr);\r\n        retArr.push('[');\r\n        retArr.push(this.memberExpressionPropertyMarkup(xProperty));\r\n        retArr.push(']');\r\n        break;\r\n      case 'HTMLImageArray':\r\n        retArr.push(`getImage3D(${ markupName }, ${ markupName }Size, ${ markupName }Dim, `);\r\n        this.memberExpressionXYZ(xProperty, yProperty, zProperty, retArr);\r\n        retArr.push(')');\r\n        break;\r\n      case 'ArrayTexture(1)':\r\n        retArr.push(`getFloatFromSampler2D(${ markupName }, ${ markupName }Size, ${ markupName }Dim, `);\r\n        this.memberExpressionXYZ(xProperty, yProperty, zProperty, retArr);\r\n        retArr.push(')');\r\n        break;\r\n      case 'Array1D(2)':\r\n      case 'Array2D(2)':\r\n      case 'Array3D(2)':\r\n        retArr.push(`getMemoryOptimizedVec2(${ markupName }, ${ markupName }Size, ${ markupName }Dim, `);\r\n        this.memberExpressionXYZ(xProperty, yProperty, zProperty, retArr);\r\n        retArr.push(')');\r\n        break;\r\n      case 'ArrayTexture(2)':\r\n        retArr.push(`getVec2FromSampler2D(${ markupName }, ${ markupName }Size, ${ markupName }Dim, `);\r\n        this.memberExpressionXYZ(xProperty, yProperty, zProperty, retArr);\r\n        retArr.push(')');\r\n        break;\r\n      case 'Array1D(3)':\r\n      case 'Array2D(3)':\r\n      case 'Array3D(3)':\r\n        retArr.push(`getMemoryOptimizedVec3(${ markupName }, ${ markupName }Size, ${ markupName }Dim, `);\r\n        this.memberExpressionXYZ(xProperty, yProperty, zProperty, retArr);\r\n        retArr.push(')');\r\n        break;\r\n      case 'ArrayTexture(3)':\r\n        retArr.push(`getVec3FromSampler2D(${ markupName }, ${ markupName }Size, ${ markupName }Dim, `);\r\n        this.memberExpressionXYZ(xProperty, yProperty, zProperty, retArr);\r\n        retArr.push(')');\r\n        break;\r\n      case 'Array1D(4)':\r\n      case 'Array2D(4)':\r\n      case 'Array3D(4)':\r\n        retArr.push(`getMemoryOptimizedVec4(${ markupName }, ${ markupName }Size, ${ markupName }Dim, `);\r\n        this.memberExpressionXYZ(xProperty, yProperty, zProperty, retArr);\r\n        retArr.push(')');\r\n        break;\r\n      case 'ArrayTexture(4)':\r\n      case 'HTMLImage':\r\n        retArr.push(`getVec4FromSampler2D(${ markupName }, ${ markupName }Size, ${ markupName }Dim, `);\r\n        this.memberExpressionXYZ(xProperty, yProperty, zProperty, retArr);\r\n        retArr.push(')');\r\n        break;\r\n      case 'NumberTexture':\r\n      case 'Array':\r\n      case 'Array2D':\r\n      case 'Array3D':\r\n      case 'Array4D':\r\n      case 'Input':\r\n      case 'Number':\r\n      case 'Float':\r\n      case 'Integer':\r\n        if (this.precision === 'single') {\r\n          // bitRatio is always 4 here, javascript doesn't yet have 8 or 16 bit support\r\n          // TODO: make 8 or 16 bit work anyway!\r\n          retArr.push(`getMemoryOptimized32(${markupName}, ${markupName}Size, ${markupName}Dim, `);\r\n          this.memberExpressionXYZ(xProperty, yProperty, zProperty, retArr);\r\n          retArr.push(')');\r\n        } else {\r\n          const bitRatio = (origin === 'user' ?\r\n            this.lookupFunctionArgumentBitRatio(this.name, name) :\r\n            this.constantBitRatios[name]\r\n          );\r\n          switch (bitRatio) {\r\n            case 1:\r\n              retArr.push(`get8(${markupName}, ${markupName}Size, ${markupName}Dim, `);\r\n              break;\r\n            case 2:\r\n              retArr.push(`get16(${markupName}, ${markupName}Size, ${markupName}Dim, `);\r\n              break;\r\n            case 4:\r\n            case 0:\r\n              retArr.push(`get32(${markupName}, ${markupName}Size, ${markupName}Dim, `);\r\n              break;\r\n            default:\r\n              throw new Error(`unhandled bit ratio of ${bitRatio}`);\r\n          }\r\n          this.memberExpressionXYZ(xProperty, yProperty, zProperty, retArr);\r\n          retArr.push(')');\r\n        }\r\n        break;\r\n      case 'MemoryOptimizedNumberTexture':\r\n        retArr.push(`getMemoryOptimized32(${ markupName }, ${ markupName }Size, ${ markupName }Dim, `);\r\n        this.memberExpressionXYZ(xProperty, yProperty, zProperty, retArr);\r\n        retArr.push(')');\r\n        break;\r\n      default:\r\n        throw new Error(`unhandled member expression \"${ type }\"`);\r\n    }\r\n    return retArr;\r\n  }\r\n\r\n  /**\r\n   * @desc Parses the abstract syntax tree for *call* expression\r\n   * @param {Object} ast - the AST object to parse\r\n   * @param {Array} retArr - return array string\r\n   * @returns  {Array} the append retArr\r\n   */\r\n  astCallExpression(ast, retArr) {\r\n    if (!ast.callee) {\r\n      throw this.astErrorOutput('Unknown CallExpression', ast);\r\n    }\r\n\r\n    let functionName = null;\r\n    const isMathFunction = this.isAstMathFunction(ast);\r\n\r\n    // Its a math operator or this.something(), remove the prefix\r\n    if (isMathFunction || (ast.callee.object && ast.callee.object.type === 'ThisExpression')) {\r\n      functionName = ast.callee.property.name;\r\n    }\r\n    // Issue #212, BABEL!\r\n    else if (ast.callee.type === 'SequenceExpression' && ast.callee.expressions[0].type === 'Literal' && !isNaN(ast.callee.expressions[0].raw)) {\r\n      functionName = ast.callee.expressions[1].property.name;\r\n    } else {\r\n      functionName = ast.callee.name;\r\n    }\r\n\r\n    if (!functionName) {\r\n      throw this.astErrorOutput(`Unhandled function, couldn't find name`, ast);\r\n    }\r\n\r\n    // if this if grows to more than one, lets use a switch\r\n    if (functionName === 'atan2') {\r\n      functionName = 'atan';\r\n    }\r\n\r\n    // Register the function into the called registry\r\n    if (this.calledFunctions.indexOf(functionName) < 0) {\r\n      this.calledFunctions.push(functionName);\r\n    }\r\n\r\n    if (functionName === 'random' && this.plugins && this.plugins.length > 0) {\r\n      for (let i = 0; i < this.plugins.length; i++) {\r\n        const plugin = this.plugins[i];\r\n        if (plugin.functionMatch === 'Math.random()' && plugin.functionReplace) {\r\n          retArr.push(plugin.functionReplace);\r\n          return retArr;\r\n        }\r\n      }\r\n    }\r\n\r\n    // track the function was called\r\n    if (this.onFunctionCall) {\r\n      this.onFunctionCall(this.name, functionName, ast.arguments);\r\n    }\r\n\r\n    // Call the function\r\n    retArr.push(functionName);\r\n\r\n    // Open arguments space\r\n    retArr.push('(');\r\n\r\n    // Add the arguments\r\n    if (isMathFunction) {\r\n      for (let i = 0; i < ast.arguments.length; ++i) {\r\n        const argument = ast.arguments[i];\r\n        const argumentType = this.getType(argument);\r\n        if (i > 0) {\r\n          retArr.push(', ');\r\n        }\r\n\r\n        switch (argumentType) {\r\n          case 'Integer':\r\n            this.castValueToFloat(argument, retArr);\r\n            break;\r\n          default:\r\n            this.astGeneric(argument, retArr);\r\n            break;\r\n        }\r\n      }\r\n    } else {\r\n      const targetTypes = this.lookupFunctionArgumentTypes(functionName) || [];\r\n      for (let i = 0; i < ast.arguments.length; ++i) {\r\n        const argument = ast.arguments[i];\r\n        let targetType = targetTypes[i];\r\n        if (i > 0) {\r\n          retArr.push(', ');\r\n        }\r\n        const argumentType = this.getType(argument);\r\n        if (!targetType) {\r\n          this.triggerImplyArgumentType(functionName, i, argumentType, this);\r\n          targetType = argumentType;\r\n        }\r\n        switch (argumentType) {\r\n          case 'Number':\r\n          case 'Float':\r\n            if (targetType === 'Integer') {\r\n              retArr.push('int(');\r\n              this.astGeneric(argument, retArr);\r\n              retArr.push(')');\r\n              continue;\r\n            } else if (targetType === 'Number' || targetType === 'Float') {\r\n              this.astGeneric(argument, retArr);\r\n              continue;\r\n            } else if (targetType === 'LiteralInteger') {\r\n              this.castLiteralToFloat(argument, retArr);\r\n              continue;\r\n            }\r\n            break;\r\n          case 'Integer':\r\n            if (targetType === 'Number' || targetType === 'Float') {\r\n              retArr.push('float(');\r\n              this.astGeneric(argument, retArr);\r\n              retArr.push(')');\r\n              continue;\r\n            } else if (targetType === 'Integer') {\r\n              this.astGeneric(argument, retArr);\r\n              continue;\r\n            }\r\n            break;\r\n          case 'LiteralInteger':\r\n            if (targetType === 'Integer') {\r\n              this.castLiteralToInteger(argument, retArr);\r\n              continue;\r\n            } else if (targetType === 'Number' || targetType === 'Float') {\r\n              this.castLiteralToFloat(argument, retArr);\r\n              continue;\r\n            } else if (targetType === 'LiteralInteger') {\r\n              this.astGeneric(argument, retArr);\r\n              continue;\r\n            }\r\n            break;\r\n          case 'Array(2)':\r\n          case 'Array(3)':\r\n          case 'Array(4)':\r\n            if (targetType === argumentType) {\r\n              this.astGeneric(argument, retArr);\r\n              continue;\r\n            }\r\n            break;\r\n          case 'ArrayTexture(1)':\r\n          case 'ArrayTexture(2)':\r\n          case 'ArrayTexture(3)':\r\n          case 'ArrayTexture(4)':\r\n          case 'Array':\r\n          case 'Input':\r\n            if (targetType === argumentType) {\r\n              this.triggerTrackArgumentSynonym(this.name, argument.name, functionName, i);\r\n              this.astGeneric(argument, retArr);\r\n              continue;\r\n            }\r\n            break;\r\n        }\r\n        throw this.astErrorOutput(`Unhandled argument combination of ${ argumentType } and ${ targetType } for argument named \"${ argument.name }\"`, ast);\r\n      }\r\n    }\r\n    // Close arguments space\r\n    retArr.push(')');\r\n\r\n    return retArr;\r\n  }\r\n\r\n  /**\r\n   * @desc Parses the abstract syntax tree for *Array* Expression\r\n   * @param {Object} arrNode - the AST object to parse\r\n   * @param {Array} retArr - return array string\r\n   * @returns {Array} the append retArr\r\n   */\r\n  astArrayExpression(arrNode, retArr) {\r\n    const arrLen = arrNode.elements.length;\r\n\r\n    retArr.push('vec' + arrLen + '(');\r\n    for (let i = 0; i < arrLen; ++i) {\r\n      if (i > 0) {\r\n        retArr.push(', ');\r\n      }\r\n      const subNode = arrNode.elements[i];\r\n      this.astGeneric(subNode, retArr)\r\n    }\r\n    retArr.push(')');\r\n\r\n    return retArr;\r\n  }\r\n\r\n  memberExpressionXYZ(x, y, z, retArr) {\r\n    if (z) {\r\n      retArr.push(this.memberExpressionPropertyMarkup(z), ', ');\r\n    } else {\r\n      retArr.push('0, ');\r\n    }\r\n    if (y) {\r\n      retArr.push(this.memberExpressionPropertyMarkup(y), ', ');\r\n    } else {\r\n      retArr.push('0, ');\r\n    }\r\n    retArr.push(this.memberExpressionPropertyMarkup(x));\r\n    return retArr;\r\n  }\r\n\r\n  memberExpressionPropertyMarkup(property) {\r\n    if (!property) {\r\n      throw new Error('Property not set');\r\n    }\r\n    const type = this.getType(property);\r\n    const result = [];\r\n    switch (type) {\r\n      case 'Number':\r\n      case 'Float':\r\n        this.castValueToInteger(property, result);\r\n        break;\r\n      case 'LiteralInteger':\r\n        this.castLiteralToInteger(property, result);\r\n        break;\r\n      default:\r\n        this.astGeneric(property, result);\r\n    }\r\n    return result.join('');\r\n  }\r\n}\r\n\r\nconst typeMap = {\r\n  'Array': 'sampler2D',\r\n  'Array(2)': 'vec2',\r\n  'Array(3)': 'vec3',\r\n  'Array(4)': 'vec4',\r\n  'Array2D': 'sampler2D',\r\n  'Array3D': 'sampler2D',\r\n  'Boolean': 'bool',\r\n  'Float': 'float',\r\n  'Input': 'sampler2D',\r\n  'Integer': 'int',\r\n  'Number': 'float',\r\n  'LiteralInteger': 'float',\r\n  'NumberTexture': 'sampler2D',\r\n  'MemoryOptimizedNumberTexture': 'sampler2D',\r\n  'ArrayTexture(1)': 'sampler2D',\r\n  'ArrayTexture(2)': 'sampler2D',\r\n  'ArrayTexture(3)': 'sampler2D',\r\n  'ArrayTexture(4)': 'sampler2D',\r\n};\r\n\r\nconst operatorMap = {\r\n  '===': '==',\r\n  '!==': '!='\r\n};\r\n","const source = `\r\n\r\nuniform highp float triangle_noise_seed;\r\nhighp float triangle_noise_shift = 0.000001;\r\n\r\n//https://www.shadertoy.com/view/4t2SDh\r\n//note: uniformly distributed, normalized rand, [0;1[\r\nfloat nrand( vec2 n )\r\n{\r\n  return fract(sin(dot(n.xy, vec2(12.9898, 78.233)))* 43758.5453);\r\n}\r\n//note: remaps v to [0;1] in interval [a;b]\r\nfloat remap( float a, float b, float v )\r\n{\r\n  return clamp( (v-a) / (b-a), 0.0, 1.0 );\r\n}\r\n\r\nfloat n4rand( vec2 n )\r\n{\r\n  float t = fract( triangle_noise_seed + triangle_noise_shift );\r\n  float nrnd0 = nrand( n + 0.07*t );\r\n  float nrnd1 = nrand( n + 0.11*t );\r\n  float nrnd2 = nrand( n + 0.13*t );\r\n  float nrnd3 = nrand( n + 0.17*t );\r\n  float result = (nrnd0+nrnd1+nrnd2+nrnd3) / 4.0;\r\n  triangle_noise_shift = result + 0.000001;\r\n  return result;\r\n}`;\r\n\r\nconst name = 'triangle-noise-noise';\r\n\r\nconst functionMatch = 'Math.random()';\r\n\r\nconst functionReplace = 'n4rand(vTexCoord)';\r\n\r\nconst functionReturnType = 'Number';\r\n\r\nconst onBeforeRun = (kernel) => {\r\n  kernel.setUniform1f('triangle_noise_seed', Math.random());\r\n};\r\n\r\n/**\r\n * @type IPlugin\r\n */\r\nexport default {\r\n  name,\r\n  onBeforeRun,\r\n  functionMatch,\r\n  functionReplace,\r\n  functionReturnType,\r\n  source\r\n};\r\n","// language=GLSL\r\nexport const fragmentShader = `__HEADER__;\r\n__FLOAT_TACTIC_DECLARATION__;\r\n__INT_TACTIC_DECLARATION__;\r\n__SAMPLER_2D_TACTIC_DECLARATION__;\r\n\r\nconst int LOOP_MAX = __LOOP_MAX__;\r\n\r\n__PLUGINS__;\r\n__CONSTANTS__;\r\n\r\nvarying vec2 vTexCoord;\r\n\r\nvec4 round(vec4 x) {\r\n  return floor(x + 0.5);\r\n}\r\n\r\nfloat round(float x) {\r\n  return floor(x + 0.5);\r\n}\r\n\r\nconst int BIT_COUNT = 32;\r\nint modi(int x, int y) {\r\n  return x - y * (x / y);\r\n}\r\n\r\nint bitwiseOr(int a, int b) {\r\n  int result = 0;\r\n  int n = 1;\r\n\r\n  for (int i = 0; i < BIT_COUNT; i++) {\r\n    if ((modi(a, 2) == 1) || (modi(b, 2) == 1)) {\r\n      result += n;\r\n    }\r\n    a = a / 2;\r\n    b = b / 2;\r\n    n = n * 2;\r\n    if(!(a > 0 || b > 0)) {\r\n      break;\r\n    }\r\n  }\r\n  return result;\r\n}\r\nint bitwiseXOR(int a, int b) {\r\n  int result = 0;\r\n  int n = 1;\r\n\r\n  for (int i = 0; i < BIT_COUNT; i++) {\r\n    if ((modi(a, 2) == 1) != (modi(b, 2) == 1)) {\r\n      result += n;\r\n    }\r\n    a = a / 2;\r\n    b = b / 2;\r\n    n = n * 2;\r\n    if(!(a > 0 || b > 0)) {\r\n      break;\r\n    }\r\n  }\r\n  return result;\r\n}\r\nint bitwiseAnd(int a, int b) {\r\n  int result = 0;\r\n  int n = 1;\r\n  for (int i = 0; i < BIT_COUNT; i++) {\r\n    if ((modi(a, 2) == 1) && (modi(b, 2) == 1)) {\r\n      result += n;\r\n    }\r\n    a = a / 2;\r\n    b = b / 2;\r\n    n = n * 2;\r\n    if(!(a > 0 && b > 0)) {\r\n      break;\r\n    }\r\n  }\r\n  return result;\r\n}\r\nint bitwiseNot(int a) {\r\n  int result = 0;\r\n  int n = 1;\r\n\r\n  for (int i = 0; i < BIT_COUNT; i++) {\r\n    if (modi(a, 2) == 0) {\r\n      result += n;\r\n    }\r\n    a = a / 2;\r\n    n = n * 2;\r\n  }\r\n  return result;\r\n}\r\nint bitwiseZeroFillLeftShift(int n, int shift) {\r\n  int maxBytes = BIT_COUNT;\r\n  for (int i = 0; i < BIT_COUNT; i++) {\r\n    if (maxBytes >= n) {\r\n      break;\r\n    }\r\n    maxBytes *= 2;\r\n  }\r\n  for (int i = 0; i < BIT_COUNT; i++) {\r\n    if (i >= shift) {\r\n      break;\r\n    }\r\n    n *= 2;\r\n  }\r\n\r\n  int result = 0;\r\n  int byteVal = 1;\r\n  for (int i = 0; i < BIT_COUNT; i++) {\r\n    if (i >= maxBytes) break;\r\n    if (modi(n, 2) > 0) { result += byteVal; }\r\n    n = int(n / 2);\r\n    byteVal *= 2;\r\n  }\r\n  return result;\r\n}\r\n\r\nint bitwiseSignedRightShift(int num, int shifts) {\r\n  return int(floor(float(num) / pow(2.0, float(shifts))));\r\n}\r\n\r\nint bitwiseZeroFillRightShift(int n, int shift) {\r\n  int maxBytes = BIT_COUNT;\r\n  for (int i = 0; i < BIT_COUNT; i++) {\r\n    if (maxBytes >= n) {\r\n      break;\r\n    }\r\n    maxBytes *= 2;\r\n  }\r\n  for (int i = 0; i < BIT_COUNT; i++) {\r\n    if (i >= shift) {\r\n      break;\r\n    }\r\n    n /= 2;\r\n  }\r\n  int result = 0;\r\n  int byteVal = 1;\r\n  for (int i = 0; i < BIT_COUNT; i++) {\r\n    if (i >= maxBytes) break;\r\n    if (modi(n, 2) > 0) { result += byteVal; }\r\n    n = int(n / 2);\r\n    byteVal *= 2;\r\n  }\r\n  return result;\r\n}\r\n\r\nvec2 integerMod(vec2 x, float y) {\r\n  vec2 res = floor(mod(x, y));\r\n  return res * step(1.0 - floor(y), -res);\r\n}\r\n\r\nvec3 integerMod(vec3 x, float y) {\r\n  vec3 res = floor(mod(x, y));\r\n  return res * step(1.0 - floor(y), -res);\r\n}\r\n\r\nvec4 integerMod(vec4 x, vec4 y) {\r\n  vec4 res = floor(mod(x, y));\r\n  return res * step(1.0 - floor(y), -res);\r\n}\r\n\r\nfloat integerMod(float x, float y) {\r\n  float res = floor(mod(x, y));\r\n  return res * (res > floor(y) - 1.0 ? 0.0 : 1.0);\r\n}\r\n\r\nint integerMod(int x, int y) {\r\n  return x - (y * int(x / y));\r\n}\r\n\r\n__DIVIDE_WITH_INTEGER_CHECK__;\r\n\r\n// Here be dragons!\r\n// DO NOT OPTIMIZE THIS CODE\r\n// YOU WILL BREAK SOMETHING ON SOMEBODY\\'S MACHINE\r\n// LEAVE IT AS IT IS, LEST YOU WASTE YOUR OWN TIME\r\nconst vec2 MAGIC_VEC = vec2(1.0, -256.0);\r\nconst vec4 SCALE_FACTOR = vec4(1.0, 256.0, 65536.0, 0.0);\r\nconst vec4 SCALE_FACTOR_INV = vec4(1.0, 0.00390625, 0.0000152587890625, 0.0); // 1, 1/256, 1/65536\r\nfloat decode32(vec4 texel) {\r\n  __DECODE32_ENDIANNESS__;\r\n  texel *= 255.0;\r\n  vec2 gte128;\r\n  gte128.x = texel.b >= 128.0 ? 1.0 : 0.0;\r\n  gte128.y = texel.a >= 128.0 ? 1.0 : 0.0;\r\n  float exponent = 2.0 * texel.a - 127.0 + dot(gte128, MAGIC_VEC);\r\n  float res = exp2(round(exponent));\r\n  texel.b = texel.b - 128.0 * gte128.x;\r\n  res = dot(texel, SCALE_FACTOR) * exp2(round(exponent-23.0)) + res;\r\n  res *= gte128.y * -2.0 + 1.0;\r\n  return res;\r\n}\r\n\r\nfloat decode16(vec4 texel, int index) {\r\n  int channel = integerMod(index, 2);\r\n  if (channel == 0) return texel.r * 255.0 + texel.g * 65280.0;\r\n  if (channel == 1) return texel.b * 255.0 + texel.a * 65280.0;\r\n  return 0.0;\r\n}\r\n\r\nfloat decode8(vec4 texel, int index) {\r\n  int channel = integerMod(index, 4);\r\n  if (channel == 0) return texel.r * 255.0;\r\n  if (channel == 1) return texel.g * 255.0;\r\n  if (channel == 2) return texel.b * 255.0;\r\n  if (channel == 3) return texel.a * 255.0;\r\n  return 0.0;\r\n}\r\n\r\nvec4 legacyEncode32(float f) {\r\n  float F = abs(f);\r\n  float sign = f < 0.0 ? 1.0 : 0.0;\r\n  float exponent = floor(log2(F));\r\n  float mantissa = (exp2(-exponent) * F);\r\n  // exponent += floor(log2(mantissa));\r\n  vec4 texel = vec4(F * exp2(23.0-exponent)) * SCALE_FACTOR_INV;\r\n  texel.rg = integerMod(texel.rg, 256.0);\r\n  texel.b = integerMod(texel.b, 128.0);\r\n  texel.a = exponent*0.5 + 63.5;\r\n  texel.ba += vec2(integerMod(exponent+127.0, 2.0), sign) * 128.0;\r\n  texel = floor(texel);\r\n  texel *= 0.003921569; // 1/255\r\n  __ENCODE32_ENDIANNESS__;\r\n  return texel;\r\n}\r\n\r\n// https://github.com/gpujs/gpu.js/wiki/Encoder-details\r\nvec4 encode32(float value) {\r\n  if (value == 0.0) return vec4(0, 0, 0, 0);\r\n\r\n  float exponent;\r\n  float mantissa;\r\n  vec4  result;\r\n  float sgn;\r\n\r\n  sgn = step(0.0, -value);\r\n  value = abs(value);\r\n\r\n  exponent = floor(log2(value));\r\n\r\n  mantissa = value*pow(2.0, -exponent)-1.0;\r\n  exponent = exponent+127.0;\r\n  result   = vec4(0,0,0,0);\r\n\r\n  result.a = floor(exponent/2.0);\r\n  exponent = exponent - result.a*2.0;\r\n  result.a = result.a + 128.0*sgn;\r\n\r\n  result.b = floor(mantissa * 128.0);\r\n  mantissa = mantissa - result.b / 128.0;\r\n  result.b = result.b + exponent*128.0;\r\n\r\n  result.g = floor(mantissa*32768.0);\r\n  mantissa = mantissa - result.g/32768.0;\r\n\r\n  result.r = floor(mantissa*8388608.0);\r\n  return result/255.0;\r\n}\r\n// Dragons end here\r\n\r\nint index;\r\nivec3 threadId;\r\n\r\nivec3 indexTo3D(int idx, ivec3 texDim) {\r\n  int z = int(idx / (texDim.x * texDim.y));\r\n  idx -= z * int(texDim.x * texDim.y);\r\n  int y = int(idx / texDim.x);\r\n  int x = int(integerMod(idx, texDim.x));\r\n  return ivec3(x, y, z);\r\n}\r\n\r\nfloat get32(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\r\n  int index = x + texDim.x * (y + texDim.y * z);\r\n  int w = texSize.x;\r\n  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;\r\n  vec4 texel = texture2D(tex, st / vec2(texSize));\r\n  return decode32(texel);\r\n}\r\n\r\nfloat get16(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\r\n  int index = x + texDim.x * (y + texDim.y * z);\r\n  int w = texSize.x * 2;\r\n  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;\r\n  vec4 texel = texture2D(tex, st / vec2(texSize.x * 2, texSize.y));\r\n  return decode16(texel, index);\r\n}\r\n\r\nfloat get8(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\r\n  int index = x + texDim.x * (y + texDim.y * z);\r\n  int w = texSize.x * 4;\r\n  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;\r\n  vec4 texel = texture2D(tex, st / vec2(texSize.x * 4, texSize.y));\r\n  return decode8(texel, index);\r\n}\r\n\r\nfloat getMemoryOptimized32(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\r\n  int index = x + texDim.x * (y + texDim.y * z);\r\n  int channel = integerMod(index, 4);\r\n  index = index / 4;\r\n  int w = texSize.x;\r\n  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;\r\n  vec4 texel = texture2D(tex, st / vec2(texSize));\r\n  if (channel == 0) return texel.r;\r\n  if (channel == 1) return texel.g;\r\n  if (channel == 2) return texel.b;\r\n  if (channel == 3) return texel.a;\r\n  return 0.0;\r\n}\r\n\r\nvec4 getImage2D(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\r\n  int index = x + texDim.x * (y + texDim.y * z);\r\n  int w = texSize.x;\r\n  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;\r\n  return texture2D(tex, st / vec2(texSize));\r\n}\r\n\r\nfloat getFloatFromSampler2D(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\r\n  vec4 result = getImage2D(tex, texSize, texDim, z, y, x);\r\n  return result[0];\r\n}\r\n\r\nvec2 getVec2FromSampler2D(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\r\n  vec4 result = getImage2D(tex, texSize, texDim, z, y, x);\r\n  return vec2(result[0], result[1]);\r\n}\r\n\r\nvec2 getMemoryOptimizedVec2(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\r\n  int index = x + (texDim.x * (y + (texDim.y * z)));\r\n  int channel = integerMod(index, 2);\r\n  index = index / 2;\r\n  int w = texSize.x;\r\n  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;\r\n  vec4 texel = texture2D(tex, st / vec2(texSize));\r\n  if (channel == 0) return vec2(texel.r, texel.g);\r\n  if (channel == 1) return vec2(texel.b, texel.a);\r\n  return vec2(0.0, 0.0);\r\n}\r\n\r\nvec3 getVec3FromSampler2D(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\r\n  vec4 result = getImage2D(tex, texSize, texDim, z, y, x);\r\n  return vec3(result[0], result[1], result[2]);\r\n}\r\n\r\nvec3 getMemoryOptimizedVec3(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\r\n  int fieldIndex = 3 * (x + texDim.x * (y + texDim.y * z));\r\n  int vectorIndex = fieldIndex / 4;\r\n  int vectorOffset = fieldIndex - vectorIndex * 4;\r\n  int readY = vectorIndex / texSize.x;\r\n  int readX = vectorIndex - readY * texSize.x;\r\n  vec4 tex1 = texture2D(tex, (vec2(readX, readY) + 0.5) / vec2(texSize));\r\n\r\n  if (vectorOffset == 0) {\r\n    return tex1.xyz;\r\n  } else if (vectorOffset == 1) {\r\n    return tex1.yzw;\r\n  } else {\r\n    readX++;\r\n    if (readX >= texSize.x) {\r\n      readX = 0;\r\n      readY++;\r\n    }\r\n    vec4 tex2 = texture2D(tex, vec2(readX, readY) / vec2(texSize));\r\n    if (vectorOffset == 2) {\r\n      return vec3(tex1.z, tex1.w, tex2.x);\r\n    } else {\r\n      return vec3(tex1.w, tex2.x, tex2.y);\r\n    }\r\n  }\r\n}\r\n\r\nvec4 getVec4FromSampler2D(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\r\n  return getImage2D(tex, texSize, texDim, z, y, x);\r\n}\r\n\r\nvec4 getMemoryOptimizedVec4(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\r\n  int index = x + texDim.x * (y + texDim.y * z);\r\n  int channel = integerMod(index, 2);\r\n  int w = texSize.x;\r\n  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;\r\n  vec4 texel = texture2D(tex, st / vec2(texSize));\r\n  return vec4(texel.r, texel.g, texel.b, texel.a);\r\n}\r\n\r\nvec4 actualColor;\r\nvoid color(float r, float g, float b, float a) {\r\n  actualColor = vec4(r,g,b,a);\r\n}\r\n\r\nvoid color(float r, float g, float b) {\r\n  color(r,g,b,1.0);\r\n}\r\n\r\nvoid color(sampler2D image) {\r\n  actualColor = texture2D(image, vTexCoord);\r\n}\r\n\r\n__MAIN_CONSTANTS__;\r\n__MAIN_ARGUMENTS__;\r\n__KERNEL__;\r\n\r\nvoid main(void) {\r\n  index = int(vTexCoord.s * float(uTexSize.x)) + int(vTexCoord.t * float(uTexSize.y)) * uTexSize.x;\r\n  __MAIN_RESULT__;\r\n}`;\r\n","// language=GLSL\r\nexport const vertexShader = `__FLOAT_TACTIC_DECLARATION__;\r\n__INT_TACTIC_DECLARATION__;\r\n__SAMPLER_2D_TACTIC_DECLARATION__;\r\n\r\nattribute vec2 aPos;\r\nattribute vec2 aTexCoord;\r\n\r\nvarying vec2 vTexCoord;\r\nuniform vec2 ratio;\r\n\r\nvoid main(void) {\r\n  gl_Position = vec4((aPos + vec2(1)) * ratio + vec2(-1), 0, 1);\r\n  vTexCoord = aTexCoord;\r\n}`;\r\n","/**\n *\n * @param {WebGLRenderingContext} gl\n * @param {IGLWiretapOptions} [options]\n * @returns {GLWiretapProxy}\n */\nfunction glWiretap(gl, options = {}) {\n  const {\n    contextName = 'gl',\n    throwGetError,\n    useTrackablePrimitives,\n    readPixelsFile,\n    recording = [],\n    variables = {},\n    onReadPixels,\n    onUnrecognizedArgumentLookup,\n  } = options;\n  const proxy = new Proxy(gl, { get: listen });\n  const contextVariables = [];\n  const entityNames = {};\n  let imageCount = 0;\n  let indent = '';\n  let readPixelsVariableName;\n  return proxy;\n  function listen(obj, property) {\n    switch (property) {\n      case 'addComment': return addComment;\n      case 'checkThrowError': return checkThrowError;\n      case 'getReadPixelsVariableName': return readPixelsVariableName;\n      case 'insertVariable': return insertVariable;\n      case 'reset': return reset;\n      case 'setIndent': return setIndent;\n      case 'toString': return toString;\n      case 'getContextVariableName': return getContextVariableName;\n    }\n    if (typeof gl[property] === 'function') {\n      return function() { // need arguments from this, fyi\n        switch (property) {\n          case 'getError':\n            if (throwGetError) {\n              recording.push(`${indent}if (${contextName}.getError() !== ${contextName}.NONE) throw new Error('error');`);\n            } else {\n              recording.push(`${indent}${contextName}.getError();`); // flush out errors\n            }\n            return gl.getError();\n          case 'getExtension': {\n            const variableName = `${contextName}Variables${contextVariables.length}`;\n            recording.push(`${indent}const ${variableName} = ${contextName}.getExtension('${arguments[0]}');`);\n            const extension = gl.getExtension(arguments[0]);\n            if (extension && typeof extension === 'object') {\n              const tappedExtension = glExtensionWiretap(extension, {\n                getEntity,\n                useTrackablePrimitives,\n                recording,\n                contextName: variableName,\n                contextVariables,\n                variables,\n                indent,\n                onUnrecognizedArgumentLookup,\n              });\n              contextVariables.push(tappedExtension);\n              return tappedExtension;\n            } else {\n              contextVariables.push(null);\n            }\n            return extension;\n          }\n          case 'readPixels':\n            const i = contextVariables.indexOf(arguments[6]);\n            let targetVariableName;\n            if (i === -1) {\n              const variableName = getVariableName(arguments[6]);\n              if (variableName) {\n                targetVariableName = variableName;\n                recording.push(`${indent}${variableName}`);\n              } else {\n                targetVariableName = `${contextName}Variable${contextVariables.length}`;\n                contextVariables.push(arguments[6]);\n                recording.push(`${indent}const ${targetVariableName} = new ${arguments[6].constructor.name}(${arguments[6].length});`);\n              }\n            } else {\n              targetVariableName = `${contextName}Variable${i}`;\n            }\n            readPixelsVariableName = targetVariableName;\n            const argumentAsStrings = [\n              arguments[0],\n              arguments[1],\n              arguments[2],\n              arguments[3],\n              getEntity(arguments[4]),\n              getEntity(arguments[5]),\n              targetVariableName\n            ];\n            recording.push(`${indent}${contextName}.readPixels(${argumentAsStrings.join(', ')});`);\n            if (readPixelsFile) {\n              writePPM(arguments[2], arguments[3]);\n            }\n            if (onReadPixels) {\n              onReadPixels(targetVariableName, argumentAsStrings);\n            }\n            return gl.readPixels.apply(gl, arguments);\n          case 'drawBuffers':\n            recording.push(`${indent}${contextName}.drawBuffers([${argumentsToString(arguments[0], { contextName, contextVariables, getEntity, addVariable, variables, onUnrecognizedArgumentLookup } )}]);`);\n            return gl.drawBuffers(arguments[0]);\n        }\n        let result = gl[property].apply(gl, arguments);\n        switch (typeof result) {\n          case 'undefined':\n            recording.push(`${indent}${methodCallToString(property, arguments)};`);\n            return;\n          case 'number':\n          case 'boolean':\n            if (useTrackablePrimitives && contextVariables.indexOf(trackablePrimitive(result)) === -1) {\n              recording.push(`${indent}const ${contextName}Variable${contextVariables.length} = ${methodCallToString(property, arguments)};`);\n              contextVariables.push(result = trackablePrimitive(result));\n              break;\n            }\n          default:\n            if (result === null) {\n              recording.push(`${methodCallToString(property, arguments)};`);\n            } else {\n              recording.push(`${indent}const ${contextName}Variable${contextVariables.length} = ${methodCallToString(property, arguments)};`);\n            }\n\n            contextVariables.push(result);\n        }\n        return result;\n      }\n    }\n    entityNames[gl[property]] = property;\n    return gl[property];\n  }\n  function toString() {\n    return recording.join('\\n');\n  }\n  function reset() {\n    while (recording.length > 0) {\n      recording.pop();\n    }\n  }\n  function insertVariable(name, value) {\n    variables[name] = value;\n  }\n  function getEntity(value) {\n    const name = entityNames[value];\n    if (name) {\n      return contextName + '.' + name;\n    }\n    return value;\n  }\n  function setIndent(spaces) {\n    indent = ' '.repeat(spaces);\n  }\n  function addVariable(value, source) {\n    const variableName = `${contextName}Variable${contextVariables.length}`;\n    recording.push(`${indent}const ${variableName} = ${source};`);\n    contextVariables.push(value);\n    return variableName;\n  }\n  function writePPM(width, height) {\n    const sourceVariable = `${contextName}Variable${contextVariables.length}`;\n    const imageVariable = `imageDatum${imageCount}`;\n    recording.push(`${indent}let ${imageVariable} = [\"P3\\\\n# ${readPixelsFile}.ppm\\\\n\", ${width}, ' ', ${height}, \"\\\\n255\\\\n\"].join(\"\");`);\n    recording.push(`${indent}for (let i = 0; i < ${imageVariable}.length; i += 4) {`);\n    recording.push(`${indent}  ${imageVariable} += ${sourceVariable}[i] + ' ' + ${sourceVariable}[i + 1] + ' ' + ${sourceVariable}[i + 2] + ' ';`);\n    recording.push(`${indent}}`);\n    recording.push(`${indent}if (typeof require !== \"undefined\") {`);\n    recording.push(`${indent}  require('fs').writeFileSync('./${readPixelsFile}.ppm', ${imageVariable});`);\n    recording.push(`${indent}}`);\n    imageCount++;\n  }\n  function addComment(value) {\n    recording.push(`${indent}// ${value}`);\n  }\n  function checkThrowError() {\n    recording.push(`${indent}(() => {\n${indent}const error = ${contextName}.getError();\n${indent}if (error !== ${contextName}.NONE) {\n${indent}  const names = Object.getOwnPropertyNames(gl);\n${indent}  for (let i = 0; i < names.length; i++) {\n${indent}    const name = names[i];\n${indent}    if (${contextName}[name] === error) {\n${indent}      throw new Error('${contextName} threw ' + name);\n${indent}    }\n${indent}  }\n${indent}}\n${indent}})();`);\n  }\n  function methodCallToString(method, args) {\n    return `${contextName}.${method}(${argumentsToString(args, { contextName, contextVariables, getEntity, addVariable, variables, onUnrecognizedArgumentLookup })})`;\n  }\n\n  function getVariableName(value) {\n    if (variables) {\n      for (const name in variables) {\n        if (variables[name] === value) {\n          return name;\n        }\n      }\n    }\n    return null;\n  }\n\n  function getContextVariableName(value) {\n    const i = contextVariables.indexOf(value);\n    if (i !== -1) {\n      return `${contextName}Variable${i}`;\n    }\n    return null;\n  }\n}\n\n/**\n *\n * @param extension\n * @param {IGLExtensionWiretapOptions} options\n * @returns {*}\n */\nfunction glExtensionWiretap(extension, options) {\n  const proxy = new Proxy(extension, { get: listen });\n  const extensionEntityNames = {};\n  const {\n    contextName,\n    contextVariables,\n    getEntity,\n    useTrackablePrimitives,\n    recording,\n    variables,\n    indent,\n    onUnrecognizedArgumentLookup,\n  } = options;\n  return proxy;\n  function listen(obj, property) {\n    if (typeof obj[property] === 'function') {\n      return function() {\n        switch (property) {\n          case 'drawBuffersWEBGL':\n            recording.push(`${indent}${contextName}.drawBuffersWEBGL([${argumentsToString(arguments[0], { contextName, contextVariables, getEntity: getExtensionEntity, addVariable, variables, onUnrecognizedArgumentLookup })}]);`);\n            return extension.drawBuffersWEBGL(arguments[0]);\n        }\n        let result = extension[property].apply(extension, arguments);\n        switch (typeof result) {\n          case 'undefined':\n            recording.push(`${indent}${methodCallToString(property, arguments)};`);\n            return;\n          case 'number':\n          case 'boolean':\n            if (useTrackablePrimitives && contextVariables.indexOf(trackablePrimitive(result)) === -1) {\n              recording.push(`${indent}const ${contextName}Variable${contextVariables.length} = ${methodCallToString(property, arguments)};`);\n              contextVariables.push(result = trackablePrimitive(result));\n            } else {\n              recording.push(`${indent}const ${contextName}Variable${contextVariables.length} = ${methodCallToString(property, arguments)};`);\n              contextVariables.push(result);\n            }\n            break;\n          default:\n            if (result === null) {\n              recording.push(`${methodCallToString(property, arguments)};`);\n            } else {\n              recording.push(`${indent}const ${contextName}Variable${contextVariables.length} = ${methodCallToString(property, arguments)};`);\n            }\n            contextVariables.push(result);\n        }\n        return result;\n      };\n    }\n    extensionEntityNames[extension[property]] = property;\n    return extension[property];\n  }\n\n  function getExtensionEntity(value) {\n    if (extensionEntityNames.hasOwnProperty(value)) {\n      return `${contextName}.${extensionEntityNames[value]}`;\n    }\n    return getEntity(value);\n  }\n\n  function methodCallToString(method, args) {\n    return `${contextName}.${method}(${argumentsToString(args, { contextName, contextVariables, getEntity: getExtensionEntity, addVariable, variables, onUnrecognizedArgumentLookup })})`;\n  }\n\n  function addVariable(value, source) {\n    const variableName = `${contextName}Variable${contextVariables.length}`;\n    contextVariables.push(value);\n    recording.push(`${indent}const ${variableName} = ${source};`);\n    return variableName;\n  }\n}\n\nfunction argumentsToString(args, options) {\n  const { variables } = options;\n  return (Array.from(args).map((arg) => {\n    const variableName = getVariableName(arg);\n    if (variableName) {\n      return variableName;\n    }\n    return argumentToString(arg, options);\n  }).join(', '));\n\n  function getVariableName(value) {\n    if (variables) {\n      for (const name in variables) {\n        if (variables[name] === value) {\n          return name;\n        }\n      }\n    }\n    return null;\n  }\n}\n\nfunction argumentToString(arg, options) {\n  const { contextName, contextVariables, getEntity, addVariable, onUnrecognizedArgumentLookup } = options;\n  if (typeof arg === 'undefined') {\n    return 'undefined';\n  }\n  if (arg === null) {\n    return 'null';\n  }\n  const i = contextVariables.indexOf(arg);\n  if (i > -1) {\n    return `${contextName}Variable${i}`;\n  }\n  switch (arg.constructor.name) {\n    case 'String':\n      const hasLines = /\\n/.test(arg);\n      const hasSingleQuotes = /'/.test(arg);\n      const hasDoubleQuotes = /\"/.test(arg);\n      if (hasLines) {\n        return '`' + arg + '`';\n      } else if (hasSingleQuotes && !hasDoubleQuotes) {\n        return '\"' + arg + '\"';\n      } else if (!hasSingleQuotes && hasDoubleQuotes) {\n        return \"'\" + arg + \"'\";\n      } else {\n        return '\\'' + arg + '\\'';\n      }\n    case 'Number': return getEntity(arg);\n    case 'Boolean': return getEntity(arg);\n    case 'Array':\n      return addVariable(arg, `new ${arg.constructor.name}(${Array.from(arg).join(',')})`);\n    case 'Float32Array':\n    case 'Uint8Array':\n    case 'Uint16Array':\n    case 'Int32Array':\n      return addVariable(arg, `new ${arg.constructor.name}(${JSON.stringify(Array.from(arg))})`);\n    default:\n      if (onUnrecognizedArgumentLookup) {\n        const instantiationString = onUnrecognizedArgumentLookup(arg);\n        if (instantiationString) {\n          return instantiationString;\n        }\n      }\n      throw new Error(`unrecognized argument type ${arg.constructor.name}`);\n  }\n}\n\nfunction trackablePrimitive(value) {\n  // wrapped in object, so track-able\n  return new value.constructor(value);\n}\n\nif (typeof module !== 'undefined') {\n  module.exports = { glWiretap, glExtensionWiretap };\n}\n\nif (typeof window !== 'undefined') {\n  glWiretap.glExtensionWiretap = glExtensionWiretap;\n  window.glWiretap = glWiretap;\n}\n","import { glWiretap } from 'gl-wiretap';\r\nimport { utils } from '../../utils';\r\n\r\nfunction toStringWithoutUtils(fn) {\r\n  return fn.toString()\r\n    .replace('=>', '')\r\n    .replace(/^function /, '')\r\n    .replace(/utils[.]/g, '/*utils.*/');\r\n}\r\n\r\n/**\r\n *\r\n * @param {Kernel} Kernel\r\n * @param {KernelVariable[]} args\r\n * @param {Kernel} originKernel\r\n * @param {string} [setupContextString]\r\n * @param {string} [destroyContextString]\r\n * @returns {string}\r\n */\r\nexport function glKernelString(Kernel, args, originKernel, setupContextString, destroyContextString) {\r\n  const postResult = [];\r\n  const context = glWiretap(originKernel.context, {\r\n    useTrackablePrimitives: true,\r\n    onReadPixels: (targetName) => {\r\n      if (kernel.subKernels) {\r\n        if (!subKernelsResultVariableSetup) {\r\n          postResult.push(`    const result = { result: ${getRenderString(targetName, kernel)} };`);\r\n          subKernelsResultVariableSetup = true;\r\n        } else {\r\n          const property = kernel.subKernels[subKernelsResultIndex++].property;\r\n          postResult.push(`    result${isNaN(property) ? '.' + property : `[${property}]`} = ${getRenderString(targetName, kernel)};`);\r\n        }\r\n        if (subKernelsResultIndex === kernel.subKernels.length) {\r\n          postResult.push('    return result;');\r\n        }\r\n        return;\r\n      }\r\n      if (targetName) {\r\n        postResult.push(`    return ${getRenderString(targetName, kernel)};`);\r\n      } else {\r\n        postResult.push(`    return null;`);\r\n      }\r\n    },\r\n    onUnrecognizedArgumentLookup: (argument) => {\r\n      for (let i = 0; i < kernel.kernelConstants.length; i++) {\r\n        const value = kernel.kernelConstants[i];\r\n        if (value.type === 'HTMLImageArray') {\r\n          const constant = kernel.constants[value.name];\r\n          const variable = `uploadValue_${value.name}[${constant.indexOf(value.uploadValue)}]`;\r\n          context.insertVariable(variable, kernel.constants);\r\n          return variable;\r\n        } else if (value.uploadValue === argument) {\r\n          const variable = `uploadValue_${value.name}`;\r\n          context.insertVariable(variable, value);\r\n          return variable;\r\n        }\r\n      }\r\n    }\r\n  });\r\n  let subKernelsResultVariableSetup = false;\r\n  let subKernelsResultIndex = 0;\r\n  const {\r\n    source,\r\n    canvas,\r\n    output,\r\n    pipeline,\r\n    graphical,\r\n    loopMaxIterations,\r\n    constants,\r\n    optimizeFloatMemory,\r\n    precision,\r\n    fixIntegerDivisionAccuracy,\r\n    functions,\r\n    nativeFunctions,\r\n    subKernels,\r\n    immutable,\r\n    argumentTypes,\r\n    constantTypes,\r\n    kernelArguments,\r\n    kernelConstants,\r\n  } = originKernel;\r\n  const kernel = new Kernel(source, {\r\n    canvas,\r\n    context,\r\n    checkContext: false,\r\n    output,\r\n    pipeline,\r\n    graphical,\r\n    loopMaxIterations,\r\n    constants,\r\n    optimizeFloatMemory,\r\n    precision,\r\n    fixIntegerDivisionAccuracy,\r\n    functions,\r\n    nativeFunctions,\r\n    subKernels,\r\n    immutable,\r\n    argumentTypes,\r\n    constantTypes,\r\n  });\r\n  let result = [];\r\n  context.setIndent(2);\r\n  kernel.build.apply(kernel, args);\r\n  result.push(context.toString());\r\n  context.reset();\r\n  const upgradedArguments = Array.from(args).map(arg => {\r\n    switch (typeof arg) {\r\n      case 'number':\r\n      case 'boolean':\r\n        return new arg.constructor(arg);\r\n    }\r\n    return arg;\r\n  });\r\n  kernel.kernelArguments.forEach((kernelArgument, i) => {\r\n    switch (kernelArgument.type) {\r\n      // primitives\r\n      case 'Integer':\r\n      case 'Boolean':\r\n      case 'Number':\r\n      case 'Float':\r\n        context.insertVariable(`uploadValue_${kernelArgument.name}`, upgradedArguments[i]);\r\n        break;\r\n\r\n        // non-primitives\r\n      case 'Array':\r\n      case 'Array(2)':\r\n      case 'Array(3)':\r\n      case 'Array(4)':\r\n        context.insertVariable(`uploadValue_${kernelArgument.name}`, upgradedArguments[i]);\r\n        break;\r\n      case 'HTMLImage':\r\n        context.insertVariable(`uploadValue_${kernelArgument.name}`, upgradedArguments[i]);\r\n        break;\r\n      case 'HTMLImageArray':\r\n        for (let imageIndex = 0; imageIndex < args[i].length; imageIndex++) {\r\n          const arg = args[i];\r\n          context.insertVariable(`uploadValue_${kernelArgument.name}[${imageIndex}]`, arg[imageIndex]);\r\n        }\r\n        break;\r\n      case 'Input':\r\n        context.insertVariable(`uploadValue_${kernelArgument.name}`, kernelArgument.uploadValue);\r\n        break;\r\n      case 'MemoryOptimizedNumberTexture':\r\n      case 'NumberTexture':\r\n      case 'Array1D(2)':\r\n      case 'Array1D(3)':\r\n      case 'Array1D(4)':\r\n      case 'Array2D(2)':\r\n      case 'Array2D(3)':\r\n      case 'Array2D(4)':\r\n      case 'Array3D(2)':\r\n      case 'Array3D(3)':\r\n      case 'Array3D(4)':\r\n      case 'ArrayTexture(1)':\r\n      case 'ArrayTexture(2)':\r\n      case 'ArrayTexture(3)':\r\n      case 'ArrayTexture(4)':\r\n        context.insertVariable(`uploadValue_${kernelArgument.name}`, upgradedArguments[i].texture);\r\n        break;\r\n      default:\r\n        throw new Error(`unhandled kernelArgumentType insertion for glWiretap of type ${kernelArgument.type}`);\r\n    }\r\n  });\r\n  result.push('/** start of injected functions **/');\r\n  result.push(`function ${toStringWithoutUtils(utils.flattenTo)}`);\r\n  result.push(`function ${toStringWithoutUtils(utils.flatten2dArrayTo)}`);\r\n  result.push(`function ${toStringWithoutUtils(utils.flatten3dArrayTo)}`);\r\n  result.push(`function ${toStringWithoutUtils(utils.isArray)}`);\r\n  if (kernel.renderOutput !== kernel.renderTexture && kernel.formatValues) {\r\n    result.push(\r\n      `  const renderOutput = function ${toStringWithoutUtils(kernel.formatValues)};`\r\n    );\r\n  }\r\n  result.push('/** end of injected functions **/');\r\n  result.push(`  const innerKernel = function (${kernel.kernelArguments.map(kernelArgument => kernelArgument.varName).join(', ')}) {`);\r\n  context.setIndent(4);\r\n  kernel.run.apply(kernel, upgradedArguments);\r\n  if (kernel.renderKernels) {\r\n    kernel.renderKernels();\r\n  } else if (kernel.renderOutput) {\r\n    kernel.renderOutput();\r\n  }\r\n  result.push('/** start setup uploads for kernel values **/');\r\n  kernel.kernelArguments.forEach(kernelArgument => {\r\n    result.push(kernelArgument.getStringValueHandler());\r\n  });\r\n  result.push('/** end setup uploads for kernel values **/');\r\n  result.push(context.toString());\r\n  if (kernel.renderOutput === kernel.renderTexture) {\r\n    context.reset();\r\n    const results = kernel.renderKernels();\r\n    const textureName = context.getContextVariableName(kernel.outputTexture);\r\n    result.push(`    return {\r\n      result: {\r\n        texture: ${ textureName },\r\n        type: '${ results.result.type }',\r\n        toArray: ${ getToArrayString(results.result, textureName) }\r\n      },`);\r\n    const { subKernels, subKernelOutputTextures } = kernel;\r\n    for (let i = 0; i < subKernels.length; i++) {\r\n      const texture = subKernelOutputTextures[i];\r\n      const subKernel = subKernels[i];\r\n      const subKernelResult = results[subKernel.property];\r\n      const subKernelTextureName = context.getContextVariableName(texture);\r\n      result.push(`\r\n      ${subKernel.property}: {\r\n        texture: ${ subKernelTextureName },\r\n        type: '${ subKernelResult.type }',\r\n        toArray: ${ getToArrayString(subKernelResult, subKernelTextureName) }\r\n      },`);\r\n    }\r\n    result.push(`    };`);\r\n  }\r\n  result.push(`    ${destroyContextString ? '\\n' + destroyContextString + '    ': ''}`);\r\n  result.push(postResult.join('\\n'));\r\n  result.push('  };');\r\n  if (kernel.graphical) {\r\n    result.push(getGetPixelsString(kernel));\r\n    result.push(`innerKernel.getPixels = getPixels;`);\r\n  }\r\n  result.push('  return innerKernel;');\r\n\r\n  let constantsUpload = [];\r\n  kernelConstants.forEach((kernelConstant) => {\r\n    constantsUpload.push(`${  kernelConstant.getStringValueHandler()}`);\r\n  });\r\n  return `function kernel(settings) {\r\n  const { context, constants } = settings;\r\n  ${constantsUpload.join('')}\r\n  ${setupContextString ? setupContextString : ''}\r\n${result.join('\\n')}\r\n}`;\r\n}\r\n\r\nfunction getRenderString(targetName, kernel) {\r\n  const readBackValue = kernel.precision === 'single' ? targetName : `new Float32Array(${targetName}.buffer)`;\r\n  if (kernel.output[2]) {\r\n    return `renderOutput(${readBackValue}, ${kernel.output[0]}, ${kernel.output[1]}, ${kernel.output[2]})`;\r\n  }\r\n  if (kernel.output[1]) {\r\n    return `renderOutput(${readBackValue}, ${kernel.output[0]}, ${kernel.output[1]})`;\r\n  }\r\n\r\n  return `renderOutput(${readBackValue}, ${kernel.output[0]})`;\r\n}\r\n\r\nfunction getGetPixelsString(kernel) {\r\n  const getPixels = kernel.getPixels.toString();\r\n  const useFunctionKeyword = !/^function/.test(getPixels);\r\n  return utils.flattenFunctionToString(`${useFunctionKeyword ? 'function ' : ''}${ getPixels }`, {\r\n    findDependency: (object, name) => {\r\n      if (object === 'utils') {\r\n        return `const ${name} = ${utils[name].toString()};`;\r\n      }\r\n      return null;\r\n    },\r\n    thisLookup: (property) => {\r\n      if (property === 'context') {\r\n        return null;\r\n      }\r\n      if (kernel.hasOwnProperty(property)) {\r\n        return JSON.stringify(kernel[property]);\r\n      }\r\n      throw new Error(`unhandled thisLookup ${ property }`);\r\n    }\r\n  });\r\n}\r\n\r\nfunction getToArrayString(kernelResult, textureName) {\r\n  const toArray = kernelResult.toArray.toString();\r\n  const useFunctionKeyword = !/^function/.test(toArray);\r\n  const flattenedFunctions = utils.flattenFunctionToString(`${useFunctionKeyword ? 'function ' : ''}${ toArray }`, {\r\n    findDependency: (object, name) => {\r\n      if (object === 'utils') {\r\n        return `const ${name} = ${utils[name].toString()};`;\r\n      } else if (object === 'this') {\r\n        return `${useFunctionKeyword ? 'function ' : ''}${kernelResult[name].toString()}`;\r\n      } else {\r\n        throw new Error('unhandled fromObject');\r\n      }\r\n    },\r\n    thisLookup: (property) => {\r\n      if (property === 'texture') {\r\n        return textureName;\r\n      }\r\n      if (kernelResult.hasOwnProperty(property)) {\r\n        return JSON.stringify(kernelResult[property]);\r\n      }\r\n      throw new Error(`unhandled thisLookup ${ property }`);\r\n    }\r\n  });\r\n  return `() => {\r\n  ${flattenedFunctions}\r\n  return toArray();\r\n  }`;\r\n}\r\n","/**\r\n * @class KernelValue\r\n */\r\nexport class KernelValue {\r\n  /**\r\n   *\r\n   * @param {IKernelArgumentSettings} settings\r\n   */\r\n  constructor(value, settings) {\r\n    const {\r\n      name,\r\n      kernel,\r\n      context,\r\n      checkContext,\r\n      onRequestContextHandle,\r\n      onUpdateValueMismatch,\r\n      origin,\r\n      strictIntegers,\r\n      type,\r\n      tactic,\r\n    } = settings;\r\n    if (!name) {\r\n      throw new Error('name not set');\r\n    }\r\n    if (!type) {\r\n      throw new Error('type not set');\r\n    }\r\n    if (!origin) {\r\n      throw new Error('origin not set');\r\n    }\r\n    if (!tactic) {\r\n      throw new Error('tactic not set');\r\n    }\r\n    if (origin !== 'user' && origin !== 'constants') {\r\n      throw new Error(`origin must be \"user\" or \"constants\" value is \"${ origin }\"`);\r\n    }\r\n    if (!onRequestContextHandle) {\r\n      throw new Error('onRequestContextHandle is not set');\r\n    }\r\n    this.name = name;\r\n    this.origin = origin;\r\n    this.tactic = tactic;\r\n    this.id = `${this.origin}_${name}`;\r\n    this.varName = origin === 'constants' ? `constants.${name}` : name;\r\n    this.kernel = kernel;\r\n    this.strictIntegers = strictIntegers;\r\n    // handle textures\r\n    this.type = value.type || type;\r\n    this.size = value.size || null;\r\n    this.index = null;\r\n    this.context = context;\r\n    this.checkContext = checkContext !== null && checkContext !== undefined ? checkContext : true;\r\n    this.contextHandle = null;\r\n    this.onRequestContextHandle = onRequestContextHandle;\r\n    this.onUpdateValueMismatch = onUpdateValueMismatch;\r\n  }\r\n\r\n  getSource() {\r\n    throw new Error(`\"getSource\" not defined on ${ this.constructor.name }`);\r\n  }\r\n\r\n  updateValue(value) {\r\n    throw new Error(`\"updateValue\" not defined on ${ this.constructor.name }`);\r\n  }\r\n\r\n  getFocusString() {\r\n    throw new Error(`\"getFocusString\" not defined on ${ this.constructor.name }`);\r\n  }\r\n}\r\n","import { Input } from '../../../input';\r\nimport { KernelValue } from '../../kernel-value';\r\nimport { utils } from '../../../utils';\r\n\r\nexport class WebGLKernelValue extends KernelValue {\r\n  /**\r\n   *\r\n   * @param {IWebGLKernerlValueSettings} settings\r\n   */\r\n  constructor(value, settings) {\r\n    super(value, settings);\r\n    this.dimensionsId = null;\r\n    this.sizeId = null;\r\n    this.initialValueConstructor = value.constructor;\r\n    this.onRequestTexture = settings.onRequestTexture;\r\n    this.onRequestIndex = settings.onRequestIndex;\r\n    this.uploadValue = null;\r\n    this.textureSize = null;\r\n    this.bitRatio = null;\r\n  }\r\n\r\n  requestTexture() {\r\n    this.texture = this.onRequestTexture();\r\n    this.setupTexture();\r\n  }\r\n\r\n  setupTexture() {\r\n    this.contextHandle = this.onRequestContextHandle();\r\n    this.index = this.onRequestIndex();\r\n    this.dimensionsId = this.id + 'Dim';\r\n    this.sizeId = this.id + 'Size';\r\n  }\r\n\r\n  getTransferArrayType(value) {\r\n    if (Array.isArray(value[0])) {\r\n      return this.getTransferArrayType(value[0]);\r\n    }\r\n    switch (value.constructor) {\r\n      case Array:\r\n      case Int32Array:\r\n      case Int16Array:\r\n      case Int8Array:\r\n        return Float32Array;\r\n      case Uint8ClampedArray:\r\n      case Uint8Array:\r\n      case Uint16Array:\r\n      case Uint32Array:\r\n      case Float32Array:\r\n      case Float64Array:\r\n        return value.constructor;\r\n    }\r\n    console.warn('Unfamiliar constructor type.  Will go ahead and use, but likley this may result in a transfer of zeros');\r\n    return value.constructor;\r\n  }\r\n  /**\r\n   * @desc Adds kernel parameters to the Value Texture,\r\n   * binding it to the context, etc.\r\n   *\r\n   * @param {Array|Float32Array|Uint16Array} value - The actual Value supplied to the kernel\r\n   * @param {Number} length - the expected total length of the output array\r\n   * @param {Object} [Type]\r\n   * @returns {Float32Array|Uint16Array|Uint8Array} flattened array to transfer\r\n   */\r\n  formatArrayTransfer(value, length, Type) {\r\n    if (utils.isArray(value[0]) || this.optimizeFloatMemory) {\r\n      // not already flat\r\n      const valuesFlat = new Float32Array(length);\r\n      utils.flattenTo(value, valuesFlat);\r\n      return valuesFlat;\r\n    } else {\r\n      switch (value.constructor) {\r\n        case Uint8ClampedArray:\r\n        case Uint8Array:\r\n        case Int8Array:\r\n        case Uint16Array:\r\n        case Int16Array:\r\n        case Float32Array:\r\n        case Int32Array: {\r\n          const valuesFlat = new(Type || value.constructor)(length);\r\n          utils.flattenTo(value, valuesFlat);\r\n          return valuesFlat;\r\n        }\r\n        default: {\r\n          const valuesFlat = new Float32Array(length);\r\n          utils.flattenTo(value, valuesFlat);\r\n          return valuesFlat;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * bit storage ratio of source to target 'buffer', i.e. if 8bit array -> 32bit tex = 4\r\n   * @param value\r\n   * @returns {number}\r\n   */\r\n  getBitRatio(value) {\r\n    if (Array.isArray(value[0])) {\r\n      return this.getBitRatio(value[0]);\r\n    } else if (value.constructor === Input) {\r\n      return this.getBitRatio(value.value);\r\n    }\r\n    switch (value.constructor) {\r\n      case Uint8ClampedArray:\r\n      case Uint8Array:\r\n      case Int8Array:\r\n        return 1;\r\n      case Uint16Array:\r\n      case Int16Array:\r\n        return 2;\r\n      case Float32Array:\r\n      case Int32Array:\r\n      default:\r\n        return 4;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Used for when we want a string output of our kernel, so we can still input values to the kernel\r\n   */\r\n  getStringValueHandler() {\r\n    throw new Error(`\"getStringValueHandler\" not implemented on ${this.constructor.name}`);\r\n  }\r\n\r\n  getVariablePrecisionString() {\r\n    switch (this.tactic) {\r\n      case 'speed':\r\n        return 'lowp';\r\n      case 'performance':\r\n        return 'highp';\r\n      case 'balanced':\r\n      default:\r\n        return 'mediump';\r\n    }\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { WebGLKernelValue } from './index';\r\n\r\nexport class WebGLKernelValueBoolean extends WebGLKernelValue {\r\n  constructor(value, settings) {\r\n    super(value, settings);\r\n    this.uploadValue = value;\r\n  }\r\n  getSource(value) {\r\n    if (this.origin === 'constants') {\r\n      return `const bool ${this.id} = ${value};\\n`;\r\n    }\r\n    return `uniform bool ${this.id};\\n`;\r\n  }\r\n\r\n  getStringValueHandler() {\r\n    return `const uploadValue_${this.name} = ${this.varName};\\n`;\r\n  }\r\n\r\n  updateValue(value) {\r\n    if (this.origin === 'constants') return;\r\n    this.kernel.setUniform1i(this.id, this.uploadValue = value);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { WebGLKernelValue } from './index';\r\n\r\nexport class WebGLKernelValueFloat extends WebGLKernelValue {\r\n  constructor(value, settings) {\r\n    super(value, settings);\r\n    this.uploadValue = value;\r\n  }\r\n  getStringValueHandler() {\r\n    return `const uploadValue_${this.name} = ${this.varName};\\n`;\r\n  }\r\n  getSource(value) {\r\n    if (this.origin === 'constants') {\r\n      if (Number.isInteger(value)) {\r\n        return `const float ${this.id} = ${value}.0;\\n`;\r\n      }\r\n      return `const float ${this.id} = ${value};\\n`;\r\n    }\r\n    return `uniform float ${this.id};\\n`;\r\n  }\r\n\r\n  updateValue(value) {\r\n    if (this.origin === 'constants') return;\r\n    this.kernel.setUniform1f(this.id, this.uploadValue = value);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { WebGLKernelValue } from './index';\r\n\r\nexport class WebGLKernelValueInteger extends WebGLKernelValue {\r\n  constructor(value, settings) {\r\n    super(value, settings);\r\n    this.uploadValue = value;\r\n  }\r\n  getStringValueHandler() {\r\n    return `const uploadValue_${this.name} = ${this.varName};\\n`;\r\n  }\r\n  getSource(value) {\r\n    if (this.origin === 'constants') {\r\n      return `const int ${this.id} = ${ parseInt(value) };\\n`;\r\n    }\r\n    return `uniform int ${this.id};\\n`;\r\n  }\r\n\r\n  updateValue(value) {\r\n    if (this.origin === 'constants') return;\r\n    this.kernel.setUniform1i(this.id, this.uploadValue = value);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { WebGLKernelValue } from './index';\r\n\r\nexport class WebGLKernelValueHTMLImage extends WebGLKernelValue {\r\n  constructor(value, settings) {\r\n    super(value, settings);\r\n    const { width, height } = value;\r\n    this.dimensions = [width, height, 1];\r\n    this.requestTexture();\r\n    this.textureSize = [width, height];\r\n    this.uploadValue = value;\r\n  }\r\n\r\n  getStringValueHandler() {\r\n    return `const uploadValue_${this.name} = ${this.varName};\\n`;\r\n  }\r\n\r\n  getSource() {\r\n    return utils.linesToString([\r\n      `uniform sampler2D ${this.id}`,\r\n      `ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,\r\n      `ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`,\r\n    ]);\r\n  }\r\n\r\n  updateValue(inputImage) {\r\n    if (inputImage.constructor !== this.initialValueConstructor) {\r\n      this.onUpdateValueMismatch();\r\n      return;\r\n    }\r\n    const { context: gl } = this;\r\n    gl.activeTexture(this.contextHandle);\r\n    gl.bindTexture(gl.TEXTURE_2D, this.texture);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\r\n    gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, true);\r\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, this.uploadValue = inputImage);\r\n    this.kernel.setUniform1i(this.id, this.index);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { WebGLKernelValueHTMLImage } from './html-image';\r\n\r\nexport class WebGLKernelValueDynamicHTMLImage extends WebGLKernelValueHTMLImage {\r\n  getSource() {\r\n    return utils.linesToString([\r\n      `uniform sampler2D ${this.id}`,\r\n      `uniform ivec2 ${this.sizeId}`,\r\n      `uniform ivec3 ${this.dimensionsId}`,\r\n    ]);\r\n  }\r\n\r\n  updateValue(value) {\r\n    const { width, height } = value;\r\n    this.dimensions = [width, height, 1];\r\n    this.textureSize = [width, height];\r\n    this.kernel.setUniform3iv(this.dimensionsId, this.dimensions);\r\n    this.kernel.setUniform2iv(this.sizeId, this.textureSize);\r\n    super.updateValue(value);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { WebGLKernelValue } from './index';\r\n\r\nexport class WebGLKernelValueSingleInput extends WebGLKernelValue {\r\n  constructor(value, settings) {\r\n    super(value, settings);\r\n    this.requestTexture();\r\n    this.bitRatio = 4;\r\n    let [w, h, d] = value.size;\r\n    this.dimensions = new Int32Array([w || 1, h || 1, d || 1]);\r\n    this.textureSize = utils.getMemoryOptimizedFloatTextureSize(this.dimensions, this.bitRatio);\r\n    this.uploadArrayLength = this.textureSize[0] * this.textureSize[1] * this.bitRatio;\r\n    this.uploadValue = new Float32Array(this.uploadArrayLength);\r\n  }\r\n\r\n  getStringValueHandler() {\r\n    return utils.linesToString([\r\n      `const uploadValue_${this.name} = new Float32Array(${this.uploadArrayLength})`,\r\n      `flattenTo(${this.varName}.value, uploadValue_${this.name})`,\r\n    ]);\r\n  }\r\n\r\n  getSource() {\r\n    return utils.linesToString([\r\n      `uniform sampler2D ${this.id}`,\r\n      `ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,\r\n      `ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`,\r\n    ]);\r\n  }\r\n\r\n  updateValue(input) {\r\n    if (input.constructor !== this.initialValueConstructor) {\r\n      this.onUpdateValueMismatch();\r\n      return;\r\n    }\r\n    const { context: gl } = this;\r\n    utils.flattenTo(input.value, this.uploadValue);\r\n    gl.activeTexture(this.contextHandle);\r\n    gl.bindTexture(gl.TEXTURE_2D, this.texture);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\r\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, this.textureSize[0], this.textureSize[1], 0, gl.RGBA, gl.FLOAT, this.uploadValue);\r\n    this.kernel.setUniform1i(this.id, this.index);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { WebGLKernelValue } from './index';\r\n\r\nexport class WebGLKernelValueUnsignedInput extends WebGLKernelValue {\r\n  constructor(value, settings) {\r\n    super(value, settings);\r\n    this.requestTexture();\r\n    this.bitRatio = this.getBitRatio(value);\r\n    const [w, h, d] = value.size;\r\n    this.dimensions = new Int32Array([w || 1, h || 1, d || 1]);\r\n    this.textureSize = utils.getMemoryOptimizedPackedTextureSize(this.dimensions, this.bitRatio);\r\n    this.uploadArrayLength = this.textureSize[0] * this.textureSize[1] * (4 / this.bitRatio);\r\n    this.TranserArrayType = this.getTransferArrayType(value.value);\r\n    this.preUploadValue = new this.TranserArrayType(this.uploadArrayLength);\r\n    this.uploadValue = new Uint8Array(this.preUploadValue.buffer);\r\n  }\r\n\r\n  getStringValueHandler() {\r\n    return utils.linesToString([\r\n      `const preUploadValue_${this.name} = new ${this.TranserArrayType.name}(${this.uploadArrayLength})`,\r\n      `const uploadValue_${this.name} = new Uint8Array(preUploadValue_${this.name}.buffer)`,\r\n      `flattenTo(${this.varName}.value, preUploadValue_${this.name})`,\r\n    ]);\r\n  }\r\n\r\n  getSource() {\r\n    return utils.linesToString([\r\n      `uniform sampler2D ${this.id}`,\r\n      `ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,\r\n      `ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`,\r\n    ]);\r\n  }\r\n\r\n  updateValue(input) {\r\n    if (input.constructor !== this.initialValueConstructor) {\r\n      this.onUpdateValueMismatch();\r\n      return;\r\n    }\r\n    const { context: gl } = this;\r\n    utils.flattenTo(input.value, this.preUploadValue);\r\n    gl.activeTexture(this.contextHandle);\r\n    gl.bindTexture(gl.TEXTURE_2D, this.texture);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\r\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, this.textureSize[0], this.textureSize[1], 0, gl.RGBA, gl.UNSIGNED_BYTE, this.uploadValue);\r\n    this.kernel.setUniform1i(this.id, this.index);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { WebGLKernelValueUnsignedInput } from './unsigned-input';\r\n\r\nexport class WebGLKernelValueDynamicUnsignedInput extends WebGLKernelValueUnsignedInput {\r\n  getSource() {\r\n    return utils.linesToString([\r\n      `uniform sampler2D ${this.id}`,\r\n      `uniform ivec2 ${this.sizeId}`,\r\n      `uniform ivec3 ${this.dimensionsId}`,\r\n    ]);\r\n  }\r\n\r\n  updateValue(value) {\r\n    let [w, h, d] = value.size;\r\n    this.dimensions = new Int32Array([w || 1, h || 1, d || 1]);\r\n    this.textureSize = utils.getMemoryOptimizedPackedTextureSize(this.dimensions, this.bitRatio);\r\n    this.uploadArrayLength = this.textureSize[0] * this.textureSize[1] * (4 / this.bitRatio);\r\n    const Type = this.getTransferArrayType(value.value);\r\n    this.preUploadValue = new Type(this.uploadArrayLength);\r\n    this.uploadValue = new Uint8Array(this.preUploadValue.buffer);\r\n    this.kernel.setUniform3iv(this.dimensionsId, this.dimensions);\r\n    this.kernel.setUniform2iv(this.sizeId, this.textureSize);\r\n    super.updateValue(value);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { WebGLKernelValue } from './index';\r\n\r\nexport class WebGLKernelValueMemoryOptimizedNumberTexture extends WebGLKernelValue {\r\n  constructor(value, settings) {\r\n    super(value, settings);\r\n    this.setupTexture();\r\n    this.dimensions = value.dimensions;\r\n    this.textureSize = value.size;\r\n    this.uploadValue = value.texture;\r\n  }\r\n\r\n  getStringValueHandler() {\r\n    return `const uploadValue_${this.name} = ${this.varName}.texture;\\n`;\r\n  }\r\n\r\n  getSource() {\r\n    return utils.linesToString([\r\n      `uniform sampler2D ${this.id}`,\r\n      `ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,\r\n      `ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`,\r\n    ]);\r\n  }\r\n\r\n  updateValue(inputTexture) {\r\n    if (inputTexture.constructor !== this.initialValueConstructor) {\r\n      this.onUpdateValueMismatch();\r\n      return;\r\n    }\r\n    if (this.checkContext && inputTexture.context !== this.context) {\r\n      throw new Error(`Value ${this.name} (${this.type }) must be from same context`);\r\n    }\r\n    const { context: gl } = this;\r\n    gl.activeTexture(this.contextHandle);\r\n    gl.bindTexture(gl.TEXTURE_2D, this.uploadValue = inputTexture.texture);\r\n    this.kernel.setUniform1i(this.id, this.index);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { WebGLKernelValueMemoryOptimizedNumberTexture } from './memory-optimized-number-texture';\r\n\r\nexport class WebGLKernelValueDynamicMemoryOptimizedNumberTexture extends WebGLKernelValueMemoryOptimizedNumberTexture {\r\n  getSource() {\r\n    return utils.linesToString([\r\n      `uniform sampler2D ${this.id}`,\r\n      `uniform ivec2 ${this.sizeId}`,\r\n      `uniform ivec3 ${this.dimensionsId}`,\r\n    ]);\r\n  }\r\n\r\n  updateValue(inputTexture) {\r\n    this.dimensions = inputTexture.dimensions;\r\n    this.textureSize = inputTexture.size;\r\n    this.kernel.setUniform3iv(this.dimensionsId, this.dimensions);\r\n    this.kernel.setUniform2iv(this.sizeId, this.textureSize);\r\n    super.updateValue(inputTexture);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { WebGLKernelValue } from './index';\r\n\r\nexport class WebGLKernelValueNumberTexture extends WebGLKernelValue {\r\n  constructor(value, settings) {\r\n    super(value, settings);\r\n    this.setupTexture();\r\n    const { size: textureSize, dimensions } = value;\r\n    this.bitRatio = this.getBitRatio(value);\r\n    this.dimensions = dimensions;\r\n    this.textureSize = textureSize;\r\n    this.uploadValue = value.texture;\r\n  }\r\n\r\n  getStringValueHandler() {\r\n    return `const uploadValue_${this.name} = ${this.varName}.texture;\\n`;\r\n  }\r\n\r\n  getSource() {\r\n    return utils.linesToString([\r\n      `uniform sampler2D ${this.id}`,\r\n      `ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,\r\n      `ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`,\r\n    ]);\r\n  }\r\n\r\n  updateValue(inputTexture) {\r\n    if (inputTexture.constructor !== this.initialValueConstructor) {\r\n      this.onUpdateValueMismatch();\r\n      return;\r\n    }\r\n    if (this.checkContext && inputTexture.context !== this.context) {\r\n      throw new Error(`Value ${this.name} (${this.type}) must be from same context`);\r\n    }\r\n    const { context: gl } = this;\r\n    gl.activeTexture(this.contextHandle);\r\n    gl.bindTexture(gl.TEXTURE_2D, this.uploadValue = inputTexture.texture);\r\n    this.kernel.setUniform1i(this.id, this.index);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { WebGLKernelValueNumberTexture } from './number-texture';\r\n\r\nexport class WebGLKernelValueDynamicNumberTexture extends WebGLKernelValueNumberTexture {\r\n  getSource() {\r\n    return utils.linesToString([\r\n      `uniform sampler2D ${this.id}`,\r\n      `uniform ivec2 ${this.sizeId}`,\r\n      `uniform ivec3 ${this.dimensionsId}`,\r\n    ]);\r\n  }\r\n\r\n  updateValue(value) {\r\n    this.dimensions = value.dimensions;\r\n    this.textureSize = value.size;\r\n    this.kernel.setUniform3iv(this.dimensionsId, this.dimensions);\r\n    this.kernel.setUniform2iv(this.sizeId, this.textureSize);\r\n    super.updateValue(value);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { WebGLKernelValue } from './index';\r\n\r\nexport class WebGLKernelValueSingleArray extends WebGLKernelValue {\r\n  constructor(value, settings) {\r\n    super(value, settings);\r\n    this.requestTexture();\r\n    this.bitRatio = 4;\r\n    this.dimensions = utils.getDimensions(value, true);\r\n    this.textureSize = utils.getMemoryOptimizedFloatTextureSize(this.dimensions, this.bitRatio);\r\n    this.uploadArrayLength = this.textureSize[0] * this.textureSize[1] * this.bitRatio;\r\n    this.uploadValue = new Float32Array(this.uploadArrayLength);\r\n  }\r\n\r\n  getStringValueHandler() {\r\n    return utils.linesToString([\r\n      `const uploadValue_${this.name} = new Float32Array(${this.uploadArrayLength})`,\r\n      `flattenTo(${this.varName}, uploadValue_${this.name})`,\r\n    ]);\r\n  }\r\n\r\n  getSource() {\r\n    return utils.linesToString([\r\n      `uniform sampler2D ${this.id}`,\r\n      `ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,\r\n      `ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`,\r\n    ]);\r\n  }\r\n\r\n  updateValue(value) {\r\n    if (value.constructor !== this.initialValueConstructor) {\r\n      this.onUpdateValueMismatch();\r\n      return;\r\n    }\r\n    const { context: gl } = this;\r\n    utils.flattenTo(value, this.uploadValue);\r\n    gl.activeTexture(this.contextHandle);\r\n    gl.bindTexture(gl.TEXTURE_2D, this.texture);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\r\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, this.textureSize[0], this.textureSize[1], 0, gl.RGBA, gl.FLOAT, this.uploadValue);\r\n    this.kernel.setUniform1i(this.id, this.index);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { WebGLKernelValueSingleArray } from './single-array';\r\n\r\nexport class WebGLKernelValueDynamicSingleArray extends WebGLKernelValueSingleArray {\r\n  getSource() {\r\n    return utils.linesToString([\r\n      `uniform sampler2D ${this.id}`,\r\n      `uniform ivec2 ${this.sizeId}`,\r\n      `uniform ivec3 ${this.dimensionsId}`,\r\n    ]);\r\n  }\r\n\r\n  updateValue(value) {\r\n    this.dimensions = utils.getDimensions(value, true);\r\n    this.textureSize = utils.getMemoryOptimizedFloatTextureSize(this.dimensions, this.bitRatio);\r\n    this.uploadArrayLength = this.textureSize[0] * this.textureSize[1] * this.bitRatio;\r\n    this.uploadValue = new Float32Array(this.uploadArrayLength);\r\n    this.kernel.setUniform3iv(this.dimensionsId, this.dimensions);\r\n    this.kernel.setUniform2iv(this.sizeId, this.textureSize);\r\n    super.updateValue(value);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { WebGLKernelValue } from './index';\r\n\r\nexport class WebGLKernelValueSingleArray1DI extends WebGLKernelValue {\r\n  constructor(value, settings) {\r\n    super(value, settings);\r\n    this.requestTexture();\r\n    this.bitRatio = 4;\r\n    this.setShape(value);\r\n  }\r\n\r\n  setShape(value) {\r\n    const valueDimensions = utils.getDimensions(value, true);\r\n    this.textureSize = utils.getMemoryOptimizedFloatTextureSize(valueDimensions, this.bitRatio);\r\n    this.dimensions = new Int32Array([valueDimensions[1], 1, 1]);\r\n    this.uploadArrayLength = this.textureSize[0] * this.textureSize[1] * this.bitRatio;\r\n    this.uploadValue = new Float32Array(this.uploadArrayLength);\r\n  }\r\n\r\n  getStringValueHandler() {\r\n    return utils.linesToString([\r\n      `const uploadValue_${this.name} = new Float32Array(${this.uploadArrayLength})`,\r\n      `flattenTo(${this.varName}, uploadValue_${this.name})`,\r\n    ]);\r\n  }\r\n\r\n  getSource() {\r\n    return utils.linesToString([\r\n      `uniform sampler2D ${this.id}`,\r\n      `ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,\r\n      `ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`,\r\n    ]);\r\n  }\r\n\r\n  updateValue(value) {\r\n    if (value.constructor !== this.initialValueConstructor) {\r\n      this.onUpdateValueMismatch();\r\n      return;\r\n    }\r\n    const { context: gl } = this;\r\n    utils.flatten2dArrayTo(value, this.uploadValue);\r\n    gl.activeTexture(this.contextHandle);\r\n    gl.bindTexture(gl.TEXTURE_2D, this.texture);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\r\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, this.textureSize[0], this.textureSize[1], 0, gl.RGBA, gl.FLOAT, this.uploadValue);\r\n    this.kernel.setUniform1i(this.id, this.index);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { WebGLKernelValueSingleArray1DI } from './single-array1d-i';\r\n\r\nexport class WebGLKernelValueDynamicSingleArray1DI extends WebGLKernelValueSingleArray1DI {\r\n  getSource() {\r\n    return utils.linesToString([\r\n      `uniform sampler2D ${this.id}`,\r\n      `uniform ivec2 ${this.sizeId}`,\r\n      `uniform ivec3 ${this.dimensionsId}`,\r\n    ]);\r\n  }\r\n\r\n  updateValue(value) {\r\n    this.setShape(value);\r\n    this.kernel.setUniform3iv(this.dimensionsId, this.dimensions);\r\n    this.kernel.setUniform2iv(this.sizeId, this.textureSize);\r\n    super.updateValue(value);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { WebGLKernelValue } from './index';\r\n\r\nexport class WebGLKernelValueSingleArray2DI extends WebGLKernelValue {\r\n  constructor(value, settings) {\r\n    super(value, settings);\r\n    this.requestTexture();\r\n    this.bitRatio = 4;\r\n    this.setShape(value);\r\n  }\r\n\r\n  setShape(value) {\r\n    const valueDimensions = utils.getDimensions(value, true);\r\n    this.textureSize = utils.getMemoryOptimizedFloatTextureSize(valueDimensions, this.bitRatio);\r\n    this.dimensions = new Int32Array([valueDimensions[1], valueDimensions[2], 1]);\r\n    this.uploadArrayLength = this.textureSize[0] * this.textureSize[1] * this.bitRatio;\r\n    this.uploadValue = new Float32Array(this.uploadArrayLength);\r\n  }\r\n\r\n  getStringValueHandler() {\r\n    return utils.linesToString([\r\n      `const uploadValue_${this.name} = new Float32Array(${this.uploadArrayLength})`,\r\n      `flattenTo(${this.varName}, uploadValue_${this.name})`,\r\n    ]);\r\n  }\r\n\r\n  getSource() {\r\n    return utils.linesToString([\r\n      `uniform sampler2D ${this.id}`,\r\n      `ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,\r\n      `ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`,\r\n    ]);\r\n  }\r\n\r\n  updateValue(value) {\r\n    if (value.constructor !== this.initialValueConstructor) {\r\n      this.onUpdateValueMismatch();\r\n      return;\r\n    }\r\n    const { context: gl } = this;\r\n    utils.flatten3dArrayTo(value, this.uploadValue);\r\n    gl.activeTexture(this.contextHandle);\r\n    gl.bindTexture(gl.TEXTURE_2D, this.texture);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\r\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, this.textureSize[0], this.textureSize[1], 0, gl.RGBA, gl.FLOAT, this.uploadValue);\r\n    this.kernel.setUniform1i(this.id, this.index);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { WebGLKernelValueSingleArray2DI } from './single-array2d-i';\r\n\r\nexport class WebGLKernelValueDynamicSingleArray2DI extends WebGLKernelValueSingleArray2DI {\r\n  getSource() {\r\n    return utils.linesToString([\r\n      `uniform sampler2D ${this.id}`,\r\n      `uniform ivec2 ${this.sizeId}`,\r\n      `uniform ivec3 ${this.dimensionsId}`,\r\n    ]);\r\n  }\r\n\r\n  updateValue(value) {\r\n    this.setShape(value);\r\n    this.kernel.setUniform3iv(this.dimensionsId, this.dimensions);\r\n    this.kernel.setUniform2iv(this.sizeId, this.textureSize);\r\n    super.updateValue(value);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { WebGLKernelValue } from './index';\r\n\r\nexport class WebGLKernelValueSingleArray3DI extends WebGLKernelValue {\r\n  constructor(value, settings) {\r\n    super(value, settings);\r\n    this.requestTexture();\r\n    this.bitRatio = 4;\r\n    this.setShape(value);\r\n  }\r\n\r\n  setShape(value) {\r\n    const valueDimensions = utils.getDimensions(value, true);\r\n    this.textureSize = utils.getMemoryOptimizedFloatTextureSize(valueDimensions, this.bitRatio);\r\n    this.dimensions = new Int32Array([valueDimensions[1], valueDimensions[2], valueDimensions[3]]);\r\n    this.uploadArrayLength = this.textureSize[0] * this.textureSize[1] * this.bitRatio;\r\n    this.uploadValue = new Float32Array(this.uploadArrayLength);\r\n  }\r\n\r\n  getStringValueHandler() {\r\n    return utils.linesToString([\r\n      `const uploadValue_${this.name} = new Float32Array(${this.uploadArrayLength})`,\r\n      `flattenTo(${this.varName}, uploadValue_${this.name})`,\r\n    ]);\r\n  }\r\n\r\n  getSource() {\r\n    return utils.linesToString([\r\n      `uniform sampler2D ${this.id}`,\r\n      `ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,\r\n      `ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`,\r\n    ]);\r\n  }\r\n\r\n  updateValue(value) {\r\n    if (value.constructor !== this.initialValueConstructor) {\r\n      this.onUpdateValueMismatch();\r\n      return;\r\n    }\r\n    const { context: gl } = this;\r\n    utils.flatten4dArrayTo(value, this.uploadValue);\r\n    gl.activeTexture(this.contextHandle);\r\n    gl.bindTexture(gl.TEXTURE_2D, this.texture);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\r\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, this.textureSize[0], this.textureSize[1], 0, gl.RGBA, gl.FLOAT, this.uploadValue);\r\n    this.kernel.setUniform1i(this.id, this.index);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { WebGLKernelValueSingleArray3DI } from './single-array3d-i';\r\n\r\nexport class WebGLKernelValueDynamicSingleArray3DI extends WebGLKernelValueSingleArray3DI {\r\n  getSource() {\r\n    return utils.linesToString([\r\n      `uniform sampler2D ${this.id}`,\r\n      `uniform ivec2 ${this.sizeId}`,\r\n      `uniform ivec3 ${this.dimensionsId}`,\r\n    ]);\r\n  }\r\n\r\n  updateValue(value) {\r\n    this.setShape(value);\r\n    this.kernel.setUniform3iv(this.dimensionsId, this.dimensions);\r\n    this.kernel.setUniform2iv(this.sizeId, this.textureSize);\r\n    super.updateValue(value);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { WebGLKernelValue } from './index';\r\n\r\nexport class WebGLKernelValueSingleArray2 extends WebGLKernelValue {\r\n  constructor(value, settings) {\r\n    super(value, settings);\r\n    this.uploadValue = value;\r\n  }\r\n  getSource(value) {\r\n    if (this.origin === 'constants') {\r\n      return `const vec2 ${this.id} = vec2(${value[0]},${value[1]});\\n`;\r\n    }\r\n    return `uniform vec2 ${this.id};\\n`;\r\n  }\r\n\r\n  getStringValueHandler() {\r\n    return `const uploadValue_${this.name} = ${this.varName};\\n`;\r\n  }\r\n\r\n  updateValue(value) {\r\n    if (this.origin === 'constants') return;\r\n    this.kernel.setUniform2fv(this.id, this.uploadValue = value);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { WebGLKernelValue } from './index';\r\n\r\nexport class WebGLKernelValueSingleArray3 extends WebGLKernelValue {\r\n  constructor(value, settings) {\r\n    super(value, settings);\r\n    this.uploadValue = value;\r\n  }\r\n  getSource(value) {\r\n    if (this.origin === 'constants') {\r\n      return `const vec3 ${this.id} = vec3(${value[0]},${value[1]},${value[2]});\\n`;\r\n    }\r\n    return `uniform vec3 ${this.id};\\n`;\r\n  }\r\n\r\n  getStringValueHandler() {\r\n    return `const uploadValue_${this.name} = ${this.varName};\\n`;\r\n  }\r\n\r\n  updateValue(value) {\r\n    if (this.origin === 'constants') return;\r\n    this.kernel.setUniform3fv(this.id, this.uploadValue = value);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { WebGLKernelValue } from './index';\r\n\r\nexport class WebGLKernelValueSingleArray4 extends WebGLKernelValue {\r\n  constructor(value, settings) {\r\n    super(value, settings);\r\n    this.uploadValue = value;\r\n  }\r\n  getSource(value) {\r\n    if (this.origin === 'constants') {\r\n      return `const vec4 ${this.id} = vec4(${value[0]},${value[1]},${value[2]},${value[3]});\\n`;\r\n    }\r\n    return `uniform vec4 ${this.id};\\n`;\r\n  }\r\n\r\n  getStringValueHandler() {\r\n    return `const uploadValue_${this.name} = ${this.varName};\\n`;\r\n  }\r\n\r\n  updateValue(value) {\r\n    if (this.origin === 'constants') return;\r\n    this.kernel.setUniform4fv(this.id, this.uploadValue = value);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { WebGLKernelValue } from './index';\r\n\r\nexport class WebGLKernelValueUnsignedArray extends WebGLKernelValue {\r\n  constructor(value, settings) {\r\n    super(value, settings);\r\n    this.requestTexture();\r\n    this.bitRatio = this.getBitRatio(value);\r\n    this.dimensions = utils.getDimensions(value, true);\r\n    this.textureSize = utils.getMemoryOptimizedPackedTextureSize(this.dimensions, this.bitRatio);\r\n    this.uploadArrayLength = this.textureSize[0] * this.textureSize[1] * (4 / this.bitRatio);\r\n    this.TranserArrayType = this.getTransferArrayType(value);\r\n    this.preUploadValue = new this.TranserArrayType(this.uploadArrayLength);\r\n    this.uploadValue = new Uint8Array(this.preUploadValue.buffer);\r\n  }\r\n\r\n  getStringValueHandler() {\r\n    return utils.linesToString([\r\n      `const preUploadValue_${this.name} = new ${this.TranserArrayType.name}(${this.uploadArrayLength})`,\r\n      `const uploadValue_${this.name} = new Uint8Array(preUploadValue_${this.name}.buffer)`,\r\n      `flattenTo(${this.varName}, preUploadValue_${this.name})`,\r\n    ]);\r\n  }\r\n\r\n  getSource() {\r\n    return utils.linesToString([\r\n      `uniform sampler2D ${this.id}`,\r\n      `ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,\r\n      `ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`,\r\n    ]);\r\n  }\r\n\r\n  updateValue(value) {\r\n    if (value.constructor !== this.initialValueConstructor) {\r\n      this.onUpdateValueMismatch();\r\n      return;\r\n    }\r\n    const { context: gl } = this;\r\n    utils.flattenTo(value, this.preUploadValue);\r\n    gl.activeTexture(this.contextHandle);\r\n    gl.bindTexture(gl.TEXTURE_2D, this.texture);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\r\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, this.textureSize[0], this.textureSize[1], 0, gl.RGBA, gl.UNSIGNED_BYTE, this.uploadValue);\r\n    this.kernel.setUniform1i(this.id, this.index);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { WebGLKernelValueUnsignedArray } from './unsigned-array';\r\n\r\nexport class WebGLKernelValueDynamicUnsignedArray extends WebGLKernelValueUnsignedArray {\r\n  getSource() {\r\n    return utils.linesToString([\r\n      `uniform sampler2D ${this.id}`,\r\n      `uniform ivec2 ${this.sizeId}`,\r\n      `uniform ivec3 ${this.dimensionsId}`,\r\n    ]);\r\n  }\r\n\r\n  updateValue(value) {\r\n    this.dimensions = utils.getDimensions(value, true);\r\n    this.textureSize = utils.getMemoryOptimizedPackedTextureSize(this.dimensions, this.bitRatio);\r\n    this.uploadArrayLength = this.textureSize[0] * this.textureSize[1] * (4 / this.bitRatio);\r\n    const Type = this.getTransferArrayType(value);\r\n    this.preUploadValue = new Type(this.uploadArrayLength);\r\n    this.uploadValue = new Uint8Array(this.preUploadValue.buffer);\r\n    this.kernel.setUniform3iv(this.dimensionsId, this.dimensions);\r\n    this.kernel.setUniform2iv(this.sizeId, this.textureSize);\r\n    super.updateValue(value);\r\n  }\r\n}\r\n","import { WebGLKernelValueBoolean } from './kernel-value/boolean';\r\nimport { WebGLKernelValueFloat } from './kernel-value/float';\r\nimport { WebGLKernelValueInteger } from './kernel-value/integer';\r\n\r\nimport { WebGLKernelValueHTMLImage } from './kernel-value/html-image';\r\nimport { WebGLKernelValueDynamicHTMLImage } from './kernel-value/dynamic-html-image';\r\n\r\nimport { WebGLKernelValueSingleInput } from './kernel-value/single-input';\r\nimport { WebGLKernelValueDynamicSingleInput } from './kernel-value/dynamic-single-input';\r\n\r\nimport { WebGLKernelValueUnsignedInput } from './kernel-value/unsigned-input';\r\nimport { WebGLKernelValueDynamicUnsignedInput } from './kernel-value/dynamic-unsigned-input';\r\n\r\nimport { WebGLKernelValueMemoryOptimizedNumberTexture } from './kernel-value/memory-optimized-number-texture';\r\nimport { WebGLKernelValueDynamicMemoryOptimizedNumberTexture } from './kernel-value/dynamic-memory-optimized-number-texture';\r\n\r\nimport { WebGLKernelValueNumberTexture } from './kernel-value/number-texture';\r\nimport { WebGLKernelValueDynamicNumberTexture } from './kernel-value/dynamic-number-texture';\r\n\r\nimport { WebGLKernelValueSingleArray } from './kernel-value/single-array';\r\nimport { WebGLKernelValueDynamicSingleArray } from './kernel-value/dynamic-single-array';\r\n\r\nimport { WebGLKernelValueSingleArray1DI } from './kernel-value/single-array1d-i';\r\nimport { WebGLKernelValueDynamicSingleArray1DI } from './kernel-value/dynamic-single-array1d-i';\r\n\r\nimport { WebGLKernelValueSingleArray2DI } from './kernel-value/single-array2d-i';\r\nimport { WebGLKernelValueDynamicSingleArray2DI } from './kernel-value/dynamic-single-array2d-i';\r\n\r\nimport { WebGLKernelValueSingleArray3DI } from './kernel-value/single-array3d-i';\r\nimport { WebGLKernelValueDynamicSingleArray3DI } from './kernel-value/dynamic-single-array3d-i';\r\n\r\nimport { WebGLKernelValueSingleArray2 } from './kernel-value/single-array2';\r\nimport { WebGLKernelValueSingleArray3 } from './kernel-value/single-array3';\r\nimport { WebGLKernelValueSingleArray4 } from './kernel-value/single-array4';\r\n\r\nimport { WebGLKernelValueUnsignedArray } from './kernel-value/unsigned-array';\r\nimport { WebGLKernelValueDynamicUnsignedArray } from './kernel-value/dynamic-unsigned-array';\r\n\r\nconst kernelValueMaps = {\r\n  unsigned: {\r\n    dynamic: {\r\n      'Boolean': WebGLKernelValueBoolean,\r\n      'Integer': WebGLKernelValueInteger,\r\n      'Float': WebGLKernelValueFloat,\r\n      'Array': WebGLKernelValueDynamicUnsignedArray,\r\n      'Array(2)': false,\r\n      'Array(3)': false,\r\n      'Array(4)': false,\r\n      'Array1D(2)': false,\r\n      'Array1D(3)': false,\r\n      'Array1D(4)': false,\r\n      'Array2D(2)': false,\r\n      'Array2D(3)': false,\r\n      'Array2D(4)': false,\r\n      'Array3D(2)': false,\r\n      'Array3D(3)': false,\r\n      'Array3D(4)': false,\r\n      'Input': WebGLKernelValueDynamicUnsignedInput,\r\n      'NumberTexture': WebGLKernelValueDynamicNumberTexture,\r\n      'ArrayTexture(1)': WebGLKernelValueDynamicNumberTexture,\r\n      'ArrayTexture(2)': WebGLKernelValueDynamicNumberTexture,\r\n      'ArrayTexture(3)': WebGLKernelValueDynamicNumberTexture,\r\n      'ArrayTexture(4)': WebGLKernelValueDynamicNumberTexture,\r\n      'MemoryOptimizedNumberTexture': WebGLKernelValueDynamicMemoryOptimizedNumberTexture,\r\n      'HTMLImage': WebGLKernelValueDynamicHTMLImage,\r\n      'HTMLImageArray': false,\r\n    },\r\n    static: {\r\n      'Boolean': WebGLKernelValueBoolean,\r\n      'Float': WebGLKernelValueFloat,\r\n      'Integer': WebGLKernelValueInteger,\r\n      'Array': WebGLKernelValueUnsignedArray,\r\n      'Array(2)': false,\r\n      'Array(3)': false,\r\n      'Array(4)': false,\r\n      'Array1D(2)': false,\r\n      'Array1D(3)': false,\r\n      'Array1D(4)': false,\r\n      'Array2D(2)': false,\r\n      'Array2D(3)': false,\r\n      'Array2D(4)': false,\r\n      'Array3D(2)': false,\r\n      'Array3D(3)': false,\r\n      'Array3D(4)': false,\r\n      'Input': WebGLKernelValueUnsignedInput,\r\n      'NumberTexture': WebGLKernelValueNumberTexture,\r\n      'ArrayTexture(1)': WebGLKernelValueNumberTexture,\r\n      'ArrayTexture(2)': WebGLKernelValueNumberTexture,\r\n      'ArrayTexture(3)': WebGLKernelValueNumberTexture,\r\n      'ArrayTexture(4)': WebGLKernelValueNumberTexture,\r\n      'MemoryOptimizedNumberTexture': WebGLKernelValueDynamicMemoryOptimizedNumberTexture,\r\n      'HTMLImage': WebGLKernelValueHTMLImage,\r\n      'HTMLImageArray': false,\r\n    }\r\n  },\r\n  single: {\r\n    dynamic: {\r\n      'Boolean': WebGLKernelValueBoolean,\r\n      'Integer': WebGLKernelValueInteger,\r\n      'Float': WebGLKernelValueFloat,\r\n      'Array': WebGLKernelValueDynamicSingleArray,\r\n      'Array(2)': WebGLKernelValueSingleArray2,\r\n      'Array(3)': WebGLKernelValueSingleArray3,\r\n      'Array(4)': WebGLKernelValueSingleArray4,\r\n      'Array1D(2)': WebGLKernelValueDynamicSingleArray1DI,\r\n      'Array1D(3)': WebGLKernelValueDynamicSingleArray1DI,\r\n      'Array1D(4)': WebGLKernelValueDynamicSingleArray1DI,\r\n      'Array2D(2)': WebGLKernelValueDynamicSingleArray2DI,\r\n      'Array2D(3)': WebGLKernelValueDynamicSingleArray2DI,\r\n      'Array2D(4)': WebGLKernelValueDynamicSingleArray2DI,\r\n      'Array3D(2)': WebGLKernelValueDynamicSingleArray3DI,\r\n      'Array3D(3)': WebGLKernelValueDynamicSingleArray3DI,\r\n      'Array3D(4)': WebGLKernelValueDynamicSingleArray3DI,\r\n      'Array': WebGLKernelValueDynamicSingleArray,\r\n      'Input': WebGLKernelValueDynamicSingleInput,\r\n      'NumberTexture': WebGLKernelValueDynamicNumberTexture,\r\n      'ArrayTexture(1)': WebGLKernelValueDynamicNumberTexture,\r\n      'ArrayTexture(2)': WebGLKernelValueDynamicNumberTexture,\r\n      'ArrayTexture(3)': WebGLKernelValueDynamicNumberTexture,\r\n      'ArrayTexture(4)': WebGLKernelValueDynamicNumberTexture,\r\n      'MemoryOptimizedNumberTexture': WebGLKernelValueDynamicMemoryOptimizedNumberTexture,\r\n      'HTMLImage': WebGLKernelValueDynamicHTMLImage,\r\n      'HTMLImageArray': false,\r\n    },\r\n    static: {\r\n      'Boolean': WebGLKernelValueBoolean,\r\n      'Float': WebGLKernelValueFloat,\r\n      'Integer': WebGLKernelValueInteger,\r\n      'Array': WebGLKernelValueSingleArray,\r\n      'Array(2)': WebGLKernelValueSingleArray2,\r\n      'Array(3)': WebGLKernelValueSingleArray3,\r\n      'Array(4)': WebGLKernelValueSingleArray4,\r\n      'Array1D(2)': WebGLKernelValueSingleArray1DI,\r\n      'Array1D(3)': WebGLKernelValueSingleArray1DI,\r\n      'Array1D(4)': WebGLKernelValueSingleArray1DI,\r\n      'Array2D(2)': WebGLKernelValueSingleArray2DI,\r\n      'Array2D(3)': WebGLKernelValueSingleArray2DI,\r\n      'Array2D(4)': WebGLKernelValueSingleArray2DI,\r\n      'Array3D(2)': WebGLKernelValueSingleArray3DI,\r\n      'Array3D(3)': WebGLKernelValueSingleArray3DI,\r\n      'Array3D(4)': WebGLKernelValueSingleArray3DI,\r\n      'Input': WebGLKernelValueSingleInput,\r\n      'NumberTexture': WebGLKernelValueNumberTexture,\r\n      'ArrayTexture(1)': WebGLKernelValueNumberTexture,\r\n      'ArrayTexture(2)': WebGLKernelValueNumberTexture,\r\n      'ArrayTexture(3)': WebGLKernelValueNumberTexture,\r\n      'ArrayTexture(4)': WebGLKernelValueNumberTexture,\r\n      'MemoryOptimizedNumberTexture': WebGLKernelValueMemoryOptimizedNumberTexture,\r\n      'HTMLImage': WebGLKernelValueHTMLImage,\r\n      'HTMLImageArray': false,\r\n    }\r\n  },\r\n};\r\n\r\nexport function lookupKernelValueType(type, dynamic, precision, value) {\r\n  if (!type) {\r\n    throw new Error('type missing');\r\n  }\r\n  if (!dynamic) {\r\n    throw new Error('dynamic missing');\r\n  }\r\n  if (!precision) {\r\n    throw new Error('precision missing');\r\n  }\r\n  if (value.type) {\r\n    type = value.type;\r\n  }\r\n  const types = kernelValueMaps[precision][dynamic];\r\n  if (types[type] === false) {\r\n    return null;\r\n  } else if (types[type] === undefined) {\r\n    throw new Error(`Could not find a KernelValue for ${ type }`);\r\n  }\r\n  return types[type];\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { WebGLKernelValueSingleInput } from './single-input';\r\n\r\nexport class WebGLKernelValueDynamicSingleInput extends WebGLKernelValueSingleInput {\r\n  getSource() {\r\n    return utils.linesToString([\r\n      `uniform sampler2D ${this.id}`,\r\n      `uniform ivec2 ${this.sizeId}`,\r\n      `uniform ivec3 ${this.dimensionsId}`,\r\n    ]);\r\n  }\r\n\r\n  updateValue(value) {\r\n    let [w, h, d] = value.size;\r\n    this.dimensions = new Int32Array([w || 1, h || 1, d || 1]);\r\n    this.textureSize = utils.getMemoryOptimizedFloatTextureSize(this.dimensions, this.bitRatio);\r\n    this.uploadArrayLength = this.textureSize[0] * this.textureSize[1] * this.bitRatio;\r\n    this.uploadValue = new Float32Array(this.uploadArrayLength);\r\n    this.kernel.setUniform3iv(this.dimensionsId, this.dimensions);\r\n    this.kernel.setUniform2iv(this.sizeId, this.textureSize);\r\n    super.updateValue(value);\r\n  }\r\n}\r\n","import { GLKernel } from '../gl/kernel';\r\nimport { FunctionBuilder } from '../function-builder';\r\nimport { WebGLFunctionNode } from './function-node';\r\nimport { utils } from '../../utils';\r\nimport triangleNoise from '../../plugins/triangle-noise';\r\nimport { fragmentShader } from './fragment-shader';\r\nimport { vertexShader } from './vertex-shader';\r\nimport { glKernelString } from '../gl/kernel-string';\r\nimport { lookupKernelValueType } from './kernel-value-maps';\r\n\r\nlet isSupported = null;\r\nlet testCanvas = null;\r\nlet testContext = null;\r\nlet testExtensions = null;\r\nlet features = null;\r\n\r\nconst plugins = [triangleNoise];\r\nconst canvases = [];\r\nconst maxTexSizes = {};\r\n\r\n/**\r\n * @desc Kernel Implementation for WebGL.\r\n * <p>This builds the shaders and runs them on the GPU,\r\n * the outputs the result back as float(enabled by default) and Texture.</p>\r\n *\r\n * @prop {Object} textureCache - webGl Texture cache\r\n * @prop {Object} programUniformLocationCache - Location of program variables in memory\r\n * @prop {Object} framebuffer - Webgl frameBuffer\r\n * @prop {Object} buffer - WebGL buffer\r\n * @prop {Object} program - The webGl Program\r\n * @prop {Object} functionBuilder - Function Builder instance bound to this Kernel\r\n * @prop {Boolean} pipeline - Set output type to FAST mode (GPU to GPU via Textures), instead of float\r\n * @prop {String} endianness - Endian information like Little-endian, Big-endian.\r\n * @prop {Array} argumentTypes - Types of parameters sent to the Kernel\r\n * @prop {String} compiledFragmentShader - Compiled fragment shader string\r\n * @prop {String} compiledVertexShader - Compiled Vertical shader string\r\n * @extends GLKernel\r\n */\r\nexport class WebGLKernel extends GLKernel {\r\n  static get isSupported() {\r\n    if (isSupported !== null) {\r\n      return isSupported;\r\n    }\r\n    this.setupFeatureChecks();\r\n    isSupported = this.isContextMatch(testContext);\r\n    return isSupported;\r\n  }\r\n\r\n  static setupFeatureChecks() {\r\n    if (typeof document !== 'undefined') {\r\n      testCanvas = document.createElement('canvas');\r\n    } else if (typeof OffscreenCanvas !== 'undefined') {\r\n      testCanvas = new OffscreenCanvas(0, 0);\r\n    }\r\n    if (!testCanvas) return;\r\n    testContext = testCanvas.getContext('webgl') || testCanvas.getContext('experimental-webgl');\r\n    if (!testContext || !testContext.getExtension) return;\r\n    testExtensions = {\r\n      OES_texture_float: testContext.getExtension('OES_texture_float'),\r\n      OES_texture_float_linear: testContext.getExtension('OES_texture_float_linear'),\r\n      OES_element_index_uint: testContext.getExtension('OES_element_index_uint'),\r\n      WEBGL_draw_buffers: testContext.getExtension('WEBGL_draw_buffers'),\r\n    };\r\n    features = this.getFeatures();\r\n  }\r\n\r\n  static isContextMatch(context) {\r\n    if (typeof WebGLRenderingContext !== 'undefined') {\r\n      return context instanceof WebGLRenderingContext;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  static getFeatures() {\r\n    const isDrawBuffers = this.getIsDrawBuffers();\r\n    return Object.freeze({\r\n      isFloatRead: this.getIsFloatRead(),\r\n      isIntegerDivisionAccurate: this.getIsIntegerDivisionAccurate(),\r\n      isTextureFloat: this.getIsTextureFloat(),\r\n      isDrawBuffers,\r\n      kernelMap: isDrawBuffers,\r\n      channelCount: this.getChannelCount(),\r\n    });\r\n  }\r\n\r\n  static getIsTextureFloat() {\r\n    return Boolean(testExtensions.OES_texture_float);\r\n  }\r\n\r\n  static getIsDrawBuffers() {\r\n    return Boolean(testExtensions.WEBGL_draw_buffers);\r\n  }\r\n\r\n  static getChannelCount() {\r\n    return testExtensions.WEBGL_draw_buffers ?\r\n      testContext.getParameter(testExtensions.WEBGL_draw_buffers.MAX_DRAW_BUFFERS_WEBGL) :\r\n      1;\r\n  }\r\n\r\n  static lookupKernelValueType(type, dynamic, precision, value) {\r\n    return lookupKernelValueType(type, dynamic, precision, value);\r\n  }\r\n\r\n  static get testCanvas() {\r\n    return testCanvas;\r\n  }\r\n\r\n  static get testContext() {\r\n    return testContext;\r\n  }\r\n\r\n  static get features() {\r\n    return features;\r\n  }\r\n\r\n  static get fragmentShader() {\r\n    return fragmentShader;\r\n  }\r\n\r\n  static get vertexShader() {\r\n    return vertexShader;\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @param {String} source\r\n   * @param {IKernelSettings} settings\r\n   */\r\n  constructor(source, settings) {\r\n    super(source, settings);\r\n    this.program = null;\r\n    this.pipeline = settings.pipeline;\r\n    this.endianness = utils.systemEndianness();\r\n    this.extensions = {};\r\n    this.subKernelOutputTextures = null;\r\n    this.kernelArguments = null;\r\n    this.argumentTextureCount = 0;\r\n    this.constantTextureCount = 0;\r\n    this.compiledFragmentShader = null;\r\n    this.compiledVertexShader = null;\r\n    this.fragShader = null;\r\n    this.vertShader = null;\r\n    this.drawBuffersMap = null;\r\n    this.outputTexture = null;\r\n\r\n    /**\r\n     *\r\n     * @type {Int32Array|null}\r\n     */\r\n    this.maxTexSize = null;\r\n    this.switchingKernels = false;\r\n    this.onRequestSwitchKernel = null;\r\n\r\n    this.mergeSettings(source.settings || settings);\r\n\r\n    /**\r\n     * The thread dimensions, x, y and z\r\n     * @type {Array|null}\r\n     */\r\n    this.threadDim = null;\r\n    this.framebuffer = null;\r\n    this.buffer = null;\r\n    this.textureCache = {};\r\n    this.programUniformLocationCache = {};\r\n    this.uniform1fCache = {};\r\n    this.uniform1iCache = {};\r\n    this.uniform2fCache = {};\r\n    this.uniform2fvCache = {};\r\n    this.uniform2ivCache = {};\r\n    this.uniform3fvCache = {};\r\n    this.uniform3ivCache = {};\r\n    this.uniform4fvCache = {};\r\n    this.uniform4ivCache = {};\r\n  }\r\n\r\n  initCanvas() {\r\n    if (typeof document !== 'undefined') {\r\n      const canvas = document.createElement('canvas');\r\n      // Default width and height, to fix webgl issue in safari\r\n      canvas.width = 2;\r\n      canvas.height = 2;\r\n      return canvas;\r\n    } else if (typeof OffscreenCanvas !== 'undefined') {\r\n      return new OffscreenCanvas(0, 0);\r\n    }\r\n  }\r\n\r\n  initContext() {\r\n    const settings = {\r\n      alpha: false,\r\n      depth: false,\r\n      antialias: false\r\n    };\r\n    return this.canvas.getContext('webgl', settings) || this.canvas.getContext('experimental-webgl', settings);\r\n  }\r\n\r\n  initPlugins(settings) {\r\n    // default plugins\r\n    const pluginsToUse = [];\r\n    const { source } = this;\r\n    if (typeof source === 'string') {\r\n      for (let i = 0; i < plugins.length; i++) {\r\n        const plugin = plugins[i];\r\n        if (source.match(plugin.functionMatch)) {\r\n          pluginsToUse.push(plugin);\r\n        }\r\n      }\r\n    } else if (typeof source === 'object') {\r\n      // `source` is from object, json\r\n      if (settings.pluginNames) { //TODO: in context of JSON support, pluginNames may not exist here\r\n        for (let i = 0; i < plugins.length; i++) {\r\n          const plugin = plugins[i];\r\n          const usePlugin = settings.pluginNames.some(pluginName => pluginName === plugin.name);\r\n          if (usePlugin) {\r\n            pluginsToUse.push(plugin);\r\n          }\r\n        }\r\n      }\r\n    }\r\n    return pluginsToUse;\r\n  }\r\n\r\n  initExtensions() {\r\n    this.extensions = {\r\n      OES_texture_float: this.context.getExtension('OES_texture_float'),\r\n      OES_texture_float_linear: this.context.getExtension('OES_texture_float_linear'),\r\n      OES_element_index_uint: this.context.getExtension('OES_element_index_uint'),\r\n      WEBGL_draw_buffers: this.context.getExtension('WEBGL_draw_buffers'),\r\n      WEBGL_color_buffer_float: this.context.getExtension('WEBGL_color_buffer_float'),\r\n    };\r\n  }\r\n\r\n  /**\r\n   * @desc Validate settings related to Kernel, such as dimensions size, and auto output support.\r\n   * @param {IArguments} args\r\n   */\r\n  validateSettings(args) {\r\n    if (!this.validate) {\r\n      this.texSize = utils.getKernelTextureSize({\r\n        optimizeFloatMemory: this.optimizeFloatMemory,\r\n        precision: this.precision,\r\n      }, this.output);\r\n      return;\r\n    }\r\n\r\n    const { features } = this.constructor;\r\n    if (this.optimizeFloatMemory === true && !features.isTextureFloat) {\r\n      throw new Error('Float textures are not supported');\r\n    } else if (this.precision === 'single' && !features.isFloatRead) {\r\n      throw new Error('Single precision not supported');\r\n    } else if (!this.graphical && this.precision === null && features.isTextureFloat) {\r\n      this.precision = features.isFloatRead ? 'single' : 'unsigned';\r\n    }\r\n\r\n    if (this.subKernels && this.subKernels.length > 0 && !this.extensions.WEBGL_draw_buffers) {\r\n      throw new Error('could not instantiate draw buffers extension');\r\n    }\r\n\r\n    if (this.fixIntegerDivisionAccuracy === null) {\r\n      this.fixIntegerDivisionAccuracy = !features.isIntegerDivisionAccurate;\r\n    } else if (this.fixIntegerDivisionAccuracy && features.isIntegerDivisionAccurate) {\r\n      this.fixIntegerDivisionAccuracy = false;\r\n    }\r\n\r\n    this.checkOutput();\r\n\r\n    if (!this.output || this.output.length === 0) {\r\n      if (args.length !== 1) {\r\n        throw new Error('Auto output only supported for kernels with only one input');\r\n      }\r\n\r\n      const argType = utils.getVariableType(args[0], this.strictIntegers);\r\n      if (argType === 'Array') {\r\n        this.output = utils.getDimensions(argType);\r\n      } else if (argType === 'NumberTexture' || argType === 'ArrayTexture(4)') {\r\n        this.output = args[0].output;\r\n      } else {\r\n        throw new Error('Auto output not supported for input type: ' + argType);\r\n      }\r\n    }\r\n\r\n    if (this.graphical) {\r\n      if (this.output.length !== 2) {\r\n        throw new Error('Output must have 2 dimensions on graphical mode');\r\n      }\r\n\r\n      if (this.precision === 'precision') {\r\n        this.precision = 'unsigned';\r\n        console.warn('Cannot use graphical mode and single precision at the same time');\r\n      }\r\n\r\n      this.texSize = utils.clone(this.output);\r\n      return;\r\n    } else if (this.precision === null && features.isTextureFloat) {\r\n      this.precision = 'single';\r\n    }\r\n\r\n    this.texSize = utils.getKernelTextureSize({\r\n      optimizeFloatMemory: this.optimizeFloatMemory,\r\n      precision: this.precision,\r\n    }, this.output);\r\n  }\r\n\r\n  updateMaxTexSize() {\r\n    const { texSize, canvas } = this;\r\n    if (this.maxTexSize === null) {\r\n      let canvasIndex = canvases.indexOf(canvas);\r\n      if (canvasIndex === -1) {\r\n        canvasIndex = canvases.length;\r\n        canvases.push(canvas);\r\n        maxTexSizes[canvasIndex] = [texSize[0], texSize[1]];\r\n      }\r\n      this.maxTexSize = maxTexSizes[canvasIndex];\r\n    }\r\n    if (this.maxTexSize[0] < texSize[0]) {\r\n      this.maxTexSize[0] = texSize[0];\r\n    }\r\n    if (this.maxTexSize[1] < texSize[1]) {\r\n      this.maxTexSize[1] = texSize[1];\r\n    }\r\n  }\r\n\r\n  // TODO: move channel checks to new place\r\n  _oldtranslateSource() {\r\n    const functionBuilder = FunctionBuilder.fromKernel(this, WebGLFunctionNode, {\r\n      fixIntegerDivisionAccuracy: this.fixIntegerDivisionAccuracy\r\n    });\r\n\r\n    // need this line to automatically get returnType\r\n    const translatedSource = functionBuilder.getPrototypeString('kernel');\r\n\r\n    if (!this.returnType) {\r\n      this.returnType = functionBuilder.getKernelResultType();\r\n    }\r\n\r\n    let requiredChannels = 0;\r\n    const returnTypes = functionBuilder.getReturnTypes();\r\n    for (let i = 0; i < returnTypes.length; i++) {\r\n      switch (returnTypes[i]) {\r\n        case 'Float':\r\n        case 'Number':\r\n        case 'Integer':\r\n          requiredChannels++;\r\n          break;\r\n        case 'Array(2)':\r\n          requiredChannels += 2;\r\n          break;\r\n        case 'Array(3)':\r\n          requiredChannels += 3;\r\n          break;\r\n        case 'Array(4)':\r\n          requiredChannels += 4;\r\n          break;\r\n      }\r\n    }\r\n\r\n    if (features && requiredChannels > features.channelCount) {\r\n      throw new Error('Too many channels!');\r\n    }\r\n\r\n    return this.translatedSource = translatedSource;\r\n  }\r\n\r\n  setupArguments(args) {\r\n    this.kernelArguments = [];\r\n    this.argumentTextureCount = 0;\r\n    const needsArgumentTypes = this.argumentTypes === null;\r\n    // TODO: remove\r\n    if (needsArgumentTypes) {\r\n      this.argumentTypes = [];\r\n    }\r\n    this.argumentSizes = [];\r\n    this.argumentBitRatios = [];\r\n    // TODO: end remove\r\n\r\n    if (args.length < this.argumentNames.length) {\r\n      throw new Error('not enough arguments for kernel');\r\n    } else if (args.length > this.argumentNames.length) {\r\n      throw new Error('too many arguments for kernel');\r\n    }\r\n\r\n    const { context: gl } = this;\r\n    let textureIndexes = 0;\r\n    for (let index = 0; index < args.length; index++) {\r\n      const value = args[index];\r\n      const name = this.argumentNames[index];\r\n      let type;\r\n      if (needsArgumentTypes) {\r\n        type = utils.getVariableType(value, this.strictIntegers);\r\n        this.argumentTypes.push(type);\r\n      } else {\r\n        type = this.argumentTypes[index];\r\n      }\r\n      const KernelValue = this.constructor.lookupKernelValueType(type, this.dynamicArguments ? 'dynamic' : 'static', this.precision, args[index]);\r\n      if (KernelValue === null) {\r\n        return this.requestFallback(args);\r\n      }\r\n      const kernelArgument = new KernelValue(value, {\r\n        name,\r\n        type,\r\n        tactic: this.tactic,\r\n        origin: 'user',\r\n        context: gl,\r\n        checkContext: this.checkContext,\r\n        kernel: this,\r\n        strictIntegers: this.strictIntegers,\r\n        onRequestTexture: () => {\r\n          return this.context.createTexture();\r\n        },\r\n        onRequestIndex: () => {\r\n          return textureIndexes++;\r\n        },\r\n        onUpdateValueMismatch: () => {\r\n          this.switchingKernels = true;\r\n        },\r\n        onRequestContextHandle: () => {\r\n          return gl.TEXTURE0 + this.constantTextureCount + this.argumentTextureCount++;\r\n        }\r\n      });\r\n      this.kernelArguments.push(kernelArgument);\r\n      this.argumentSizes.push(kernelArgument.textureSize);\r\n      this.argumentBitRatios[index] = kernelArgument.bitRatio;\r\n    }\r\n  }\r\n\r\n  setupConstants(args) {\r\n    const { context: gl } = this;\r\n    this.kernelConstants = [];\r\n    let needsConstantTypes = this.constantTypes === null;\r\n    if (needsConstantTypes) {\r\n      this.constantTypes = {};\r\n    }\r\n    this.constantBitRatios = {};\r\n    let textureIndexes = 0;\r\n    for (const name in this.constants) {\r\n      const value = this.constants[name];\r\n      let type;\r\n      if (needsConstantTypes) {\r\n        type = utils.getVariableType(value, this.strictIntegers);\r\n        this.constantTypes[name] = type;\r\n      } else {\r\n        type = this.constantTypes[name];\r\n      }\r\n      const KernelValue = this.constructor.lookupKernelValueType(type, 'static', this.precision, value);\r\n      if (KernelValue === null) {\r\n        return this.requestFallback(args);\r\n      }\r\n      const kernelValue = new KernelValue(value, {\r\n        name,\r\n        type,\r\n        tactic: this.tactic,\r\n        origin: 'constants',\r\n        context: this.context,\r\n        checkContext: this.checkContext,\r\n        kernel: this,\r\n        strictIntegers: this.strictIntegers,\r\n        onRequestTexture: () => {\r\n          return this.context.createTexture();\r\n        },\r\n        onRequestIndex: () => {\r\n          return textureIndexes++;\r\n        },\r\n        onRequestContextHandle: () => {\r\n          return gl.TEXTURE0 + this.constantTextureCount++;\r\n        }\r\n      });\r\n      this.constantBitRatios[name] = kernelValue.bitRatio;\r\n      this.kernelConstants.push(kernelValue);\r\n    }\r\n  }\r\n\r\n  build() {\r\n    this.initExtensions();\r\n    this.validateSettings(arguments);\r\n    this.setupConstants(arguments);\r\n    if (this.fallbackRequested) return;\r\n    this.setupArguments(arguments);\r\n    if (this.fallbackRequested) return;\r\n    this.updateMaxTexSize();\r\n    this.translateSource();\r\n    const failureResult = this.pickRenderStrategy(arguments);\r\n    if (failureResult) {\r\n      return failureResult;\r\n    }\r\n    const { texSize, context: gl, canvas } = this;\r\n    gl.enable(gl.SCISSOR_TEST);\r\n    if (this.pipeline && this.precision === 'single') {\r\n      gl.viewport(0, 0, this.maxTexSize[0], this.maxTexSize[1]);\r\n      canvas.width = this.maxTexSize[0];\r\n      canvas.height = this.maxTexSize[1];\r\n    } else {\r\n      gl.viewport(0, 0, this.maxTexSize[0], this.maxTexSize[1]);\r\n      canvas.width = this.maxTexSize[0];\r\n      canvas.height = this.maxTexSize[1];\r\n    }\r\n    const threadDim = this.threadDim = Array.from(this.output);\r\n    while (threadDim.length < 3) {\r\n      threadDim.push(1);\r\n    }\r\n\r\n    const compiledVertexShader = this.getVertexShader(arguments);\r\n    const vertShader = gl.createShader(gl.VERTEX_SHADER);\r\n    gl.shaderSource(vertShader, compiledVertexShader);\r\n    gl.compileShader(vertShader);\r\n    this.vertShader = vertShader;\r\n\r\n    const compiledFragmentShader = this.getFragmentShader(arguments);\r\n    const fragShader = gl.createShader(gl.FRAGMENT_SHADER);\r\n    gl.shaderSource(fragShader, compiledFragmentShader);\r\n    gl.compileShader(fragShader);\r\n    this.fragShader = fragShader;\r\n\r\n    if (this.debug) {\r\n      console.log('GLSL Shader Output:');\r\n      console.log(compiledFragmentShader);\r\n    }\r\n\r\n    if (!gl.getShaderParameter(vertShader, gl.COMPILE_STATUS)) {\r\n      throw new Error('Error compiling vertex shader: ' + gl.getShaderInfoLog(vertShader));\r\n    }\r\n    if (!gl.getShaderParameter(fragShader, gl.COMPILE_STATUS)) {\r\n      throw new Error('Error compiling fragment shader: ' + gl.getShaderInfoLog(fragShader));\r\n    }\r\n\r\n    const program = this.program = gl.createProgram();\r\n    gl.attachShader(program, vertShader);\r\n    gl.attachShader(program, fragShader);\r\n    gl.linkProgram(program);\r\n    this.framebuffer = gl.createFramebuffer();\r\n    this.framebuffer.width = texSize[0];\r\n    this.framebuffer.height = texSize[1];\r\n\r\n    const vertices = new Float32Array([-1, -1,\r\n      1, -1, -1, 1,\r\n      1, 1\r\n    ]);\r\n    const texCoords = new Float32Array([\r\n      0, 0,\r\n      1, 0,\r\n      0, 1,\r\n      1, 1\r\n    ]);\r\n\r\n    const texCoordOffset = vertices.byteLength;\r\n\r\n    let buffer = this.buffer;\r\n    if (!buffer) {\r\n      buffer = this.buffer = gl.createBuffer();\r\n      gl.bindBuffer(gl.ARRAY_BUFFER, buffer);\r\n      gl.bufferData(gl.ARRAY_BUFFER, vertices.byteLength + texCoords.byteLength, gl.STATIC_DRAW);\r\n    } else {\r\n      gl.bindBuffer(gl.ARRAY_BUFFER, buffer);\r\n    }\r\n\r\n    gl.bufferSubData(gl.ARRAY_BUFFER, 0, vertices);\r\n    gl.bufferSubData(gl.ARRAY_BUFFER, texCoordOffset, texCoords);\r\n\r\n    const aPosLoc = gl.getAttribLocation(this.program, 'aPos');\r\n    gl.enableVertexAttribArray(aPosLoc);\r\n    gl.vertexAttribPointer(aPosLoc, 2, gl.FLOAT, false, 0, 0);\r\n    const aTexCoordLoc = gl.getAttribLocation(this.program, 'aTexCoord');\r\n    gl.enableVertexAttribArray(aTexCoordLoc);\r\n    gl.vertexAttribPointer(aTexCoordLoc, 2, gl.FLOAT, false, 0, texCoordOffset);\r\n    gl.bindFramebuffer(gl.FRAMEBUFFER, this.framebuffer);\r\n\r\n    let i = 0;\r\n    gl.useProgram(this.program);\r\n    for (let p in this.constants) {\r\n      this.kernelConstants[i++].updateValue(this.constants[p]);\r\n    }\r\n\r\n    if (!this.immutable) {\r\n      this._setupOutputTexture();\r\n      if (\r\n        this.subKernels !== null &&\r\n        this.subKernels.length > 0\r\n      ) {\r\n        this._setupSubOutputTextures();\r\n      }\r\n    }\r\n  }\r\n\r\n  translateSource() {\r\n    const functionBuilder = FunctionBuilder.fromKernel(this, WebGLFunctionNode, {\r\n      fixIntegerDivisionAccuracy: this.fixIntegerDivisionAccuracy\r\n    });\r\n    this.translatedSource = functionBuilder.getPrototypeString('kernel');\r\n    if (!this.graphical && !this.returnType) {\r\n      this.returnType = functionBuilder.getKernelResultType();\r\n    }\r\n\r\n    if (this.subKernels && this.subKernels.length > 0) {\r\n      for (let i = 0; i < this.subKernels.length; i++) {\r\n        const subKernel = this.subKernels[i];\r\n        if (!subKernel.returnType) {\r\n          subKernel.returnType = functionBuilder.getSubKernelResultType(i);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  run() {\r\n    const { kernelArguments } = this;\r\n    const texSize = this.texSize;\r\n    const gl = this.context;\r\n\r\n    gl.useProgram(this.program);\r\n    gl.scissor(0, 0, texSize[0], texSize[1]);\r\n\r\n    if (this.dynamicOutput) {\r\n      this.setUniform3iv('uOutputDim', this.threadDim);\r\n      this.setUniform2iv('uTexSize', texSize);\r\n    }\r\n\r\n    this.setUniform2f('ratio', texSize[0] / this.maxTexSize[0], texSize[1] / this.maxTexSize[1]);\r\n\r\n    this.switchingKernels = false;\r\n    for (let i = 0; i < kernelArguments.length; i++) {\r\n      kernelArguments[i].updateValue(arguments[i]);\r\n      if (this.switchingKernels) return;\r\n    }\r\n\r\n    if (this.plugins) {\r\n      for (let i = 0; i < this.plugins.length; i++) {\r\n        const plugin = this.plugins[i];\r\n        if (plugin.onBeforeRun) {\r\n          plugin.onBeforeRun(this);\r\n        }\r\n      }\r\n    }\r\n\r\n    if (this.graphical) {\r\n      if (this.pipeline) {\r\n        gl.bindRenderbuffer(gl.RENDERBUFFER, null);\r\n        gl.bindFramebuffer(gl.FRAMEBUFFER, this.framebuffer);\r\n        if (!this.outputTexture || this.immutable) {\r\n          this._setupOutputTexture();\r\n        }\r\n        gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\r\n        return new this.TextureConstructor({\r\n          texture: this.outputTexture,\r\n          size: texSize,\r\n          dimensions: this.threadDim,\r\n          output: this.output,\r\n          context: this.context,\r\n        });\r\n      }\r\n      gl.bindRenderbuffer(gl.RENDERBUFFER, null);\r\n      gl.bindFramebuffer(gl.FRAMEBUFFER, null);\r\n      gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\r\n      return;\r\n    }\r\n\r\n    gl.bindFramebuffer(gl.FRAMEBUFFER, this.framebuffer);\r\n    if (this.immutable) {\r\n      this._setupOutputTexture();\r\n    }\r\n\r\n    if (this.subKernels !== null) {\r\n      if (this.immutable) {\r\n        this._setupSubOutputTextures();\r\n      }\r\n      this.extensions.WEBGL_draw_buffers.drawBuffersWEBGL(this.drawBuffersMap);\r\n    }\r\n\r\n    gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\r\n  }\r\n\r\n  /**\r\n   * @desc This return defined outputTexture, which is setup in .build(), or if immutable, is defined in .run()\r\n   * @returns {Object} Output Texture Cache\r\n   */\r\n  getOutputTexture() {\r\n    return this.outputTexture;\r\n  }\r\n\r\n  /**\r\n   * @desc Setup and replace output texture\r\n   */\r\n  _setupOutputTexture() {\r\n    const gl = this.context;\r\n    const texSize = this.texSize;\r\n    const texture = this.outputTexture = this.context.createTexture();\r\n    gl.activeTexture(gl.TEXTURE0 + this.constantTextureCount + this.argumentTextureCount);\r\n    gl.bindTexture(gl.TEXTURE_2D, texture);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\r\n    // if (this.precision === 'single') {\r\n    //   gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, texSize[0], texSize[1], 0, gl.RGBA, gl.FLOAT, null);\r\n    // } else {\r\n    //   gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, texSize[0], texSize[1], 0, gl.RGBA, gl.UNSIGNED_BYTE, null);\r\n    // }\r\n    if (this.precision === 'single') {\r\n      if (this.pipeline) {\r\n        // TODO: investigate if webgl1 can handle gl.RED usage in gl.texImage2D, otherwise, simplify the below\r\n        switch (this.returnType) {\r\n          case 'Number':\r\n          case 'Float':\r\n          case 'Integer':\r\n            if (this.optimizeFloatMemory) {\r\n              gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, texSize[0], texSize[1], 0, gl.RGBA, gl.FLOAT, null);\r\n            } else {\r\n              gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, texSize[0], texSize[1], 0, gl.RGBA, gl.FLOAT, null);\r\n            }\r\n            break;\r\n          case 'Array(2)':\r\n            gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, texSize[0], texSize[1], 0, gl.RGBA, gl.FLOAT, null);\r\n            break;\r\n          case 'Array(3)':\r\n            gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, texSize[0], texSize[1], 0, gl.RGBA, gl.FLOAT, null);\r\n            break;\r\n          case 'Array(4)':\r\n            gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, texSize[0], texSize[1], 0, gl.RGBA, gl.FLOAT, null);\r\n            break;\r\n          default:\r\n            if (!this.graphical) {\r\n              throw new Error('Unhandled return type');\r\n            }\r\n        }\r\n      } else {\r\n        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, texSize[0], texSize[1], 0, gl.RGBA, gl.FLOAT, null);\r\n      }\r\n    } else {\r\n      gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, texSize[0], texSize[1], 0, gl.RGBA, gl.UNSIGNED_BYTE, null);\r\n    }\r\n    gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, texture, 0);\r\n  }\r\n\r\n  /**\r\n   * @desc Setup and replace sub-output textures\r\n   */\r\n  _setupSubOutputTextures() {\r\n    const gl = this.context;\r\n    const texSize = this.texSize;\r\n    this.drawBuffersMap = [gl.COLOR_ATTACHMENT0];\r\n    this.subKernelOutputTextures = [];\r\n    for (let i = 0; i < this.subKernels.length; i++) {\r\n      const texture = this.context.createTexture();\r\n      this.subKernelOutputTextures.push(texture);\r\n      this.drawBuffersMap.push(gl.COLOR_ATTACHMENT0 + i + 1);\r\n      gl.activeTexture(gl.TEXTURE0 + this.constantTextureCount + this.argumentTextureCount + i);\r\n      gl.bindTexture(gl.TEXTURE_2D, texture);\r\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\r\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\r\n      if (this.precision === 'single') {\r\n        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, texSize[0], texSize[1], 0, gl.RGBA, gl.FLOAT, null);\r\n      } else {\r\n        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, texSize[0], texSize[1], 0, gl.RGBA, gl.UNSIGNED_BYTE, null);\r\n      }\r\n      gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0 + i + 1, gl.TEXTURE_2D, texture, 0);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @desc This uses *getTextureCache** to get the Texture Cache of the argument supplied\r\n   * @param {String} name - Name of the argument\r\n   */\r\n  getArgumentTexture(name) {\r\n    return this.getTextureCache(`ARGUMENT_${name}`);\r\n  }\r\n\r\n  /**\r\n   * @desc Returns the Texture Cache of the supplied parameter (can be kernel, sub-kernel or argument)\r\n   * @param {String} name - Name of the subkernel, argument, or kernel.\r\n   * @returns {Object} Texture cache\r\n   */\r\n  getTextureCache(name) {\r\n    if (this.textureCache.hasOwnProperty(name)) {\r\n      return this.textureCache[name];\r\n    }\r\n    return this.textureCache[name] = this.context.createTexture();\r\n  }\r\n\r\n  /**\r\n   * @desc removes a texture from the kernel's cache\r\n   * @param {String} name - Name of texture\r\n   */\r\n  detachTextureCache(name) {\r\n    delete this.textureCache[name];\r\n  }\r\n\r\n  setUniform1f(name, value) {\r\n    if (this.uniform1fCache.hasOwnProperty(name)) {\r\n      const cache = this.uniform1fCache[name];\r\n      if (value === cache) {\r\n        return;\r\n      }\r\n    }\r\n    this.uniform1fCache[name] = value;\r\n    const loc = this.getUniformLocation(name);\r\n    this.context.uniform1f(loc, value);\r\n  }\r\n\r\n  setUniform1i(name, value) {\r\n    if (this.uniform1iCache.hasOwnProperty(name)) {\r\n      const cache = this.uniform1iCache[name];\r\n      if (value === cache) {\r\n        return;\r\n      }\r\n    }\r\n    this.uniform1iCache[name] = value;\r\n    const loc = this.getUniformLocation(name);\r\n    this.context.uniform1i(loc, value);\r\n  }\r\n\r\n  setUniform2f(name, value1, value2) {\r\n    if (this.uniform2fCache.hasOwnProperty(name)) {\r\n      const cache = this.uniform2fCache[name];\r\n      if (\r\n        value1 === cache[0] &&\r\n        value2 === cache[1]\r\n      ) {\r\n        return;\r\n      }\r\n    }\r\n    this.uniform2fCache[name] = [value1, value2];\r\n    const loc = this.getUniformLocation(name);\r\n    this.context.uniform2f(loc, value1, value2);\r\n  }\r\n\r\n  setUniform2fv(name, value) {\r\n    if (this.uniform2fvCache.hasOwnProperty(name)) {\r\n      const cache = this.uniform2fvCache[name];\r\n      if (\r\n        value[0] === cache[0] &&\r\n        value[1] === cache[1]\r\n      ) {\r\n        return;\r\n      }\r\n    }\r\n    this.uniform2fvCache[name] = value;\r\n    const loc = this.getUniformLocation(name);\r\n    this.context.uniform2fv(loc, value);\r\n  }\r\n\r\n  setUniform2iv(name, value) {\r\n    if (this.uniform2ivCache.hasOwnProperty(name)) {\r\n      const cache = this.uniform2ivCache[name];\r\n      if (\r\n        value[0] === cache[0] &&\r\n        value[1] === cache[1]\r\n      ) {\r\n        return;\r\n      }\r\n    }\r\n    this.uniform2ivCache[name] = value;\r\n    const loc = this.getUniformLocation(name);\r\n    this.context.uniform2iv(loc, value);\r\n  }\r\n\r\n  setUniform3fv(name, value) {\r\n    if (this.uniform3fvCache.hasOwnProperty(name)) {\r\n      const cache = this.uniform3fvCache[name];\r\n      if (\r\n        value[0] === cache[0] &&\r\n        value[1] === cache[1] &&\r\n        value[2] === cache[2]\r\n      ) {\r\n        return;\r\n      }\r\n    }\r\n    this.uniform3fvCache[name] = value;\r\n    const loc = this.getUniformLocation(name);\r\n    this.context.uniform3fv(loc, value);\r\n  }\r\n\r\n  setUniform3iv(name, value) {\r\n    if (this.uniform3ivCache.hasOwnProperty(name)) {\r\n      const cache = this.uniform3ivCache[name];\r\n      if (\r\n        value[0] === cache[0] &&\r\n        value[1] === cache[1] &&\r\n        value[2] === cache[2]\r\n      ) {\r\n        return;\r\n      }\r\n    }\r\n    this.uniform3ivCache[name] = value;\r\n    const loc = this.getUniformLocation(name);\r\n    this.context.uniform3iv(loc, value);\r\n  }\r\n\r\n  setUniform3fv(name, value) {\r\n    if (this.uniform3fvCache.hasOwnProperty(name)) {\r\n      const cache = this.uniform3fvCache[name];\r\n      if (\r\n        value[0] === cache[0] &&\r\n        value[1] === cache[1] &&\r\n        value[2] === cache[2]\r\n      ) {\r\n        return;\r\n      }\r\n    }\r\n    this.uniform3fvCache[name] = value;\r\n    const loc = this.getUniformLocation(name);\r\n    this.context.uniform3fv(loc, value);\r\n  }\r\n\r\n  setUniform4iv(name, value) {\r\n    if (this.uniform4ivCache.hasOwnProperty(name)) {\r\n      const cache = this.uniform4ivCache[name];\r\n      if (\r\n        value[0] === cache[0] &&\r\n        value[1] === cache[1] &&\r\n        value[2] === cache[2] &&\r\n        value[3] === cache[3]\r\n      ) {\r\n        return;\r\n      }\r\n    }\r\n    this.uniform4ivCache[name] = value;\r\n    const loc = this.getUniformLocation(name);\r\n    this.context.uniform4iv(loc, value);\r\n  }\r\n\r\n  setUniform4fv(name, value) {\r\n    if (this.uniform4fvCache.hasOwnProperty(name)) {\r\n      const cache = this.uniform4fvCache[name];\r\n      if (\r\n        value[0] === cache[0] &&\r\n        value[1] === cache[1] &&\r\n        value[2] === cache[2] &&\r\n        value[3] === cache[3]\r\n      ) {\r\n        return;\r\n      }\r\n    }\r\n    this.uniform4fvCache[name] = value;\r\n    const loc = this.getUniformLocation(name);\r\n    this.context.uniform4fv(loc, value);\r\n  }\r\n\r\n  /**\r\n   * @desc Return WebGlUniformLocation for various variables\r\n   * related to webGl program, such as user-defined variables,\r\n   * as well as, dimension sizes, etc.\r\n   */\r\n  getUniformLocation(name) {\r\n    if (this.programUniformLocationCache.hasOwnProperty(name)) {\r\n      return this.programUniformLocationCache[name];\r\n    }\r\n    return this.programUniformLocationCache[name] = this.context.getUniformLocation(this.program, name);\r\n  }\r\n\r\n  /**\r\n   * @desc Generate Shader artifacts for the kernel program.\r\n   * The final object contains HEADER, KERNEL, MAIN_RESULT, and others.\r\n   *\r\n   * @param {Array} args - The actual parameters sent to the Kernel\r\n   * @returns {Object} An object containing the Shader Artifacts(CONSTANTS, HEADER, KERNEL, etc.)\r\n   */\r\n  _getFragShaderArtifactMap(args) {\r\n    return {\r\n      HEADER: this._getHeaderString(),\r\n      LOOP_MAX: this._getLoopMaxString(),\r\n      PLUGINS: this._getPluginsString(),\r\n      CONSTANTS: this._getConstantsString(),\r\n      DECODE32_ENDIANNESS: this._getDecode32EndiannessString(),\r\n      ENCODE32_ENDIANNESS: this._getEncode32EndiannessString(),\r\n      DIVIDE_WITH_INTEGER_CHECK: this._getDivideWithIntegerCheckString(),\r\n      MAIN_CONSTANTS: this._getMainConstantsString(),\r\n      MAIN_ARGUMENTS: this._getMainArgumentsString(args),\r\n      KERNEL: this.getKernelString(),\r\n      MAIN_RESULT: this.getMainResultString(),\r\n      FLOAT_TACTIC_DECLARATION: this.getFloatTacticDeclaration(),\r\n      INT_TACTIC_DECLARATION: this.getIntTacticDeclaration(),\r\n      SAMPLER_2D_TACTIC_DECLARATION: this.getSampler2DTacticDeclaration(),\r\n      SAMPLER_2D_ARRAY_TACTIC_DECLARATION: this.getSampler2DArrayTacticDeclaration(),\r\n    };\r\n  }\r\n\r\n  /**\r\n   * @desc Generate Shader artifacts for the kernel program.\r\n   * The final object contains HEADER, KERNEL, MAIN_RESULT, and others.\r\n   *\r\n   * @param {Array} args - The actual parameters sent to the Kernel\r\n   * @returns {Object} An object containing the Shader Artifacts(CONSTANTS, HEADER, KERNEL, etc.)\r\n   */\r\n  _getVertShaderArtifactMap(args) {\r\n    return {\r\n      FLOAT_TACTIC_DECLARATION: this.getFloatTacticDeclaration(),\r\n      INT_TACTIC_DECLARATION: this.getIntTacticDeclaration(),\r\n      SAMPLER_2D_TACTIC_DECLARATION: this.getSampler2DTacticDeclaration(),\r\n      SAMPLER_2D_ARRAY_TACTIC_DECLARATION: this.getSampler2DArrayTacticDeclaration(),\r\n    };\r\n  }\r\n\r\n  /**\r\n   * @desc Get the header string for the program.\r\n   * This returns an empty string if no sub-kernels are defined.\r\n   *\r\n   * @returns {String} result\r\n   */\r\n  _getHeaderString() {\r\n    return (\r\n      this.subKernels !== null ?\r\n      '#extension GL_EXT_draw_buffers : require\\n' :\r\n      ''\r\n    );\r\n  }\r\n\r\n  /**\r\n   * @desc Get the maximum loop size String.\r\n   * @returns {String} result\r\n   */\r\n  _getLoopMaxString() {\r\n    return (\r\n      this.loopMaxIterations ?\r\n      ` ${parseInt(this.loopMaxIterations)};\\n` :\r\n      ' 1000;\\n'\r\n    );\r\n  }\r\n\r\n  _getPluginsString() {\r\n    if (!this.plugins) return '\\n';\r\n    return this.plugins.map(plugin => plugin.source && this.source.match(plugin.functionMatch) ? plugin.source : '').join('\\n');\r\n  }\r\n\r\n  /**\r\n   * @desc Generate transpiled glsl Strings for constant parameters sent to a kernel\r\n   * @returns {String} result\r\n   */\r\n  _getConstantsString() {\r\n    const result = [];\r\n    const { threadDim, texSize } = this;\r\n    if (this.dynamicOutput) {\r\n      result.push(\r\n        'uniform ivec3 uOutputDim',\r\n        'uniform ivec2 uTexSize'\r\n      );\r\n    } else {\r\n      result.push(\r\n        `ivec3 uOutputDim = ivec3(${threadDim[0]}, ${threadDim[1]}, ${threadDim[2]})`,\r\n        `ivec2 uTexSize = ivec2(${texSize[0]}, ${texSize[1]})`\r\n      );\r\n    }\r\n    return utils.linesToString(result);\r\n  }\r\n\r\n  /**\r\n   * @desc Get texture coordinate string for the program\r\n   * @returns {String} result\r\n   */\r\n  _getTextureCoordinate() {\r\n    const subKernels = this.subKernels;\r\n    if (subKernels === null || subKernels.length < 1) {\r\n      return 'varying vec2 vTexCoord;\\n';\r\n    } else {\r\n      return 'out vec2 vTexCoord;\\n';\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @desc Get Decode32 endianness string for little-endian and big-endian\r\n   * @returns {String} result\r\n   */\r\n  _getDecode32EndiannessString() {\r\n    return (\r\n      this.endianness === 'LE' ?\r\n      '' :\r\n      '  texel.rgba = texel.abgr;\\n'\r\n    );\r\n  }\r\n\r\n  /**\r\n   * @desc Get Encode32 endianness string for little-endian and big-endian\r\n   * @returns {String} result\r\n   */\r\n  _getEncode32EndiannessString() {\r\n    return (\r\n      this.endianness === 'LE' ?\r\n      '' :\r\n      '  texel.rgba = texel.abgr;\\n'\r\n    );\r\n  }\r\n\r\n  /**\r\n   * @desc if fixIntegerDivisionAccuracy provide method to replace /\r\n   * @returns {String} result\r\n   */\r\n  _getDivideWithIntegerCheckString() {\r\n    return this.fixIntegerDivisionAccuracy ?\r\n      `float div_with_int_check(float x, float y) {\r\n  if (floor(x) == x && floor(y) == y && integerMod(x, y) == 0.0) {\r\n    return float(int(x)/int(y));\r\n  }\r\n  return x / y;\r\n}` :\r\n      '';\r\n  }\r\n\r\n  /**\r\n   * @desc Generate transpiled glsl Strings for user-defined parameters sent to a kernel\r\n   * @param {Array} args - The actual parameters sent to the Kernel\r\n   * @returns {String} result\r\n   */\r\n  _getMainArgumentsString(args) {\r\n    const results = [];\r\n    const { argumentNames } = this;\r\n    for (let i = 0; i < argumentNames.length; i++) {\r\n      results.push(this.kernelArguments[i].getSource(args[i]));\r\n    }\r\n    return results.join('');\r\n  }\r\n\r\n  _getMainConstantsString() {\r\n    const result = [];\r\n    const { constants } = this;\r\n    if (constants) {\r\n      let i = 0;\r\n      for (const name in constants) {\r\n        result.push(this.kernelConstants[i++].getSource(this.constants[name]));\r\n      }\r\n    }\r\n    return result.join('');\r\n  }\r\n\r\n  /**\r\n   * @desc Get Kernel program string (in *glsl*) for a kernel.\r\n   * @returns {String} result\r\n   */\r\n  getKernelString() {\r\n    let kernelResultDeclaration;\r\n    switch (this.returnType) {\r\n      case 'Array(2)':\r\n        kernelResultDeclaration = 'vec2 kernelResult';\r\n        break;\r\n      case 'Array(3)':\r\n        kernelResultDeclaration = 'vec3 kernelResult';\r\n        break;\r\n      case 'Array(4)':\r\n        kernelResultDeclaration = 'vec4 kernelResult';\r\n        break;\r\n      case 'LiteralInteger':\r\n      case 'Float':\r\n      case 'Number':\r\n      case 'Integer':\r\n        kernelResultDeclaration = 'float kernelResult';\r\n        break;\r\n      default:\r\n        if (this.graphical) {\r\n          kernelResultDeclaration = 'float kernelResult';\r\n        } else {\r\n          throw new Error(`unrecognized output type \"${ this.returnType }\"`);\r\n        }\r\n    }\r\n\r\n    const result = [];\r\n    const subKernels = this.subKernels;\r\n    if (subKernels !== null) {\r\n      result.push(\r\n        kernelResultDeclaration\r\n      );\r\n      switch (this.returnType) {\r\n        case 'Number':\r\n        case 'Float':\r\n        case 'Integer':\r\n          for (let i = 0; i < subKernels.length; i++) {\r\n            const subKernel = subKernels[i];\r\n            result.push(\r\n              subKernel.returnType === 'Integer' ?\r\n              `int subKernelResult_${ subKernel.name } = 0` :\r\n              `float subKernelResult_${ subKernel.name } = 0.0`\r\n            );\r\n          }\r\n          break;\r\n        case 'Array(2)':\r\n          for (let i = 0; i < subKernels.length; i++) {\r\n            result.push(\r\n              `vec2 subKernelResult_${ subKernels[i].name }`\r\n            );\r\n          }\r\n          break;\r\n        case 'Array(3)':\r\n          for (let i = 0; i < subKernels.length; i++) {\r\n            result.push(\r\n              `vec3 subKernelResult_${ subKernels[i].name }`\r\n            );\r\n          }\r\n          break;\r\n        case 'Array(4)':\r\n          for (let i = 0; i < subKernels.length; i++) {\r\n            result.push(\r\n              `vec4 subKernelResult_${ subKernels[i].name }`\r\n            );\r\n          }\r\n          break;\r\n      }\r\n    } else {\r\n      result.push(\r\n        kernelResultDeclaration\r\n      );\r\n    }\r\n\r\n    return utils.linesToString(result) + this.translatedSource;\r\n  }\r\n\r\n  getMainResultGraphical() {\r\n    return utils.linesToString([\r\n      '  threadId = indexTo3D(index, uOutputDim)',\r\n      '  kernel()',\r\n      '  gl_FragColor = actualColor',\r\n    ]);\r\n  }\r\n\r\n  getMainResultPackedPixels() {\r\n    switch (this.returnType) {\r\n      case 'LiteralInteger':\r\n      case 'Number':\r\n      case 'Integer':\r\n      case 'Float':\r\n        return this.getMainResultKernelPackedPixels() +\r\n          this.getMainResultSubKernelPackedPixels();\r\n      default:\r\n        throw new Error(`packed output only usable with Numbers, \"${this.returnType}\" specified`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @return {String}\r\n   */\r\n  getMainResultKernelPackedPixels() {\r\n    return utils.linesToString([\r\n      '  threadId = indexTo3D(index, uOutputDim)',\r\n      '  kernel()',\r\n      `  gl_FragData[0] = ${this.useLegacyEncoder ? 'legacyEncode32' : 'encode32'}(kernelResult)`\r\n    ]);\r\n  }\r\n\r\n  /**\r\n   * @return {String}\r\n   */\r\n  getMainResultSubKernelPackedPixels() {\r\n    const result = [];\r\n    if (!this.subKernels) return '';\r\n    for (let i = 0; i < this.subKernels.length; i++) {\r\n      const subKernel = this.subKernels[i];\r\n      if (subKernel.returnType === 'Integer') {\r\n        result.push(\r\n          `  gl_FragData[${i + 1}] = ${this.useLegacyEncoder ? 'legacyEncode32' : 'encode32'}(float(subKernelResult_${this.subKernels[i].name}))`\r\n        );\r\n      } else {\r\n        result.push(\r\n          `  gl_FragData[${i + 1}] = ${this.useLegacyEncoder ? 'legacyEncode32' : 'encode32'}(subKernelResult_${this.subKernels[i].name})`\r\n        );\r\n      }\r\n    }\r\n    return utils.linesToString(result);\r\n  }\r\n\r\n  getMainResultMemoryOptimizedFloats() {\r\n    const result = [\r\n      '  index *= 4',\r\n    ];\r\n\r\n    switch (this.returnType) {\r\n      case 'Number':\r\n      case 'Integer':\r\n      case 'Float':\r\n        const channels = ['r', 'g', 'b', 'a'];\r\n        for (let i = 0; i < channels.length; i++) {\r\n          const channel = channels[i];\r\n          this.getMainResultKernelMemoryOptimizedFloats(result, channel);\r\n          this.getMainResultSubKernelMemoryOptimizedFloats(result, channel);\r\n          if (i + 1 < channels.length) {\r\n            result.push('  index += 1');\r\n          }\r\n        }\r\n        break;\r\n      default:\r\n        throw new Error(`optimized output only usable with Numbers, ${this.returnType} specified`);\r\n    }\r\n\r\n    return utils.linesToString(result);\r\n  }\r\n\r\n  getMainResultKernelMemoryOptimizedFloats(result, channel) {\r\n    result.push(\r\n      '  threadId = indexTo3D(index, uOutputDim)',\r\n      '  kernel()',\r\n      `  gl_FragData[0].${channel} = kernelResult`,\r\n    );\r\n  }\r\n\r\n  getMainResultSubKernelMemoryOptimizedFloats(result, channel) {\r\n    if (!this.subKernels) return result;\r\n    for (let i = 0; i < this.subKernels.length; i++) {\r\n      const subKernel = this.subKernels[i];\r\n      if (subKernel.returnType === 'Integer') {\r\n        result.push(\r\n          `  gl_FragData[${i + 1}].${channel} = float(subKernelResult_${this.subKernels[i].name})`,\r\n        );\r\n      } else {\r\n        result.push(\r\n          `  gl_FragData[${i + 1}].${channel} = subKernelResult_${this.subKernels[i].name}`,\r\n        );\r\n      }\r\n    }\r\n  }\r\n\r\n  getMainResultKernelNumberTexture() {\r\n    return [\r\n      '  threadId = indexTo3D(index, uOutputDim)',\r\n      '  kernel()',\r\n      '  gl_FragData[0][0] = kernelResult',\r\n    ];\r\n  }\r\n\r\n  getMainResultSubKernelNumberTexture() {\r\n    const result = [];\r\n    if (!this.subKernels) return result;\r\n    for (let i = 0; i < this.subKernels.length; ++i) {\r\n      const subKernel = this.subKernels[i];\r\n      if (subKernel.returnType === 'Integer') {\r\n        result.push(\r\n          `  gl_FragData[${i + 1}][0] = float(subKernelResult_${subKernel.name})`,\r\n        );\r\n      } else {\r\n        result.push(\r\n          `  gl_FragData[${i + 1}][0] = subKernelResult_${subKernel.name}`,\r\n        );\r\n      }\r\n    }\r\n    return result;\r\n  }\r\n\r\n  getMainResultKernelArray2Texture() {\r\n    return [\r\n      '  threadId = indexTo3D(index, uOutputDim)',\r\n      '  kernel()',\r\n      '  gl_FragData[0][0] = kernelResult[0]',\r\n      '  gl_FragData[0][1] = kernelResult[1]',\r\n    ];\r\n  }\r\n\r\n  getMainResultSubKernelArray2Texture() {\r\n    const result = [];\r\n    if (!this.subKernels) return result;\r\n    for (let i = 0; i < this.subKernels.length; ++i) {\r\n      result.push(\r\n        `  gl_FragData[${i + 1}][0] = subKernelResult_${this.subKernels[i].name}[0]`,\r\n        `  gl_FragData[${i + 1}][1] = subKernelResult_${this.subKernels[i].name}[1]`,\r\n      );\r\n    }\r\n    return result;\r\n  }\r\n\r\n  getMainResultKernelArray3Texture() {\r\n    return [\r\n      '  threadId = indexTo3D(index, uOutputDim)',\r\n      '  kernel()',\r\n      '  gl_FragData[0][0] = kernelResult[0]',\r\n      '  gl_FragData[0][1] = kernelResult[1]',\r\n      '  gl_FragData[0][2] = kernelResult[2]',\r\n    ];\r\n  }\r\n\r\n  getMainResultSubKernelArray3Texture() {\r\n    const result = [];\r\n    if (!this.subKernels) return result;\r\n    for (let i = 0; i < this.subKernels.length; ++i) {\r\n      result.push(\r\n        `  gl_FragData[${i + 1}][0] = subKernelResult_${this.subKernels[i].name}[0]`,\r\n        `  gl_FragData[${i + 1}][1] = subKernelResult_${this.subKernels[i].name}[1]`,\r\n        `  gl_FragData[${i + 1}][2] = subKernelResult_${this.subKernels[i].name}[2]`,\r\n      );\r\n    }\r\n    return result;\r\n  }\r\n\r\n  getMainResultKernelArray4Texture() {\r\n    return [\r\n      '  threadId = indexTo3D(index, uOutputDim)',\r\n      '  kernel()',\r\n      '  gl_FragData[0] = kernelResult',\r\n    ];\r\n  }\r\n\r\n  getMainResultSubKernelArray4Texture() {\r\n    const result = [];\r\n    if (!this.subKernels) return result;\r\n    switch (this.returnType) {\r\n      case 'Number':\r\n      case 'Float':\r\n      case 'Integer':\r\n        for (let i = 0; i < this.subKernels.length; ++i) {\r\n          const subKernel = this.subKernels[i];\r\n          if (subKernel.returnType === 'Integer') {\r\n            result.push(\r\n              `  gl_FragData[${i + 1}] = float(subKernelResult_${this.subKernels[i].name})`,\r\n            );\r\n          } else {\r\n            result.push(\r\n              `  gl_FragData[${i + 1}] = subKernelResult_${this.subKernels[i].name}`,\r\n            );\r\n          }\r\n        }\r\n        break;\r\n      case 'Array(2)':\r\n        for (let i = 0; i < this.subKernels.length; ++i) {\r\n          result.push(\r\n            `  gl_FragData[${i + 1}][0] = subKernelResult_${this.subKernels[i].name}[0]`,\r\n            `  gl_FragData[${i + 1}][1] = subKernelResult_${this.subKernels[i].name}[1]`,\r\n          );\r\n        }\r\n        break;\r\n      case 'Array(3)':\r\n        for (let i = 0; i < this.subKernels.length; ++i) {\r\n          result.push(\r\n            `  gl_FragData[${i + 1}][0] = subKernelResult_${this.subKernels[i].name}[0]`,\r\n            `  gl_FragData[${i + 1}][1] = subKernelResult_${this.subKernels[i].name}[1]`,\r\n            `  gl_FragData[${i + 1}][2] = subKernelResult_${this.subKernels[i].name}[2]`,\r\n          );\r\n        }\r\n        break;\r\n      case 'Array(4)':\r\n        for (let i = 0; i < this.subKernels.length; ++i) {\r\n          result.push(\r\n            `  gl_FragData[${i + 1}][0] = subKernelResult_${this.subKernels[i].name}[0]`,\r\n            `  gl_FragData[${i + 1}][1] = subKernelResult_${this.subKernels[i].name}[1]`,\r\n            `  gl_FragData[${i + 1}][2] = subKernelResult_${this.subKernels[i].name}[2]`,\r\n            `  gl_FragData[${i + 1}][3] = subKernelResult_${this.subKernels[i].name}[3]`,\r\n          );\r\n        }\r\n        break;\r\n    }\r\n\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * @param {String} src - Shader string\r\n   * @param {Object} map - Variables/Constants associated with shader\r\n   */\r\n  replaceArtifacts(src, map) {\r\n    return src.replace(/[ ]*__([A-Z]+[0-9]*([_]?[A-Z]*[0-9]?)*)__;\\n/g, (match, artifact) => {\r\n      if (map.hasOwnProperty(artifact)) {\r\n        return map[artifact];\r\n      }\r\n      throw `unhandled artifact ${artifact}`;\r\n    });\r\n  }\r\n\r\n  /**\r\n   * @desc Get the fragment shader String.\r\n   * If the String hasn't been compiled yet,\r\n   * then this method compiles it as well\r\n   *\r\n   * @param {Array} args - The actual parameters sent to the Kernel\r\n   * @returns {string} Fragment Shader string\r\n   */\r\n  getFragmentShader(args) {\r\n    if (this.compiledFragmentShader !== null) {\r\n      return this.compiledFragmentShader;\r\n    }\r\n    return this.compiledFragmentShader = this.replaceArtifacts(this.constructor.fragmentShader, this._getFragShaderArtifactMap(args));\r\n  }\r\n\r\n  /**\r\n   * @desc Get the vertical shader String\r\n   * @param {Array|IArguments} args - The actual parameters sent to the Kernel\r\n   * @returns {string} Vertical Shader string\r\n   */\r\n  getVertexShader(args) {\r\n    if (this.compiledVertexShader !== null) {\r\n      return this.compiledVertexShader;\r\n    }\r\n    return this.compiledVertexShader = this.replaceArtifacts(this.constructor.vertexShader, this._getVertShaderArtifactMap(args));\r\n  }\r\n\r\n  /**\r\n   * @desc Returns the *pre-compiled* Kernel as a JS Object String, that can be reused.\r\n   */\r\n  toString() {\r\n    const setupContextString = utils.linesToString([\r\n      `const gl = context`,\r\n    ]);\r\n    return glKernelString(this.constructor, arguments, this, setupContextString);\r\n  }\r\n\r\n  destroy(removeCanvasReferences) {\r\n    if (this.outputTexture) {\r\n      this.context.deleteTexture(this.outputTexture);\r\n    }\r\n    if (this.buffer) {\r\n      this.context.deleteBuffer(this.buffer);\r\n    }\r\n    if (this.framebuffer) {\r\n      this.context.deleteFramebuffer(this.framebuffer);\r\n    }\r\n    if (this.vertShader) {\r\n      this.context.deleteShader(this.vertShader);\r\n    }\r\n    if (this.fragShader) {\r\n      this.context.deleteShader(this.fragShader);\r\n    }\r\n    if (this.program) {\r\n      this.context.deleteProgram(this.program);\r\n    }\r\n\r\n    const keys = Object.keys(this.textureCache);\r\n\r\n    for (let i = 0; i < keys.length; i++) {\r\n      const name = keys[i];\r\n      this.context.deleteTexture(this.textureCache[name]);\r\n    }\r\n\r\n    if (this.subKernelOutputTextures) {\r\n      for (let i = 0; i < this.subKernelOutputTextures.length; i++) {\r\n        this.context.deleteTexture(this.subKernelOutputTextures[i]);\r\n      }\r\n    }\r\n    if (removeCanvasReferences) {\r\n      const idx = canvases.indexOf(this.canvas);\r\n      if (idx >= 0) {\r\n        canvases[idx] = null;\r\n        maxTexSizes[idx] = null;\r\n      }\r\n    }\r\n    this.destroyExtensions();\r\n    delete this.context;\r\n    delete this.canvas;\r\n  }\r\n\r\n  destroyExtensions() {\r\n    this.extensions.OES_texture_float = null;\r\n    this.extensions.OES_texture_float_linear = null;\r\n    this.extensions.OES_element_index_uint = null;\r\n    this.extensions.WEBGL_draw_buffers = null;\r\n  }\r\n\r\n  static destroyContext(context) {\r\n    const extension = context.getExtension('WEBGL_lose_context');\r\n    if (extension) {\r\n      extension.loseContext();\r\n    }\r\n  }\r\n\r\n  toJSON() {\r\n    const json = super.toJSON();\r\n    json.functionNodes = FunctionBuilder.fromKernel(this, WebGLFunctionNode).toJSON();\r\n    return json;\r\n  }\r\n}\r\n","import { WebGLFunctionNode } from '../web-gl/function-node';\r\n\r\n/**\r\n * @class WebGL2FunctionNode\r\n * @desc [INTERNAL] Takes in a function node, and does all the AST voodoo required to toString its respective webGL code.\r\n * @extends WebGLFunctionNode\r\n * @returns the converted webGL function string\r\n */\r\nexport class WebGL2FunctionNode extends WebGLFunctionNode {\r\n\r\n  /**\r\n   * @desc Parses the abstract syntax tree for *identifier* expression\r\n   * @param {Object} idtNode - An ast Node\r\n   * @param {Array} retArr - return array string\r\n   * @returns {Array} the append retArr\r\n   */\r\n  astIdentifierExpression(idtNode, retArr) {\r\n    if (idtNode.type !== 'Identifier') {\r\n      throw this.astErrorOutput(\r\n        'IdentifierExpression - not an Identifier',\r\n        idtNode\r\n      );\r\n    }\r\n\r\n    const type = this.getType(idtNode);\r\n\r\n    if (idtNode.name === 'Infinity') {\r\n      retArr.push('intBitsToFloat(2139095039)');\r\n    } else if (type === 'Boolean') {\r\n      if (this.argumentNames.indexOf(idtNode.name) > -1) {\r\n        retArr.push(`bool(user_${idtNode.name})`);\r\n      } else {\r\n        retArr.push(`user_${idtNode.name}`);\r\n      }\r\n    } else {\r\n      const userArgumentName = this.getKernelArgumentName(idtNode.name);\r\n      if (userArgumentName) {\r\n        retArr.push(`user_${userArgumentName}`);\r\n      } else {\r\n        retArr.push(`user_${idtNode.name}`);\r\n      }\r\n    }\r\n\r\n    return retArr;\r\n  }\r\n}\r\n","// language=GLSL\r\nexport const fragmentShader = `#version 300 es\r\n__HEADER__;\r\n__FLOAT_TACTIC_DECLARATION__;\r\n__INT_TACTIC_DECLARATION__;\r\n__SAMPLER_2D_TACTIC_DECLARATION__;\r\n__SAMPLER_2D_ARRAY_TACTIC_DECLARATION__;\r\n\r\nconst int LOOP_MAX = __LOOP_MAX__;\r\n\r\n__PLUGINS__;\r\n__CONSTANTS__;\r\n\r\nin vec2 vTexCoord;\r\n\r\nconst int BIT_COUNT = 32;\r\nint modi(int x, int y) {\r\n  return x - y * (x / y);\r\n}\r\n\r\nint bitwiseOr(int a, int b) {\r\n  int result = 0;\r\n  int n = 1;\r\n\r\n  for (int i = 0; i < BIT_COUNT; i++) {\r\n    if ((modi(a, 2) == 1) || (modi(b, 2) == 1)) {\r\n      result += n;\r\n    }\r\n    a = a / 2;\r\n    b = b / 2;\r\n    n = n * 2;\r\n    if(!(a > 0 || b > 0)) {\r\n      break;\r\n    }\r\n  }\r\n  return result;\r\n}\r\nint bitwiseXOR(int a, int b) {\r\n  int result = 0;\r\n  int n = 1;\r\n\r\n  for (int i = 0; i < BIT_COUNT; i++) {\r\n    if ((modi(a, 2) == 1) != (modi(b, 2) == 1)) {\r\n      result += n;\r\n    }\r\n    a = a / 2;\r\n    b = b / 2;\r\n    n = n * 2;\r\n    if(!(a > 0 || b > 0)) {\r\n      break;\r\n    }\r\n  }\r\n  return result;\r\n}\r\nint bitwiseAnd(int a, int b) {\r\n  int result = 0;\r\n  int n = 1;\r\n  for (int i = 0; i < BIT_COUNT; i++) {\r\n    if ((modi(a, 2) == 1) && (modi(b, 2) == 1)) {\r\n      result += n;\r\n    }\r\n    a = a / 2;\r\n    b = b / 2;\r\n    n = n * 2;\r\n    if(!(a > 0 && b > 0)) {\r\n      break;\r\n    }\r\n  }\r\n  return result;\r\n}\r\nint bitwiseNot(int a) {\r\n  int result = 0;\r\n  int n = 1;\r\n\r\n  for (int i = 0; i < BIT_COUNT; i++) {\r\n    if (modi(a, 2) == 0) {\r\n      result += n;\r\n    }\r\n    a = a / 2;\r\n    n = n * 2;\r\n  }\r\n  return result;\r\n}\r\nint bitwiseZeroFillLeftShift(int n, int shift) {\r\n  int maxBytes = BIT_COUNT;\r\n  for (int i = 0; i < BIT_COUNT; i++) {\r\n    if (maxBytes >= n) {\r\n      break;\r\n    }\r\n    maxBytes *= 2;\r\n  }\r\n  for (int i = 0; i < BIT_COUNT; i++) {\r\n    if (i >= shift) {\r\n      break;\r\n    }\r\n    n *= 2;\r\n  }\r\n\r\n  int result = 0;\r\n  int byteVal = 1;\r\n  for (int i = 0; i < BIT_COUNT; i++) {\r\n    if (i >= maxBytes) break;\r\n    if (modi(n, 2) > 0) { result += byteVal; }\r\n    n = int(n / 2);\r\n    byteVal *= 2;\r\n  }\r\n  return result;\r\n}\r\n\r\nint bitwiseSignedRightShift(int num, int shifts) {\r\n  return int(floor(float(num) / pow(2.0, float(shifts))));\r\n}\r\n\r\nint bitwiseZeroFillRightShift(int n, int shift) {\r\n  int maxBytes = BIT_COUNT;\r\n  for (int i = 0; i < BIT_COUNT; i++) {\r\n    if (maxBytes >= n) {\r\n      break;\r\n    }\r\n    maxBytes *= 2;\r\n  }\r\n  for (int i = 0; i < BIT_COUNT; i++) {\r\n    if (i >= shift) {\r\n      break;\r\n    }\r\n    n /= 2;\r\n  }\r\n  int result = 0;\r\n  int byteVal = 1;\r\n  for (int i = 0; i < BIT_COUNT; i++) {\r\n    if (i >= maxBytes) break;\r\n    if (modi(n, 2) > 0) { result += byteVal; }\r\n    n = int(n / 2);\r\n    byteVal *= 2;\r\n  }\r\n  return result;\r\n}\r\n\r\nvec2 integerMod(vec2 x, float y) {\r\n  vec2 res = floor(mod(x, y));\r\n  return res * step(1.0 - floor(y), -res);\r\n}\r\n\r\nvec3 integerMod(vec3 x, float y) {\r\n  vec3 res = floor(mod(x, y));\r\n  return res * step(1.0 - floor(y), -res);\r\n}\r\n\r\nvec4 integerMod(vec4 x, vec4 y) {\r\n  vec4 res = floor(mod(x, y));\r\n  return res * step(1.0 - floor(y), -res);\r\n}\r\n\r\nfloat integerMod(float x, float y) {\r\n  float res = floor(mod(x, y));\r\n  return res * (res > floor(y) - 1.0 ? 0.0 : 1.0);\r\n}\r\n\r\nint integerMod(int x, int y) {\r\n  return x - (y * int(x/y));\r\n}\r\n\r\n__DIVIDE_WITH_INTEGER_CHECK__;\r\n\r\n// Here be dragons!\r\n// DO NOT OPTIMIZE THIS CODE\r\n// YOU WILL BREAK SOMETHING ON SOMEBODY\\'S MACHINE\r\n// LEAVE IT AS IT IS, LEST YOU WASTE YOUR OWN TIME\r\nconst vec2 MAGIC_VEC = vec2(1.0, -256.0);\r\nconst vec4 SCALE_FACTOR = vec4(1.0, 256.0, 65536.0, 0.0);\r\nconst vec4 SCALE_FACTOR_INV = vec4(1.0, 0.00390625, 0.0000152587890625, 0.0); // 1, 1/256, 1/65536\r\nfloat decode32(vec4 texel) {\r\n  __DECODE32_ENDIANNESS__;\r\n  texel *= 255.0;\r\n  vec2 gte128;\r\n  gte128.x = texel.b >= 128.0 ? 1.0 : 0.0;\r\n  gte128.y = texel.a >= 128.0 ? 1.0 : 0.0;\r\n  float exponent = 2.0 * texel.a - 127.0 + dot(gte128, MAGIC_VEC);\r\n  float res = exp2(round(exponent));\r\n  texel.b = texel.b - 128.0 * gte128.x;\r\n  res = dot(texel, SCALE_FACTOR) * exp2(round(exponent-23.0)) + res;\r\n  res *= gte128.y * -2.0 + 1.0;\r\n  return res;\r\n}\r\n\r\nfloat decode16(vec4 texel, int index) {\r\n  int channel = integerMod(index, 2);\r\n  return texel[channel*2] * 255.0 + texel[channel*2 + 1] * 65280.0;\r\n}\r\n\r\nfloat decode8(vec4 texel, int index) {\r\n  int channel = integerMod(index, 4);\r\n  return texel[channel] * 255.0;\r\n}\r\n\r\nvec4 legacyEncode32(float f) {\r\n  float F = abs(f);\r\n  float sign = f < 0.0 ? 1.0 : 0.0;\r\n  float exponent = floor(log2(F));\r\n  float mantissa = (exp2(-exponent) * F);\r\n  // exponent += floor(log2(mantissa));\r\n  vec4 texel = vec4(F * exp2(23.0-exponent)) * SCALE_FACTOR_INV;\r\n  texel.rg = integerMod(texel.rg, 256.0);\r\n  texel.b = integerMod(texel.b, 128.0);\r\n  texel.a = exponent*0.5 + 63.5;\r\n  texel.ba += vec2(integerMod(exponent+127.0, 2.0), sign) * 128.0;\r\n  texel = floor(texel);\r\n  texel *= 0.003921569; // 1/255\r\n  __ENCODE32_ENDIANNESS__;\r\n  return texel;\r\n}\r\n\r\n// https://github.com/gpujs/gpu.js/wiki/Encoder-details\r\nvec4 encode32(float value) {\r\n  if (value == 0.0) return vec4(0, 0, 0, 0);\r\n\r\n  float exponent;\r\n  float mantissa;\r\n  vec4  result;\r\n  float sgn;\r\n\r\n  sgn = step(0.0, -value);\r\n  value = abs(value);\r\n\r\n  exponent = floor(log2(value));\r\n\r\n  mantissa = value*pow(2.0, -exponent)-1.0;\r\n  exponent = exponent+127.0;\r\n  result   = vec4(0,0,0,0);\r\n\r\n  result.a = floor(exponent/2.0);\r\n  exponent = exponent - result.a*2.0;\r\n  result.a = result.a + 128.0*sgn;\r\n\r\n  result.b = floor(mantissa * 128.0);\r\n  mantissa = mantissa - result.b / 128.0;\r\n  result.b = result.b + exponent*128.0;\r\n\r\n  result.g = floor(mantissa*32768.0);\r\n  mantissa = mantissa - result.g/32768.0;\r\n\r\n  result.r = floor(mantissa*8388608.0);\r\n  return result/255.0;\r\n}\r\n// Dragons end here\r\n\r\nint index;\r\nivec3 threadId;\r\n\r\nivec3 indexTo3D(int idx, ivec3 texDim) {\r\n  int z = int(idx / (texDim.x * texDim.y));\r\n  idx -= z * int(texDim.x * texDim.y);\r\n  int y = int(idx / texDim.x);\r\n  int x = int(integerMod(idx, texDim.x));\r\n  return ivec3(x, y, z);\r\n}\r\n\r\nfloat get32(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\r\n  int index = x + texDim.x * (y + texDim.y * z);\r\n  int w = texSize.x;\r\n  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;\r\n  vec4 texel = texture(tex, st / vec2(texSize));\r\n  return decode32(texel);\r\n}\r\n\r\nfloat get16(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\r\n  int index = x + (texDim.x * (y + (texDim.y * z)));\r\n  int w = texSize.x * 2;\r\n  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;\r\n  vec4 texel = texture(tex, st / vec2(texSize.x * 2, texSize.y));\r\n  return decode16(texel, index);\r\n}\r\n\r\nfloat get8(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\r\n  int index = x + (texDim.x * (y + (texDim.y * z)));\r\n  int w = texSize.x * 4;\r\n  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;\r\n  vec4 texel = texture(tex, st / vec2(texSize.x * 4, texSize.y));\r\n  return decode8(texel, index);\r\n}\r\n\r\nfloat getMemoryOptimized32(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\r\n  int index = x + (texDim.x * (y + (texDim.y * z)));\r\n  int channel = integerMod(index, 4);\r\n  index = index / 4;\r\n  int w = texSize.x;\r\n  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;\r\n  index = index / 4;\r\n  vec4 texel = texture(tex, st / vec2(texSize));\r\n  return texel[channel];\r\n}\r\n\r\nvec4 getImage2D(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\r\n  int index = x + texDim.x * (y + texDim.y * z);\r\n  int w = texSize.x;\r\n  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;\r\n  return texture(tex, st / vec2(texSize));\r\n}\r\n\r\nvec4 getImage3D(sampler2DArray tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\r\n  int index = x + texDim.x * (y + texDim.y * z);\r\n  int w = texSize.x;\r\n  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;\r\n  return texture(tex, vec3(st / vec2(texSize), z));\r\n}\r\n\r\nfloat getFloatFromSampler2D(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\r\n  vec4 result = getImage2D(tex, texSize, texDim, z, y, x);\r\n  return result[0];\r\n}\r\n\r\nvec2 getVec2FromSampler2D(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\r\n  vec4 result = getImage2D(tex, texSize, texDim, z, y, x);\r\n  return vec2(result[0], result[1]);\r\n}\r\n\r\nvec2 getMemoryOptimizedVec2(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\r\n  int index = x + texDim.x * (y + texDim.y * z);\r\n  int channel = integerMod(index, 2);\r\n  index = index / 2;\r\n  int w = texSize.x;\r\n  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;\r\n  vec4 texel = texture(tex, st / vec2(texSize));\r\n  if (channel == 0) return vec2(texel.r, texel.g);\r\n  if (channel == 1) return vec2(texel.b, texel.a);\r\n  return vec2(0.0, 0.0);\r\n}\r\n\r\nvec3 getVec3FromSampler2D(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\r\n  vec4 result = getImage2D(tex, texSize, texDim, z, y, x);\r\n  return vec3(result[0], result[1], result[2]);\r\n}\r\n\r\nvec3 getMemoryOptimizedVec3(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\r\n  int fieldIndex = 3 * (x + texDim.x * (y + texDim.y * z));\r\n  int vectorIndex = fieldIndex / 4;\r\n  int vectorOffset = fieldIndex - vectorIndex * 4;\r\n  int readY = vectorIndex / texSize.x;\r\n  int readX = vectorIndex - readY * texSize.x;\r\n  vec4 tex1 = texture(tex, (vec2(readX, readY) + 0.5) / vec2(texSize));\r\n\r\n  if (vectorOffset == 0) {\r\n    return tex1.xyz;\r\n  } else if (vectorOffset == 1) {\r\n    return tex1.yzw;\r\n  } else {\r\n    readX++;\r\n    if (readX >= texSize.x) {\r\n      readX = 0;\r\n      readY++;\r\n    }\r\n    vec4 tex2 = texture(tex, vec2(readX, readY) / vec2(texSize));\r\n    if (vectorOffset == 2) {\r\n      return vec3(tex1.z, tex1.w, tex2.x);\r\n    } else {\r\n      return vec3(tex1.w, tex2.x, tex2.y);\r\n    }\r\n  }\r\n}\r\n\r\nvec4 getVec4FromSampler2D(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\r\n  return getImage2D(tex, texSize, texDim, z, y, x);\r\n}\r\n\r\nvec4 getMemoryOptimizedVec4(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\r\n  int index = x + texDim.x * (y + texDim.y * z);\r\n  int channel = integerMod(index, 2);\r\n  int w = texSize.x;\r\n  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;\r\n  vec4 texel = texture(tex, st / vec2(texSize));\r\n  return vec4(texel.r, texel.g, texel.b, texel.a);\r\n}\r\n\r\nvec4 actualColor;\r\nvoid color(float r, float g, float b, float a) {\r\n  actualColor = vec4(r,g,b,a);\r\n}\r\n\r\nvoid color(float r, float g, float b) {\r\n  color(r,g,b,1.0);\r\n}\r\n\r\n__MAIN_CONSTANTS__;\r\n__MAIN_ARGUMENTS__;\r\n__KERNEL__;\r\n\r\nvoid main(void) {\r\n  index = int(vTexCoord.s * float(uTexSize.x)) + int(vTexCoord.t * float(uTexSize.y)) * uTexSize.x;\r\n  __MAIN_RESULT__;\r\n}`;\r\n","// language=GLSL\r\nexport const vertexShader = `#version 300 es\r\n__FLOAT_TACTIC_DECLARATION__;\r\n__INT_TACTIC_DECLARATION__;\r\n__SAMPLER_2D_TACTIC_DECLARATION__;\r\n\r\nin vec2 aPos;\r\nin vec2 aTexCoord;\r\n\r\nout vec2 vTexCoord;\r\nuniform vec2 ratio;\r\n\r\nvoid main(void) {\r\n  gl_Position = vec4((aPos + vec2(1)) * ratio + vec2(-1), 0, 1);\r\n  vTexCoord = aTexCoord;\r\n}`;\r\n","import { WebGLKernelValueBoolean } from '../../web-gl/kernel-value/boolean';\r\n\r\nexport class WebGL2KernelValueBoolean extends WebGLKernelValueBoolean {}\r\n","import { WebGLKernelValueFloat } from '../../web-gl/kernel-value/float';\r\n\r\nexport class WebGL2KernelValueFloat extends WebGLKernelValueFloat {}\r\n","import { WebGLKernelValueInteger } from '../../web-gl/kernel-value/integer';\r\n\r\nexport class WebGL2KernelValueInteger extends WebGLKernelValueInteger {\r\n  getSource(value) {\r\n    const variablePrecision = this.getVariablePrecisionString();\r\n    if (this.origin === 'constants') {\r\n      return `const ${ variablePrecision } int ${this.id} = ${ parseInt(value) };\\n`;\r\n    }\r\n    return `uniform ${ variablePrecision } int ${this.id};\\n`;\r\n  }\r\n\r\n  updateValue(value) {\r\n    if (this.origin === 'constants') return;\r\n    this.kernel.setUniform1i(this.id, this.uploadValue = value);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { WebGLKernelValueHTMLImage } from '../../web-gl/kernel-value/html-image';\r\n\r\nexport class WebGL2KernelValueHTMLImage extends WebGLKernelValueHTMLImage {\r\n  getSource() {\r\n    const variablePrecision = this.getVariablePrecisionString();\r\n    return utils.linesToString([\r\n      `uniform ${ variablePrecision } sampler2D ${this.id}`,\r\n      `${ variablePrecision } ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,\r\n      `${ variablePrecision } ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`,\r\n    ]);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { WebGLKernelValueDynamicHTMLImage } from '../../web-gl/kernel-value/dynamic-html-image';\r\n\r\nexport class WebGL2KernelValueDynamicHTMLImage extends WebGLKernelValueDynamicHTMLImage {\r\n  getSource() {\r\n    const variablePrecision = this.getVariablePrecisionString();\r\n    return utils.linesToString([\r\n      `uniform ${ variablePrecision } sampler2D ${this.id}`,\r\n      `uniform ${ variablePrecision } ivec2 ${this.sizeId}`,\r\n      `uniform ${ variablePrecision } ivec3 ${this.dimensionsId}`,\r\n    ]);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { WebGLKernelValue } from '../../web-gl/kernel-value/index';\r\n\r\nexport class WebGL2KernelValueHtmlImageArray extends WebGLKernelValue {\r\n  constructor(value, settings) {\r\n    super(value, settings);\r\n    this.requestTexture();\r\n    this.dimensions = [value[0].width, value[0].height, value.length];\r\n    this.textureSize = [value[0].width, value[0].height];\r\n  }\r\n  getStringValueHandler() {\r\n    return `const uploadValue_${this.name} = ${this.varName};\\n`;\r\n  }\r\n  getSource() {\r\n    const variablePrecision = this.getVariablePrecisionString();\r\n    return utils.linesToString([\r\n      `uniform ${ variablePrecision } sampler2DArray ${this.id}`,\r\n      `${ variablePrecision } ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,\r\n      `${ variablePrecision } ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`,\r\n    ]);\r\n  }\r\n\r\n  updateValue(images) {\r\n    const { context: gl } = this;\r\n    gl.activeTexture(this.contextHandle);\r\n    gl.bindTexture(gl.TEXTURE_2D_ARRAY, this.texture);\r\n    gl.texParameteri(gl.TEXTURE_2D_ARRAY, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\r\n    gl.texParameteri(gl.TEXTURE_2D_ARRAY, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\r\n    gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, true);\r\n    // Upload the images into the texture.\r\n    gl.texImage3D(\r\n      gl.TEXTURE_2D_ARRAY,\r\n      0,\r\n      gl.RGBA,\r\n      images[0].width,\r\n      images[0].height,\r\n      images.length,\r\n      0,\r\n      gl.RGBA,\r\n      gl.UNSIGNED_BYTE,\r\n      null\r\n    );\r\n    for (let i = 0; i < images.length; i++) {\r\n      const xOffset = 0;\r\n      const yOffset = 0;\r\n      const imageDepth = 1;\r\n      gl.texSubImage3D(\r\n        gl.TEXTURE_2D_ARRAY,\r\n        0,\r\n        xOffset,\r\n        yOffset,\r\n        i,\r\n        images[i].width,\r\n        images[i].height,\r\n        imageDepth,\r\n        gl.RGBA,\r\n        gl.UNSIGNED_BYTE,\r\n        this.uploadValue = images[i]\r\n      );\r\n    }\r\n    this.kernel.setUniform1i(this.id, this.index);\r\n  }\r\n}\r\n","import { WebGL2KernelValueHtmlImageArray } from './html-image-array';\r\n\r\nexport class WebGL2KernelValueDynamicHtmlImageArray extends WebGL2KernelValueHtmlImageArray {\r\n  getSource() {\r\n    const variablePrecision = this.getVariablePrecisionString();\r\n    return utils.linesToString([\r\n      `uniform ${ variablePrecision } sampler2DArray ${this.id}`,\r\n      `uniform ${ variablePrecision } ivec2 ${this.sizeId}`,\r\n      `uniform ${ variablePrecision } ivec3 ${this.dimensionsId}`,\r\n    ]);\r\n  }\r\n\r\n  updateValue(images) {\r\n    this.dimensions = [images[0].width, images[0].height, images.length];\r\n    this.textureSize = [images[0].width, images[0].height];\r\n    this.kernel.setUniform3iv(this.dimensionsId, this.dimensions);\r\n    this.kernel.setUniform2iv(this.sizeId, this.textureSize);\r\n    super.updateValue(images);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { WebGLKernelValueSingleInput } from '../../web-gl/kernel-value/single-input';\r\n\r\nexport class WebGL2KernelValueSingleInput extends WebGLKernelValueSingleInput {\r\n  getSource() {\r\n    const variablePrecision = this.getVariablePrecisionString();\r\n    return utils.linesToString([\r\n      `uniform ${ variablePrecision } sampler2D ${this.id}`,\r\n      `${ variablePrecision } ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,\r\n      `${ variablePrecision } ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`,\r\n    ]);\r\n  }\r\n\r\n  updateValue(input) {\r\n    const { context: gl } = this;\r\n    utils.flattenTo(input.value, this.uploadValue);\r\n    gl.activeTexture(this.contextHandle);\r\n    gl.bindTexture(gl.TEXTURE_2D, this.texture);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\r\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA32F, this.textureSize[0], this.textureSize[1], 0, gl.RGBA, gl.FLOAT, this.uploadValue);\r\n    this.kernel.setUniform1i(this.id, this.index);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { WebGLKernelValueDynamicMemoryOptimizedNumberTexture } from '../../web-gl/kernel-value/dynamic-memory-optimized-number-texture';\r\n\r\nexport class WebGL2KernelValueDynamicMemoryOptimizedNumberTexture extends WebGLKernelValueDynamicMemoryOptimizedNumberTexture {\r\n  getSource() {\r\n    return utils.linesToString([\r\n      `uniform sampler2D ${this.id}`,\r\n      `uniform ivec2 ${this.sizeId}`,\r\n      `uniform ivec3 ${this.dimensionsId}`,\r\n    ]);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { WebGLKernelValueNumberTexture } from '../../web-gl/kernel-value/number-texture';\r\n\r\nexport class WebGL2KernelValueNumberTexture extends WebGLKernelValueNumberTexture {\r\n  getSource() {\r\n    const variablePrecision = this.getVariablePrecisionString();\r\n    return utils.linesToString([\r\n      `uniform ${ variablePrecision } sampler2D ${this.id}`,\r\n      `${ variablePrecision } ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,\r\n      `${ variablePrecision } ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`,\r\n    ]);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { WebGLKernelValueDynamicNumberTexture } from '../../web-gl/kernel-value/dynamic-number-texture';\r\n\r\nexport class WebGL2KernelValueDynamicNumberTexture extends WebGLKernelValueDynamicNumberTexture {\r\n  getSource() {\r\n    const variablePrecision = this.getVariablePrecisionString();\r\n    return utils.linesToString([\r\n      `uniform ${ variablePrecision } sampler2D ${this.id}`,\r\n      `uniform ${ variablePrecision } ivec2 ${this.sizeId}`,\r\n      `uniform ${ variablePrecision } ivec3 ${this.dimensionsId}`,\r\n    ]);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { WebGLKernelValueSingleArray } from '../../web-gl/kernel-value/single-array';\r\n\r\nexport class WebGL2KernelValueSingleArray extends WebGLKernelValueSingleArray {\r\n  getSource() {\r\n    const variablePrecision = this.getVariablePrecisionString();\r\n    return utils.linesToString([\r\n      `uniform ${ variablePrecision } sampler2D ${this.id}`,\r\n      `${ variablePrecision } ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,\r\n      `${ variablePrecision } ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`,\r\n    ]);\r\n  }\r\n\r\n  updateValue(value) {\r\n    if (value.constructor !== this.initialValueConstructor) {\r\n      this.onUpdateValueMismatch();\r\n      return;\r\n    }\r\n    const { context: gl } = this;\r\n    utils.flattenTo(value, this.uploadValue);\r\n    gl.activeTexture(this.contextHandle);\r\n    gl.bindTexture(gl.TEXTURE_2D, this.texture);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\r\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA32F, this.textureSize[0], this.textureSize[1], 0, gl.RGBA, gl.FLOAT, this.uploadValue);\r\n    this.kernel.setUniform1i(this.id, this.index);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { WebGLKernelValueSingleArray1DI } from '../../web-gl/kernel-value/single-array1d-i';\r\n\r\nexport class WebGL2KernelValueSingleArray1DI extends WebGLKernelValueSingleArray1DI {\r\n  updateValue(value) {\r\n    if (value.constructor !== this.initialValueConstructor) {\r\n      this.onUpdateValueMismatch();\r\n      return;\r\n    }\r\n    const { context: gl } = this;\r\n    utils.flattenTo(value, this.uploadValue);\r\n    gl.activeTexture(this.contextHandle);\r\n    gl.bindTexture(gl.TEXTURE_2D, this.texture);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\r\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA32F, this.textureSize[0], this.textureSize[1], 0, gl.RGBA, gl.FLOAT, this.uploadValue);\r\n    this.kernel.setUniform1i(this.id, this.index);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { WebGL2KernelValueSingleArray1DI } from '../../web-gl2/kernel-value/single-array1d-i';\r\n\r\nexport class WebGL2KernelValueDynamicSingleArray1DI extends WebGL2KernelValueSingleArray1DI {\r\n  getSource() {\r\n    const variablePrecision = this.getVariablePrecisionString();\r\n    return utils.linesToString([\r\n      `uniform ${ variablePrecision } sampler2D ${this.id}`,\r\n      `uniform ${ variablePrecision } ivec2 ${this.sizeId}`,\r\n      `uniform ${ variablePrecision } ivec3 ${this.dimensionsId}`,\r\n    ]);\r\n  }\r\n\r\n  updateValue(value) {\r\n    this.setShape(value);\r\n    this.kernel.setUniform3iv(this.dimensionsId, this.dimensions);\r\n    this.kernel.setUniform2iv(this.sizeId, this.textureSize);\r\n    super.updateValue(value);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { WebGLKernelValueSingleArray2DI } from '../../web-gl/kernel-value/single-array2d-i';\r\n\r\nexport class WebGL2KernelValueSingleArray2DI extends WebGLKernelValueSingleArray2DI {\r\n  updateValue(value) {\r\n    if (value.constructor !== this.initialValueConstructor) {\r\n      this.onUpdateValueMismatch();\r\n      return;\r\n    }\r\n    const { context: gl } = this;\r\n    utils.flattenTo(value, this.uploadValue);\r\n    gl.activeTexture(this.contextHandle);\r\n    gl.bindTexture(gl.TEXTURE_2D, this.texture);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\r\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA32F, this.textureSize[0], this.textureSize[1], 0, gl.RGBA, gl.FLOAT, this.uploadValue);\r\n    this.kernel.setUniform1i(this.id, this.index);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { WebGL2KernelValueSingleArray2DI } from '../../web-gl2/kernel-value/single-array2d-i';\r\n\r\nexport class WebGL2KernelValueDynamicSingleArray2DI extends WebGL2KernelValueSingleArray2DI {\r\n  getSource() {\r\n    const variablePrecision = this.getVariablePrecisionString();\r\n    return utils.linesToString([\r\n      `uniform ${ variablePrecision } sampler2D ${this.id}`,\r\n      `uniform ${ variablePrecision } ivec2 ${this.sizeId}`,\r\n      `uniform ${ variablePrecision } ivec3 ${this.dimensionsId}`,\r\n    ]);\r\n  }\r\n\r\n  updateValue(value) {\r\n    this.setShape(value);\r\n    this.kernel.setUniform3iv(this.dimensionsId, this.dimensions);\r\n    this.kernel.setUniform2iv(this.sizeId, this.textureSize);\r\n    super.updateValue(value);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { WebGLKernelValueSingleArray3DI } from '../../web-gl/kernel-value/single-array3d-i';\r\n\r\nexport class WebGL2KernelValueSingleArray3DI extends WebGLKernelValueSingleArray3DI {\r\n  updateValue(value) {\r\n    if (value.constructor !== this.initialValueConstructor) {\r\n      this.onUpdateValueMismatch();\r\n      return;\r\n    }\r\n    const { context: gl } = this;\r\n    utils.flattenTo(value, this.uploadValue);\r\n    gl.activeTexture(this.contextHandle);\r\n    gl.bindTexture(gl.TEXTURE_2D, this.texture);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\r\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA32F, this.textureSize[0], this.textureSize[1], 0, gl.RGBA, gl.FLOAT, this.uploadValue);\r\n    this.kernel.setUniform1i(this.id, this.index);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { WebGL2KernelValueSingleArray3DI } from '../../web-gl2/kernel-value/single-array3d-i';\r\n\r\nexport class WebGL2KernelValueDynamicSingleArray3DI extends WebGL2KernelValueSingleArray3DI {\r\n  getSource() {\r\n    const variablePrecision = this.getVariablePrecisionString();\r\n    return utils.linesToString([\r\n      `uniform ${ variablePrecision } sampler2D ${this.id}`,\r\n      `uniform ${ variablePrecision } ivec2 ${this.sizeId}`,\r\n      `uniform ${ variablePrecision } ivec3 ${this.dimensionsId}`,\r\n    ]);\r\n  }\r\n\r\n  updateValue(value) {\r\n    this.setShape(value);\r\n    this.kernel.setUniform3iv(this.dimensionsId, this.dimensions);\r\n    this.kernel.setUniform2iv(this.sizeId, this.textureSize);\r\n    super.updateValue(value);\r\n  }\r\n}\r\n","import { WebGLKernelValueSingleArray2 } from '../../web-gl/kernel-value/single-array2';\r\n\r\nexport class WebGL2KernelValueSingleArray2 extends WebGLKernelValueSingleArray2 {}\r\n","import { WebGLKernelValueSingleArray3 } from '../../web-gl/kernel-value/single-array3';\r\n\r\nexport class WebGL2KernelValueSingleArray3 extends WebGLKernelValueSingleArray3 {}\r\n","import { WebGLKernelValueSingleArray4 } from '../../web-gl/kernel-value/single-array4';\r\n\r\nexport class WebGL2KernelValueSingleArray4 extends WebGLKernelValueSingleArray4 {}\r\n","import { WebGL2KernelValueBoolean } from './kernel-value/boolean';\r\nimport { WebGL2KernelValueFloat } from './kernel-value/float';\r\nimport { WebGL2KernelValueInteger } from './kernel-value/integer';\r\n\r\nimport { WebGL2KernelValueHTMLImage } from './kernel-value/html-image';\r\nimport { WebGL2KernelValueDynamicHTMLImage } from './kernel-value/dynamic-html-image';\r\n\r\nimport { WebGL2KernelValueHtmlImageArray } from './kernel-value/html-image-array';\r\nimport { WebGL2KernelValueDynamicHtmlImageArray } from './kernel-value/dynamic-html-image-array';\r\n\r\nimport { WebGL2KernelValueSingleInput } from './kernel-value/single-input';\r\nimport { WebGL2KernelValueDynamicSingleInput } from './kernel-value/dynamic-single-input';\r\n\r\nimport { WebGL2KernelValueUnsignedInput } from './kernel-value/unsigned-input';\r\nimport { WebGL2KernelValueDynamicUnsignedInput } from './kernel-value/dynamic-unsigned-input';\r\n\r\nimport { WebGL2KernelValueMemoryOptimizedNumberTexture } from './kernel-value/memory-optimized-number-texture';\r\nimport { WebGL2KernelValueDynamicMemoryOptimizedNumberTexture } from './kernel-value/dynamic-memory-optimized-number-texture';\r\n\r\nimport { WebGL2KernelValueNumberTexture } from './kernel-value/number-texture';\r\nimport { WebGL2KernelValueDynamicNumberTexture } from './kernel-value/dynamic-number-texture';\r\n\r\nimport { WebGL2KernelValueSingleArray } from './kernel-value/single-array';\r\nimport { WebGL2KernelValueDynamicSingleArray } from './kernel-value/dynamic-single-array';\r\n\r\nimport { WebGL2KernelValueSingleArray1DI } from './kernel-value/single-array1d-i';\r\nimport { WebGL2KernelValueDynamicSingleArray1DI } from './kernel-value/dynamic-single-array1d-i';\r\n\r\nimport { WebGL2KernelValueSingleArray2DI } from './kernel-value/single-array2d-i';\r\nimport { WebGL2KernelValueDynamicSingleArray2DI } from './kernel-value/dynamic-single-array2d-i';\r\n\r\nimport { WebGL2KernelValueSingleArray3DI } from './kernel-value/single-array3d-i';\r\nimport { WebGL2KernelValueDynamicSingleArray3DI } from './kernel-value/dynamic-single-array3d-i';\r\n\r\nimport { WebGL2KernelValueSingleArray2 } from './kernel-value/single-array2';\r\nimport { WebGL2KernelValueSingleArray3 } from './kernel-value/single-array3';\r\nimport { WebGL2KernelValueSingleArray4 } from './kernel-value/single-array4';\r\n\r\nimport { WebGL2KernelValueUnsignedArray } from './kernel-value/unsigned-array';\r\nimport { WebGL2KernelValueDynamicUnsignedArray } from './kernel-value/dynamic-unsigned-array';\r\n\r\nconst kernelValueMaps = {\r\n  unsigned: {\r\n    dynamic: {\r\n      'Boolean': WebGL2KernelValueBoolean,\r\n      'Integer': WebGL2KernelValueInteger,\r\n      'Float': WebGL2KernelValueFloat,\r\n      'Array': WebGL2KernelValueDynamicUnsignedArray,\r\n      'Array(2)': false,\r\n      'Array(3)': false,\r\n      'Array(4)': false,\r\n      'Array1D(2)': false,\r\n      'Array1D(3)': false,\r\n      'Array1D(4)': false,\r\n      'Array2D(2)': false,\r\n      'Array2D(3)': false,\r\n      'Array2D(4)': false,\r\n      'Array3D(2)': false,\r\n      'Array3D(3)': false,\r\n      'Array3D(4)': false,\r\n      'Input': WebGL2KernelValueDynamicUnsignedInput,\r\n      'NumberTexture': WebGL2KernelValueDynamicNumberTexture,\r\n      'ArrayTexture(1)': WebGL2KernelValueDynamicNumberTexture,\r\n      'ArrayTexture(2)': WebGL2KernelValueDynamicNumberTexture,\r\n      'ArrayTexture(3)': WebGL2KernelValueDynamicNumberTexture,\r\n      'ArrayTexture(4)': WebGL2KernelValueDynamicNumberTexture,\r\n      'MemoryOptimizedNumberTexture': WebGL2KernelValueDynamicMemoryOptimizedNumberTexture,\r\n      'HTMLImage': WebGL2KernelValueDynamicHTMLImage,\r\n      'HTMLImageArray': WebGL2KernelValueDynamicHtmlImageArray,\r\n    },\r\n    static: {\r\n      'Boolean': WebGL2KernelValueBoolean,\r\n      'Float': WebGL2KernelValueFloat,\r\n      'Integer': WebGL2KernelValueInteger,\r\n      'Array': WebGL2KernelValueUnsignedArray,\r\n      'Array(2)': false,\r\n      'Array(3)': false,\r\n      'Array(4)': false,\r\n      'Array1D(2)': false,\r\n      'Array1D(3)': false,\r\n      'Array1D(4)': false,\r\n      'Array2D(2)': false,\r\n      'Array2D(3)': false,\r\n      'Array2D(4)': false,\r\n      'Array3D(2)': false,\r\n      'Array3D(3)': false,\r\n      'Array3D(4)': false,\r\n      'Input': WebGL2KernelValueUnsignedInput,\r\n      'NumberTexture': WebGL2KernelValueNumberTexture,\r\n      'ArrayTexture(1)': WebGL2KernelValueNumberTexture,\r\n      'ArrayTexture(2)': WebGL2KernelValueNumberTexture,\r\n      'ArrayTexture(3)': WebGL2KernelValueNumberTexture,\r\n      'ArrayTexture(4)': WebGL2KernelValueNumberTexture,\r\n      'MemoryOptimizedNumberTexture': WebGL2KernelValueDynamicMemoryOptimizedNumberTexture,\r\n      'HTMLImage': WebGL2KernelValueHTMLImage,\r\n      'HTMLImageArray': WebGL2KernelValueHtmlImageArray,\r\n    }\r\n  },\r\n  single: {\r\n    dynamic: {\r\n      'Boolean': WebGL2KernelValueBoolean,\r\n      'Integer': WebGL2KernelValueInteger,\r\n      'Float': WebGL2KernelValueFloat,\r\n      'Array': WebGL2KernelValueDynamicSingleArray,\r\n      'Array(2)': WebGL2KernelValueSingleArray2,\r\n      'Array(3)': WebGL2KernelValueSingleArray3,\r\n      'Array(4)': WebGL2KernelValueSingleArray4,\r\n      'Array1D(2)': WebGL2KernelValueDynamicSingleArray1DI,\r\n      'Array1D(3)': WebGL2KernelValueDynamicSingleArray1DI,\r\n      'Array1D(4)': WebGL2KernelValueDynamicSingleArray1DI,\r\n      'Array2D(2)': WebGL2KernelValueDynamicSingleArray2DI,\r\n      'Array2D(3)': WebGL2KernelValueDynamicSingleArray2DI,\r\n      'Array2D(4)': WebGL2KernelValueDynamicSingleArray2DI,\r\n      'Array3D(2)': WebGL2KernelValueDynamicSingleArray3DI,\r\n      'Array3D(3)': WebGL2KernelValueDynamicSingleArray3DI,\r\n      'Array3D(4)': WebGL2KernelValueDynamicSingleArray3DI,\r\n      'Input': WebGL2KernelValueDynamicSingleInput,\r\n      'NumberTexture': WebGL2KernelValueDynamicNumberTexture,\r\n      'ArrayTexture(1)': WebGL2KernelValueDynamicNumberTexture,\r\n      'ArrayTexture(2)': WebGL2KernelValueDynamicNumberTexture,\r\n      'ArrayTexture(3)': WebGL2KernelValueDynamicNumberTexture,\r\n      'ArrayTexture(4)': WebGL2KernelValueDynamicNumberTexture,\r\n      'MemoryOptimizedNumberTexture': WebGL2KernelValueDynamicMemoryOptimizedNumberTexture,\r\n      'HTMLImage': WebGL2KernelValueDynamicHTMLImage,\r\n      'HTMLImageArray': WebGL2KernelValueDynamicHtmlImageArray,\r\n    },\r\n    static: {\r\n      'Boolean': WebGL2KernelValueBoolean,\r\n      'Float': WebGL2KernelValueFloat,\r\n      'Integer': WebGL2KernelValueInteger,\r\n      'Array': WebGL2KernelValueSingleArray,\r\n      'Array(2)': WebGL2KernelValueSingleArray2,\r\n      'Array(3)': WebGL2KernelValueSingleArray3,\r\n      'Array(4)': WebGL2KernelValueSingleArray4,\r\n      'Array1D(2)': WebGL2KernelValueSingleArray1DI,\r\n      'Array1D(3)': WebGL2KernelValueSingleArray1DI,\r\n      'Array1D(4)': WebGL2KernelValueSingleArray1DI,\r\n      'Array2D(2)': WebGL2KernelValueSingleArray2DI,\r\n      'Array2D(3)': WebGL2KernelValueSingleArray2DI,\r\n      'Array2D(4)': WebGL2KernelValueSingleArray2DI,\r\n      'Array3D(2)': WebGL2KernelValueSingleArray3DI,\r\n      'Array3D(3)': WebGL2KernelValueSingleArray3DI,\r\n      'Array3D(4)': WebGL2KernelValueSingleArray3DI,\r\n      'Input': WebGL2KernelValueSingleInput,\r\n      'NumberTexture': WebGL2KernelValueNumberTexture,\r\n      'ArrayTexture(1)': WebGL2KernelValueNumberTexture,\r\n      'ArrayTexture(2)': WebGL2KernelValueNumberTexture,\r\n      'ArrayTexture(3)': WebGL2KernelValueNumberTexture,\r\n      'ArrayTexture(4)': WebGL2KernelValueNumberTexture,\r\n      'MemoryOptimizedNumberTexture': WebGL2KernelValueMemoryOptimizedNumberTexture,\r\n      'HTMLImage': WebGL2KernelValueHTMLImage,\r\n      'HTMLImageArray': WebGL2KernelValueHtmlImageArray,\r\n    }\r\n  },\r\n};\r\n\r\nexport function lookupKernelValueType(type, dynamic, precision, value) {\r\n  if (!type) {\r\n    throw new Error('type missing');\r\n  }\r\n  if (!dynamic) {\r\n    throw new Error('dynamic missing');\r\n  }\r\n  if (!precision) {\r\n    throw new Error('precision missing');\r\n  }\r\n  if (value.type) {\r\n    type = value.type;\r\n  }\r\n  const types = kernelValueMaps[precision][dynamic];\r\n  if (types[type] === false) {\r\n    return null;\r\n  } else if (types[type] === undefined) {\r\n    throw new Error(`Could not find a KernelValue for ${ type }`);\r\n  }\r\n  return types[type];\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { WebGLKernelValueDynamicUnsignedArray } from '../../web-gl/kernel-value/dynamic-unsigned-array';\r\n\r\nexport class WebGL2KernelValueDynamicUnsignedArray extends WebGLKernelValueDynamicUnsignedArray {\r\n  getSource() {\r\n    const variablePrecision = this.getVariablePrecisionString();\r\n    return utils.linesToString([\r\n      `uniform ${ variablePrecision } sampler2D ${this.id}`,\r\n      `uniform ${ variablePrecision } ivec2 ${this.sizeId}`,\r\n      `uniform ${ variablePrecision } ivec3 ${this.dimensionsId}`,\r\n    ]);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { WebGLKernelValueDynamicUnsignedInput } from '../../web-gl/kernel-value/dynamic-unsigned-input';\r\n\r\nexport class WebGL2KernelValueDynamicUnsignedInput extends WebGLKernelValueDynamicUnsignedInput {\r\n  getSource() {\r\n    const variablePrecision = this.getVariablePrecisionString();\r\n    return utils.linesToString([\r\n      `uniform ${ variablePrecision } sampler2D ${this.id}`,\r\n      `uniform ${ variablePrecision } ivec2 ${this.sizeId}`,\r\n      `uniform ${ variablePrecision } ivec3 ${this.dimensionsId}`,\r\n    ]);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { WebGLKernelValueUnsignedArray } from '../../web-gl/kernel-value/unsigned-array';\r\n\r\nexport class WebGL2KernelValueUnsignedArray extends WebGLKernelValueUnsignedArray {\r\n  getSource() {\r\n    const variablePrecision = this.getVariablePrecisionString();\r\n    return utils.linesToString([\r\n      `uniform ${ variablePrecision } sampler2D ${this.id}`,\r\n      `${ variablePrecision } ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,\r\n      `${ variablePrecision } ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`,\r\n    ]);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { WebGLKernelValueUnsignedInput } from '../../web-gl/kernel-value/unsigned-input';\r\n\r\nexport class WebGL2KernelValueUnsignedInput extends WebGLKernelValueUnsignedInput {\r\n  getSource() {\r\n    const variablePrecision = this.getVariablePrecisionString();\r\n    return utils.linesToString([\r\n      `uniform ${ variablePrecision } sampler2D ${this.id}`,\r\n      `${ variablePrecision } ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,\r\n      `${ variablePrecision } ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`,\r\n    ]);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { WebGL2KernelValueSingleArray } from '../../web-gl2/kernel-value/single-array';\r\n\r\nexport class WebGL2KernelValueDynamicSingleArray extends WebGL2KernelValueSingleArray {\r\n  getSource() {\r\n    const variablePrecision = this.getVariablePrecisionString();\r\n    return utils.linesToString([\r\n      `uniform ${ variablePrecision } sampler2D ${this.id}`,\r\n      `uniform ${ variablePrecision } ivec2 ${this.sizeId}`,\r\n      `uniform ${ variablePrecision } ivec3 ${this.dimensionsId}`,\r\n    ]);\r\n  }\r\n\r\n  updateValue(value) {\r\n    this.dimensions = utils.getDimensions(value, true);\r\n    this.textureSize = utils.getMemoryOptimizedFloatTextureSize(this.dimensions, this.bitRatio);\r\n    this.uploadArrayLength = this.textureSize[0] * this.textureSize[1] * this.bitRatio;\r\n    this.uploadValue = new Float32Array(this.uploadArrayLength);\r\n    this.kernel.setUniform3iv(this.dimensionsId, this.dimensions);\r\n    this.kernel.setUniform2iv(this.sizeId, this.textureSize);\r\n    super.updateValue(value);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { WebGL2KernelValueSingleInput } from '../../web-gl2/kernel-value/single-input';\r\n\r\nexport class WebGL2KernelValueDynamicSingleInput extends WebGL2KernelValueSingleInput {\r\n  getSource() {\r\n    const variablePrecision = this.getVariablePrecisionString();\r\n    return utils.linesToString([\r\n      `uniform ${ variablePrecision } sampler2D ${this.id}`,\r\n      `uniform ${ variablePrecision } ivec2 ${this.sizeId}`,\r\n      `uniform ${ variablePrecision } ivec3 ${this.dimensionsId}`,\r\n    ]);\r\n  }\r\n\r\n  updateValue(value) {\r\n    let [w, h, d] = value.size;\r\n    this.dimensions = new Int32Array([w || 1, h || 1, d || 1]);\r\n    this.textureSize = utils.getMemoryOptimizedFloatTextureSize(this.dimensions, this.bitRatio);\r\n    this.uploadArrayLength = this.textureSize[0] * this.textureSize[1] * this.bitRatio;\r\n    this.uploadValue = new Float32Array(this.uploadArrayLength);\r\n    this.kernel.setUniform3iv(this.dimensionsId, this.dimensions);\r\n    this.kernel.setUniform2iv(this.sizeId, this.textureSize);\r\n    super.updateValue(value);\r\n  }\r\n}\r\n","import { utils } from '../../../utils';\r\nimport { WebGLKernelValueMemoryOptimizedNumberTexture } from '../../web-gl/kernel-value/memory-optimized-number-texture';\r\n\r\nexport class WebGL2KernelValueMemoryOptimizedNumberTexture extends WebGLKernelValueMemoryOptimizedNumberTexture {\r\n  getSource() {\r\n    const variablePrecision = this.getVariablePrecisionString();\r\n    return utils.linesToString([\r\n      `uniform sampler2D ${this.id}`,\r\n      `${ variablePrecision } ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,\r\n      `${ variablePrecision } ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`,\r\n    ]);\r\n  }\r\n}\r\n","import { WebGLKernel } from '../web-gl/kernel';\r\nimport { WebGL2FunctionNode } from './function-node';\r\nimport { FunctionBuilder } from '../function-builder';\r\nimport { utils } from '../../utils';\r\nimport { fragmentShader } from './fragment-shader';\r\nimport { vertexShader } from './vertex-shader';\r\nimport { lookupKernelValueType } from './kernel-value-maps';\r\n\r\nlet isSupported = null;\r\nlet testCanvas = null;\r\nlet testContext = null;\r\nlet testExtensions = null;\r\n\r\n/**\r\n *\r\n * @type {IKernelFeatures}\r\n */\r\nlet features = null;\r\n\r\n/**\r\n * @extends WebGLKernel\r\n */\r\nexport class WebGL2Kernel extends WebGLKernel {\r\n  static get isSupported() {\r\n    if (isSupported !== null) {\r\n      return isSupported;\r\n    }\r\n    this.setupFeatureChecks();\r\n    isSupported = this.isContextMatch(testContext);\r\n    return isSupported;\r\n  }\r\n\r\n  static setupFeatureChecks() {\r\n    if (typeof document !== 'undefined') {\r\n      testCanvas = document.createElement('canvas');\r\n    } else if (typeof OffscreenCanvas !== 'undefined') {\r\n      testCanvas = new OffscreenCanvas(0, 0);\r\n    }\r\n    if (!testCanvas) return;\r\n    testContext = testCanvas.getContext('webgl2');\r\n    if (!testContext || !testContext.getExtension) return;\r\n    testExtensions = {\r\n      EXT_color_buffer_float: testContext.getExtension('EXT_color_buffer_float'),\r\n      OES_texture_float_linear: testContext.getExtension('OES_texture_float_linear'),\r\n    };\r\n    features = this.getFeatures();\r\n  }\r\n\r\n  static isContextMatch(context) {\r\n    // from global\r\n    if (typeof WebGL2RenderingContext !== 'undefined') {\r\n      return context instanceof WebGL2RenderingContext;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  static getFeatures() {\r\n    return Object.freeze({\r\n      isFloatRead: this.getIsFloatRead(),\r\n      isIntegerDivisionAccurate: this.getIsIntegerDivisionAccurate(),\r\n      kernelMap: true,\r\n      isTextureFloat: true,\r\n      channelCount: this.getChannelCount(),\r\n    });\r\n  }\r\n\r\n  static getIsTextureFloat() {\r\n    return true;\r\n  }\r\n\r\n  static getIsIntegerDivisionAccurate() {\r\n    return super.getIsIntegerDivisionAccurate();\r\n  }\r\n\r\n  static getChannelCount() {\r\n    return testContext.getParameter(testContext.MAX_DRAW_BUFFERS);\r\n  }\r\n\r\n  static lookupKernelValueType(type, dynamic, precision, value) {\r\n    return lookupKernelValueType(type, dynamic, precision, value);\r\n  }\r\n\r\n  static get testCanvas() {\r\n    return testCanvas;\r\n  }\r\n\r\n  static get testContext() {\r\n    return testContext;\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @returns {{isFloatRead: Boolean, isIntegerDivisionAccurate: Boolean, kernelMap: Boolean, isTextureFloat: Boolean}}\r\n   */\r\n  static get features() {\r\n    return features;\r\n  }\r\n\r\n  static get fragmentShader() {\r\n    return fragmentShader;\r\n  }\r\n  static get vertexShader() {\r\n    return vertexShader;\r\n  }\r\n\r\n  initContext() {\r\n    const settings = {\r\n      alpha: false,\r\n      depth: false,\r\n      antialias: false\r\n    };\r\n    const context = this.canvas.getContext('webgl2', settings);\r\n    return context;\r\n  }\r\n\r\n  initExtensions() {\r\n    this.extensions = {\r\n      EXT_color_buffer_float: this.context.getExtension('EXT_color_buffer_float'),\r\n      OES_texture_float_linear: this.context.getExtension('OES_texture_float_linear'),\r\n    };\r\n  }\r\n\r\n  /**\r\n   * @desc Validate settings related to Kernel, such as dimensions size, and auto output support.\r\n   * @param {IArguments} args\r\n   */\r\n  validateSettings(args) {\r\n    if (!this.validate) {\r\n      this.texSize = utils.getKernelTextureSize({\r\n        optimizeFloatMemory: this.optimizeFloatMemory,\r\n        precision: this.precision,\r\n      }, this.output);\r\n      return;\r\n    }\r\n\r\n    const features = this.constructor.features;\r\n    if (this.precision === 'single' && !features.isFloatRead) {\r\n      throw new Error('Float texture outputs are not supported');\r\n    } else if (!this.graphical && this.precision === null) {\r\n      this.precision = features.isFloatRead ? 'single' : 'unsigned';\r\n    }\r\n\r\n    if (this.fixIntegerDivisionAccuracy === null) {\r\n      this.fixIntegerDivisionAccuracy = !features.isIntegerDivisionAccurate;\r\n    } else if (this.fixIntegerDivisionAccuracy && features.isIntegerDivisionAccurate) {\r\n      this.fixIntegerDivisionAccuracy = false;\r\n    }\r\n\r\n    this.checkOutput();\r\n\r\n    if (!this.output || this.output.length === 0) {\r\n      if (args.length !== 1) {\r\n        throw new Error('Auto output only supported for kernels with only one input');\r\n      }\r\n\r\n      const argType = utils.getVariableType(args[0], this.strictIntegers);\r\n      switch (argType) {\r\n        case 'Array':\r\n          this.output = utils.getDimensions(argType);\r\n          break;\r\n        case 'NumberTexture':\r\n        case 'MemoryOptimizedNumberTexture':\r\n        case 'ArrayTexture(1)':\r\n        case 'ArrayTexture(2)':\r\n        case 'ArrayTexture(3)':\r\n        case 'ArrayTexture(4)':\r\n          this.output = args[0].output;\r\n          break;\r\n        default:\r\n          throw new Error('Auto output not supported for input type: ' + argType);\r\n      }\r\n    }\r\n\r\n    if (this.graphical) {\r\n      if (this.output.length !== 2) {\r\n        throw new Error('Output must have 2 dimensions on graphical mode');\r\n      }\r\n\r\n      if (this.precision === 'single') {\r\n        console.warn('Cannot use graphical mode and single precision at the same time');\r\n        this.precision = 'unsigned';\r\n      }\r\n\r\n      this.texSize = utils.clone(this.output);\r\n      return;\r\n    } else if (!this.graphical && this.precision === null && features.isTextureFloat) {\r\n      this.precision = 'single';\r\n    }\r\n\r\n    this.texSize = utils.getKernelTextureSize({\r\n      optimizeFloatMemory: this.optimizeFloatMemory,\r\n      precision: this.precision,\r\n    }, this.output);\r\n  }\r\n\r\n  translateSource() {\r\n    const functionBuilder = FunctionBuilder.fromKernel(this, WebGL2FunctionNode, {\r\n      fixIntegerDivisionAccuracy: this.fixIntegerDivisionAccuracy\r\n    });\r\n    this.translatedSource = functionBuilder.getPrototypeString('kernel');\r\n    if (!this.graphical && !this.returnType) {\r\n      this.returnType = functionBuilder.getKernelResultType();\r\n    }\r\n\r\n    if (this.subKernels && this.subKernels.length > 0) {\r\n      for (let i = 0; i < this.subKernels.length; i++) {\r\n        const subKernel = this.subKernels[i];\r\n        if (!subKernel.returnType) {\r\n          subKernel.returnType = functionBuilder.getSubKernelResultType(i);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  run() {\r\n    const { kernelArguments, texSize } = this;\r\n    const gl = this.context;\r\n\r\n    gl.useProgram(this.program);\r\n    gl.scissor(0, 0, texSize[0], texSize[1]);\r\n\r\n    if (this.dynamicOutput) {\r\n      this.setUniform3iv('uOutputDim', new Int32Array(this.threadDim));\r\n      this.setUniform2iv('uTexSize', texSize);\r\n    }\r\n\r\n    this.setUniform2f('ratio', texSize[0] / this.maxTexSize[0], texSize[1] / this.maxTexSize[1]);\r\n\r\n    for (let i = 0; i < kernelArguments.length; i++) {\r\n      kernelArguments[i].updateValue(arguments[i]);\r\n      if (this.switchingKernels) return;\r\n    }\r\n\r\n    if (this.plugins) {\r\n      for (let i = 0; i < this.plugins.length; i++) {\r\n        const plugin = this.plugins[i];\r\n        if (plugin.onBeforeRun) {\r\n          plugin.onBeforeRun(this);\r\n        }\r\n      }\r\n    }\r\n\r\n    if (this.graphical) {\r\n      if (this.pipeline) {\r\n        gl.bindRenderbuffer(gl.RENDERBUFFER, null);\r\n        gl.bindFramebuffer(gl.FRAMEBUFFER, this.framebuffer);\r\n        if (!this.outputTexture || this.immutable) {\r\n          this._setupOutputTexture();\r\n        }\r\n        gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\r\n        return new this.TextureConstructor({\r\n          texture: this.outputTexture,\r\n          size: texSize,\r\n          dimensions: this.threadDim,\r\n          output: this.output,\r\n          context: this.context\r\n        });\r\n      }\r\n      gl.bindRenderbuffer(gl.RENDERBUFFER, null);\r\n      gl.bindFramebuffer(gl.FRAMEBUFFER, null);\r\n      gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\r\n      return;\r\n    }\r\n\r\n    gl.bindFramebuffer(gl.FRAMEBUFFER, this.framebuffer);\r\n    if (this.immutable) {\r\n      this._setupOutputTexture();\r\n    }\r\n\r\n    if (this.subKernels !== null) {\r\n      if (this.immutable) {\r\n        this._setupSubOutputTextures();\r\n      }\r\n      gl.drawBuffers(this.drawBuffersMap);\r\n    }\r\n\r\n    gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\r\n  }\r\n\r\n  drawBuffers() {\r\n    this.context.drawBuffers(this.drawBuffersMap);\r\n  }\r\n\r\n  getOutputTexture() {\r\n    return this.outputTexture;\r\n  }\r\n\r\n  _setupOutputTexture() {\r\n    const { texSize } = this;\r\n    const gl = this.context;\r\n    const texture = this.outputTexture = gl.createTexture();\r\n    gl.activeTexture(gl.TEXTURE0 + this.constantTextureCount + this.argumentTextureCount);\r\n    gl.bindTexture(gl.TEXTURE_2D, texture);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\r\n    if (this.precision === 'single') {\r\n      if (this.pipeline) {\r\n        switch (this.returnType) {\r\n          case 'Number':\r\n          case 'Float':\r\n          case 'Integer':\r\n            if (this.optimizeFloatMemory) {\r\n              gl.texStorage2D(gl.TEXTURE_2D, 1, gl.RGBA32F, texSize[0], texSize[1]);\r\n            } else {\r\n              gl.texStorage2D(gl.TEXTURE_2D, 1, gl.R32F, texSize[0], texSize[1]);\r\n            }\r\n            break;\r\n          case 'Array(2)':\r\n            gl.texStorage2D(gl.TEXTURE_2D, 1, gl.RG32F, texSize[0], texSize[1]);\r\n            break;\r\n          case 'Array(3)': // there is _no_ 3 channel format which is guaranteed to be color-renderable\r\n          case 'Array(4)':\r\n            gl.texStorage2D(gl.TEXTURE_2D, 1, gl.RGBA32F, texSize[0], texSize[1]);\r\n            break;\r\n          default:\r\n            throw new Error('Unhandled return type');\r\n        }\r\n      } else {\r\n        gl.texStorage2D(gl.TEXTURE_2D, 1, gl.RGBA32F, texSize[0], texSize[1]);\r\n      }\r\n    } else {\r\n      gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, texSize[0], texSize[1], 0, gl.RGBA, gl.UNSIGNED_BYTE, null);\r\n    }\r\n    gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, texture, 0);\r\n  }\r\n\r\n  _setupSubOutputTextures() {\r\n    const { texSize } = this;\r\n    const gl = this.context;\r\n    this.drawBuffersMap = [gl.COLOR_ATTACHMENT0];\r\n    this.subKernelOutputTextures = [];\r\n    for (let i = 0; i < this.subKernels.length; i++) {\r\n      const texture = this.context.createTexture();\r\n      this.subKernelOutputTextures.push(texture);\r\n      this.drawBuffersMap.push(gl.COLOR_ATTACHMENT0 + i + 1);\r\n      gl.activeTexture(gl.TEXTURE0 + this.constantTextureCount + this.argumentTextureCount + i);\r\n      gl.bindTexture(gl.TEXTURE_2D, texture);\r\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\r\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\r\n      // TODO: upgrade this\r\n      if (this.precision === 'single') {\r\n        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA32F, texSize[0], texSize[1], 0, gl.RGBA, gl.FLOAT, null);\r\n      } else {\r\n        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, texSize[0], texSize[1], 0, gl.RGBA, gl.UNSIGNED_BYTE, null);\r\n      }\r\n      gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0 + i + 1, gl.TEXTURE_2D, texture, 0);\r\n    }\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @desc Get the header string for the program.\r\n   * This returns an empty string if no sub-kernels are defined.\r\n   *\r\n   * @returns {String} result\r\n   */\r\n  _getHeaderString() {\r\n    return '';\r\n  }\r\n\r\n  /**\r\n   * @desc Get texture coordinate string for the program\r\n   * @returns {String} result\r\n   */\r\n  _getTextureCoordinate() {\r\n    const subKernels = this.subKernels;\r\n    if (subKernels === null || subKernels.length < 1) {\r\n      switch (this.tactic) {\r\n        case 'speed':\r\n          return 'in lowp vec2 vTexCoord;\\n';\r\n        case 'performance':\r\n          return 'in highp vec2 vTexCoord;\\n';\r\n        case 'balanced':\r\n        default:\r\n          return 'in mediump vec2 vTexCoord;\\n';\r\n      }\r\n    } else {\r\n      switch (this.tactic) {\r\n        case 'speed':\r\n          return 'out lowp vec2 vTexCoord;\\n';\r\n        case 'performance':\r\n          return 'out highp vec2 vTexCoord;\\n';\r\n        case 'balanced':\r\n        default:\r\n          return 'out mediump vec2 vTexCoord;\\n';\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @desc Generate transpiled glsl Strings for user-defined parameters sent to a kernel\r\n   * @param {Array} args - The actual parameters sent to the Kernel\r\n   * @returns {String} result\r\n   */\r\n  _getMainArgumentsString(args) {\r\n    const result = [];\r\n    const argumentNames = this.argumentNames;\r\n    for (let i = 0; i < argumentNames.length; i++) {\r\n      result.push(this.kernelArguments[i].getSource(args[i]));\r\n    }\r\n    return result.join('');\r\n  }\r\n\r\n  /**\r\n   * @desc Get Kernel program string (in *glsl*) for a kernel.\r\n   * @returns {String} result\r\n   */\r\n  getKernelString() {\r\n    let kernelResultDeclaration;\r\n    switch (this.returnType) {\r\n      case 'Array(2)':\r\n        kernelResultDeclaration = 'vec2 kernelResult';\r\n        break;\r\n      case 'Array(3)':\r\n        kernelResultDeclaration = 'vec3 kernelResult';\r\n        break;\r\n      case 'Array(4)':\r\n        kernelResultDeclaration = 'vec4 kernelResult';\r\n        break;\r\n      case 'LiteralInteger':\r\n      case 'Float':\r\n      case 'Number':\r\n      case 'Integer':\r\n        kernelResultDeclaration = 'float kernelResult';\r\n        break;\r\n      default:\r\n        if (this.graphical) {\r\n          kernelResultDeclaration = 'float kernelResult';\r\n        } else {\r\n          throw new Error(`unrecognized output type \"${ this.returnType }\"`);\r\n        }\r\n    }\r\n\r\n    const result = [];\r\n    const subKernels = this.subKernels;\r\n    if (subKernels !== null) {\r\n      result.push(\r\n        kernelResultDeclaration,\r\n        'layout(location = 0) out vec4 data0'\r\n      );\r\n      for (let i = 0; i < subKernels.length; i++) {\r\n        const subKernel = subKernels[i];\r\n        result.push(\r\n          subKernel.returnType === 'Integer' ?\r\n          `int subKernelResult_${ subKernel.name } = 0` :\r\n          `float subKernelResult_${ subKernel.name } = 0.0`,\r\n          `layout(location = ${ i + 1 }) out vec4 data${ i + 1 }`\r\n        );\r\n      }\r\n    } else {\r\n      result.push(\r\n        'out vec4 data0',\r\n        kernelResultDeclaration\r\n      );\r\n    }\r\n\r\n    return utils.linesToString(result) + this.translatedSource;\r\n  }\r\n\r\n  getMainResultGraphical() {\r\n    return utils.linesToString([\r\n      '  threadId = indexTo3D(index, uOutputDim)',\r\n      '  kernel()',\r\n      '  data0 = actualColor',\r\n    ]);\r\n  }\r\n\r\n  getMainResultPackedPixels() {\r\n    switch (this.returnType) {\r\n      case 'LiteralInteger':\r\n      case 'Number':\r\n      case 'Integer':\r\n      case 'Float':\r\n        return this.getMainResultKernelPackedPixels() +\r\n          this.getMainResultSubKernelPackedPixels();\r\n      default:\r\n        throw new Error(`packed output only usable with Numbers, \"${this.returnType}\" specified`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @return {String}\r\n   */\r\n  getMainResultKernelPackedPixels() {\r\n    return utils.linesToString([\r\n      '  threadId = indexTo3D(index, uOutputDim)',\r\n      '  kernel()',\r\n      `  data0 = ${this.useLegacyEncoder ? 'legacyEncode32' : 'encode32'}(kernelResult)`\r\n    ]);\r\n  }\r\n\r\n  /**\r\n   * @return {String}\r\n   */\r\n  getMainResultSubKernelPackedPixels() {\r\n    const result = [];\r\n    if (!this.subKernels) return '';\r\n    for (let i = 0; i < this.subKernels.length; i++) {\r\n      const subKernel = this.subKernels[i];\r\n      if (subKernel.returnType === 'Integer') {\r\n        result.push(\r\n          `  data${i + 1} = ${this.useLegacyEncoder ? 'legacyEncode32' : 'encode32'}(float(subKernelResult_${this.subKernels[i].name}))`\r\n        );\r\n      } else {\r\n        result.push(\r\n          `  data${i + 1} = ${this.useLegacyEncoder ? 'legacyEncode32' : 'encode32'}(subKernelResult_${this.subKernels[i].name})`\r\n        );\r\n      }\r\n    }\r\n    return utils.linesToString(result);\r\n  }\r\n\r\n  getMainResultMemoryOptimizedFloats() {\r\n    const result = [\r\n      '  index *= 4',\r\n    ];\r\n\r\n    switch (this.returnType) {\r\n      case 'Number':\r\n      case 'Integer':\r\n      case 'Float':\r\n        const channels = ['r', 'g', 'b', 'a'];\r\n        for (let i = 0; i < channels.length; i++) {\r\n          const channel = channels[i];\r\n          this.getMainResultKernelMemoryOptimizedFloats(result, channel);\r\n          this.getMainResultSubKernelMemoryOptimizedFloats(result, channel);\r\n          if (i + 1 < channels.length) {\r\n            result.push('  index += 1');\r\n          }\r\n        }\r\n        break;\r\n      default:\r\n        throw new Error(`optimized output only usable with Numbers, ${this.returnType} specified`);\r\n    }\r\n\r\n    return utils.linesToString(result);\r\n  }\r\n\r\n  getMainResultKernelMemoryOptimizedFloats(result, channel) {\r\n    result.push(\r\n      '  threadId = indexTo3D(index, uOutputDim)',\r\n      '  kernel()',\r\n      `  data0.${channel} = kernelResult`,\r\n    );\r\n  }\r\n\r\n  getMainResultSubKernelMemoryOptimizedFloats(result, channel) {\r\n    if (!this.subKernels) return result;\r\n    for (let i = 0; i < this.subKernels.length; i++) {\r\n      const subKernel = this.subKernels[i];\r\n      if (subKernel.returnType === 'Integer') {\r\n        result.push(\r\n          `  data${i + 1}.${channel} = float(subKernelResult_${subKernel.name})`,\r\n        );\r\n      } else {\r\n        result.push(\r\n          `  data${i + 1}.${channel} = subKernelResult_${subKernel.name}`,\r\n        );\r\n      }\r\n    }\r\n  }\r\n\r\n  getMainResultKernelNumberTexture() {\r\n    return [\r\n      '  threadId = indexTo3D(index, uOutputDim)',\r\n      '  kernel()',\r\n      '  data0[0] = kernelResult',\r\n    ];\r\n  }\r\n\r\n  getMainResultSubKernelNumberTexture() {\r\n    const result = [];\r\n    if (!this.subKernels) return result;\r\n    for (let i = 0; i < this.subKernels.length; ++i) {\r\n      const subKernel = this.subKernels[i];\r\n      if (subKernel.returnType === 'Integer') {\r\n        result.push(\r\n          `  data${i + 1}[0] = float(subKernelResult_${subKernel.name})`,\r\n        );\r\n      } else {\r\n        result.push(\r\n          `  data${i + 1}[0] = subKernelResult_${subKernel.name}`,\r\n        );\r\n      }\r\n    }\r\n    return result;\r\n  }\r\n\r\n  getMainResultKernelArray2Texture() {\r\n    return [\r\n      '  threadId = indexTo3D(index, uOutputDim)',\r\n      '  kernel()',\r\n      '  data0[0] = kernelResult[0]',\r\n      '  data0[1] = kernelResult[1]',\r\n    ];\r\n  }\r\n\r\n  getMainResultSubKernelArray2Texture() {\r\n    const result = [];\r\n    if (!this.subKernels) return result;\r\n    for (let i = 0; i < this.subKernels.length; ++i) {\r\n      const subKernel = this.subKernels[i];\r\n      result.push(\r\n        `  data${i + 1}[0] = subKernelResult_${subKernel.name}[0]`,\r\n        `  data${i + 1}[1] = subKernelResult_${subKernel.name}[1]`,\r\n      );\r\n    }\r\n    return result;\r\n  }\r\n\r\n  getMainResultKernelArray3Texture() {\r\n    return [\r\n      '  threadId = indexTo3D(index, uOutputDim)',\r\n      '  kernel()',\r\n      '  data0[0] = kernelResult[0]',\r\n      '  data0[1] = kernelResult[1]',\r\n      '  data0[2] = kernelResult[2]',\r\n    ];\r\n  }\r\n\r\n  getMainResultSubKernelArray3Texture() {\r\n    const result = [];\r\n    if (!this.subKernels) return result;\r\n    for (let i = 0; i < this.subKernels.length; ++i) {\r\n      const subKernel = this.subKernels[i];\r\n      result.push(\r\n        `  data${i + 1}[0] = subKernelResult_${subKernel.name}[0]`,\r\n        `  data${i + 1}[1] = subKernelResult_${subKernel.name}[1]`,\r\n        `  data${i + 1}[2] = subKernelResult_${subKernel.name}[2]`,\r\n      );\r\n    }\r\n    return result;\r\n  }\r\n\r\n  getMainResultKernelArray4Texture() {\r\n    return [\r\n      '  threadId = indexTo3D(index, uOutputDim)',\r\n      '  kernel()',\r\n      '  data0 = kernelResult',\r\n    ];\r\n  }\r\n\r\n  getMainResultSubKernelArray4Texture() {\r\n    const result = [];\r\n    if (!this.subKernels) return result;\r\n    for (let i = 0; i < this.subKernels.length; ++i) {\r\n      result.push(\r\n        `  data${i + 1} = subKernelResult_${this.subKernels[i].name}`,\r\n      );\r\n    }\r\n    return result;\r\n  }\r\n\r\n  destroyExtensions() {\r\n    this.extensions.EXT_color_buffer_float = null;\r\n    this.extensions.OES_texture_float_linear = null;\r\n  }\r\n\r\n  toJSON() {\r\n    const json = super.toJSON();\r\n    json.functionNodes = FunctionBuilder.fromKernel(this, WebGL2FunctionNode).toJSON();\r\n    return json;\r\n  }\r\n}\r\n","import { utils } from './utils';\r\n\r\n/**\r\n * Makes kernels easier for mortals (including me)\r\n * @param kernel\r\n * @returns {function()}\r\n */\r\nexport function kernelRunShortcut(kernel) {\r\n  let run = function() {\r\n    kernel.build.apply(kernel, arguments);\r\n    if (kernel.renderKernels) {\r\n      run = function() {\r\n        kernel.run.apply(kernel, arguments);\r\n        if (kernel.switchingKernels) {\r\n          kernel.switchingKernels = false;\r\n          return kernel.onRequestSwitchKernel(arguments, kernel);\r\n        }\r\n        return kernel.renderKernels();\r\n      };\r\n    } else if (kernel.renderOutput) {\r\n      run = function() {\r\n        kernel.run.apply(kernel, arguments);\r\n        if (kernel.switchingKernels) {\r\n          kernel.switchingKernels = false;\r\n          return kernel.onRequestSwitchKernel(arguments, kernel);\r\n        }\r\n        return kernel.renderOutput();\r\n      };\r\n    } else {\r\n      run = function() {\r\n        return kernel.run.apply(kernel, arguments);\r\n      };\r\n    }\r\n    return run.apply(kernel, arguments);\r\n  };\r\n  const shortcut = function() {\r\n    return run.apply(kernel, arguments);\r\n  };\r\n  /**\r\n   * Run kernel in async mode\r\n   * @returns {Promise<KernelOutput>}\r\n   */\r\n  shortcut.exec = function() {\r\n    return new Promise((accept, reject) => {\r\n      try {\r\n        accept(run.apply(this, arguments));\r\n      } catch (e) {\r\n        reject(e);\r\n      }\r\n    });\r\n  };\r\n  shortcut.replaceKernel = function(replacementKernel) {\r\n    kernel = replacementKernel;\r\n    bindKernelToShortcut(kernel, shortcut);\r\n    shortcut.kernel = kernel;\r\n  };\r\n\r\n  bindKernelToShortcut(kernel, shortcut);\r\n  shortcut.kernel = kernel;\r\n  return shortcut;\r\n}\r\n\r\nfunction bindKernelToShortcut(kernel, shortcut) {\r\n  const properties = utils.allPropertiesOf(kernel);\r\n  for (let i = 0; i < properties.length; i++) {\r\n    const property = properties[i];\r\n    if (property[0] === '_' && property[1] === '_') continue;\r\n    if (typeof kernel[property] === 'function') {\r\n      if (property.substring(0, 3) === 'add' || property.substring(0, 3) === 'set') {\r\n        shortcut[property] = function() {\r\n          kernel[property].apply(kernel, arguments);\r\n          return shortcut;\r\n        };\r\n      } else {\r\n        if (property === 'toString') {\r\n          shortcut.toString = function() {\r\n            return kernel.toString.apply(kernel, arguments);\r\n          };\r\n        } else {\r\n          shortcut[property] = kernel[property].bind(kernel);\r\n        }\r\n      }\r\n    } else {\r\n      shortcut.__defineGetter__(property, () => {\r\n        return kernel[property];\r\n      });\r\n      shortcut.__defineSetter__(property, (value) => {\r\n        kernel[property] = value;\r\n      });\r\n    }\r\n  }\r\n}\r\n","import { gpuMock } from 'gpu-mock.js';\r\nimport { CPUKernel } from './backend/cpu/kernel';\r\nimport { WebGL2Kernel } from './backend/web-gl2/kernel';\r\nimport { WebGLKernel } from './backend/web-gl/kernel';\r\nimport { kernelRunShortcut } from './kernel-run-shortcut';\r\nimport {\r\n  functionToIFunction,\r\n  getFunctionNameFromString,\r\n  isFunction,\r\n  warnDeprecated\r\n} from './common';\r\nimport { getVariableType } from './utils';\r\n\r\n/**\r\n * @type {Kernel[]}\r\n */\r\nconst kernelOrder = [ WebGL2Kernel, WebGLKernel ];\r\n\r\n/**\r\n * @type {string[]}\r\n */\r\nconst kernelTypes = [ 'gpu', 'cpu' ];\r\n\r\nconst internalKernels = {\r\n  'webgl2': WebGL2Kernel,\r\n  'webgl': WebGLKernel,\r\n};\r\n\r\nlet validate = true;\r\n\r\n/**\r\n * The GPU.js library class which manages the GPU context for the creating kernels\r\n */\r\nexport class GPU {\r\n  static disableValidation() {\r\n    validate = false;\r\n  }\r\n\r\n  static enableValidation() {\r\n    validate = true;\r\n  }\r\n\r\n  static get isGPUSupported() {\r\n    return kernelOrder.some(Kernel => Kernel.isSupported);\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @returns {boolean}\r\n   */\r\n  static get isKernelMapSupported() {\r\n    return kernelOrder.some(Kernel => Kernel.isSupported && Kernel.features.kernelMap);\r\n  }\r\n\r\n  /**\r\n   * @desc TRUE is platform supports OffscreenCanvas\r\n   */\r\n  static get isOffscreenCanvasSupported() {\r\n    return (typeof Worker !== 'undefined' && typeof OffscreenCanvas !== 'undefined') || typeof importScripts !== 'undefined';\r\n  }\r\n\r\n  /**\r\n   * @desc TRUE if platform supports WebGL\r\n   */\r\n  static get isWebGLSupported() {\r\n    return WebGLKernel.isSupported;\r\n  }\r\n\r\n  /**\r\n   * @desc TRUE if platform supports WebGL2\r\n   */\r\n  static get isWebGL2Supported() {\r\n    return WebGL2Kernel.isSupported;\r\n  }\r\n\r\n  /**\r\n   * @desc TRUE if platform supports HeadlessGL\r\n   */\r\n  static get isHeadlessGLSupported() {\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @desc TRUE if platform supports Canvas\r\n   */\r\n  static get isCanvasSupported() {\r\n    return typeof HTMLCanvasElement !== 'undefined';\r\n  }\r\n\r\n  /**\r\n   * @desc TRUE if platform supports HTMLImageArray}\r\n   */\r\n  static get isGPUHTMLImageArraySupported() {\r\n    return WebGL2Kernel.isSupported;\r\n  }\r\n\r\n  /**\r\n   * @desc TRUE if platform supports single precision}\r\n   * @returns {boolean}\r\n   */\r\n  static get isSinglePrecisionSupported() {\r\n    return kernelOrder.some(Kernel => Kernel.isSupported && Kernel.features.isFloatRead && Kernel.features.isTextureFloat);\r\n  }\r\n\r\n  /**\r\n   * Creates an instance of GPU.\r\n   * @param {IGPUSettings} [settings] - Settings to set mode, and other properties\r\n   */\r\n  constructor(settings) {\r\n    settings = settings || {};\r\n    this.canvas = settings.canvas || null;\r\n    this.context = settings.context || null;\r\n    this.mode = settings.mode;\r\n    this.Kernel = null;\r\n    this.kernels = [];\r\n    this.functions = [];\r\n    this.nativeFunctions = [];\r\n    if (this.mode === 'dev') return;\r\n    this.chooseKernel();\r\n    // add functions from settings\r\n    if (settings.functions) {\r\n      for (let i = 0; i < settings.functions.length; i++) {\r\n        this.addFunction(settings.functions[i]);\r\n      }\r\n    }\r\n\r\n    // add native functions from settings\r\n    if (settings.nativeFunctions) {\r\n      for (const p in settings.nativeFunctions) {\r\n        this.addNativeFunction(p, settings.nativeFunctions[p]);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Choose kernel type and save on .Kernel property of GPU\r\n   */\r\n  chooseKernel() {\r\n    if (this.Kernel) return;\r\n\r\n    let Kernel = null;\r\n\r\n    if (this.context) {\r\n      for (let i = 0; i < kernelOrder.length; i++) {\r\n        const ExternalKernel = kernelOrder[i];\r\n        if (ExternalKernel.isContextMatch(this.context)) {\r\n          if (!ExternalKernel.isSupported) {\r\n            throw new Error(`Kernel type ${ExternalKernel.name} not supported`);\r\n          }\r\n          Kernel = ExternalKernel;\r\n          break;\r\n        }\r\n      }\r\n      if (Kernel === null) {\r\n        throw new Error('unknown Context');\r\n      }\r\n    } else if (this.mode) {\r\n      if (this.mode in internalKernels) {\r\n        if (!validate || internalKernels[this.mode].isSupported) {\r\n          Kernel = internalKernels[this.mode];\r\n        }\r\n      } else if (this.mode === 'gpu') {\r\n        for (let i = 0; i < kernelOrder.length; i++) {\r\n          if (kernelOrder[i].isSupported) {\r\n            Kernel = kernelOrder[i];\r\n            break;\r\n          }\r\n        }\r\n      } else if (this.mode === 'cpu') {\r\n        Kernel = CPUKernel;\r\n      }\r\n      if (!Kernel) {\r\n        throw new Error(`A requested mode of \"${this.mode}\" and is not supported`);\r\n      }\r\n    } else {\r\n      for (let i = 0; i < kernelOrder.length; i++) {\r\n        if (kernelOrder[i].isSupported) {\r\n          Kernel = kernelOrder[i];\r\n          break;\r\n        }\r\n      }\r\n      if (!Kernel) {\r\n        Kernel = CPUKernel;\r\n      }\r\n    }\r\n\r\n    if (!this.mode) {\r\n      this.mode = Kernel.mode;\r\n    }\r\n    this.Kernel = Kernel;\r\n  }\r\n\r\n  /**\r\n   * @desc This creates a callable function object to call the kernel function with the argument parameter set\r\n   * @param {Function|String|object} source - The calling to perform the conversion\r\n   * @param {Object} [settings] - The parameter configuration object\r\n   * @return {Kernel} callable function to run\r\n   */\r\n  createKernel(source, settings) {\r\n    if (typeof source === 'undefined') {\r\n      throw new Error('Missing source parameter');\r\n    }\r\n    if (typeof source !== 'object' && !isFunction(source) && typeof source !== 'string') {\r\n      throw new Error('source parameter not a function');\r\n    }\r\n\r\n    if (this.mode === 'dev') {\r\n      const devKernel = gpuMock(source, upgradeDeprecatedCreateKernelSettings(settings));\r\n      this.kernels.push(devKernel);\r\n      return devKernel;\r\n    }\r\n\r\n    source = typeof source === 'function' ? source.toString() : source;\r\n    const switchableKernels = {};\r\n    const settingsCopy = upgradeDeprecatedCreateKernelSettings(settings) || {};\r\n    // handle conversion of argumentTypes\r\n    if (settings && typeof settings.argumentTypes === 'object') {\r\n      settingsCopy.argumentTypes = Object.keys(settings.argumentTypes).map(argumentName => settings.argumentTypes[argumentName]);\r\n    }\r\n\r\n    function onRequestFallback(args) {\r\n      const fallbackKernel = new CPUKernel(source, {\r\n        argumentTypes: kernelRun.argumentTypes,\r\n        constantTypes: kernelRun.constantTypes,\r\n        graphical: kernelRun.graphical,\r\n        loopMaxIterations: kernelRun.loopMaxIterations,\r\n        constants: kernelRun.constants,\r\n        dynamicOutput: kernelRun.dynamicOutput,\r\n        dynamicArgument: kernelRun.dynamicArguments,\r\n        output: kernelRun.output,\r\n        precision: kernelRun.precision,\r\n        pipeline: kernelRun.pipeline,\r\n        immutable: kernelRun.immutable,\r\n        optimizeFloatMemory: kernelRun.optimizeFloatMemory,\r\n        fixIntegerDivisionAccuracy: kernelRun.fixIntegerDivisionAccuracy,\r\n        functions: kernelRun.functions,\r\n        nativeFunctions: kernelRun.nativeFunctions,\r\n        subKernels: kernelRun.subKernels,\r\n        strictIntegers: kernelRun.strictIntegers,\r\n        debug: kernelRun.debug,\r\n        warnVarUsage: kernelRun.warnVarUsage,\r\n      });\r\n      fallbackKernel.build.apply(fallbackKernel, args);\r\n      const result = fallbackKernel.run.apply(fallbackKernel, args);\r\n      kernelRun.replaceKernel(fallbackKernel);\r\n      return result;\r\n    }\r\n\r\n    function onRequestSwitchKernel(args, kernel) {\r\n      const argumentTypes = new Array(args.length);\r\n      for (let i = 0; i < args.length; i++) {\r\n        const arg = args[i];\r\n        const type = kernel.argumentTypes[i];\r\n        if (arg.type) {\r\n          argumentTypes[i] = arg.type;\r\n        } else {\r\n          switch (type) {\r\n            case 'Number':\r\n            case 'Integer':\r\n            case 'Float':\r\n            case 'ArrayTexture(1)':\r\n              argumentTypes[i] = getVariableType(arg);\r\n              break;\r\n            default:\r\n              argumentTypes[i] = type;\r\n          }\r\n        }\r\n      }\r\n      const signature = argumentTypes.join(',');\r\n      const existingKernel = switchableKernels[signature];\r\n      if (existingKernel) {\r\n        existingKernel.run.apply(existingKernel, args);\r\n        if (existingKernel.renderKernels) {\r\n          return existingKernel.renderKernels();\r\n        } else {\r\n          return existingKernel.renderOutput();\r\n        }\r\n      }\r\n\r\n      const newKernel = switchableKernels[signature] = new kernel.constructor(source, {\r\n        argumentTypes,\r\n        constantTypes: kernel.constantTypes,\r\n        graphical: kernel.graphical,\r\n        loopMaxIterations: kernel.loopMaxIterations,\r\n        constants: kernel.constants,\r\n        dynamicOutput: kernel.dynamicOutput,\r\n        dynamicArgument: kernel.dynamicArguments,\r\n        context: kernel.context,\r\n        canvas: kernel.canvas,\r\n        output: kernel.output,\r\n        precision: kernel.precision,\r\n        pipeline: kernel.pipeline,\r\n        immutable: kernel.immutable,\r\n        optimizeFloatMemory: kernel.optimizeFloatMemory,\r\n        fixIntegerDivisionAccuracy: kernel.fixIntegerDivisionAccuracy,\r\n        functions: kernel.functions,\r\n        nativeFunctions: kernel.nativeFunctions,\r\n        subKernels: kernel.subKernels,\r\n        strictIntegers: kernel.strictIntegers,\r\n        debug: kernel.debug,\r\n        gpu: kernel.gpu,\r\n        validate,\r\n        warnVarUsage: kernel.warnVarUsage,\r\n        returnType: kernel.returnType,\r\n        onRequestFallback,\r\n        onRequestSwitchKernel,\r\n      });\r\n      newKernel.build.apply(newKernel, args);\r\n      newKernel.run.apply(newKernel, args);\r\n      kernelRun.replaceKernel(newKernel);\r\n      if (newKernel.renderKernels) {\r\n        return newKernel.renderKernels();\r\n      } else {\r\n        return newKernel.renderOutput();\r\n      }\r\n    }\r\n    const mergedSettings = Object.assign({\r\n      context: this.context,\r\n      canvas: this.canvas,\r\n      functions: this.functions,\r\n      nativeFunctions: this.nativeFunctions,\r\n      gpu: this,\r\n      validate,\r\n      onRequestFallback,\r\n      onRequestSwitchKernel\r\n    }, settingsCopy);\r\n\r\n    const kernelRun = kernelRunShortcut(new this.Kernel(source, mergedSettings));\r\n\r\n    //if canvas didn't come from this, propagate from kernel\r\n    if (!this.canvas) {\r\n      this.canvas = kernelRun.canvas;\r\n    }\r\n\r\n    //if context didn't come from this, propagate from kernel\r\n    if (!this.context) {\r\n      this.context = kernelRun.context;\r\n    }\r\n\r\n    this.kernels.push(kernelRun);\r\n\r\n    return kernelRun;\r\n  }\r\n\r\n  /**\r\n   *\r\n   * Create a super kernel which executes sub kernels\r\n   * and saves their output to be used with the next sub kernel.\r\n   * This can be useful if we want to save the output on one kernel,\r\n   * and then use it as an input to another kernel. *Machine Learning*\r\n   *\r\n   * @param {Object|Array} subKernels - Sub kernels for this kernel\r\n   * @param {Function} rootKernel - Root kernel\r\n   *\r\n   * @returns {Function} callable kernel function\r\n   *\r\n   * @example\r\n   * const megaKernel = gpu.createKernelMap({\r\n   *   addResult: function add(a, b) {\r\n   *     return a[this.thread.x] + b[this.thread.x];\r\n   *   },\r\n   *   multiplyResult: function multiply(a, b) {\r\n   *     return a[this.thread.x] * b[this.thread.x];\r\n   *   },\r\n   *  }, function(a, b, c) {\r\n   *       return multiply(add(a, b), c);\r\n   * });\r\n   *\r\n   * megaKernel(a, b, c);\r\n   *\r\n   * Note: You can also define subKernels as an array of functions.\r\n   * > [add, multiply]\r\n   *\r\n   */\r\n  createKernelMap() {\r\n    let fn;\r\n    let settings;\r\n    if (typeof arguments[arguments.length - 2] === 'function') {\r\n      fn = arguments[arguments.length - 2];\r\n      settings = arguments[arguments.length - 1];\r\n    } else {\r\n      fn = arguments[arguments.length - 1];\r\n    }\r\n\r\n    if (this.mode !== 'dev') {\r\n      if (!this.Kernel.isSupported || !this.Kernel.features.kernelMap) {\r\n        if (this.mode && kernelTypes.indexOf(this.mode) < 0) {\r\n          throw new Error(`kernelMap not supported on ${this.Kernel.name}`);\r\n        }\r\n      }\r\n    }\r\n\r\n    const settingsCopy = upgradeDeprecatedCreateKernelSettings(settings);\r\n    // handle conversion of argumentTypes\r\n    if (settings && typeof settings.argumentTypes === 'object') {\r\n      settingsCopy.argumentTypes = Object.keys(settings.argumentTypes).map(argumentName => settings.argumentTypes[argumentName]);\r\n    }\r\n\r\n    if (Array.isArray(arguments[0])) {\r\n      settingsCopy.subKernels = [];\r\n      const functions = arguments[0];\r\n      for (let i = 0; i < functions.length; i++) {\r\n        const source = functions[i].toString();\r\n        const name = getFunctionNameFromString(source);\r\n        settingsCopy.subKernels.push({\r\n          name,\r\n          source,\r\n          property: i,\r\n        });\r\n      }\r\n    } else {\r\n      settingsCopy.subKernels = [];\r\n      const functions = arguments[0];\r\n      for (let p in functions) {\r\n        if (!functions.hasOwnProperty(p)) continue;\r\n        const source = functions[p].toString();\r\n        const name = getFunctionNameFromString(source);\r\n        settingsCopy.subKernels.push({\r\n          name: name || p,\r\n          source,\r\n          property: p,\r\n        });\r\n      }\r\n    }\r\n    const kernel = this.createKernel(fn, settingsCopy);\r\n\r\n    return kernel;\r\n  }\r\n\r\n  /**\r\n   *\r\n   * Combine different kernels into one super Kernel,\r\n   * useful to perform multiple operations inside one\r\n   * kernel without the penalty of data transfer between\r\n   * cpu and gpu.\r\n   *\r\n   * The number of kernel functions sent to this method can be variable.\r\n   * You can send in one, two, etc.\r\n   *\r\n   * @param {Function} subKernels - Kernel function(s) to combine.\r\n   * @param {Function} rootKernel - Root kernel to combine kernels into\r\n   *\r\n   * @example\r\n   *   combineKernels(add, multiply, function(a,b,c){\r\n   *     return add(multiply(a,b), c)\r\n   *  })\r\n   *\r\n   * @returns {Function} Callable kernel function\r\n   *\r\n   */\r\n  combineKernels() {\r\n    const firstKernel = arguments[0];\r\n    const combinedKernel = arguments[arguments.length - 1];\r\n    if (firstKernel.kernel.constructor.mode === 'cpu') return combinedKernel;\r\n    const canvas = arguments[0].canvas;\r\n    const context = arguments[0].context;\r\n    const max = arguments.length - 1;\r\n    for (let i = 0; i < max; i++) {\r\n      arguments[i]\r\n        .setCanvas(canvas)\r\n        .setContext(context)\r\n        .setPipeline(true);\r\n    }\r\n\r\n    return function() {\r\n      const texture = combinedKernel.apply(this, arguments);\r\n      if (texture.toArray) {\r\n        return texture.toArray();\r\n      }\r\n      return texture;\r\n    };\r\n  }\r\n\r\n  /**\r\n   * @desc Adds additional functions, that the kernel may call.\r\n   * @param {Function|String} source - Javascript function to convert\r\n   * @param {IFunctionSettings} [settings]\r\n   * @returns {GPU} returns itself\r\n   */\r\n  addFunction(source, settings) {\r\n    this.functions.push(functionToIFunction(source, settings));\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * @desc Adds additional native functions, that the kernel may call.\r\n   * @param {String} name - native function name, used for reverse lookup\r\n   * @param {String} source - the native function implementation, as it would be defined in it's entirety\r\n   * @param {object} [settings]\r\n   * @returns {GPU} returns itself\r\n   */\r\n  addNativeFunction(name, source, settings) {\r\n    if (this.kernels.length > 0) {\r\n      throw new Error('Cannot call \"addNativeFunction\" after \"createKernels\" has been called.');\r\n    }\r\n    settings = settings || {};\r\n    const { argumentTypes, argumentNames } = this.Kernel.nativeFunctionArguments(source) || {};\r\n    this.nativeFunctions.push({\r\n      name,\r\n      source,\r\n      settings,\r\n      argumentTypes,\r\n      argumentNames,\r\n      returnType: settings.returnType || this.Kernel.nativeFunctionReturnType(source),\r\n    });\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * @desc Destroys all memory associated with gpu.js & the webGl if we created it\r\n   */\r\n  destroy() {\r\n    if (!this.kernels) return;\r\n    // perform on next run loop - for some reason we dont get lose context events\r\n    // if webGl is created and destroyed in the same run loop.\r\n    setTimeout(() => {\r\n      for (let i = 0; i < this.kernels.length; i++) {\r\n        this.kernels[i].destroy(true); // remove canvas if exists\r\n      }\r\n      // all kernels are associated with one context, go ahead and take care of it here\r\n      let firstKernel = this.kernels[0];\r\n      if (firstKernel) {\r\n        // if it is shortcut\r\n        if (firstKernel.kernel) {\r\n          firstKernel = firstKernel.kernel;\r\n        }\r\n        if (firstKernel.constructor.destroyContext) {\r\n          firstKernel.constructor.destroyContext(this.context);\r\n        }\r\n      }\r\n    }, 0);\r\n  }\r\n}\r\n\r\nfunction upgradeDeprecatedCreateKernelSettings(settings) {\r\n  if (!settings) {\r\n    return {};\r\n  }\r\n  const upgradedSettings = Object.assign({}, settings);\r\n\r\n  if (settings.hasOwnProperty('floatOutput')) {\r\n    warnDeprecated('setting', 'floatOutput', 'precision');\r\n    upgradedSettings.precision = settings.floatOutput ? 'single' : 'unsigned';\r\n  }\r\n  if (settings.hasOwnProperty('outputToTexture')) {\r\n    warnDeprecated('setting', 'outputToTexture', 'pipeline');\r\n    upgradedSettings.pipeline = Boolean(settings.outputToTexture);\r\n  }\r\n  if (settings.hasOwnProperty('outputImmutable')) {\r\n    warnDeprecated('setting', 'outputImmutable', 'immutable');\r\n    upgradedSettings.immutable = Boolean(settings.outputImmutable);\r\n  }\r\n  if (settings.hasOwnProperty('floatTextures')) {\r\n    warnDeprecated('setting', 'floatTextures', 'optimizeFloatMemory');\r\n    upgradedSettings.optimizeFloatMemory = Boolean(settings.floatTextures);\r\n  }\r\n  return upgradedSettings;\r\n}\r\n","import { GPU } from './base-gpu';\r\nimport { alias } from './alias';\r\nimport { utils } from './utils';\r\nimport * as common from './common';\r\nimport { Input, input } from './input';\r\nimport { Texture } from './texture';\r\nimport { FunctionBuilder } from './backend/function-builder';\r\nimport { FunctionNode } from './backend/function-node';\r\nimport { CPUFunctionNode } from './backend/cpu/function-node';\r\nimport { CPUKernel } from './backend/cpu/kernel';\r\nimport { WebGLFunctionNode } from './backend/web-gl/function-node';\r\nimport { WebGLKernel } from './backend/web-gl/kernel';\r\nimport { WebGL2FunctionNode } from './backend/web-gl2/function-node';\r\nimport { WebGL2Kernel } from './backend/web-gl2/kernel';\r\nimport { GLKernel } from './backend/gl/kernel';\r\nimport { Kernel } from './backend/kernel';\r\n\r\nconst lib = GPU;\r\nlib.alias = alias;\r\nlib.CPUFunctionNode = CPUFunctionNode;\r\nlib.CPUKernel = CPUKernel;\r\nlib.FunctionBuilder = FunctionBuilder;\r\nlib.FunctionNode = FunctionNode;\r\nlib.Input = Input;\r\nlib.input = input;\r\nlib.Texture = Texture;\r\nlib.utils = { ...common, ...utils };\r\nlib.WebGL2FunctionNode = WebGL2FunctionNode;\r\nlib.WebGL2Kernel = WebGL2Kernel;\r\nlib.WebGLFunctionNode = WebGLFunctionNode;\r\nlib.WebGLKernel = WebGLKernel;\r\nlib.GLKernel = GLKernel;\r\nlib.Kernel = Kernel;\r\n\r\nexport default lib;\r\n","import { utils } from './utils';\r\n\r\n/**\r\n * @param name\r\n * @param source\r\n * @returns {Function}\r\n */\r\nexport function alias(name, source) {\r\n  const fnString = source.toString();\r\n  return new Function(`return function ${ name } (${ utils.getArgumentNamesFromString(fnString).join(', ') }) {\r\n  ${ utils.getFunctionBodyFromString(fnString) }\r\n}`)();\r\n}\r\n"],"names":["setupArguments","args","newArguments","Array","length","i","arg","toArray","mock1D","arguments","row","Float32Array","this","output","x","thread","y","z","_fn","apply","mock2D","matrix","mock2DGraphical","mock3D","cube","apiDecorate","kernel","setOutput","setupOutput","graphical","setupGraphical","toJSON","Error","setConstants","flag","constants","setGraphical","setCanvas","canvas","setContext","context","exec","Promise","resolve","reject","e","getPixels","flip","pixels","width","height","halfHeight","bytesPerRow","temp","Uint8ClampedArray","result","slice","topOffset","bottomOffset","set","subarray","copyWithin","flipPixels","_imageData","data","color","r","g","b","a","Math","floor","index","_colorData","setWarnVarUsage","setOptimizeFloatMemory","setArgumentTypes","setDebug","setLoopMaxIterations","setPipeline","setPrecision","setImmutable","setFunctions","addSubKernel","destroy","validateSettings","createImageData","fn","settings","ARGUMENT_NAMES","FUNCTION_NAME","STRIP_COMMENTS","isFunction","funcObj","getFunctionNameFromString","funcStr","trim","functionToIFunction","source","sourceString","toString","argumentTypes","isArray","getArgumentNamesFromString","map","name","returnType","warnDeprecated","type","oldName","newName","msg","console","warn","isFunctionString","toLowerCase","fnStr","replace","indexOf","match","array","isNaN","erectMemoryOptimized2DFloat","yResults","offset","erectMemoryOptimized3DFloat","depth","zResults","getAstString","ast","lines","split","start","loc","end","line","push","substring","column","join","Input","[object Object]","value","size","Int32Array","w","h","d","Texture","texture","dimensions","constructor","deleteTexture","getSystemEndianness","ArrayBuffer","Uint32Array","c","Uint8Array","_systemEndianness","getVariableType","strictIntegers","nodeName","Boolean","Number","isInteger","hasOwnProperty","utils","systemEndianness","getFunctionBodyFromString","lastIndexOf","obj","key","Object","prototype","call","isActiveClone","clone","texelCount","optimizeFloatMemory","precision","ceil","closestSquareDimensions","sqrt","high","low","bitRatio","roundTo","n","pad","ret","dim","reverse","from","target","l","flatten4dArrayTo","flatten3dArrayTo","flatten2dArrayTo","part","buffer","byteOffset","props","getOwnPropertyNames","getPrototypeOf","linesToString","erectPackedFloat","erect2DPackedFloat","xStart","xEnd","erect3DPackedFloat","erectMemoryOptimizedFloat","erectFloat","xResults","erect2DFloat","erect3DFloat","erectArray2","xResultsMax","erect2DArray2","XResultsMax","erect3DArray2","erectArray3","erect2DArray3","erect3DArray3","erectArray4","erect2DArray4","erect3DArray4","flattenFunctionToString","findDependency","thisLookup","doNotDefine","flattened","parse","functionDependencies","flatten","results","body","id","params","declarations","init","properties","declaration","test","lookups","lookup","property","kind","callee","object","foundSource","argument","left","operator","right","prefix","expression","raw","computed","update","consequent","elements","alternate","flattenedFunctionDependencies","functionDependency","Kernel","isSupported","useLegacyEncoder","fallbackRequested","onRequestFallback","argumentNames","argumentSizes","argumentBitRatios","kernelArguments","kernelConstants","debug","loopMaxIterations","constantTypes","constantBitRatios","dynamicArguments","dynamicOutput","checkContext","gpu","functions","nativeFunctions","subKernels","validate","immutable","pipeline","tactic","plugins","leadingReturnStatement","followingReturnStatement","fixIntegerDivisionAccuracy","warnVarUsage","p","initCanvas","initContext","initPlugins","argType","getBitRatio","needsConstantTypes","max","setDynamicOutput","setDynamicArguments","argumentIndex","subKernel","removeCanvasReferences","Int8Array","Uint16Array","Int16Array","threadDim","argumentsTypes","pluginNames","plugin","FunctionBuilder","FunctionNode","extraNodeOptions","kernelConstant","needsArgumentType","functionName","functionBuilder","assignArgumentType","lookupReturnType","requestingNode","lookupFunctionArgumentTypes","lookupFunctionArgumentName","lookupFunctionArgumentBitRatio","argumentName","triggerImplyArgumentType","argumentType","triggerTrackArgumentSynonym","calleeFunctionName","trackArgumentSynonym","lookupArgumentSynonym","originFunctionName","onFunctionCall","trackFunctionCall","nodeOptions","assign","isRootKernel","onNestedFunction","nestedFunction","traceFunctionAST","addFunctionNode","rootNodeOptions","functionNodes","fromJSON","rootNode","subKernelNodes","isSubKernel","functionMap","nativeFunctionNames","lookupChain","argumentChain","functionNodeDependencies","functionCalls","nativeFunction","functionNode","retList","functionIndex","calledFunctions","traceFunctionCalls","dependantFunctionName","splice","getPrototypes","getPrototypesFromFunctionNames","keys","functionList","node","nativeIndex","jsonFunctionNodes","jsonFunctionNode","getStringFromFunctionNames","_isNativeFunction","_lookupNativeFunctionReturnType","_isFunction","_getFunction","j","getType","pop","getJsAST","_getNativeFunction","argumentSynonym","synonymIndex","fnNode","calleeArgumentName","synonymUseIndex","Set","add","subKernelNode","called","functionCallIndex","list","FunctionTracer","runningContexts","contexts","identifiers","returnStatements","inLoopInit","scan","currentContext","run","newContext","origin","forceInteger","assignable","discriminant","cases","states","strictTypingChecking","literalTypes","_string","_internalVariableNames","state","astMemberExpressionUnroll","firstExpression","expressions","astErrorOutput","inParser","parser","freeze","locations","functionAST","dependencies","getDependencies","valueType","realType","isSafe","isSafeDependencies","identifier","getDeclaration","typeLookupMap","constantName","astGeneric","literalKey","isAstMathFunction","inferArgumentTypesIfNeeded","isState","rightType","lastType","isAstVariable","getVariableSignature","findIdentifierOrigin","getLookupType","getConstantType","isAstMathVariable","lastReturn","findLastReturn","every","dependency","isNotSafe","Infinity","details","getMemberExpressionDetails","signature","xProperty","yProperty","zProperty","unshift","signatureString","retArr","astFunctionDeclaration","astFunctionExpression","astReturnStatement","astLiteral","astBinaryExpression","astIdentifierExpression","astAssignmentExpression","astExpressionStatement","astEmptyStatement","astBlockStatement","astIfStatement","astSwitchStatement","astBreakStatement","astContinueStatement","astForStatement","astWhileStatement","astDoWhileStatement","astVariableDeclaration","astVariableDeclarator","astThisExpression","astSequenceExpression","astUnaryExpression","astUpdateExpression","astLogicalExpression","astMemberExpression","astCallExpression","astArrayExpression","astDebuggerStatement","astConditionalExpression","error","debugString","splitLines","substr","lineBefore","arrNode","isChildFunction","astFunction","esNode","eNode","brNode","crNode","varDecNode","firstDeclaration","markupType","typeMap","iVarDecNode","sNode","uNode","checkAndUpconvertBitwiseUnary","logNode","variableSignature","astToFind","stack","atNode","shift","Float","Integer","Array(2)","Array(3)","Array(4)","Array2D","Array3D","HTMLImage","HTMLImageArray","NumberTexture","MemoryOptimizedNumberTexture","Array1D(2)","Array1D(3)","Array1D(4)","Array2D(2)","Array2D(3)","Array2D(4)","Array3D(2)","Array3D(3)","Array3D(4)","ArrayTexture(1)","ArrayTexture(2)","ArrayTexture(3)","ArrayTexture(4)","CPUFunctionNode","idtNode","getKernelArgumentName","forNode","initArr","testArr","updateArr","bodyArr","pushState","includes","popState","iVariableName","getInternalVariableName","whileNode","doWhileNode","assNode","bNode","varWarn","ifNode","tNode","mNode","synonymName","markupName","isInput","constant","targetTypes","arrLen","subNode","CPUKernel","features","kernelMap","isIntegerDivisionAccurate","mode","combinedKernel","super","mergeSettings","_kernelString","translatedSources","document","createElement","OffscreenCanvas","getContext","getDimensions","checkOutput","fromKernel","getKernelResultType","setupConstants","translateSource","kernelString","getKernelString","log","Function","bind","kernelThreadString","filter","_getLoopMaxString","_processConstants","_processArguments","_graphicalKernelBody","_resultKernelBody","cpuKernel","header","thisProperties","beforeReturn","useFunctionKeyword","JSON","stringify","constantsToString","colorFn","propertyName","getPixelsFn","constantKeys","flattenedImageTo3DArray","_imageTo3DArray","flattenedImageTo2DArray","_imageTo2DArray","cpuKernelString","parseInt","variableName","image","ctx","drawImage","pixelsData","getImageData","imageArray","pixel","images","imagesArray","_resultKernel1DLoop","_kernelOutput","_resultKernel2DLoop","_resultKernel3DLoop","_graphicalKernel2DLoop","_graphicalOutput","constructorString","_getKernelResultTypeConstructorString","_mapSubKernels","removeCanvasReference","json","GLTextureFloat","gl","framebuffer","createFramebuffer","bindFramebuffer","FRAMEBUFFER","framebufferTexture2D","COLOR_ATTACHMENT0","TEXTURE_2D","readPixels","RGBA","FLOAT","renderRawOutput","renderValues","GLTextureArray2Float","GLTextureArray2Float2D","GLTextureArray2Float3D","GLTextureArray3Float","GLTextureArray3Float2D","GLTextureArray3Float3D","GLTextureArray4Float","GLTextureArray4Float2D","GLTextureArray4Float3D","GLTextureFloat2D","GLTextureFloat3D","GLTextureMemoryOptimized","GLTextureMemoryOptimized2D","GLTextureMemoryOptimized3D","GLTextureUnsigned","UNSIGNED_BYTE","GLTextureUnsigned2D","GLTextureUnsigned3D","GLTextureGraphical","GLKernel","testContext","testCanvas","build","renderOutput","v1","v2","fix","floatTextures","isStartingVariableName","isVariableChar","char","nextChar","lastKernel","texSize","bytes","splitArray","transferValues","formatValues","TextureConstructor","translatedSource","renderStrategy","compiledFragmentShader","compiledVertexShader","readPackedPixelsToUint8Array","readPackedPixelsToFloat32Array","renderTexture","renderKernels","renderKernelsToTextures","PackedPixelTo3DFloat","PackedPixelTo2DFloat","PackedPixelToFloat","requestFallback","renderKernelsToArrays","readFloatPixelsToFloat32Array","FloatTexture","MemoryOptimizedFloatPixelToMemoryOptimized3DFloat","MemoryOptimizedFloatPixelToMemoryOptimized2DFloat","MemoryOptimizedFloatPixelToMemoryOptimizedFloat","FloatPixelTo3DArray2","FloatPixelTo2DArray2","FloatPixelToArray2","FloatPixelTo3DArray3","FloatPixelTo2DArray3","FloatPixelToArray3","FloatPixelTo3DArray4","FloatPixelTo2DArray4","FloatPixelToArray4","FloatPixelTo3DFloat","FloatPixelTo2DFloat","FloatPixelToFloat","getMainResultNumberTexture","getMainResultArray2Texture","getMainResultArray3Texture","getMainResultArray4Texture","getMainResultGraphical","getMainResultMemoryOptimizedFloats","getMainResultTexture","getMainResultPackedPixels","getMainResultKernelNumberTexture","getMainResultSubKernelNumberTexture","getMainResultKernelArray2Texture","getMainResultSubKernelArray2Texture","getMainResultKernelArray3Texture","getMainResultSubKernelArray3Texture","getMainResultKernelArray4Texture","getMainResultSubKernelArray4Texture","outputTexture","subKernelOutputTextures","program","getKernelTextureSize","updateMaxTexSize","viewport","maxTexSize","_setupOutputTexture","_setupSubOutputTextures","PackedPixelToUint8Array","Symbol","PackedTexture","FloatPixelToFloat32Array","int","float","vec2","vec3","vec4","WebGLFunctionNode","castLiteralToFloat","castValueToInteger","castLiteralToInteger","round","checkAndUpconvertOperator","castValueToFloat","leftType","operatorMap","literalResult","bitwiseResult","checkAndUpconvertBitwiseOperators","foundOperator","%","**","&","|","^","<<",">>",">>>","~","userArgumentName","inForLoopInit","info","actualType","declarationResult","varName","fallingThrough","defaultResult","movingDefaultToEnd","pastFirstIf","memberExpressionPropertyMarkup","memberExpressionXYZ","isMathFunction","functionMatch","functionReplace","targetType","LiteralInteger","===","!==","onBeforeRun","setUniform1f","random","functionReturnType","fragmentShader","vertexShader","glWiretap","options","contextName","throwGetError","useTrackablePrimitives","readPixelsFile","recording","variables","onReadPixels","onUnrecognizedArgumentLookup","proxy","Proxy","get","addComment","checkThrowError","readPixelsVariableName","insertVariable","reset","setIndent","getContextVariableName","indent","getError","contextVariables","extension","getExtension","tappedExtension","glExtensionWiretap","getEntity","targetVariableName","getVariableName","argumentAsStrings","writePPM","argumentsToString","addVariable","drawBuffers","methodCallToString","trackablePrimitive","entityNames","imageCount","spaces","repeat","sourceVariable","imageVariable","method","getExtensionEntity","drawBuffersWEBGL","extensionEntityNames","hasLines","hasSingleQuotes","hasDoubleQuotes","instantiationString","argumentToString","module","window","toStringWithoutUtils","glKernelString","originKernel","setupContextString","destroyContextString","postResult","targetName","subKernelsResultVariableSetup","subKernelsResultIndex","getRenderString","variable","uploadValue","upgradedArguments","forEach","kernelArgument","imageIndex","flattenTo","getStringValueHandler","textureName","getToArrayString","subKernelResult","subKernelTextureName","getGetPixelsString","constantsUpload","readBackValue","kernelResult","KernelValue","onRequestContextHandle","onUpdateValueMismatch","contextHandle","WebGLKernelValue","dimensionsId","sizeId","initialValueConstructor","onRequestTexture","onRequestIndex","textureSize","setupTexture","getTransferArrayType","Float64Array","Type","valuesFlat","WebGLKernelValueBoolean","setUniform1i","WebGLKernelValueFloat","WebGLKernelValueInteger","WebGLKernelValueHTMLImage","requestTexture","inputImage","activeTexture","bindTexture","texParameteri","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","TEXTURE_MIN_FILTER","NEAREST","TEXTURE_MAG_FILTER","pixelStorei","UNPACK_FLIP_Y_WEBGL","texImage2D","WebGLKernelValueDynamicHTMLImage","setUniform3iv","setUniform2iv","updateValue","WebGLKernelValueSingleInput","getMemoryOptimizedFloatTextureSize","uploadArrayLength","input","WebGLKernelValueUnsignedInput","getMemoryOptimizedPackedTextureSize","TranserArrayType","preUploadValue","WebGLKernelValueDynamicUnsignedInput","WebGLKernelValueMemoryOptimizedNumberTexture","inputTexture","WebGLKernelValueDynamicMemoryOptimizedNumberTexture","WebGLKernelValueNumberTexture","WebGLKernelValueDynamicNumberTexture","WebGLKernelValueSingleArray","WebGLKernelValueDynamicSingleArray","WebGLKernelValueSingleArray1DI","setShape","valueDimensions","WebGLKernelValueDynamicSingleArray1DI","WebGLKernelValueSingleArray2DI","WebGLKernelValueDynamicSingleArray2DI","WebGLKernelValueSingleArray3DI","WebGLKernelValueDynamicSingleArray3DI","WebGLKernelValueSingleArray2","setUniform2fv","WebGLKernelValueSingleArray3","setUniform3fv","WebGLKernelValueSingleArray4","setUniform4fv","WebGLKernelValueUnsignedArray","WebGLKernelValueDynamicUnsignedArray","kernelValueMaps","unsigned","dynamic","static","single","testExtensions","triangleNoise","canvases","maxTexSizes","WebGLKernel","setupFeatureChecks","isContextMatch","OES_texture_float","OES_texture_float_linear","OES_element_index_uint","WEBGL_draw_buffers","getFeatures","WebGLRenderingContext","isDrawBuffers","getIsDrawBuffers","isFloatRead","getIsFloatRead","getIsIntegerDivisionAccurate","isTextureFloat","getIsTextureFloat","channelCount","getChannelCount","getParameter","MAX_DRAW_BUFFERS_WEBGL","types","undefined","lookupKernelValueType","endianness","extensions","argumentTextureCount","constantTextureCount","fragShader","vertShader","drawBuffersMap","switchingKernels","onRequestSwitchKernel","textureCache","programUniformLocationCache","uniform1fCache","uniform1iCache","uniform2fCache","uniform2fvCache","uniform2ivCache","uniform3fvCache","uniform3ivCache","uniform4fvCache","uniform4ivCache","alpha","antialias","pluginsToUse","some","pluginName","WEBGL_color_buffer_float","canvasIndex","getPrototypeString","requiredChannels","returnTypes","getReturnTypes","needsArgumentTypes","textureIndexes","createTexture","TEXTURE0","kernelValue","initExtensions","failureResult","pickRenderStrategy","enable","SCISSOR_TEST","getVertexShader","createShader","VERTEX_SHADER","shaderSource","compileShader","getFragmentShader","FRAGMENT_SHADER","getShaderParameter","COMPILE_STATUS","getShaderInfoLog","createProgram","attachShader","linkProgram","vertices","texCoords","texCoordOffset","byteLength","bindBuffer","ARRAY_BUFFER","createBuffer","bufferData","STATIC_DRAW","bufferSubData","aPosLoc","getAttribLocation","enableVertexAttribArray","vertexAttribPointer","aTexCoordLoc","useProgram","getSubKernelResultType","scissor","setUniform2f","bindRenderbuffer","RENDERBUFFER","drawArrays","TRIANGLE_STRIP","getTextureCache","getUniformLocation","uniform1f","uniform1i","value1","value2","cache","uniform2f","uniform2fv","uniform2iv","uniform3fv","uniform3iv","uniform4iv","uniform4fv","HEADER","_getHeaderString","LOOP_MAX","PLUGINS","_getPluginsString","CONSTANTS","_getConstantsString","DECODE32_ENDIANNESS","_getDecode32EndiannessString","ENCODE32_ENDIANNESS","_getEncode32EndiannessString","DIVIDE_WITH_INTEGER_CHECK","_getDivideWithIntegerCheckString","MAIN_CONSTANTS","_getMainConstantsString","MAIN_ARGUMENTS","_getMainArgumentsString","KERNEL","MAIN_RESULT","getMainResultString","FLOAT_TACTIC_DECLARATION","getFloatTacticDeclaration","INT_TACTIC_DECLARATION","getIntTacticDeclaration","SAMPLER_2D_TACTIC_DECLARATION","getSampler2DTacticDeclaration","SAMPLER_2D_ARRAY_TACTIC_DECLARATION","getSampler2DArrayTacticDeclaration","getSource","kernelResultDeclaration","getMainResultKernelPackedPixels","getMainResultSubKernelPackedPixels","channels","channel","getMainResultKernelMemoryOptimizedFloats","getMainResultSubKernelMemoryOptimizedFloats","src","artifact","replaceArtifacts","_getFragShaderArtifactMap","_getVertShaderArtifactMap","deleteBuffer","deleteFramebuffer","deleteShader","deleteProgram","idx","destroyExtensions","loseContext","WebGL2FunctionNode","WebGL2KernelValueBoolean","WebGL2KernelValueFloat","WebGL2KernelValueInteger","variablePrecision","getVariablePrecisionString","WebGL2KernelValueHTMLImage","WebGL2KernelValueDynamicHTMLImage","WebGL2KernelValueHtmlImageArray","TEXTURE_2D_ARRAY","texImage3D","xOffset","yOffset","imageDepth","texSubImage3D","WebGL2KernelValueDynamicHtmlImageArray","WebGL2KernelValueSingleInput","RGBA32F","WebGL2KernelValueDynamicMemoryOptimizedNumberTexture","WebGL2KernelValueNumberTexture","WebGL2KernelValueDynamicNumberTexture","WebGL2KernelValueSingleArray","WebGL2KernelValueSingleArray1DI","WebGL2KernelValueDynamicSingleArray1DI","WebGL2KernelValueSingleArray2DI","WebGL2KernelValueDynamicSingleArray2DI","WebGL2KernelValueSingleArray3DI","WebGL2KernelValueDynamicSingleArray3DI","WebGL2KernelValueSingleArray2","WebGL2KernelValueSingleArray3","WebGL2KernelValueSingleArray4","WebGL2Kernel","EXT_color_buffer_float","WebGL2RenderingContext","MAX_DRAW_BUFFERS","texStorage2D","R32F","RG32F","bindKernelToShortcut","shortcut","allPropertiesOf","__defineGetter__","__defineSetter__","kernelOrder","kernelTypes","internalKernels","webgl2","webgl","upgradeDeprecatedCreateKernelSettings","upgradedSettings","floatOutput","outputToTexture","outputImmutable","lib","isGPUSupported","isKernelMapSupported","isOffscreenCanvasSupported","Worker","importScripts","isWebGLSupported","isWebGL2Supported","isHeadlessGLSupported","isCanvasSupported","HTMLCanvasElement","isGPUHTMLImageArraySupported","isSinglePrecisionSupported","kernels","chooseKernel","addFunction","addNativeFunction","ExternalKernel","devKernel","gpuMock","switchableKernels","settingsCopy","fallbackKernel","kernelRun","dynamicArgument","replaceKernel","mergedSettings","existingKernel","newKernel","accept","replacementKernel","kernelRunShortcut","createKernel","firstKernel","nativeFunctionArguments","nativeFunctionReturnType","setTimeout","destroyContext","alias","fnString","common"],"mappings":"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"}